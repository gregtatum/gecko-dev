

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Partner attribution &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Version Control in CI" href="versioncontrol.html" />
    <link rel="prev" title="Partner repacks" href="partner-repacks.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TaskCluster Task-Graph Generation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="taskgraph.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mach.html">Taskcluster Mach commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading.html">Loading Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="transforms.html">Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker-images.html">Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="cron.html">Periodic Taskgraphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="try.html">Try</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="release-promotion.html">Release Promotion</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="release-promotion.html#release-promotion-phases">Release Promotion Phases</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="release-promotion.html#in-depth-relpro-guide">In-depth relpro guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="release-promotion-action.html">Release Promotion Action</a></li>
<li class="toctree-l4"><a class="reference internal" href="balrog.html">Balrog in Release Promotion</a></li>
<li class="toctree-l4"><a class="reference internal" href="setting-up-an-update-server.html">Setting Up An Update Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="partials.html">Partial Update Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="signing.html">Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="partner-repacks.html">Partner repacks</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Partner attribution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="versioncontrol.html">Version Control in CI</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Taskcluster Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-tos.html">How Tos</a></li>
<li class="toctree-l2"><a class="reference internal" href="task-graph.html">Task Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">TaskCluster Task-Graph Generation</a> &raquo;</li>
        
          <li><a href="release-promotion.html">Release Promotion</a> &raquo;</li>
        
      <li>Partner attribution</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/taskcluster/partner-attribution.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="partner-attribution">
<h1>Partner attribution<a class="headerlink" href="#partner-attribution" title="Permalink to this headline">¶</a></h1>
<p id="id1">In contrast to <a class="reference internal" href="partner-repacks.html#partner-repacks"><span class="std std-ref">Partner repacks</span></a>, attributed builds only differ from the normal Firefox
builds by the adding a string in the dummy windows signing certificate. We support doing this for
full installers but not stub. The parameters of the string are carried into the telemetry system,
tagging an install into a cohort of users. This a lighter weight process because we don’t
repackage or re-sign the builds.</p>
<div class="section" id="parameters-scheduling">
<h2>Parameters &amp; Scheduling<a class="headerlink" href="#parameters-scheduling" title="Permalink to this headline">¶</a></h2>
<p>Partner attribution uses a number of parameters to control how they work:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">release_enable_partner_attribution</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">release_partner_config</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">release_partner_build_number</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">release_partners</span></code></p></li>
</ul>
<p>The enable parameter is a boolean, a simple on/off switch. We set it in shipit’s
<a class="reference external" href="https://github.com/mozilla-releng/shipit/blob/main/api/src/shipit_api/admin/release.py#L93">is_partner_enabled()</a> when starting a
release. It’s true for Firefox betas &gt;= b8 and releases, but otherwise false, the same as
partner repacks.</p>
<p><code class="docutils literal notranslate"><span class="pre">release_partner_config</span></code> is a dictionary of configuration data which drives the task generation
logic. It’s usually looked up during the release promotion action task, using the Github
GraphQL API in the <a class="reference external" href="python/taskgraph.util.html#taskgraph.util.partners.get_partner_config_by_url">get_partner_config_by_url()</a> function, with the
url defined in <a class="reference external" href="https://searchfox.org/mozilla-central/search?q=partner-urls&amp;path=taskcluster%2Fci%2Fconfig.yml&amp;case=true&amp;regexp=false&amp;redirect=true">taskcluster/ci/config.yml</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">release_partner_build_number</span></code> is an integer used to create unique upload paths in the firefox
candidates directory, while <code class="docutils literal notranslate"><span class="pre">release_partners</span></code> is a list of partners that should be
attributed (i.e. a subset of the whole config). Both are intended for use when respinning a partner after
the regular Firefox has shipped. More information on that can be found in the
<a class="reference external" href="https://moz-releng-docs.readthedocs.io/en/latest/procedures/misc-operations/off-cycle-partner-repacks-and-funnelcake.html">RelEng Docs</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">release_partners</span></code> is shared with partner repacks but we don’t support doing both at the same time.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>This is done using an <code class="docutils literal notranslate"><span class="pre">attribution_config.yml</span></code> file which next lives to the <code class="docutils literal notranslate"><span class="pre">default.xml</span></code> used
for partner repacks. There are no repos for each partner, the whole configuration exists in the one
file because the amount of information to be tracked is much smaller.</p>
<p>An example config looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">defaults</span><span class="p">:</span>
    <span class="nt">medium</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">distribution</span>
    <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mozilla</span>
<span class="nt">configs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span>   <span class="nt">campaign</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sample</span>
        <span class="nt">content</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sample-001</span>
        <span class="nt">locales</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">en-US</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">de</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ru</span>
        <span class="nt">platforms</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">win64-shippable</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">win32-shippable</span>
        <span class="nt">upload_to_candidates</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>The four main parameters are <code class="docutils literal notranslate"><span class="pre">medium,</span> <span class="pre">source,</span> <span class="pre">campaign,</span> <span class="pre">content</span></code>, of which the first two are
common to all attributions. The combination of <code class="docutils literal notranslate"><span class="pre">campaign</span></code> and <code class="docutils literal notranslate"><span class="pre">content</span></code> should be unique
to avoid confusion in telemetry data. They correspond to the repo name and sub-directory in partner repacks,
so avoid any overlap between values in partner repacks and atrribution.
The optional parameters of <code class="docutils literal notranslate"><span class="pre">variation</span></code>, and <code class="docutils literal notranslate"><span class="pre">experiment</span></code> may also be specified.</p>
<p>Non-empty lists of locales and platforms are required parameters (NB the <cite>-shippable</cite> suffix should be used on
the platforms).</p>
<p><code class="docutils literal notranslate"><span class="pre">upload_to_candidates</span></code> is an optional setting which controls whether the Firefox installers
are uploaded into the <a class="reference external" href="https://archive.mozilla.org/pub/firefox/candidates/">candidates directory</a>.
If not set the files are uploaded to the private S3 bucket for partner builds.</p>
</div>
<div class="section" id="repacking-process">
<h2>Repacking process<a class="headerlink" href="#repacking-process" title="Permalink to this headline">¶</a></h2>
<p>Attribution only has two kinds:</p>
<ul class="simple">
<li><p>attribution - add attribution code to the regular builds</p></li>
<li><p>beetmover - move the files to a partner-specific destination</p></li>
</ul>
<div class="section" id="attribution">
<h3>Attribution<a class="headerlink" href="#attribution" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-partner-attribution</span></code></p></li>
<li><p>platforms: Any Windows, runs on linux</p></li>
<li><p>upstreams: <code class="docutils literal notranslate"><span class="pre">repackage-signing</span></code> <code class="docutils literal notranslate"><span class="pre">repackage-signing-l10n</span></code></p></li>
</ul>
<p>There is one task, calling out to <a class="reference external" href="https://hg.mozilla.org/releases/mozilla-release/file/default/python/mozrelease/mozrelease/partner_attribution.py">python/mozrelease/mozrelease/partner_attribution.py</a>.</p>
<p>It takes as input the repackage-signing and repackage-signing-l10n artifacts, which are all
target.exe full installers. The <code class="docutils literal notranslate"><span class="pre">ATTRIBUTION_CONFIG</span></code> environment variable controls the script.
It produces more target.exe installers.</p>
<p>The size of <code class="docutils literal notranslate"><span class="pre">ATTRIBUTION_CONFIG</span></code> variable may grow large if the number of configurations
increases, and it may be necesssary to pass the content of <code class="docutils literal notranslate"><span class="pre">attribution_config.yml</span></code> to the
script instead, or via an artifact of the promotion task.</p>
</div>
<div class="section" id="beetmover">
<h3>Beetmover<a class="headerlink" href="#beetmover" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-partner-attribution-beetmover</span></code></p></li>
<li><p>platforms: N/A, scriptworker</p></li>
<li><p>upstreams: <code class="docutils literal notranslate"><span class="pre">release-partner-attribution</span></code></p></li>
</ul>
<p>Moves and renames the artifacts to their public location in the <a class="reference external" href="https://archive.mozilla.org/pub/firefox/candidates/">candidates directory</a>, or a private S3 bucket. There is one task
for public artifacts and another for private.</p>
<p>Each task will have the <code class="docutils literal notranslate"><span class="pre">project:releng:beetmover:action:push-to-partner</span></code> scope, with public uploads having
<code class="docutils literal notranslate"><span class="pre">project:releng:beetmover:bucket:release</span></code> and private uploads using
<code class="docutils literal notranslate"><span class="pre">project:releng:beetmover:bucket:partner</span></code>. There’s a partner-specific code path in
<a class="reference external" href="https://github.com/mozilla-releng/scriptworker-scripts/tree/master/beetmoverscript">beetmoverscript</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="versioncontrol.html" class="btn btn-neutral float-right" title="Version Control in CI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="partner-repacks.html" class="btn btn-neutral float-left" title="Partner repacks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>