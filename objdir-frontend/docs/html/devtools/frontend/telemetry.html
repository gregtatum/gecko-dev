

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Telemetry &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Current DevTools CSP" href="csp.html" />
    <link rel="prev" title="Getting data from the store" href="redux-guidelines.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Firefox DevTools Contributor Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#automated-tests">Automated tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#files-and-directories">Files and directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tool-architectures">Tool Architectures</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#frontend">Frontend</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="svgs.html">Panel SVGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="react.html">React</a></li>
<li class="toctree-l3"><a class="reference internal" href="react-guidelines.html">React Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="redux.html">Redux</a></li>
<li class="toctree-l3"><a class="reference internal" href="redux-guidelines.html">Redux Guidelines</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Telemetry</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-metrics-to-a-tool">Adding metrics to a tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#accessing-existing-data">Accessing existing data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="csp.html">Current DevTools CSP</a></li>
<li class="toctree-l3"><a class="reference internal" href="csp.html#scope-of-the-devtools-csp">Scope of the DevTools CSP</a></li>
<li class="toctree-l3"><a class="reference internal" href="csp.html#recognizing-csp-issues">Recognizing CSP issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="csp.html#fixing-csp-issues">Fixing CSP issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="csp.html#fixing-csp-issues-in-tests">Fixing CSP issues in tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#backend">Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#preferences">Preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#about-this-documentation">About this documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Firefox DevTools Contributor Docs</a> &raquo;</li>
        
      <li>Telemetry</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/devtools/frontend/telemetry.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="telemetry">
<h1>Telemetry<a class="headerlink" href="#telemetry" title="Permalink to this headline">¶</a></h1>
<p>We use telemetry to get metrics of usage of the different features and panels in DevTools. This will help us take better, informed decisions when prioritising our work.</p>
<div class="section" id="adding-metrics-to-a-tool">
<h2>Adding metrics to a tool<a class="headerlink" href="#adding-metrics-to-a-tool" title="Permalink to this headline">¶</a></h2>
<p>The process to add metrics to a tool roughly consists in:</p>
<ol class="simple">
<li><p>Adding the probe to Firefox</p></li>
<li><p>Using Histograms.json probes in DevTools code</p></li>
<li><p>Using Scalars.yaml probes in DevTools code</p></li>
<li><p>Using Events.yaml probes in DevTools code for analysis in Amplitude.</p></li>
<li><p>Getting approval from the data team</p></li>
</ol>
<div class="section" id="adding-the-probe-to-firefox">
<h3>1. Adding the probe to Firefox<a class="headerlink" href="#adding-the-probe-to-firefox" title="Permalink to this headline">¶</a></h3>
<p>The first step involves creating entries for the probe in one of the files that contain declarations for all data that Firefox might report to Mozilla.</p>
<p>These files are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">toolkit/components/telemetry/Histograms.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">toolkit/components/telemetry/Scalars.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">toolkit/components/telemetry/Events.yaml</span></code></p></li>
</ul>
<p>Scalars allow collection of simple values, like counts, booleans and strings and are to be used whenever possible instead of histograms.</p>
<p>Histograms allow collection of multiple different values, but aggregate them into a number of buckets. Each bucket has a value range and a count of how many values we recorded.</p>
<p>Events allow collection of a number of properties keyed to a category, method, object and value. Event telemetry helps us tell a story about how a user is interacting with the browser.</p>
<p>Both scalars &amp; histograms allow recording by keys. This allows for more flexible, two-level data collection.</p>
<div class="section" id="the-different-file-formats">
<h4>The different file formats<a class="headerlink" href="#the-different-file-formats" title="Permalink to this headline">¶</a></h4>
<p>The data team chose YAML for <code class="docutils literal notranslate"><span class="pre">Scalars.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">Events.yaml</span></code> because it is easy to write and provides a number of features not available in JSON including comments, extensible data types, relational anchors, strings without quotation marks, and mapping types preserving key order.</p>
<p>While we previously used JSON for similar purposes in histograms.json, we have used YAML here because it allows for comments and is generally easier to write.</p>
<p>The data team are considering moving the histograms over to YAML format at some point.</p>
<p>If it’s the first time you add one of these, it’s advised to follow the style of existing entries.</p>
<p>New data types have been added over the years, so it’s quite feasible that some of our probes are not the most suitable nowadays.</p>
<p>There’s more information about types (and telemetry in general) on <a class="reference external" href="https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/telemetry/start/adding-a-new-probe.html">this page</a> and <a class="reference external" href="https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/telemetry/collection/index.html">this other page</a>.</p>
<p>And of course, in case of doubt, ask!</p>
</div>
</div>
<div class="section" id="adding-probes-to-histograms-json">
<h3>Adding probes to <code class="docutils literal notranslate"><span class="pre">Histograms.json</span></code><a class="headerlink" href="#adding-probes-to-histograms-json" title="Permalink to this headline">¶</a></h3>
<p>Our entries are prefixed with <code class="docutils literal notranslate"><span class="pre">DEVTOOLS_</span></code>. For example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>  &quot;DEVTOOLS_DOM_OPENED_COUNT&quot;: {
    &quot;alert_emails&quot;: [&quot;dev-developer-tools@lists.mozilla.org&quot;],
    &quot;expires_in_version&quot;: &quot;never&quot;,
    &quot;kind&quot;: &quot;count&quot;,
    &quot;bug_numbers&quot;: [1343501],
    &quot;description&quot;: &quot;Number of times the DevTools DOM Inspector has been opened.&quot;,
    &quot;releaseChannelCollection&quot;: &quot;opt-out&quot;
  },
  &quot;DEVTOOLS_DOM_TIME_ACTIVE_SECONDS&quot;: {
    &quot;alert_emails&quot;: [&quot;dev-developer-tools@lists.mozilla.org&quot;],
    &quot;expires_in_version&quot;: &quot;never&quot;,
    &quot;kind&quot;: &quot;exponential&quot;,
    &quot;bug_numbers&quot;: [1343501],
    &quot;high&quot;: 10000000,
    &quot;n_buckets&quot;: 100,
    &quot;description&quot;: &quot;How long has the DOM inspector been active (seconds)&quot;
  },
</pre></div>
</div>
<p>There are different types of probes you can use. These are specified by the <code class="docutils literal notranslate"><span class="pre">kind</span></code> field. Normally we use <code class="docutils literal notranslate"><span class="pre">count</span></code> for counting how many times the tools are opened, and <code class="docutils literal notranslate"><span class="pre">exponential</span></code> for how many times a panel is active.</p>
</div>
<div class="section" id="adding-probes-to-scalars-yaml">
<h3>Adding probes to <code class="docutils literal notranslate"><span class="pre">Scalars.yaml</span></code><a class="headerlink" href="#adding-probes-to-scalars-yaml" title="Permalink to this headline">¶</a></h3>
<p>Our entries are prefixed with <code class="docutils literal notranslate"><span class="pre">devtools.</span></code>. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">devtools.toolbar.eyedropper</span><span class="p">:</span>
  <span class="nt">opened</span><span class="p">:</span>
    <span class="nt">bug_numbers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1247985</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1352115</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Number of times the DevTools Eyedropper has been opened via the inspector toolbar.</span>
    <span class="nt">expires</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">never</span>
    <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">uint</span>
    <span class="nt">notification_emails</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dev-developer-tools@lists.mozilla.org</span>
    <span class="nt">release_channel_collection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">opt-out</span>
    <span class="nt">record_in_processes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;main&#39;</span>

<span class="nt">devtools.copy.unique.css.selector</span><span class="p">:</span>
  <span class="nt">opened</span><span class="p">:</span>
    <span class="nt">bug_numbers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1323700</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1352115</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Number of times the DevTools copy unique CSS selector has been used.</span>
    <span class="nt">expires</span><span class="p">:</span> <span class="s">&quot;57&quot;</span>
    <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">uint</span>
    <span class="nt">notification_emails</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dev-developer-tools@lists.mozilla.org</span>
    <span class="nt">release_channel_collection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">opt-out</span>
    <span class="nt">record_in_processes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;main&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-probes-to-events-yaml">
<h3>Adding probes to <code class="docutils literal notranslate"><span class="pre">Events.yaml</span></code><a class="headerlink" href="#adding-probes-to-events-yaml" title="Permalink to this headline">¶</a></h3>
<p>Our entries are prefixed with <code class="docutils literal notranslate"><span class="pre">devtools.</span></code>. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">devtools.main</span><span class="p">:</span>
  <span class="nt">open</span><span class="p">:</span>
    <span class="nt">objects</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;tools&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">bug_numbers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">1416024</span><span class="p p-Indicator">]</span>
    <span class="nt">notification_emails</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;dev-developer-tools@lists.mozilla.org&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;hkirschner@mozilla.com&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">record_in_processes</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;main&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User opens devtools toolbox.</span>
    <span class="nt">release_channel_collection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">opt-out</span>
    <span class="nt">expiry_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">never</span>
    <span class="nt">extra_keys</span><span class="p">:</span>
      <span class="nt">entrypoint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">How was the toolbox opened? CommandLine, ContextMenu, HamburgerMenu, KeyShortcut, SessionRestore or SystemMenu</span>
      <span class="nt">first_panel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The name of the first panel opened.</span>
      <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;Toolbox</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">(positioning):</span><span class="nv"> </span><span class="s">bottom,</span><span class="nv"> </span><span class="s">side,</span><span class="nv"> </span><span class="s">window</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">other.&quot;</span>
      <span class="nt">splitconsole</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Indicates whether the split console was open.</span>
      <span class="nt">width</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Toolbox width (px).</span>
</pre></div>
</div>
</div>
<div class="section" id="using-histograms-json-probes-in-devtools-code">
<h3>2. Using Histograms.json probes in DevTools code<a class="headerlink" href="#using-histograms-json-probes-in-devtools-code" title="Permalink to this headline">¶</a></h3>
<p>Once the probe has been declared in the <code class="docutils literal notranslate"><span class="pre">Histograms.json</span></code> file, you’ll need to actually use it in our code.</p>
<p>First, you need to give it an id in <code class="docutils literal notranslate"><span class="pre">devtools/client/shared/telemetry.js</span></code>. Similarly to the <code class="docutils literal notranslate"><span class="pre">Histograms.json</span></code> case, you’ll want to follow the style of existing entries. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">dom</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">histogram</span><span class="o">:</span> <span class="s2">&quot;DEVTOOLS_DOM_OPENED_COUNT&quot;</span><span class="p">,</span>
  <span class="nx">timerHistogram</span><span class="o">:</span> <span class="s2">&quot;DEVTOOLS_DOM_TIME_ACTIVE_SECONDS&quot;</span>
<span class="p">},</span>
</pre></div>
</div>
<p>… would correspond to the probes we declared in the previous section.</p>
<p>Then, include that module on each tool that requires telemetry:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">Telemetry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;devtools/client/shared/telemetry&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Create a telemetry instance on the tool constructor:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Telemetry</span><span class="p">();</span>
</pre></div>
</div>
<p>And use the instance to report e.g. tool opening…</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">toolOpened</span><span class="p">(</span><span class="s2">&quot;mytoolname&quot;</span><span class="p">,</span> <span class="nx">sessionId</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
</pre></div>
</div>
<p>… or closing:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">toolClosed</span><span class="p">(</span><span class="s2">&quot;mytoolname&quot;</span><span class="p">,</span> <span class="nx">sessionId</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">mytoolname</span></code> is the id we declared in the <code class="docutils literal notranslate"><span class="pre">telemetry.js</span></code> module.</p>
</div>
<div class="section" id="using-scalars-yaml-probes-in-devtools-code">
<h3>3. Using Scalars.yaml probes in DevTools code<a class="headerlink" href="#using-scalars-yaml-probes-in-devtools-code" title="Permalink to this headline">¶</a></h3>
<p>Once the probe has been declared in the <code class="docutils literal notranslate"><span class="pre">Scalars.yaml</span></code> file, you’ll need to actually use it in our code.</p>
<p>First, you need to give it an id in <code class="docutils literal notranslate"><span class="pre">devtools/client/shared/telemetry.js</span></code>. You will want to follow the style of existing lowercase histogram entries. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">toolbareyedropper</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">scalar</span><span class="o">:</span> <span class="s2">&quot;devtools.toolbar.eyedropper.opened&quot;</span><span class="p">,</span> <span class="c1">// Note that the scalar is lowercase</span>
<span class="p">},</span>
<span class="nx">copyuniquecssselector</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">scalar</span><span class="o">:</span> <span class="s2">&quot;devtools.copy.unique.css.selector.opened&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<p>… would correspond to the probes we declared in the previous section.</p>
<p>Then, include that module on each tool that requires telemetry:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">Telemetry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;devtools/client/shared/telemetry&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Create a telemetry instance on the tool constructor:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Telemetry</span><span class="p">();</span>
</pre></div>
</div>
<p>And use the instance to report e.g. tool opening…</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">toolOpened</span><span class="p">(</span><span class="s2">&quot;mytoolname&quot;</span><span class="p">,</span> <span class="nx">sessionId</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mytoolname</span></code> is the id we declared in the <code class="docutils literal notranslate"><span class="pre">Scalars.yaml</span></code> module.</p></li>
<li><p>Because we are not logging tool’s time opened in <code class="docutils literal notranslate"><span class="pre">Scalars.yaml</span></code> we don’t care
about toolClosed. Of course, if there was an accompanying <code class="docutils literal notranslate"><span class="pre">timerHistogram</span></code>
field defined in <code class="docutils literal notranslate"><span class="pre">telemetry.js</span></code> and <code class="docutils literal notranslate"><span class="pre">histograms.json</span></code> then <code class="docutils literal notranslate"><span class="pre">toolClosed</span></code> should
also be added.</p></li>
</ul>
</div>
<div class="section" id="using-events-yaml-probes-in-devtools-code">
<h3>4. Using Events.yaml probes in DevTools code<a class="headerlink" href="#using-events-yaml-probes-in-devtools-code" title="Permalink to this headline">¶</a></h3>
<p>Once the probe has been declared in the <code class="docutils literal notranslate"><span class="pre">Events.yaml</span></code> file, you’ll need to actually use it in our code.</p>
<p>It is crucial to understand that event telemetry have a string identifier which is constructed from the <code class="docutils literal notranslate"><span class="pre">category</span></code>, <code class="docutils literal notranslate"><span class="pre">method</span></code>, <code class="docutils literal notranslate"><span class="pre">object</span></code> (name) and <code class="docutils literal notranslate"><span class="pre">value</span></code> on which the event occurred. This key points to an “extra” object that contains further information about the event (we will give examples later in this section).</p>
<p>Because these “extra” objects can be from completely independent code paths we
can send events and leave them in a pending state until all of the expected extra properties have been received.</p>
<p>First, include the telemetry module in each tool that requires telemetry:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">Telemetry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;devtools/client/shared/telemetry&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Create a telemetry instance on the tool constructor:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Telemetry</span><span class="p">();</span>
</pre></div>
</div>
<p>And use the instance to report e.g. tool opening…</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Event telemetry is disabled by default so enable it for your category.</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">setEventRecordingEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="c1">// If you already have all the properties for the event you can send the</span>
<span class="c1">// telemetry event using:</span>
<span class="c1">// this._telemetry.recordEvent(method, object, value, extra) e.g.</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">recordEvent</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
  <span class="s2">&quot;entrypoint&quot;</span><span class="o">:</span> <span class="s2">&quot;ContextMenu&quot;</span><span class="p">,</span>
  <span class="s2">&quot;first_panel&quot;</span><span class="o">:</span> <span class="s2">&quot;Inspector&quot;</span><span class="p">,</span>
  <span class="s2">&quot;host&quot;</span><span class="o">:</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
  <span class="s2">&quot;splitconsole&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="s2">&quot;width&quot;</span><span class="o">:</span> <span class="mf">1024</span><span class="p">,</span>
  <span class="s2">&quot;session_id&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">sessionId</span>
<span class="p">});</span>

<span class="c1">// If your &quot;extra&quot; properties are in different code paths you will need to</span>
<span class="c1">// create a &quot;pending event.&quot; These events contain a list of expected properties</span>
<span class="c1">// that can be populated before or after creating the pending event.</span>

<span class="c1">// Use the category, method, object, value combinations above to add a</span>
<span class="c1">// property... we do this before creating the pending event simply to</span>
<span class="c1">// demonstrate that properties can be sent before the pending event is created.</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">addEventProperty</span><span class="p">(</span>
  <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;entrypoint&quot;</span><span class="p">,</span> <span class="s2">&quot;ContextMenu&quot;</span><span class="p">);</span>

<span class="c1">// In this example `&quot;open&quot;, &quot;tools&quot;, null` make up the</span>
<span class="c1">// signature of the event and needs to be sent with all properties.</span>

<span class="c1">// Create the pending event using</span>
<span class="c1">// this._telemetry.preparePendingEvent(this, method, object, value,</span>
<span class="c1">// expectedPropertyNames) e.g.</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">preparePendingEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
  <span class="p">[</span><span class="s2">&quot;entrypoint&quot;</span><span class="p">,</span> <span class="s2">&quot;first_panel&quot;</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;splitconsole&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;session_id&quot;</span><span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Use the category, method, object, value combinations above to add each</span>
<span class="c1">// property.</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">addEventProperty</span><span class="p">(</span>
  <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;first_panel&quot;</span><span class="p">,</span> <span class="s2">&quot;inspector&quot;</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">addEventProperty</span><span class="p">(</span>
  <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">addEventProperty</span><span class="p">(</span>
  <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;splitconsole&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">addEventProperty</span><span class="p">(</span>
  <span class="k">this</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mf">1024</span><span class="p">);</span>

<span class="c1">// You can also add properties in batches using e.g.:</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">addEventProperties</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
  <span class="s2">&quot;first_panel&quot;</span><span class="o">:</span> <span class="s2">&quot;inspector&quot;</span><span class="p">,</span>
  <span class="s2">&quot;host&quot;</span><span class="o">:</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
  <span class="s2">&quot;splitconsole&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="s2">&quot;width&quot;</span><span class="o">:</span> <span class="mf">1024</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mytoolname</span></code> is the id we declared in the <code class="docutils literal notranslate"><span class="pre">Scalars.yaml</span></code> module.</p></li>
<li><p>Because we are not logging tool’s time opened in <code class="docutils literal notranslate"><span class="pre">Scalars.yaml</span></code> we don’t care
about toolClosed. Of course, if there was an accompanying <code class="docutils literal notranslate"><span class="pre">timerHistogram</span></code>
field defined in <code class="docutils literal notranslate"><span class="pre">telemetry.js</span></code> and <code class="docutils literal notranslate"><span class="pre">histograms.json</span></code> then <code class="docutils literal notranslate"><span class="pre">toolClosed</span></code> should
also be added.</p></li>
</ul>
<div class="section" id="note-on-top-level-panels">
<h4>Note on top level panels<a class="headerlink" href="#note-on-top-level-panels" title="Permalink to this headline">¶</a></h4>
<p>The code for the tabs uses their ids to automatically report telemetry when you switch between panels, so you don’t need to explicitly call <code class="docutils literal notranslate"><span class="pre">toolOpened</span></code> and <code class="docutils literal notranslate"><span class="pre">toolClosed</span></code> on top level panels.</p>
<p>You will still need to call those functions on subpanels, or tools such as about:debugging which are not opened as tabs.</p>
</div>
<div class="section" id="testing">
<h4>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h4>
<p>The telemetry module will print warnings to stdout if there are missing ids. It is strongly advisable to ensure this is working correctly, as the module will attribute usage for undeclared ids to a generic <code class="docutils literal notranslate"><span class="pre">custom</span></code> bucket. This is not good for accurate results!</p>
<p>To see these warnings, you need to have the <code class="docutils literal notranslate"><span class="pre">browser.dom.window.dump.enabled</span></code> browser preference set to <code class="docutils literal notranslate"><span class="pre">true</span></code> in <code class="docutils literal notranslate"><span class="pre">about:config</span></code> (and restart the browser).</p>
<p>Then, try doing things that trigger telemetry calls (e.g. opening a tool). Imagine we had a typo when reporting the tool was opened:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">_telemetry</span><span class="p">.</span><span class="nx">toolOpened</span><span class="p">(</span><span class="s1">&#39;mytoolnmae&#39;</span><span class="p">,</span> <span class="nx">sessionId</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
                                  <span class="o">^^^^</span> <span class="nx">typo</span><span class="p">,</span> <span class="nx">should</span> <span class="nx">be</span> <span class="o">*</span><span class="nx">mytoolname</span><span class="o">*</span>
</pre></div>
</div>
<p>Would report an error to stdout:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Warning: An attempt was made to write to the mytoolnmae histogram, which is not defined in Histograms.json
</pre></div>
</div>
<p>So watch out for errors.</p>
</div>
<div class="section" id="testing-event-telemetry">
<h4>Testing Event Telemetry<a class="headerlink" href="#testing-event-telemetry" title="Permalink to this headline">¶</a></h4>
<p>This is best shown via an example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Any copyright is dedicated to the Public Domain.</span>
<span class="cm"> * http://creativecommons.org/publicdomain/zero/1.0/ */</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">Toolbox</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;devtools/client/framework/toolbox&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">TelemetryTestUtils</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">ChromeUtils</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="s2">&quot;resource://testing-common/TelemetryTestUtils.jsm&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">URL</span> <span class="o">=</span> <span class="s2">&quot;data:text/html;charset=utf8,browser_toolbox_telemetry_close.js&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">RIGHT</span><span class="p">,</span> <span class="nx">BOTTOM</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">Toolbox</span><span class="p">.</span><span class="nx">HostType</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">DATA</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="nx">category</span><span class="o">:</span> <span class="s2">&quot;devtools.main&quot;</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
    <span class="nx">object</span><span class="o">:</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">extra</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span>
      <span class="nx">width</span><span class="o">:</span> <span class="nx">w</span> <span class="p">=&gt;</span> <span class="nx">w</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">category</span><span class="o">:</span> <span class="s2">&quot;devtools.main&quot;</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
    <span class="nx">object</span><span class="o">:</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">extra</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
      <span class="nx">width</span><span class="o">:</span> <span class="nx">w</span> <span class="p">=&gt;</span> <span class="nx">w</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">];</span>

<span class="nx">add_task</span><span class="p">(</span><span class="nx">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Let&#39;s reset the counts.</span>
  <span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">clearEvents</span><span class="p">();</span>

  <span class="c1">// Ensure no events have been logged</span>
  <span class="nx">TelemetryTestUtils</span><span class="p">.</span><span class="nx">assertNumberOfEvents</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

  <span class="nx">await</span> <span class="nx">openAndCloseToolbox</span><span class="p">(</span><span class="s2">&quot;webconsole&quot;</span><span class="p">,</span> <span class="nx">SIDE</span><span class="p">);</span>
  <span class="nx">await</span> <span class="nx">openAndCloseToolbox</span><span class="p">(</span><span class="s2">&quot;webconsole&quot;</span><span class="p">,</span> <span class="nx">BOTTOM</span><span class="p">);</span>

  <span class="nx">checkResults</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">openAndCloseToolbox</span><span class="p">(</span><span class="nx">toolId</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">tab</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">addTab</span><span class="p">(</span><span class="nx">URL</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">TargetFactory</span><span class="p">.</span><span class="nx">forTab</span><span class="p">(</span><span class="nx">tab</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">toolbox</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">gDevTools</span><span class="p">.</span><span class="nx">showToolbox</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">toolId</span><span class="p">);</span>

  <span class="nx">await</span> <span class="nx">toolbox</span><span class="p">.</span><span class="nx">switchHost</span><span class="p">(</span><span class="nx">host</span><span class="p">);</span>
  <span class="nx">await</span> <span class="nx">toolbox</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">checkResults</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">TelemetryTestUtils</span><span class="p">.</span><span class="nx">assertEvents</span><span class="p">(</span><span class="nx">DATA</span><span class="p">,</span> <span class="p">{</span><span class="nx">category</span><span class="o">:</span> <span class="s2">&quot;devtools.main&quot;</span><span class="p">,</span> <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="nx">object</span><span class="o">:</span> <span class="s2">&quot;tools&quot;</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="compile-it">
<h4>Compile it<a class="headerlink" href="#compile-it" title="Permalink to this headline">¶</a></h4>
<p>You need to do a full Firefox build if you have edited either <code class="docutils literal notranslate"><span class="pre">Histograms.json</span></code> or <code class="docutils literal notranslate"><span class="pre">Events.yaml</span></code>, as they are processed at build time, and various checks will be run on them to guarantee they are valid.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./mach build
</pre></div>
</div>
<p>If you use <code class="docutils literal notranslate"><span class="pre">mach</span> <span class="pre">build</span> <span class="pre">faster</span></code> or artifact builds, the checks will not be performed, and your try builds will fail (“bust”) when the checks are run there.</p>
<p>Save yourself some time and run the checks locally.</p>
<p>NOTE: Changes to <code class="docutils literal notranslate"><span class="pre">Scalars.yaml</span></code> <em>are</em> processed when doing an artifact build.</p>
</div>
</div>
<div class="section" id="getting-approval-from-the-data-team">
<h3>4. Getting approval from the data team<a class="headerlink" href="#getting-approval-from-the-data-team" title="Permalink to this headline">¶</a></h3>
<p>This is required before the changes make their way into <code class="docutils literal notranslate"><span class="pre">mozilla-central</span></code>.</p>
<p>To get approval, attach your patch to the bug in Bugzilla, and set two flags:</p>
<ul class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">review?</span></code> flag for a data steward.</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">needinfo?</span></code> flag to hkirschner (our product manager, so he vouches that we’re using the data)</p></li>
</ul>
<p>Be sure to explain very clearly what is the new probe for. E.g. “We’re seeking approval for tracking opens of a new panel for debugging Web API ABCD” is much better than just asking for feedback without background info.</p>
<p>This review shouldn’t take too long: if there’s something wrong, they should tell you what to fix. If you see no signs of activity after a few days, you can ask in <code class="docutils literal notranslate"><span class="pre">#developers</span></code>.</p>
<p>Note that this review is <em>in addition</em> to normal colleague reviews.</p>
<p>Click <a class="reference external" href="https://wiki.mozilla.org/Firefox/Data_Collection#Requesting_Data_Collection">here</a> for more details.</p>
</div>
</div>
<div class="section" id="accessing-existing-data">
<h2>Accessing existing data<a class="headerlink" href="#accessing-existing-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="local-data">
<h3>Local data<a class="headerlink" href="#local-data" title="Permalink to this headline">¶</a></h3>
<p>Go to <a class="reference external" href="about:telemetry">about:telemetry</a> to see stats relating to your local instance.</p>
</div>
<div class="section" id="global-data">
<h3>Global data<a class="headerlink" href="#global-data" title="Permalink to this headline">¶</a></h3>
<p>Data aggregated from large groups of Firefox users is available at <a class="reference external" href="https://telemetry.mozilla.org">telemetry.mozilla.org</a>.</p>
<p>Reports are written with SQL. For example, here’s one comparing <a class="reference external" href="https://sql.telemetry.mozilla.org/queries/1000#table">usage of some DevTools panels</a>.</p>
<p>If you want to get better understanding of how people are using the tools, you are encouraged to explore this data set by writing your own reports.</p>
<p>The easiest way to get started is to <em>fork</em> an existing report and modify it to get used to the syntax, as SQL for massive data tables is very different from SQL for a humble blog engine, and you’ll find some new operators that might look unfamiliar.</p>
<p>It’s also recommended to take small steps and run the queries often to detect errors before they’re too complicated to solve, particularly if you’re not experienced with this (yet).</p>
<p>Slow queries will be interrupted by the system, so don’t worry about “fetching too much data” or “using too many resources”. There’s built-in protection to avoid your code eating up the Telemetry database.</p>
<p>Funnily, if you’re based in Europe, you might be in luck, as the website tends to be more responsive during European working hours than it is at Pacific working hours, as seemingly there’s less people in Europe interacting with it.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="csp.html" class="btn btn-neutral float-right" title="Current DevTools CSP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="redux-guidelines.html" class="btn btn-neutral float-left" title="Getting data from the store" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>