

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Memory Tool Architecture &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="debugger-panel.html" />
    <link rel="prev" title="Highlighters" href="highlighters.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Firefox DevTools Contributor Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#automated-tests">Automated tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#files-and-directories">Files and directories</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#tool-architectures">Tool Architectures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="inspector-panel.html">Inspector Panel Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="highlighters.html">Inspector Highlighters</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Memory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#js-ubi-node"><code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#heapanalysesworker"><code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#frontend">Frontend</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="responsive-design-mode.html">Responsive Design Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="console-panel.html">Console</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#frontend">Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#backend">Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#preferences">Preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#about-this-documentation">About this documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Firefox DevTools Contributor Docs</a> &raquo;</li>
        
      <li>Memory Tool Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/devtools/tools/memory-panel.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="memory-tool-architecture">
<h1>Memory Tool Architecture<a class="headerlink" href="#memory-tool-architecture" title="Permalink to this headline">¶</a></h1>
<p>The memory tool is built of three main elements:</p>
<ol class="simple">
<li><p>The live heap graph exists in memory, and is managed by the C++ allocator and
garbage collector. In order to get access to the structure of this graph, a
specialized interface is created to represent its state. The <code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code>
is the basis for this representation. This interface can be created from the
live heap graph, or a serialized, offline snapshot from a previous moment in
time. Our various heap analyses (census, dominator trees, shortest paths,
etc) run on top of <code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code> graphs. The <code class="docutils literal notranslate"><span class="pre">ubi</span></code> in the name stands for
“ubiquitous” and provides a namespace for memory analyses in C++ code.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code> runs in a worker thread, performing analyses on
snapshots and translating the results into something the frontend can render
simply and quickly. The <code class="docutils literal notranslate"><span class="pre">HeapAnalysesClient</span></code> is used to communicate between
the worker and the main thread.</p></li>
<li><p>Finally, the last element is the frontend that renders data received from the
<code class="docutils literal notranslate"><span class="pre">HeapAnalysesClient</span></code> to the DOM and translates user input into requests for
new data with the <code class="docutils literal notranslate"><span class="pre">HeapAnalysesClient</span></code>.</p></li>
</ol>
<p>Unlike other tools (such as the JavaScript debugger), the memory tool makes very
little use of the Remote DevTools Server and the actors that reside in it. Use
of the <a class="reference external" href="devtools/server/actors/memory.js"><code class="docutils literal notranslate"><span class="pre">MemoryActor</span></code></a> is limited to toggling
allocation stack recording on and off, and transferring heap snapshots from the
debuggee (which is on the server) to the <code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code> (which is on the
client). A nice benefit that naturally emerges, is that supporting “legacy”
servers (eg, using Firefox Developer Edition as a client to remote debug a
release Firefox for Android server) is a no-op. As we add new analyses, we can
run them on snapshots taken on old servers no problem. The only requirement is
that changes to the snapshot format itself remain backwards compatible.</p>
<div class="section" id="js-ubi-node">
<h2><code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code><a class="headerlink" href="#js-ubi-node" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code> is a lightweight serializable interface that can represent the
current state of the heap graph. For a deeper dive into the particulars of how
it works, it is very well documented in the <code class="docutils literal notranslate"><span class="pre">js/public/UbiNode.h</span></code></p>
<p>A “heap snapshot” is a representation of the heap graph at some particular past
instance in time.</p>
<p>A “heap analysis” is an algorithm that runs on a <code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code> heap graph.
Generally, analyses can run on either the live heap graph or a deserialized
snapshot. Example analyses include “census”, which aggregates and counts nodes
into various user-specified buckets; “dominator trees”, which compute the
<a class="reference external" href="https://en.wikipedia.org/wiki/Dominator_%28graph_theory%29">dominates</a> relation
and retained size for all nodes in the heap graph; and “shortest paths” which
finds the shortest paths from the GC roots to some subset of nodes.</p>
<div class="section" id="saving-heap-snapshots">
<h3>Saving Heap Snapshots<a class="headerlink" href="#saving-heap-snapshots" title="Permalink to this headline">¶</a></h3>
<p>Saving a heap snapshot has a few requirements:</p>
<ol class="simple">
<li><p>The binary format must remain backwards compatible and future extensible.</p></li>
<li><p>The live heap graph must not mutate while we are in the process of
serializing it.</p></li>
<li><p>The act of saving a heap snapshot should impose as little memory overhead as
possible. If we are taking a snapshot to debug frequent out-of-memory errors,
we don’t want to trigger an OOM ourselves!</p></li>
</ol>
<p>To solve (1), we use the <a class="reference external" href="https://developers.google.com/protocol-buffers/">protobuf</a>
message format. The message definitions themselves are in
<code class="docutils literal notranslate"><span class="pre">devtools/shared/heapsnapshot/CoreDump.proto</span></code>. We always use <code class="docutils literal notranslate"><span class="pre">optional</span></code> fields
so we can change our mind about what fields are required sometime in the future.
Deserialization checks the semantic integrity of deserialized protobuf messages.</p>
<p>For (2), we rely on SpiderMonkey’s GC rooting hazard static analysis and the
<code class="docutils literal notranslate"><span class="pre">AutoCheckCannotGC</span></code> dynamic analysis to ensure that neither JS nor GC runs and
modifies objects or moves them from one address in memory to another. There is
no equivalent suppression and static analysis technique for the
<a class="reference external" href="https://developer.mozilla.org/en/docs/Interfacing_with_the_XPCOM_cycle_collector">cycle collector</a>,
so care must be taken not to invoke methods that could start cycle collection or
mutate the heap graph from the cycle collector’s perspective. At the time of
writing, we don’t yet support saving the cycle collector’s portion of the heap
graph in snapshots, but that work is deemed Very Important and Very High
Priority.</p>
<p>Finally, (3) imposes upon us that we do not build the serialized heap snapshot
binary blob in memory, but instead stream it out to disk while generating it.</p>
<p>Once all of that is accounted for, saving snapshots becomes pretty straight
forward. We traverse the live heap graph with <code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code> and
<code class="docutils literal notranslate"><span class="pre">JS::ubi::BreadthFirst</span></code>, create a protobuf message for each node and each node’s
edges, and write these messages to disk before continuing the traversal to the
next node.</p>
<p>This functionality is exposed to chrome JavaScript as the
<code class="docutils literal notranslate"><span class="pre">ChromeUtils.saveHeapSnapshot</span></code> function. See <code class="docutils literal notranslate"><span class="pre">dom/webidl/ChromeUtils.webidl</span></code> for
API documentation.</p>
</div>
<div class="section" id="reading-heap-snapshots">
<h3>Reading Heap Snapshots<a class="headerlink" href="#reading-heap-snapshots" title="Permalink to this headline">¶</a></h3>
<p>Reading heap snapshots has less restrictions than saving heap snapshots. The
protobuf messages that make up the core dump are deserialized one by one, stored
as a set of <code class="docutils literal notranslate"><span class="pre">DeserializedNode</span></code>s and a set of <code class="docutils literal notranslate"><span class="pre">DeserializedEdge</span></code>s, and the result
is a <code class="docutils literal notranslate"><span class="pre">HeapSnapshot</span></code> instance.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DeserializedNode</span></code> and <code class="docutils literal notranslate"><span class="pre">DeserializedEdge</span></code> classes implement the
<code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code> interface. Analyses running on offline heap snapshots rather
than the live heap graph operate on these classes (unknowingly, of course).</p>
<p>For more details, see the
<a class="reference external" href="devtools/shared/heapsnapshot/HeapSnapshot.cpp"><code class="docutils literal notranslate"><span class="pre">mozilla::devtools::HeapSnapshot</span></code></a>
and
<a class="reference external" href="devtools/shared/heapsnapshot/DeserializedNode.h"><code class="docutils literal notranslate"><span class="pre">mozilla::devtools::Deserialized{Node,Edge}</span></code></a>
classes.</p>
</div>
<div class="section" id="heap-analyses">
<h3>Heap Analyses<a class="headerlink" href="#heap-analyses" title="Permalink to this headline">¶</a></h3>
<p>Heap analyses operate on <code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code> graphs without knowledge of whether
that graph is backed by the live heap graph or an offline heap snapshot. They
must make sure never to allocate GC things or modify the live heap graph.</p>
<p>In general, analyses are implemented in their own <code class="docutils literal notranslate"><span class="pre">js/public/Ubi{AnalysisName}.h</span></code>
header (eg <code class="docutils literal notranslate"><span class="pre">js/public/UbiCensus.h</span></code>), and are exposed to chrome JavaScript code
via a method on the <a class="reference external" href="dom/webidl/HeapSnapshot.webidl"><code class="docutils literal notranslate"><span class="pre">HeapSnapshot</span></code></a> webidl
interface.</p>
<p>For each analysis we expose to chrome JavaScript on the <code class="docutils literal notranslate"><span class="pre">HeapSnapshot</span></code> webidl
interface, there is a small amount of glue code in Gecko. The
<a class="reference external" href="devtools/shared/heapsnapshot/HeapSnapshot.h"><code class="docutils literal notranslate"><span class="pre">mozilla::devtools::HeapSnapshot</span></code></a>
C++ class implements the webidl interface. The analyses methods (eg
<code class="docutils literal notranslate"><span class="pre">ComputeDominatorTree</span></code>) take the deserialized nodes and edges from the heap
snapshot, create <code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code>s from them, call the analyses from
<code class="docutils literal notranslate"><span class="pre">js/public/Ubi*.h</span></code>, and wrap the results in something that can be represented in
JavaScript.</p>
<p>For API documentation on running specific analyses, see the
<a class="reference external" href="dom/webidl/HeapSnapshot.webidl"><code class="docutils literal notranslate"><span class="pre">HeapSnapshot</span></code></a> webidl interface.</p>
</div>
<div class="section" id="testing-js-ubi-node-snapshots-and-analyses">
<h3>Testing <code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code>, Snapshots, and Analyses<a class="headerlink" href="#testing-js-ubi-node-snapshots-and-analyses" title="Permalink to this headline">¶</a></h3>
<p>The majority of the tests reside within <code class="docutils literal notranslate"><span class="pre">devtools/shared/heapsnapshot/tests/**</span></code>.
For reading and saving heap snapshots, most tests are gtests. The gtests can be
run with the <code class="docutils literal notranslate"><span class="pre">mach</span> <span class="pre">gtest</span> <span class="pre">DevTools.*</span></code> command. The rest are integration sanity
tests to make sure we can read and save snapshots in various environments, such
as xpcshell or workers. These can be run with the usual <code class="docutils literal notranslate"><span class="pre">mach</span> <span class="pre">test</span> <span class="pre">$PATH</span></code>
commands.</p>
<p>There are also <code class="docutils literal notranslate"><span class="pre">JS::ubi::Node</span></code> related unit tests in
<code class="docutils literal notranslate"><span class="pre">js/src/jit-test/tests/heap-analysis/*</span></code>, <code class="docutils literal notranslate"><span class="pre">js/src/jit-test/tests/debug/Memory-*</span></code>,
and <code class="docutils literal notranslate"><span class="pre">js/src/jsapi-tests/testUbiNode.cpp</span></code>. See
https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Running_Automated_JavaScript_Tests#Running_jit-tests
for running the JIT tests.</p>
</div>
</div>
<div class="section" id="heapanalysesworker">
<h2><code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code><a class="headerlink" href="#heapanalysesworker" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code> orchestrates running specific analyses on snapshots and
transforming the results into something that can simply and quickly be rendered
by the frontend. The analyses can take some time to run (sometimes on the order
of seconds), so doing them in a worker thread allows the interface to stay
responsive. The <code class="docutils literal notranslate"><span class="pre">HeapAnalysisClient</span></code> provides the main thread’s interface to the
worker.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code> doesn’t actually do much itself; mostly just shuffling
data and transforming it from one representation to another or calling C++
utility functions exposed by webidl that do those things. Most of these are
implemented as traversals of the resulting census or dominator trees.</p>
<p>See the following files for details on the various data transformations and
shuffling that the <code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code> delegates to.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">devtools/shared/heapsnapshot/CensusUtils.js</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">devtools/shared/heapsnapshot/CensusTreeNode.js</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">devtools/shared/heapsnapshot/DominatorTreeNode.js</span></code></p></li>
</ul>
<div class="section" id="testing-the-heapanalysesworker-and-heapanalysesclient">
<h3>Testing the <code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code> and <code class="docutils literal notranslate"><span class="pre">HeapAnalysesClient</span></code><a class="headerlink" href="#testing-the-heapanalysesworker-and-heapanalysesclient" title="Permalink to this headline">¶</a></h3>
<p>Tests for the <code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code> and <code class="docutils literal notranslate"><span class="pre">HeapAnalysesClient</span></code> reside in
<code class="docutils literal notranslate"><span class="pre">devtools/shared/heapsnapshot/tests/**</span></code> and can be run with the usual <code class="docutils literal notranslate"><span class="pre">mach</span> <span class="pre">test</span> <span class="pre">$PATH</span></code> command.</p>
</div>
</div>
<div class="section" id="frontend">
<h2>Frontend<a class="headerlink" href="#frontend" title="Permalink to this headline">¶</a></h2>
<p>The frontend of the memory tool is built with React and Redux.</p>
<p><a class="reference external" href="https://facebook.github.io/react/">React has thorough documentation.</a></p>
<p><a class="reference external" href="http://rackt.org/redux/index.html">Redux has thorough documentation.</a></p>
<p>We have React components in <code class="docutils literal notranslate"><span class="pre">devtools/client/memory/components/*</span></code>.</p>
<p>We have Redux reducers in <code class="docutils literal notranslate"><span class="pre">devtools/client/memory/reducers/*</span></code>.</p>
<p>We have Redux actions and action-creating tasks in
<code class="docutils literal notranslate"><span class="pre">devtools/client/memory/actions/*</span></code>.</p>
<p>React components should be pure functions from their props to the rendered
(virtual) DOM. Redux reducers should also be observably pure.</p>
<p>Impurity within the frontend is confined to the tasks that are creating and
dispatching actions. All communication with the outside world (such as the
<code class="docutils literal notranslate"><span class="pre">HeapAnalysesWorker</span></code>, the Remote DevTools Server, or the file system) is
restricted to within these tasks.</p>
<div class="section" id="snapshots-state">
<h3>Snapshots State<a class="headerlink" href="#snapshots-state" title="Permalink to this headline">¶</a></h3>
<p>On the JavaScript side, the snapshots represent a reference to the underlying
heap dump and the various analyses. The following diagram represents a finite
state machine describing the snapshot states. Any of these states may go to the
ERROR state, from which they can never leave.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SAVING → SAVED → READING → READ
                  ↗
         IMPORTING
</pre></div>
</div>
<p>Each of the report types (census, diffing, tree maps, dominators) have their own states as well, and are documented at <code class="docutils literal notranslate"><span class="pre">devtools/client/memory/constants.js</span></code>.
These report states are updated as the various filtering and selecting options
are updated in the UI.</p>
</div>
<div class="section" id="testing-the-frontend">
<h3>Testing the Frontend<a class="headerlink" href="#testing-the-frontend" title="Permalink to this headline">¶</a></h3>
<p>Unit tests for React components are in <code class="docutils literal notranslate"><span class="pre">devtools/client/memory/test/chrome/*</span></code>.</p>
<p>Unit tests for actions, reducers, and state changes are in
<code class="docutils literal notranslate"><span class="pre">devtools/client/memory/test/xpcshell/*</span></code>.</p>
<p>Holistic integration tests for the frontend and the whole memory tool are in
<code class="docutils literal notranslate"><span class="pre">devtools/client/memory/test/browser/*</span></code>.</p>
<p>All tests can be run with the usual <code class="docutils literal notranslate"><span class="pre">mach</span> <span class="pre">test</span> <span class="pre">$PATH</span></code> command.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="debugger-panel.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="highlighters.html" class="btn btn-neutral float-left" title="Highlighters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>