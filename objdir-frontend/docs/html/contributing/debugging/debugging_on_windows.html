

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Debugging On Windows &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to get a process dump with Windows Task Manager" href="process_dump_task_manager.html" />
    <link rel="prev" title="Debugging On Mac Os X" href="debugging_on_mac_os_x.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Working on Firefox</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../contribution_quickref.html">Firefox Contributors’ Quick Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pocket-guide-shipping-firefox.html">Pocket Guide: Shipping Firefox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../editor.html">Editor / IDE integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reviews.html">Getting reviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vcs/mercurial.html">Mercurial Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vcs/mercurial_bundles.html">Mercurial Bundles</a></li>
<li class="toctree-l2"><a class="reference internal" href="capturing_minidump.html">Capturing a minidump</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_a_hang_on_os_x.html">Debugging A Hang On OS X</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_a_minidump.html">Debugging A Minidump</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_firefox_with_gdb.html">Debugging Firefox with GDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_firefox_with_lldb.html">Debugging Firefox with LLDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_firefox_with_rr.html">Debugging Firefox with rr</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_firefox_with_valgrind.html">Debugging Firefox with Valgrind</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_on_mac_os_x.html">Debugging On Mac Os X</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Debugging On Windows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ways-to-start-the-debugger">Ways to start the debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-release-and-nightly-builds">Debugging Release and Nightly Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-visual-c-project-for-firefox">Creating a Visual C++ project for Firefox</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changing-setting-the-executable-to-debug">Changing/setting the executable to debug</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line-parameters-and-environment-variables">Command line parameters and environment variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-breakpoints-in-dlls-which-are-not-yet-loaded-in-memory">Setting breakpoints in DLLs which are not yet loaded in memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-the-debugger-s-variable-value-view">Customizing the debugger’s variable value view</a></li>
<li class="toctree-l3"><a class="reference internal" href="#avoiding-stepping-into-certain-functions">Avoiding stepping into certain functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#obtaining-stdout-and-other-file-handles">Obtaining <code class="docutils literal notranslate"><span class="pre">stdout</span></code> and other <code class="docutils literal notranslate"><span class="pre">FILE</span></code> handles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#disabling-assertions">Disabling ASSERTIONS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#environment-variable">Environment variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#changing-running-code">Changing running code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#automatically-handling-assertions-without-a-debugger-attached">Automatically handling ASSERTIONS without a debugger attached</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-optimized-builds">Debugging optimized builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#console-debugging">Console debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-two-instances-of-mozilla-simultaneously">Running two instances of Mozilla simultaneously</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-javascript">Debugging JavaScript</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-minidumps">Debugging minidumps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-tinderbox-builds">Debugging tinderbox builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#problems-loading-debug-symbols">Problems Loading Debug Symbols</a></li>
<li class="toctree-l3"><a class="reference internal" href="#problems-post-mortem-debugging-on-windows-7-sp1-x64">Problems post-mortem debugging on Windows 7 SP1 x64?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#got-a-tip">Got a tip?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="process_dump_task_manager.html">How to get a process dump with Windows Task Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="stacktrace_report.html">How to get a stacktrace for a bug report</a></li>
<li class="toctree-l2"><a class="reference internal" href="stacktrace_windbg.html">How to get a stacktrace with WinDbg</a></li>
<li class="toctree-l2"><a class="reference internal" href="understanding_crash_reports.html">Understanding Crash Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../directory_structure.html">Firefox Source Code Directory Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build/artifact_builds.html">Understanding Artifact Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build/building_mobile_firefox.html">Firefox for Mobile Devices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Working on Firefox</a> &raquo;</li>
        
      <li>Debugging On Windows</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/contributing/debugging/debugging_on_windows.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="debugging-on-windows">
<h1>Debugging On Windows<a class="headerlink" href="#debugging-on-windows" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>This page is an import from MDN and the contents might be outdated</p></td>
</tr>
</tbody>
</table>
<p>This document explains how to debug Gecko based applications such as
Firefox, Thunderbird, and SeaMonkey on Windows using the Visual C++ IDE.</p>
<p>If VC++ and your Gecko application hang shortly after you launch the
application under the debugger, see <a class="reference external" href="#problems-loading-debug-symbols">Problems Loading Debug
Symbols</a>.</p>
<div class="section" id="ways-to-start-the-debugger">
<h2>Ways to start the debugger<a class="headerlink" href="#ways-to-start-the-debugger" title="Permalink to this headline">¶</a></h2>
<p>First of all, it’s necessary to install a Visual Studio extension to be
able to follow child processes as they are created. Firefox, in general,
and even in non-e10s mode, does not start the main process directly, it
starts it via a Launcher Process. This means that Visual Studio will
only attach to the first process it finds, and will not hit any
break-point (and even notifies you that it cannot find their location).
<a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=vsdbgplat.MicrosoftChildProcessDebuggingPowerTool">Microsoft Child Process Debugging Power
Tool</a>
allows automatically attaching to child processes, such as Web Content
process, GPU process, etc. Enable it by going its configuration menu in
“Debug &gt; Other debugging targets &gt; Child process debugging settings”,
and ticking the box.</p>
<p>If you have followed the steps in <a class="reference internal" href="../../setup/windows_build.html#building-firefox-on-windows"><span class="std std-ref">Building Firefox for
Windows</span></a>
and have a local debug build, you can <strong>execute ``./mach run –debug``</strong>
from the same command line. It would open Visual Studio with Firefox’s
run options configured. You can <strong>click “Start” button</strong> to run Firefox
then, already attached in the debugger.</p>
<p>Alternatively, if you have generated the Visual Studio solution, via
<code class="docutils literal notranslate"><span class="pre">./mach</span> <span class="pre">build-backend</span> <span class="pre">-b</span> <span class="pre">VisualStudio</span></code>, opening this solution allows
you to run <code class="docutils literal notranslate"><span class="pre">firefox.exe</span></code> directly in the debugger. Making it the
startup project, by right clicking on it (it appears bold when it’s the
case) can be useful. Breakpoints are kept across runs, this can be a
good way to debug startup issues.</p>
<p><strong>Run the program until you hit an assertion.</strong> You will get a dialog
box asking if you would like to debug. Hit “Cancel”. The MSDEV IDE will
launch and load the file where the assertion happened. This will also
create a Visual C++ Mozilla project in the directory of the executable
by default.</p>
<p><strong>Attach the debugger to an existing Mozilla process</strong>.  In the Visual
Studio, select Debug &gt; Attach to Process. If you want to debug a content
process, you can <strong>hover on the tab</strong> of page you want to debug, which
would show the pid. You can then select the process from dialog opened
from “Attach to Process”. For more information, see <a class="reference external" href="http://msdn.microsoft.com/en-us/library/vstudio/3s68z0b3.aspx">Attach to Running
Processes with the Visual Studio
Debugger</a>.</p>
</div>
<div class="section" id="debugging-release-and-nightly-builds">
<h2>Debugging Release and Nightly Builds<a class="headerlink" href="#debugging-release-and-nightly-builds" title="Permalink to this headline">¶</a></h2>
<p>Refer to the steps to <a class="reference internal" href="../../toolkit/crashreporter/crashreporter/Using_the_Mozilla_symbol_server.html#using-the-mozilla-symbol-server"><span class="std std-ref">use the Mozilla symbol
server</span></a> and <a class="reference internal" href="../../taskcluster/using-the-mozilla-source-server.html#using-the-mozilla-source-server"><span class="std std-ref">source
server</span></a></p>
</div>
<div class="section" id="creating-a-visual-c-project-for-firefox">
<h2>Creating a Visual C++ project for Firefox<a class="headerlink" href="#creating-a-visual-c-project-for-firefox" title="Permalink to this headline">¶</a></h2>
<p>Please refer to <a class="reference internal" href="../../build/buildsystem/visualstudio.html#visual-studio-projects"><span class="std std-ref">this</span></a>.</p>
</div>
<div class="section" id="changing-setting-the-executable-to-debug">
<h2>Changing/setting the executable to debug<a class="headerlink" href="#changing-setting-the-executable-to-debug" title="Permalink to this headline">¶</a></h2>
<p>VC++ 6.0: To change or set the executable to debug, go to Project &gt;
Settings…, Debug tab and select General from the drop down list.
“Executable for debug session:” should show the executable you are
debugging. If it is empty or incorrect, use the arrow button and select
Browse… to locate the executable.</p>
</div>
<div class="section" id="command-line-parameters-and-environment-variables">
<h2>Command line parameters and environment variables<a class="headerlink" href="#command-line-parameters-and-environment-variables" title="Permalink to this headline">¶</a></h2>
<p>VC++ 6.0: To change or set the command line options, go to Project &gt;
Settings…, Debug tab and select General from the drop down list.
“Program arguments:” should show the options.</p>
<p>Some common options would be the URL of the file you want the browser to
open as soon as it starts, starting the Profile Manager, or selecting a
profile. You can also redirect the console output to a file (by adding
“<code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">filename.txt</span></code>” for example, without the quotes).</p>
<p>In VC 7 and 8 this option is called Project &gt; Properties &gt; Debugging &gt;
Command Arguments. VC 8 also allows you to set environment variables
there.</p>
</div>
<div class="section" id="setting-breakpoints-in-dlls-which-are-not-yet-loaded-in-memory">
<h2>Setting breakpoints in DLLs which are not yet loaded in memory<a class="headerlink" href="#setting-breakpoints-in-dlls-which-are-not-yet-loaded-in-memory" title="Permalink to this headline">¶</a></h2>
<p>VC++ 6.0: Go to Project &gt; Settings…, Debug tab and select “Additional
DLLs” from the drop down list. Check “Locate Additional DLLs” option.
For each DLL, click the “New” button which creates a new entry and then
hit the “…” buttons which lets you browse to the DLL. You will only be
able to add one DLL at a time.</p>
<p>VC++ 7.0 automatically finds additional DLLs.</p>
</div>
<div class="section" id="customizing-the-debugger-s-variable-value-view">
<h2>Customizing the debugger’s variable value view<a class="headerlink" href="#customizing-the-debugger-s-variable-value-view" title="Permalink to this headline">¶</a></h2>
<p>You can customize how Visual C++ displays classes in the variable view.
By default VC++ displays “{…}” and you need to click the small + icon
to expand the members. You can change this behaviour, and make Visual
C++ display whatever data member you want in whatever order, formatter
however you like instead of just “{…}”.</p>
<p>You need to locate a file called “AUTOEXP.DAT” in your Visual C++
installation. By default it will be:</p>
<p>VC++ 6.0:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span>\<span class="n">Microsoft</span> <span class="n">Visual</span> <span class="n">Studio</span>\<span class="n">Common</span>\<span class="n">MSDev98</span>\<span class="n">Bin</span>\<span class="n">AUTOEXP</span><span class="o">.</span><span class="n">DAT</span>
</pre></div>
</div>
<p>VC++ 7.0:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span>\<span class="n">Microsoft</span> <span class="n">Visual</span> <span class="n">Studio</span> <span class="o">.</span><span class="n">NET</span> <span class="mi">2003</span>\<span class="n">Common7</span>\<span class="n">Packages</span>\<span class="n">Debugger</span>\<span class="n">AUTOEXP</span><span class="o">.</span><span class="n">DAT</span>
</pre></div>
</div>
<p>The file has information about the format in the beginning, and after a
little practice you should be well on your way. Here are some entries
that will make your life easier:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">;;</span> <span class="n">Mozilla</span> <span class="p">(</span><span class="mf">1.7</span><span class="n">beta</span> <span class="ow">and</span> <span class="n">later</span><span class="p">)</span>
<span class="n">nsAutoString</span><span class="o">=&lt;</span><span class="n">mData</span><span class="p">,</span><span class="n">su</span><span class="o">&gt;</span>
<span class="n">nsString</span><span class="o">=&lt;</span><span class="n">mData</span><span class="p">,</span><span class="n">su</span><span class="o">&gt;</span>
<span class="n">nsCString</span><span class="o">=&lt;</span><span class="n">mData</span><span class="p">,</span><span class="n">s</span><span class="o">&gt;</span>
<span class="n">nsCAutoString</span><span class="o">=&lt;</span><span class="n">mData</span><span class="p">,</span><span class="n">s</span><span class="o">&gt;</span>
<span class="n">nsRect</span><span class="o">=</span><span class="n">x</span><span class="o">=&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">d</span><span class="o">&gt;</span> <span class="n">y</span><span class="o">=&lt;</span><span class="n">y</span><span class="p">,</span><span class="n">d</span><span class="o">&gt;</span> <span class="n">width</span><span class="o">=&lt;</span><span class="n">width</span><span class="p">,</span><span class="n">d</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">height</span><span class="o">=&lt;</span><span class="n">height</span><span class="p">,</span><span class="n">d</span><span class="o">&gt;</span>
<span class="n">nsStaticAtomWrapper</span><span class="o">=&lt;</span><span class="n">mStaticAtom</span><span class="o">-&gt;</span><span class="n">mString</span><span class="p">,</span><span class="n">s</span><span class="o">&gt;</span>
<span class="n">nsIAtom</span><span class="o">=&lt;</span><span class="n">mString</span><span class="p">,</span><span class="n">su</span><span class="o">&gt;</span>
<span class="p">;</span> <span class="n">the</span> <span class="n">following</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">necessary</span> <span class="ow">in</span> <span class="n">vc8</span>
<span class="n">nsCOMPtr</span><span class="o">&lt;*&gt;=&lt;</span><span class="n">mRawPtr</span><span class="p">,</span><span class="n">x</span><span class="o">&gt;</span>
<span class="n">nsRefPtr</span><span class="o">=&lt;</span><span class="n">mRawPtr</span><span class="p">,</span><span class="n">x</span><span class="o">&gt;</span>
<span class="n">nsAutoPtr</span><span class="o">=&lt;</span><span class="n">mRawPtr</span><span class="p">,</span><span class="n">x</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>After you have made the changes and saved the file, you will need to
restart Visual C++ for the changes to take effect.</p>
<p>For XPCOM Strings (the “external” string API) you can use the following
values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">;;</span> <span class="n">Mozilla</span> <span class="p">(</span><span class="mf">1.9</span><span class="p">)</span>
<span class="p">;</span> <span class="n">Internal</span> <span class="n">Strings</span>
<span class="n">nsAString_internal</span><span class="o">=&lt;</span><span class="n">mData</span><span class="p">,</span><span class="n">su</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">length</span><span class="o">=&lt;</span><span class="n">mLength</span><span class="p">,</span><span class="n">u</span><span class="o">&gt;</span>
<span class="n">nsACString_internal</span><span class="o">=&lt;</span><span class="n">mData</span><span class="p">,</span><span class="n">s</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">length</span><span class="o">=&lt;</span><span class="n">mLength</span><span class="p">,</span><span class="n">u</span><span class="o">&gt;</span>
<span class="p">;</span> <span class="n">XPCOM</span> <span class="n">Strings</span>
<span class="n">nsAString</span><span class="o">=&lt;</span><span class="n">nsStringContainer</span><span class="o">.</span><span class="n">v</span><span class="p">,</span><span class="n">su</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">length</span><span class="o">=&lt;</span><span class="n">nsStringContainer</span><span class="o">.</span><span class="n">d1</span><span class="p">,</span><span class="n">u</span><span class="o">&gt;</span>
<span class="n">nsACString</span><span class="o">=&lt;</span><span class="n">nsCStringContainer</span><span class="o">.</span><span class="n">v</span><span class="p">,</span><span class="n">s</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">length</span><span class="o">=&lt;</span><span class="n">nsCStringContainer</span><span class="o">.</span><span class="n">d1</span><span class="p">,</span><span class="n">u</span><span class="o">&gt;</span>
<span class="n">nsStringContainer</span><span class="o">=&lt;</span><span class="n">v</span><span class="p">,</span><span class="n">su</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">length</span><span class="o">=&lt;</span><span class="n">d1</span><span class="p">,</span><span class="n">u</span><span class="o">&gt;</span>
<span class="n">nsCStringContainer</span><span class="o">=&lt;</span><span class="n">v</span><span class="p">,</span><span class="n">s</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">length</span><span class="o">=&lt;</span><span class="n">d1</span><span class="p">,</span><span class="n">u</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>There is a more extensive version of this file in progress in
<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Mozilla/Debugging/AutoExpForVC8">AutoExpForVC8.</a></p>
</div>
<div class="section" id="avoiding-stepping-into-certain-functions">
<h2>Avoiding stepping into certain functions<a class="headerlink" href="#avoiding-stepping-into-certain-functions" title="Permalink to this headline">¶</a></h2>
<p>You can avoid stepping into certain functions, such as nsCOMPtr methods,
using an undocumented feature of VC. See the blog post <a class="reference external" href="http://blogs.msdn.com/andypennell/archive/2004/02/06/69004.aspx">How to Not Step
Into Functions using the Visual C++
Debugger</a>
for details.</p>
<p>Here are some wildcards you can use (tested with VC 8):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nsCOMPtr</span><span class="o">.*</span>\<span class="p">:</span>\<span class="p">:</span><span class="o">.*=</span><span class="n">NoStepInto</span>
<span class="p">(</span><span class="n">nsG</span><span class="o">|</span><span class="n">g</span><span class="p">)</span><span class="n">etter_</span><span class="o">*</span><span class="n">AddRefs</span><span class="o">.*=</span><span class="n">NoStepInto</span>
<span class="n">NS_ConvertUTF</span><span class="o">.*</span>
<span class="p">;</span> <span class="n">Might</span> <span class="n">be</span> <span class="n">too</span> <span class="n">broad</span><span class="p">:</span>
<span class="p">(</span><span class="n">ns</span><span class="o">|</span><span class="n">Promise</span><span class="p">)[</span><span class="o">^</span>\<span class="p">:]</span><span class="o">*</span><span class="p">[</span><span class="n">sS</span><span class="p">]</span><span class="n">tring</span><span class="o">.*</span>
<span class="o">...</span><span class="n">add</span> <span class="n">common</span> <span class="n">functions</span> <span class="n">to</span> <span class="n">this</span> <span class="nb">list</span>
</pre></div>
</div>
<p>should probably make a .reg file for easy importing</p>
</div>
<div class="section" id="obtaining-stdout-and-other-file-handles">
<h2>Obtaining <code class="docutils literal notranslate"><span class="pre">stdout</span></code> and other <code class="docutils literal notranslate"><span class="pre">FILE</span></code> handles<a class="headerlink" href="#obtaining-stdout-and-other-file-handles" title="Permalink to this headline">¶</a></h2>
<p>Running the following command in the Command Window in Visual Studio
returns the value of <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, which can be used with various
debugging methods (such as <code class="docutils literal notranslate"><span class="pre">nsGenericElement::List</span></code>) that take a
<code class="docutils literal notranslate"><span class="pre">FILE*</span></code> param:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Debug</span><span class="o">.</span><span class="n">EvaluateStatement</span> <span class="p">{,,</span><span class="n">msvcr80d</span><span class="p">}(</span><span class="o">&amp;</span><span class="n">__iob_func</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>(Alternatively you can evaluate <code class="docutils literal notranslate"><span class="pre">{,,msvcr80d}(&amp;__iob_func()[1])</span></code> in
the QuickWatch window)</p>
<p>Similarly, you can open a file on the disk using <code class="docutils literal notranslate"><span class="pre">fopen</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">Debug</span><span class="o">.</span><span class="n">EvaluateStatement</span> <span class="p">{,,</span><span class="n">msvcr80d</span><span class="p">}</span><span class="n">fopen</span><span class="p">(</span><span class="s2">&quot;c:</span><span class="se">\\</span><span class="s2">123&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="mh">0x10311dc0</span> <span class="p">{</span> <span class="o">..</span><span class="n">snip</span><span class="o">..</span> <span class="p">}</span>
<span class="o">&gt;</span><span class="n">Debug</span><span class="o">.</span><span class="n">EvaluateStatement</span> <span class="p">((</span><span class="n">nsGenericElement</span><span class="o">*</span><span class="p">)</span><span class="mh">0x03f0e710</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">List</span><span class="p">((</span><span class="n">FILE</span><span class="o">*</span><span class="p">)</span><span class="mh">0x10311dc0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">void</span><span class="o">&gt;</span>
<span class="o">&gt;</span><span class="n">Debug</span><span class="o">.</span><span class="n">EvaluateStatement</span> <span class="p">{,,</span><span class="n">msvcr80d</span><span class="p">}</span><span class="n">fclose</span><span class="p">((</span><span class="n">FILE</span><span class="o">*</span><span class="p">)</span><span class="mh">0x10311dc0</span><span class="p">)</span>
<span class="mh">0x00000000</span>
</pre></div>
</div>
<p>Note that you may not see the debugging output until you flush or close
the file handle.</p>
</div>
<div class="section" id="disabling-assertions">
<h2>Disabling ASSERTIONS<a class="headerlink" href="#disabling-assertions" title="Permalink to this headline">¶</a></h2>
<p>There are basically two ways to disable assertions. One requires setting
an environment variable, while the other affects only the currently
running program instance in memory.</p>
<div class="section" id="environment-variable">
<h3>Environment variable<a class="headerlink" href="#environment-variable" title="Permalink to this headline">¶</a></h3>
<p>There is an environment variable that can disable breaking for
assertions. This is how you would normally set it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">XPCOM_DEBUG_BREAK</span><span class="o">=</span><span class="n">warn</span>
</pre></div>
</div>
<p>The environment variable takes also other values besides <code class="docutils literal notranslate"><span class="pre">warn</span></code>, see
<code class="docutils literal notranslate"><span class="pre">XPCOM_DEBUG_BREAK</span></code> for more details.</p>
<p>Note that unlike Unix, the default for Windows is not warn, it’s to pop
up a dialog. To set the environment variable for Visual Studio, use
Project &gt; Properties &gt; Debugging &gt; Environment and click the little box.
Then use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">XPCOM_DEBUG_BREAK</span><span class="o">=</span><span class="n">warn</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-running-code">
<h3>Changing running code<a class="headerlink" href="#changing-running-code" title="Permalink to this headline">¶</a></h3>
<p>You normally shouldn’t need to do this (just quit the application, set
the environment variable described above, and run it again). And this
can be <strong>dangerous</strong> (like <strong>trashing your hard disc and corrupting your
system</strong>). So unless you feel comfortable with this, don’t do it. <strong>You
have been warned!</strong></p>
<p>It is possible to change the interrupt code in memory (which causes you
to break into debugger) to be a NOP (no operation).</p>
<p>You do this by running the program in the debugger until you hit an
assertion. You should see some assembly code. One assemly code
instruction reads “int 3”. Check the memory address for that line. Now
open memory view. Type/copy/drag the memory address of “int 3” into the
memory view to get it to update on that part of the memory. Change the
value of the memory to “90”, close the memory view and hit “F5” to
continue.</p>
<div class="line-block">
<div class="line">Confused? See the screenshot below:</div>
<div class="line"><img alt="Screenshot of disabling assertions" class="internal" src="https://developer.mozilla.org/&#64;api/deki/files/420/=Win32-debug-nop.png" /></div>
</div>
<p>VC++ 7.0?</p>
</div>
</div>
<div class="section" id="automatically-handling-assertions-without-a-debugger-attached">
<h2>Automatically handling ASSERTIONS without a debugger attached<a class="headerlink" href="#automatically-handling-assertions-without-a-debugger-attached" title="Permalink to this headline">¶</a></h2>
<p>When an assertion happens and there is not a debugger attached, a small
helper application
(<code class="docutils literal notranslate"><span class="pre">`windbgdlg.exe</span></code> &lt;/En/Automatically_Handle_Failed_Asserts_in_Debug_Builds&gt;`__)
is run. That application can automatically select a response to the “Do
you want to debug” dialog instead of prompting if you configure it, for
more info, see
<code class="docutils literal notranslate"><span class="pre">`windbgdlg.exe</span></code> &lt;/En/Automatically_Handle_Failed_Asserts_in_Debug_Builds&gt;`__.</p>
</div>
<div class="section" id="debugging-optimized-builds">
<h2>Debugging optimized builds<a class="headerlink" href="#debugging-optimized-builds" title="Permalink to this headline">¶</a></h2>
<p>To effectively debug optimized builds, you should enable debugging
information which effectively leaves the debug symbols in optimized code
so you can still set breakpoints etc. Because the code is optimized,
stepping through the code may occasionally provide small surprises when
the debugger jumps over something.</p>
<p>You need to make sure this configure parameter is set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">debugger</span><span class="o">-</span><span class="n">info</span><span class="o">-</span><span class="n">modules</span><span class="o">=</span><span class="n">yes</span>
</pre></div>
</div>
<p>You can also choose to include or exclude specific modules. This is
particularly useful to avoid linking layout with debugging information.</p>
</div>
<div class="section" id="console-debugging">
<h2>Console debugging<a class="headerlink" href="#console-debugging" title="Permalink to this headline">¶</a></h2>
<p>When printing to STDOUT from a content process, the console message will
not appear on Windows. One way to view it is simply to disable e10s
(<code class="docutils literal notranslate"><span class="pre">./mach</span> <span class="pre">run</span> <span class="pre">--disable-e10s</span></code>) but in order to debug with e10s enabled
one can run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">mach</span> <span class="n">run</span> <span class="o">...</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">tee</span>
</pre></div>
</div>
<p>It may also be necessary to disable the content sandbox
(<code class="docutils literal notranslate"><span class="pre">MOZ_DISABLE_CONTENT_SANDBOX=1</span> <span class="pre">./mach</span> <span class="pre">run</span> <span class="pre">...</span></code>).</p>
</div>
<div class="section" id="running-two-instances-of-mozilla-simultaneously">
<h2>Running two instances of Mozilla simultaneously<a class="headerlink" href="#running-two-instances-of-mozilla-simultaneously" title="Permalink to this headline">¶</a></h2>
<p>You can run two instances of Mozilla (e.g. debug and optimized)
simultaneously by setting the environment variable <code class="docutils literal notranslate"><span class="pre">MOZ_NO_REMOTE</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">MOZ_NO_REMOTE</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>Or, starting with Firefox 2 and other Gecko 1.8.1-based applications,
you can use the <code class="docutils literal notranslate"><span class="pre">-no-remote</span></code> command-line switch instead (implemented
in
<a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=325509">bug 325509</a>).</p>
<p>You can also specify the profile to use with the <code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">profile_name</span></code>
command-line argument.</p>
</div>
<div class="section" id="debugging-javascript">
<h2>Debugging JavaScript<a class="headerlink" href="#debugging-javascript" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Archive/Mozilla/Venkman">Venkman</a>, the JavaScript Debugger for Mozilla.</p>
<p>You can use helper functions from
<a class="reference external" href="https://searchfox.org/mozilla-central/source/js/xpconnect/src/nsXPConnect.cpp">nsXPConnect.cpp</a>
to inspect and modify the state of JavaScript code from the MSVS
debugger.</p>
<p>For example, to print current JavaScript stack to stdout, evaluate this
in QuickWatch window:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{,,</span><span class="n">xul</span><span class="p">}</span><span class="n">DumpJSStack</span><span class="p">()</span>
</pre></div>
</div>
<p>Visual C++ will show you something in the quick watch window, but
not the stack, you have to look in the OS console for the output.</p>
<p>Also this magical command only works when the VC++ stack is in certain
states. It works when you have js_Interpret() in the newest stackframe</p>
</div>
<div class="section" id="debugging-minidumps">
<h2>Debugging minidumps<a class="headerlink" href="#debugging-minidumps" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="debugging_a_minidump.html#debugging-a-minidump"><span class="std std-ref">debugging a minidump</span></a>.</p>
</div>
<div class="section" id="debugging-tinderbox-builds">
<h2>Debugging tinderbox builds<a class="headerlink" href="#debugging-tinderbox-builds" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Archive/Mozilla/Running_Windows_Debug_Builds">Running Windows Debug Builds</a></p>
</div>
<div class="section" id="problems-loading-debug-symbols">
<h2>Problems Loading Debug Symbols<a class="headerlink" href="#problems-loading-debug-symbols" title="Permalink to this headline">¶</a></h2>
<p>If both your application and Visual C++ hang shortly after launching the
application under the debugger, you may be hitting a known deadlock in
the way Visual Studio downloads debug symbols for the system libraries;
see
<a class="reference external" href="https://connect.microsoft.com/VisualStudio/feedback/details/422970/hang-loading-rasapi32-pdb-when-using-symbol-server">https://connect.microsoft.com/VisualStudio/feedback/details/422970/hang-loading-rasapi32-pdb-when-using-symbol-server</a>.</p>
<p>There are two ways to work around this problem:</p>
<ol class="arabic">
<li><p>Turn off automatic symbol downloading for system libraries: in Tools
&gt; Options &gt; Debugging &gt; Symbols, uncheck the Microsoft symbol server.</p></li>
<li><p>Pre-load all the Windows debug symbols. These instructions apply to
Visual Studio 10 on Windows 7; other software versions likely need to
have file paths adjusted.</p>
<ol class="arabic">
<li><p>Locate the Microsoft utility “SymChk.exe” on your system (it will
likely be in the installation directory of your Windows Debugging
Tools).</p></li>
<li><p>Find the directory where Visual Studio caches downloaded symbols;
in VC++ 10 open the menu to Tools &gt; Options &gt; Debugging  &gt; Symbols
and copy the field “Cache symbols in this directory”.</p></li>
<li><p>In a command window, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symchk</span><span class="o">.</span><span class="n">exe</span> <span class="o">/</span><span class="n">r</span> <span class="n">C</span><span class="p">:</span>\<span class="n">windows</span>\<span class="n">SysWOW64</span>\ <span class="o">/</span><span class="n">s</span> <span class="s2">&quot;SRV*&lt;your cache symbols directory&gt;\MicrosoftPublicSymbols*http://msdl.microsoft.com/download/symbols&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Note the “<code class="docutils literal notranslate"><span class="pre">\MicrosoftPublicSymbols</span></code>” appended to the cache
directory configured in Visual Studio.</div>
</div>
</li>
</ol>
</li>
</ol>
<p>Downloading all symbols can take a long time; you can replace
C:windowsSysWOW64\ with the name of a single .DLL to download symbols
only for the specific libraries you are trying to debug. Unfortunately,
it’s hard to know which symbols to download without having VS hang and
seeing the “Downloading symbols for &lt;library&gt;” status at the bottom left
of the main window.</p>
</div>
<div class="section" id="problems-post-mortem-debugging-on-windows-7-sp1-x64">
<h2>Problems post-mortem debugging on Windows 7 SP1 x64?<a class="headerlink" href="#problems-post-mortem-debugging-on-windows-7-sp1-x64" title="Permalink to this headline">¶</a></h2>
<p>If you attempt to use <code class="docutils literal notranslate"><span class="pre">NS_DebugBreak</span></code> etc to perform post-mortem
debugging on a 64bit Windows 7, but as soon as you try and continue
debugging the program crashes with an Access Violation, you may be
hitting a Windows bug relating to AVX support.  For more details,
including a work-around see <a class="reference external" href="http://www.os2museum.com/wp/?p=960">this blog
post</a> or <a class="reference external" href="http://social.msdn.microsoft.com/Forums/vstudio/en-US/392ca62c-e502-42d9-adbc-b4e22d5da0c3/jit-debugging-32bit-app-crashing-with-access-violation">this social.msdn
thread</a>.
(And just in-case those links die, the work-around is to execute</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bcdedit</span> <span class="o">/</span><span class="nb">set</span> <span class="n">xsavedisable</span> <span class="mi">1</span>
</pre></div>
</div>
<p>from an elevated command-prompt to disable AVX support.)</p>
</div>
<div class="section" id="got-a-tip">
<h2>Got a tip?<a class="headerlink" href="#got-a-tip" title="Permalink to this headline">¶</a></h2>
<p>If you think you know a cool Mozilla debugging trick, feel free to
discuss it with <a class="reference external" href="https://chat.mozilla.org/#/room/#developers:mozilla.org">#developers</a> and
then post it here.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="process_dump_task_manager.html" class="btn btn-neutral float-right" title="How to get a process dump with Windows Task Manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="debugging_on_mac_os_x.html" class="btn btn-neutral float-left" title="Debugging On Mac Os X" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>