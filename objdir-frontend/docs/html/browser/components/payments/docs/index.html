

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>WebPayments UI &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="DOM" href="../../../../dom/index.html" />
    <link rel="prev" title="UITour library API" href="../../uitour/docs/UITour-lib.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Firefox</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../urlbar/index.html">Address Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../BrowserUsageTelemetry.html">Browser Usage Telemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../enterprisepolicies/docs/index.html">Enterprise Policies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extensions/formautofill/docs/index.html">Form Autofill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../newtab/docs/index.html">Firefox Home (New Tab)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installer/windows/installer/index.html">Installer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../toolkit/mozapps/defaultagent/default-browser-agent/index.html">Default Browser Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../newtab/content-src/asrouter/docs/index.html">Messaging System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../base/sslerrorreport/index.html">SSL Error Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../base/tabbrowser/index.html">tabbrowser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../touchbar/index.html">Touch Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../uitour/docs/index.html">UITour</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">WebPayments UI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debugging-development">Debugging/Development</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#must-have-electrolysis">Must Have Electrolysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unprivileged-ui-development">Unprivileged UI Development</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging-console">Debugging Console</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dialog-architecture">Dialog Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#communication-with-the-dom">Communication with the DOM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-elements">Custom Elements</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Firefox</a> &raquo;</li>
        
      <li>WebPayments UI</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/browser/components/payments/docs/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="webpayments-ui">
<h1>WebPayments UI<a class="headerlink" href="#webpayments-ui" title="Permalink to this headline">¶</a></h1>
<p>User Interface for the WebPayments <a class="reference external" href="https://w3c.github.io/browser-payment-api/">Payment Request API</a> and <a class="reference external" href="https://w3c.github.io/payment-handler/">Payment Handler API</a>.</p>
<blockquote>
<div><p><a class="reference external" href="https://wiki.mozilla.org/Firefox/Features/Web_Payments">Project Wiki</a> |
<a class="reference external" href="ircs://irc.mozilla.org:6697/payments">#payments on IRC</a> |
<a class="reference external" href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Firefox&amp;component=WebPayments%20UI&amp;status_whiteboard=[webpayments]%20[triage]">File a bug</a></p>
</div></blockquote>
<p>JSDoc style comments are used within the JS files of the component. This document will focus on higher-level and shared concepts.</p>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="debugging-development">
<h2>Debugging/Development<a class="headerlink" href="#debugging-development" title="Permalink to this headline">¶</a></h2>
<p>Relevant preferences: <code class="docutils literal notranslate"><span class="pre">dom.payments.*</span></code></p>
<div class="section" id="must-have-electrolysis">
<h3>Must Have Electrolysis<a class="headerlink" href="#must-have-electrolysis" title="Permalink to this headline">¶</a></h3>
<p>Web Payments <a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1365964">does not work without e10s</a>!</p>
</div>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<p>Set the pref <code class="docutils literal notranslate"><span class="pre">dom.payments.loglevel</span></code> to “Debug” to increase the verbosity of console messages.</p>
</div>
<div class="section" id="unprivileged-ui-development">
<h3>Unprivileged UI Development<a class="headerlink" href="#unprivileged-ui-development" title="Permalink to this headline">¶</a></h3>
<p>During development of the unprivileged custom elements, you can load the dialog in a tab with
the url <cite>resource://payments/paymentRequest.xhtml</cite>.
You can then use the debugging console to load sample data. Autofill add/edit form strings
will not appear when developing this way until they are converted to FTL.
You can force localization of Form Autofill strings using the following in the Browser Console when
the <cite>paymentRequest.xhtml</cite> tab is selected then reloading:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gBrowser</span><span class="o">.</span><span class="n">selectedBrowser</span><span class="o">.</span><span class="n">messageManager</span><span class="o">.</span><span class="n">loadFrameScript</span><span class="p">(</span><span class="s2">&quot;chrome://formautofill/content/l10n.js&quot;</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="debugging-console">
<h3>Debugging Console<a class="headerlink" href="#debugging-console" title="Permalink to this headline">¶</a></h3>
<p>To open the debugging console in the dialog, use the keyboard shortcut
<strong>Ctrl-Alt-d (Ctrl-Option-d on macOS)</strong>. While loading <cite>paymentRequest.xhtml</cite> directly in the
browser, add <cite>?debug=1</cite> to have the debugging console open by default.</p>
<div class="section" id="debugging-the-unprivileged-frame-with-the-developer-tools">
<h4>Debugging the unprivileged frame with the developer tools<a class="headerlink" href="#debugging-the-unprivileged-frame-with-the-developer-tools" title="Permalink to this headline">¶</a></h4>
<p>To open a debugger in the context of the remote payment frame, click the “Debug frame” button in the
debugging console.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">tabs</span></code> variable in the Browser Content Toolbox’s console to access the frame contents.
There can be multiple frames loaded in the same process so you will need to find the correct tab
in the array by checking the file name is <cite>paymentRequest.xhtml</cite> (e.g. <code class="docutils literal notranslate"><span class="pre">tabs[0].content.location</span></code>).</p>
</div>
</div>
</div>
<div class="section" id="dialog-architecture">
<h2>Dialog Architecture<a class="headerlink" href="#dialog-architecture" title="Permalink to this headline">¶</a></h2>
<p>A remote <code class="docutils literal notranslate"><span class="pre">&lt;xul:browser=&quot;true&quot;</span> <span class="pre">remote=&quot;true&quot;&gt;</span></code> is <a class="reference external" href="https://searchfox.org/mozilla-central/search?q=%20_createPaymentFrame&amp;case=false&amp;regexp=false&amp;path=">added to the Browser Window</a>
containing unprivileged XHTML (paymentRequest.xhtml).
Keeping the dialog contents unprivileged is useful since the dialog will render payment line items and shipping options that are provided by web developers and should therefore be considered untrusted.
In order to communicate across the process boundary a privileged frame script (<cite>paymentDialogFrameScript.js</cite>) is loaded into the iframe to relay messages.
This is because the unprivileged document cannot access message managers.
Instead, all communication across the privileged/unprivileged boundary is done via custom DOM events:</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">paymentContentToChrome</span></code> event is dispatched when the dialog contents want to communicate with the privileged dialog wrapper.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">paymentChromeToContent</span></code> event is dispatched on the <code class="docutils literal notranslate"><span class="pre">window</span></code> with the <code class="docutils literal notranslate"><span class="pre">detail</span></code> property populated when the privileged dialog wrapper communicates with the unprivileged dialog.</p></li>
</ul>
<p>These events are converted to/from message manager messages of the same name to communicate to the other process.
The purpose of <cite>paymentDialogFrameScript.js</cite> is to simply convert unprivileged DOM events to/from messages from the other process.</p>
<p>The dialog depends on the add/edit forms and storage from <a class="reference internal" href="../../../extensions/formautofill/docs/index.html"><span class="doc">Form Autofill</span></a> for addresses and credit cards.</p>
<div class="section" id="communication-with-the-dom">
<h3>Communication with the DOM<a class="headerlink" href="#communication-with-the-dom" title="Permalink to this headline">¶</a></h3>
<p>Communication from the DOM to the UI happens via the <cite>paymentUIService.js</cite> (implementing <code class="docutils literal notranslate"><span class="pre">nsIPaymentUIService</span></code>).
The UI talks to the DOM code via the <code class="docutils literal notranslate"><span class="pre">nsIPaymentRequestService</span></code> interface.</p>
</div>
<div class="section" id="custom-elements">
<h3>Custom Elements<a class="headerlink" href="#custom-elements" title="Permalink to this headline">¶</a></h3>
<p>The Payment Request UI uses <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements">Custom Elements</a> for the UI components.</p>
<p>Some guidelines:</p>
<ul class="simple">
<li><p>There are some <a class="reference external" href="https://searchfox.org/mozilla-central/source/browser/components/payments/res/mixins/">mixins</a>
to provide commonly needed functionality to a custom element.</p></li>
<li><p><a class="reference external" href="https://searchfox.org/mozilla-central/source/browser/components/payments/res/containers/">res/containers/</a>
contains elements that react to application state changes,
<a class="reference external" href="https://searchfox.org/mozilla-central/source/browser/components/payments/res/components">res/components/</a>
contains elements that aren’t connected to the state directly.</p></li>
<li><p>Elements should avoid having their own internal/private state and should react to state changes.
Containers primarily use the application state (<code class="docutils literal notranslate"><span class="pre">requestStore</span></code>) while components primarily use attributes.</p></li>
<li><p>If you’re overriding a lifecycle callback, don’t forget to call that method on
<code class="docutils literal notranslate"><span class="pre">super</span></code> from the implementation to ensure that mixins and ancestor classes
work properly.</p></li>
<li><p>From within a custom element, don’t use <code class="docutils literal notranslate"><span class="pre">document.getElementById</span></code> or
<code class="docutils literal notranslate"><span class="pre">document.querySelector*</span></code> because they can return elements that are outside
of the component, thus breaking the modularization. It can also cause problems
if the elements you’re looking for aren’t attached to the document yet. Use
<code class="docutils literal notranslate"><span class="pre">querySelector*</span></code> on <code class="docutils literal notranslate"><span class="pre">this</span></code> (the custom element) or one of its descendants
instead.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../../dom/index.html" class="btn btn-neutral float-right" title="DOM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../uitour/docs/UITour-lib.html" class="btn btn-neutral float-left" title="UITour library API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>