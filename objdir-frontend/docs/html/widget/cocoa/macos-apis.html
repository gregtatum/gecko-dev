

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using macOS APIs &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="A primer on macOS SDKs" href="sdks.html" />
    <link rel="prev" title="Firefox on macOS" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Firefox on macOS</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using macOS APIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#availability-of-apis-and-runtime-checks">Availability of APIs, and runtime checks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#frameworks">Frameworks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-new-apis-with-old-sdks">Using new APIs with old SDKs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enum-types-and-c-structs">Enum types and C structs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#new-enum-values-for-existing-enum-type">New enum values for existing enum type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#objective-c-classes">Objective-C classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#objective-c-properties-and-methods-on-an-existing-class">Objective-C properties and methods on an existing class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#notes-on-rust">Notes on Rust</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sdks.html">A primer on macOS SDKs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Firefox on macOS</a> &raquo;</li>
        
      <li>Using macOS APIs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/widget/cocoa/macos-apis.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-macos-apis">
<h1>Using macOS APIs<a class="headerlink" href="#using-macos-apis" title="Permalink to this headline">¶</a></h1>
<p>With each new macOS release, new APIs are added. Due to the wide range of platforms that Firefox runs on,
and due to the <a class="reference external" href="./sdks.html#supported-sdks">wide range of SDKs that we support building with</a>,
using macOS APIs in Firefox requires some extra care.</p>
<div class="section" id="availability-of-apis-and-runtime-checks">
<h2>Availability of APIs, and runtime checks<a class="headerlink" href="#availability-of-apis-and-runtime-checks" title="Permalink to this headline">¶</a></h2>
<p>First of all, if you use an API that is supported by all versions of macOS that Firefox runs on,
i.e. 10.9 and above, then you don’t need to worry about anything:
The API declaration will be present in any of the supported SDKs, and you don’t need any runtime checks.</p>
<p>If you want to use a macOS API that was added after 10.9, then you have to have a runtime check.
This requirement is completely independent of what SDK is being used for building.</p>
<p>The runtime check <a class="reference external" href="https://developer.apple.com/documentation/macos_release_notes/macos_mojave_10_14_release_notes/appkit_release_notes_for_macos_10_14?language=objc#3014609">should have the following form</a>
(replace <code class="docutils literal notranslate"><span class="pre">10.14</span></code> with the appropriate version):</p>
<div class="highlight-objc++ notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.14</span><span class="p">,</span> <span class="o">*</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Code for macOS 10.14 or later</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Code for versions earlier than 10.14.</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;available</span></code> guards can be used in Objective-C(++) code.
(In C++ code, you can use <a class="reference external" href="https://searchfox.org/mozilla-central/rev/9ad88f80aeedcd3cd7d7f63be07f577861727054/widget/cocoa/nsCocoaFeatures.h#21-27">these <code class="docutils literal notranslate"><span class="pre">nsCocoaFeatures</span></code> methods</a> instead.)</p>
<p>For each API, the API declarations in the SDK headers are annotated with <code class="docutils literal notranslate"><span class="pre">API_AVAILABLE</span></code> macros.
For example, the definition of the <code class="docutils literal notranslate"><span class="pre">NSVisualEffectMaterial</span></code> enum looks like this:</p>
<div class="highlight-objc++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="nf">NS_ENUM</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">,</span> <span class="n">NSVisualEffectMaterial</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSVisualEffectMaterialTitlebar</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">NSVisualEffectMaterialSelection</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">NSVisualEffectMaterialMenu</span> <span class="n">API_AVAILABLE</span><span class="p">(</span><span class="n">macos</span><span class="p">(</span><span class="mf">10.11</span><span class="p">))</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
   <span class="c1">// [...]</span>
    <span class="n">NSVisualEffectMaterialSheet</span> <span class="n">API_AVAILABLE</span><span class="p">(</span><span class="n">macos</span><span class="p">(</span><span class="mf">10.14</span><span class="p">))</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
   <span class="c1">// [...]</span>
<span class="p">}</span> <span class="n">API_AVAILABLE</span><span class="p">(</span><span class="n">macos</span><span class="p">(</span><span class="mf">10.10</span><span class="p">));</span>
</pre></div>
</div>
<p>The compiler understands these annotations and makes sure that you wrap all uses of the annotated APIs
in appropriate <code class="docutils literal notranslate"><span class="pre">&#64;available</span></code> runtime checks.</p>
<div class="section" id="frameworks">
<h3>Frameworks<a class="headerlink" href="#frameworks" title="Permalink to this headline">¶</a></h3>
<p>In some rare cases, you need functionality from frameworks that are not available on all supported macOS versions.
Examples of this are <code class="docutils literal notranslate"><span class="pre">Metal.framework</span></code> (added in 10.11) and <code class="docutils literal notranslate"><span class="pre">MediaPlayer.framework</span></code> (added in 10.12.2).</p>
<p>In that case, you can either <code class="docutils literal notranslate"><span class="pre">dlopen</span></code> your framework at runtime (<a class="reference external" href="https://searchfox.org/mozilla-central/rev/9ad88f80aeedcd3cd7d7f63be07f577861727054/widget/cocoa/MediaPlayerWrapper.mm#21-27">like we do for MediaPlayer</a>),
or you can <a class="reference external" href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Concepts/WeakLinking.html#//apple_ref/doc/uid/20002378-107026">use <code class="docutils literal notranslate"><span class="pre">-weak_framework</span></code></a>
<a class="reference external" href="https://searchfox.org/mozilla-central/rev/9ad88f80aeedcd3cd7d7f63be07f577861727054/toolkit/library/moz.build#301-304">like we do for Metal</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">CONFIG</span><span class="p">[</span><span class="s1">&#39;OS_ARCH&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
    <span class="n">OS_LIBS</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="c1"># Link to Metal as required by the Metal gfx-hal backend</span>
        <span class="s1">&#39;-weak_framework Metal&#39;</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-new-apis-with-old-sdks">
<h2>Using new APIs with old SDKs<a class="headerlink" href="#using-new-apis-with-old-sdks" title="Permalink to this headline">¶</a></h2>
<p>If you want to use an API that was introduced after 10.11, you now have one extra thing to worry about.
In addition to the runtime check <a class="reference external" href="#using-macos-apis">described in the previous section</a>, you also
have to jump through extra hoops in order to allow the build to succeed with older SDKs, because
<a class="reference external" href="./sdks.html#supported-sdks">we need to support building Firefox with SDK versions all the way down to the 10.11 SDK</a>.</p>
<p>In order to make the compiler accept your code, you will need to copy some amount of the API declaration
into your own code. Copy it from the newest recent SDK you can get your hands on.
The exact procedure varies based on the type of API (enum, objc class, method, etc.),
but the general approach looks like this:</p>
<div class="highlight-objc++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#if !defined(MAC_OS_X_VERSION_10_12) || MAC_OS_X_VERSION_MAX_ALLOWED &lt; MAC_OS_X_VERSION_10_12</span>
<span class="k">@interface</span> <span class="nc">NSWindow</span> <span class="nl">(AutomaticWindowTabbing)</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">class</span><span class="p">)</span> <span class="kt">BOOL</span> <span class="n">allowsAutomaticWindowTabbing</span> <span class="n">API_AVAILABLE</span><span class="p">(</span><span class="n">macos</span><span class="p">(</span><span class="mf">10.12</span><span class="p">));</span>
<span class="k">@end</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="./sdks.html#supporting-multiple-sdks">Supporting Multiple SDKs</a> docs for more information on the <code class="docutils literal notranslate"><span class="pre">MAC_OS_X_VERSION_MAX_ALLOWED</span></code> macro.</p>
<p>Keep these three things in mind:</p>
<ul class="simple">
<li><p>Copy only what you need.</p></li>
<li><p>Wrap your declaration in <code class="docutils literal notranslate"><span class="pre">MAC_OS_X_VERSION_MAX_ALLOWED</span></code> checks so that, if an SDK is used that
already contains these declarations, your declaration does not conflict with the declaration in the SDK.</p></li>
<li><p>Include the <code class="docutils literal notranslate"><span class="pre">API_AVAILABLE</span></code> annotations so that the compiler can protect you from accidentally
calling the API on unsupported macOS versions.</p></li>
</ul>
<p>Our current code does not always follow the <code class="docutils literal notranslate"><span class="pre">API_AVAILABLE</span></code> advice, but it should.</p>
<div class="section" id="enum-types-and-c-structs">
<h3>Enum types and C structs<a class="headerlink" href="#enum-types-and-c-structs" title="Permalink to this headline">¶</a></h3>
<p>If you need a new enum type or C struct, copy the entire type declaration and wrap it in the appropriate ifdefs. Example:</p>
<div class="highlight-objc++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#if !defined(MAC_OS_X_VERSION_10_12_2) || MAC_OS_X_VERSION_MAX_ALLOWED &lt; MAC_OS_X_VERSION_10_12_2</span>
<span class="k">typedef</span> <span class="nf">NS_ENUM</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">,</span> <span class="n">MPNowPlayingPlaybackState</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">MPNowPlayingPlaybackStateUnknown</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">MPNowPlayingPlaybackStatePlaying</span><span class="p">,</span>
    <span class="n">MPNowPlayingPlaybackStatePaused</span><span class="p">,</span>
    <span class="n">MPNowPlayingPlaybackStateStopped</span><span class="p">,</span>
    <span class="n">MPNowPlayingPlaybackStateInterrupted</span>
<span class="p">}</span> <span class="n">MP_API</span><span class="p">(</span><span class="n">ios</span><span class="p">(</span><span class="mf">11.0</span><span class="p">),</span> <span class="n">tvos</span><span class="p">(</span><span class="mf">11.0</span><span class="p">),</span> <span class="n">macos</span><span class="p">(</span><span class="mf">10.12.2</span><span class="p">),</span> <span class="n">watchos</span><span class="p">(</span><span class="mf">5.0</span><span class="p">));</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="section" id="new-enum-values-for-existing-enum-type">
<h3>New enum values for existing enum type<a class="headerlink" href="#new-enum-values-for-existing-enum-type" title="Permalink to this headline">¶</a></h3>
<p>If the enum type itself already exists, but gained a new value, define the value in an unnamed enum:</p>
<div class="highlight-objc++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#if !defined(MAC_OS_X_VERSION_10_12) || MAC_OS_X_VERSION_MAX_ALLOWED &lt; MAC_OS_X_VERSION_10_12</span>
<span class="k">enum</span> <span class="p">{</span> <span class="n">NSVisualEffectMaterialSelection</span> <span class="o">=</span> <span class="mi">4</span> <span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>(This is an example of an interesting case: <code class="docutils literal notranslate"><span class="pre">NSVisualEffectMaterialSelection</span></code> is available starting with
macOS 10.10, but it’s only defined in SDKs starting with the 10.12 SDK.)</p>
</div>
<div class="section" id="objective-c-classes">
<h3>Objective-C classes<a class="headerlink" href="#objective-c-classes" title="Permalink to this headline">¶</a></h3>
<p>For a new Objective-C class, copy the entire <code class="docutils literal notranslate"><span class="pre">&#64;interface</span></code> declaration and wrap it in the appropriate ifdefs.</p>
<p>I haven’t personally tested this. If this does not compile (or maybe link?), you can use the following workaround:</p>
<ul class="simple">
<li><p>Define your methods and properties as a category on <code class="docutils literal notranslate"><span class="pre">NSObject</span></code>.</p></li>
<li><p>Look up the class at runtime using <code class="docutils literal notranslate"><span class="pre">NSClassFromString()</span></code>.</p></li>
<li><p>If you need to create a subclass, do it at runtime using <code class="docutils literal notranslate"><span class="pre">objc_allocateClassPair</span></code> and <code class="docutils literal notranslate"><span class="pre">class_addMethod</span></code>.
<a class="reference external" href="https://searchfox.org/mozilla-central/rev/9ad88f80aeedcd3cd7d7f63be07f577861727054/widget/cocoa/VibrancyManager.mm#44-60">Here’s an example of that.</a></p></li>
</ul>
</div>
<div class="section" id="objective-c-properties-and-methods-on-an-existing-class">
<h3>Objective-C properties and methods on an existing class<a class="headerlink" href="#objective-c-properties-and-methods-on-an-existing-class" title="Permalink to this headline">¶</a></h3>
<p>If an Objective-C class that already exists gains a new method or property, you can “add” it to the
existing class declaration with the help of a <a class="reference external" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html">category</a>:</p>
<div class="highlight-objc++ notranslate"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">ExistingClass</span> <span class="nl">(YourMadeUpCategoryName)</span>
<span class="c1">// methods and properties here</span>
<span class="k">@end</span>
</pre></div>
</div>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p>With free-standing functions I’m not entirely sure what to do.
In theory, copying the declarations from the new SDK headers should work. Example:</p>
<div class="highlight-objc++ notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
  <span class="n">__attribute__</span><span class="p">((</span><span class="n">warn_unused_result</span><span class="p">))</span> <span class="kt">bool</span>
<span class="n">SecTrustEvaluateWithError</span><span class="p">(</span><span class="n">SecTrustRef</span> <span class="n">trust</span><span class="p">,</span> <span class="n">CFErrorRef</span> <span class="n">_Nullable</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">CF_RETURNS_RETAINED</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">API_AVAILABLE</span><span class="p">(</span><span class="n">macos</span><span class="p">(</span><span class="mf">10.14</span><span class="p">),</span> <span class="n">ios</span><span class="p">(</span><span class="mf">12.0</span><span class="p">),</span> <span class="n">tvos</span><span class="p">(</span><span class="mf">12.0</span><span class="p">),</span> <span class="n">watchos</span><span class="p">(</span><span class="mf">5.0</span><span class="p">));</span>

  <span class="n">__nullable</span>
<span class="n">CFDataRef</span> <span class="n">SecCertificateCopyNormalizedSubjectSequence</span><span class="p">(</span><span class="n">SecCertificateRef</span> <span class="n">certificate</span><span class="p">)</span>
    <span class="n">__OSX_AVAILABLE_STARTING</span><span class="p">(</span><span class="n">__MAC_10_12_4</span><span class="p">,</span> <span class="n">__IPHONE_10_3</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>I’m not sure what the linker or the dynamic linker do when the symbol is not available.
Does this require <a class="reference external" href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Concepts/WeakLinking.html#//apple_ref/doc/uid/20002378-107262-CJBJAEID"><code class="docutils literal notranslate"><span class="pre">__attribute__((weak_import))</span></code> annotations</a>?</p>
<p>And maybe this is where .tbd files in the SDK come in? So that the linker knows which symbols to allow?
So then that part cannot be worked around by copying code from headers.</p>
<p>Anyway, what always works is the pure runtime approach:</p>
<ol class="simple">
<li><p>Define types for the functions you need, but not the functions themselves.</p></li>
<li><p>At runtime, look up the functions using <code class="docutils literal notranslate"><span class="pre">dlsym</span></code>.</p></li>
</ol>
</div>
</div>
<div class="section" id="notes-on-rust">
<h2>Notes on Rust<a class="headerlink" href="#notes-on-rust" title="Permalink to this headline">¶</a></h2>
<p>If you call macOS APIs from Rust code, you’re kind of on your own. Apple does not provide any Rust
“headers”, so there isn’t really an SDK to speak of. So you have to supply your own API declarations
anyway, regardless of what SDK is being used for building.</p>
<p>In a way, you’re side-stepping some of the build time trouble. You don’t need to worry about any
<code class="docutils literal notranslate"><span class="pre">#ifdefs</span></code> because there are no system headers you could conflict with.</p>
<p>On the other hand, you still need to worry about API availability at runtime.
And in Rust, there are no <a class="reference external" href="https://clang.llvm.org/docs/AttributeReference.html#availability">availability attributes</a>
on your API declarations, and there are no
<a class="reference external" href="https://clang.llvm.org/docs/LanguageExtensions.html#objective-c-available"><code class="docutils literal notranslate"><span class="pre">&#64;available</span></code> runtime check helpers</a>,
and the compiler cannot warn you if you call APIs outside of availability checks.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sdks.html" class="btn btn-neutral float-right" title="A primer on macOS SDKs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Firefox on macOS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>