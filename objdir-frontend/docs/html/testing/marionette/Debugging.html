

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Debugging &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Testing" href="Testing.html" />
    <link rel="prev" title="Submitting patches" href="Patches.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Marionette</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Intro.html">Introduction to Marionette</a></li>
<li class="toctree-l2"><a class="reference internal" href="Building.html">Building</a></li>
<li class="toctree-l2"><a class="reference internal" href="PythonTests.html">Mn Python tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="Protocol.html">Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="NewContributors.html">New contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="Patches.html">Submitting patches</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Debugging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#redirecting-the-gecko-output">Redirecting the Gecko output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#javascript-debugger">JavaScript debugger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Taskcluster.html">Testing with one-click loaners</a></li>
<li class="toctree-l2"><a class="reference internal" href="CodeStyle.html">Style guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="SeleniumAtoms.html">Selenium atoms</a></li>
<li class="toctree-l2"><a class="reference internal" href="Prefs.html">Preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals/index.html">Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#bugs">Bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#communication">Communication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Marionette</a> &raquo;</li>
        
      <li>Debugging</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/testing/marionette/Debugging.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="debugging">
<h1>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h1>
<div class="section" id="redirecting-the-gecko-output">
<h2>Redirecting the Gecko output<a class="headerlink" href="#redirecting-the-gecko-output" title="Permalink to this headline">¶</a></h2>
<p>The most common way to debug Marionette, as well as chrome code in
general, is to use <code class="docutils literal notranslate"><span class="pre">dump()</span></code> to print a string to stdout.  In Firefox,
this log output normally ends up in the gecko.log file in your current
working directory.  With Fennec it can be inspected using <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">logcat</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">mach</span> <span class="pre">marionette-test</span></code> takes a <code class="docutils literal notranslate"><span class="pre">--gecko-log</span></code> option which lets
you redirect this output stream.  This is convenient if you want to
“merge” the test harness output with the stdout from the browser.
Per Unix conventions you can use <code class="docutils literal notranslate"><span class="pre">-</span></code> (dash) to have Firefox write
its log to stdout instead of file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="o">./</span><span class="n">mach</span> <span class="n">marionette</span><span class="o">-</span><span class="n">test</span> <span class="o">--</span><span class="n">gecko</span><span class="o">-</span><span class="n">log</span> <span class="o">-</span>
</pre></div>
</div>
<p>It is common to use this in conjunction with an option to increase
the Marionette log level:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="o">./</span><span class="n">mach</span> <span class="n">test</span> <span class="o">--</span><span class="n">gecko</span><span class="o">-</span><span class="n">log</span> <span class="o">-</span> <span class="o">-</span><span class="n">vv</span> <span class="n">TEST</span>
</pre></div>
</div>
<p>A single <code class="docutils literal notranslate"><span class="pre">-v</span></code> enables debug logging, and a double <code class="docutils literal notranslate"><span class="pre">-vv</span></code> enables
trace logging.</p>
<p>This debugging technique can be particularly effective when combined
with using <a class="reference external" href="https://docs.python.org/2/library/pdb.html">pdb</a> in the Python client or the JS remote debugger
that is described below.</p>
</div>
<div class="section" id="javascript-debugger">
<h2>JavaScript debugger<a class="headerlink" href="#javascript-debugger" title="Permalink to this headline">¶</a></h2>
<p>You can attach the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Tools/Browser_Toolbox">Browser Toolbox</a> JavaScript debugger to the
Marionette server using the <code class="docutils literal notranslate"><span class="pre">--jsdebugger</span></code> flag.  This enables you
to introspect and set breakpoints in Gecko chrome code, which is a
more powerful debugging technique than using <code class="docutils literal notranslate"><span class="pre">dump()</span></code> or <code class="docutils literal notranslate"><span class="pre">console.log()</span></code>.</p>
<p>To automatically open the JS debugger for <code class="docutils literal notranslate"><span class="pre">Mn</span></code> tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="o">./</span><span class="n">mach</span> <span class="n">marionette</span><span class="o">-</span><span class="n">test</span> <span class="o">--</span><span class="n">jsdebugger</span>
</pre></div>
</div>
<p>It will prompt you when to start to allow you time to set your
breakpoints.  It will also prompt you between each test.</p>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">debugger;</span></code> statement anywhere in chrome code
to add a breakpoint.  In this example, a breakpoint will be added
whenever the <code class="docutils literal notranslate"><span class="pre">WebDriver:GetPageSource</span></code> command is called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GeckoDriver.prototype.getPageSource = async function() {
  debugger;
  …
}
</pre></div>
</div>
<p>To not be prompted at the start of the test run or between tests,
you can set the <code class="docutils literal notranslate"><span class="pre">marionette.debugging.clicktostart</span></code> preference to
false this way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="o">./</span><span class="n">mach</span> <span class="n">marionette</span><span class="o">-</span><span class="n">test</span> <span class="o">--</span><span class="n">pref</span> <span class="s1">&#39;marionette.debugging.clicktostart:false&#39;</span> <span class="o">--</span><span class="n">jsdebugger</span>
</pre></div>
</div>
<p>For reference, below is the list of preferences that enables the
chrome debugger for Marionette.  These are all set implicitly when
<code class="docutils literal notranslate"><span class="pre">--jsdebugger</span></code> is passed to mach.  In non-official builds, which
are the default when built using <code class="docutils literal notranslate"><span class="pre">./mach</span> <span class="pre">build</span></code>, you will find that
the chrome debugger won’t prompt for connection and will allow
remote connections.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">devtools.debugger.prompt-connection</span></code> → true</p>
<p>Controls the remote connection prompt.  Note that this will
automatically expose your Firefox instance to the network.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">devtools.chrome.enabled</span></code> → true</p>
<p>Enables debugging of chrome code.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">devtools.debugger.remote-enabled</span></code> → true</p>
<p>Allows a remote debugger to connect, which is necessary for
debugging chrome code.</p>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Testing.html" class="btn btn-neutral float-right" title="Testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Patches.html" class="btn btn-neutral float-left" title="Submitting patches" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>