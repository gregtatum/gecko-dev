

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>External Helper App Service &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Firefox on macOS" href="../../widget/cocoa/index.html" />
    <link rel="prev" title="URI Loader Service" href="../uriloader.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">File Handling</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../uriloader.html">URI Loader Service</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">External Helper App Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#when-a-link-is-clicked">When a Link is Clicked</a></li>
<li class="toctree-l3"><a class="reference internal" href="#during-a-load">During a Load</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mime-service">MIME Service</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">File Handling</a> &raquo;</li>
        
      <li>External Helper App Service</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/uriloader/exthandler/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="external-helper-app-service">
<span id="id1"></span><h1>External Helper App Service<a class="headerlink" href="#external-helper-app-service" title="Permalink to this headline">¶</a></h1>
<p>The external helper app service is responsible for deciding how to handle an
attempt to load come content that cannot be loaded by the browser itself.</p>
<p>Part of this involves using the Handler Service which manages the users
preferences for what to do by default with different content.</p>
<div class="section" id="when-a-link-is-clicked">
<h2>When a Link is Clicked<a class="headerlink" href="#when-a-link-is-clicked" title="Permalink to this headline">¶</a></h2>
<p>When a link in a page is clicked (or a form submitted) <code class="docutils literal notranslate"><span class="pre">nsDocShell</span></code> tests
whether the target protocol can be loaded by the browser itself, this is based
on the preferences under <code class="docutils literal notranslate"><span class="pre">network.protocol-handler</span></code>. When the browser cannot
load the protocol it calls into <code class="docutils literal notranslate"><span class="pre">nsExternalHelperAppService::LoadURI</span></code>.</p>
<p>Some validation checks are performed but ultimateley we look for a registered
protocol handler. First the OS is queried for an app registration for the
protocol and then the handler server is asked to fill in any user settings from
the internal database. If there were no settings from the handler service then
some defaults are applied in <code class="docutils literal notranslate"><span class="pre">nsExternalHelperAppService::SetProtocolHandlerDefaults</span></code>.</p>
<p>If there is a default handler app chosen and the settings say to use it without
asking then that happens. If not a dialog s shown asking the user what they
want to do.</p>
</div>
<div class="section" id="during-a-load">
<h2>During a Load<a class="headerlink" href="#during-a-load" title="Permalink to this headline">¶</a></h2>
<p>When content is already being loaded the <a class="reference internal" href="../uriloader.html#uri-loader-service"><span class="std std-ref">URI Loader Service</span></a>
determines whether the browser can handle the content or not. If not it calls
into the external helper app server through <code class="docutils literal notranslate"><span class="pre">nsExternalHelperAppService::DoContent</span></code>.</p>
<p>The content type of the loading content is retrieved from the channel. A file
extension is also generated using the Content-Disposition header or if the load
is not a HTTP POST request the file extension is generated from the requested URL.</p>
<p>We then query the MIME Service for an nsIMIMEInfo to find information about
apps that can handle the content type or file extension based on OS and user
settings, <a class="reference internal" href="#mime-service"><span class="std std-ref">see below</span></a> for further details. The result is
used to create a <code class="docutils literal notranslate"><span class="pre">nsExternalAppHandler</span></code> which is then used as a stream listener
for the content.</p>
<p>The MIME info object contains settings that control whether to prompt the user
before doing anything and what the default action should be. If we need to ask
the user then a dialog is shown offering to let users cancel the load, save the
content to disk or send it to a registered application handler.</p>
<p>Assuming the load isn’t canceled the content is streamed to disk using a background
file saver with a target <code class="docutils literal notranslate"><span class="pre">nsITransfer</span></code>. The <code class="docutils literal notranslate"><span class="pre">nsITransfer</span></code> is responsible for
showing the download in the UI.</p>
<p>If the user opted to open the file with an application then once the transfer is
complete then <code class="docutils literal notranslate"><span class="pre">nsIMIMEInfo::LaunchWithFile</span></code> is used to
<a class="reference external" href="https://searchfox.org/mozilla-central/search?q=nsIMIMEInfo%3A%3ALaunchWithFile&amp;path=">launch the application</a>.</p>
</div>
<div class="section" id="mime-service">
<span id="id2"></span><h2>MIME Service<a class="headerlink" href="#mime-service" title="Permalink to this headline">¶</a></h2>
<p>The MIME service is responsible for getting an <code class="docutils literal notranslate"><span class="pre">nsIMIMEInfo</span></code> object for a
content type or file extension:</p>
<ol class="arabic simple">
<li><p>Fills out an <code class="docutils literal notranslate"><span class="pre">nsIMIMEInfo</span></code> based on OS provided information. This is platform
specific but should try to find the default application registered to handle
the content.</p></li>
<li><p>Ask the handler service to fill out the <code class="docutils literal notranslate"><span class="pre">nsIMIMEInfo</span></code> with information held
in browser settings. This will not overwrite a any application found from
the OS.</p></li>
<li><p>If one has not been found already then try to find a type description from
a <a class="reference external" href="https://searchfox.org/mozilla-central/search?q=extraMimeEntries[]&amp;path=">lookup table</a>
or just by appending ” File” to the file extension.</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../widget/cocoa/index.html" class="btn btn-neutral float-right" title="Firefox on macOS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../uriloader.html" class="btn btn-neutral float-left" title="URI Loader Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>