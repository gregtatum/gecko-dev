

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Balrog in Release Promotion &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Setting Up An Update Server" href="setting-up-an-update-server.html" />
    <link rel="prev" title="Release Promotion Action" href="release-promotion-action.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TaskCluster Task-Graph Generation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="taskgraph.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mach.html">Taskcluster Mach commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading.html">Loading Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="transforms.html">Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker-images.html">Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="cron.html">Periodic Taskgraphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="try.html">Try</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="release-promotion.html">Release Promotion</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="release-promotion.html#release-promotion-phases">Release Promotion Phases</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="release-promotion.html#in-depth-relpro-guide">In-depth relpro guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="release-promotion-action.html">Release Promotion Action</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Balrog in Release Promotion</a></li>
<li class="toctree-l4"><a class="reference internal" href="setting-up-an-update-server.html">Setting Up An Update Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="partials.html">Partial Update Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="signing.html">Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="partner-repacks.html">Partner repacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="partner-attribution.html">Partner attribution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="versioncontrol.html">Version Control in CI</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Taskcluster Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-tos.html">How Tos</a></li>
<li class="toctree-l2"><a class="reference internal" href="task-graph.html">Task Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">TaskCluster Task-Graph Generation</a> &raquo;</li>
        
          <li><a href="release-promotion.html">Release Promotion</a> &raquo;</li>
        
      <li>Balrog in Release Promotion</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/taskcluster/balrog.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="balrog-in-release-promotion">
<h1>Balrog in Release Promotion<a class="headerlink" href="#balrog-in-release-promotion" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Balrog is Mozilla’s update server. It is responsible for delivering newer versions of Firefox to existing Firefox installations. If you are not already, it would be useful to be familiar with Balrog’s core concepts before continuing with this doc. You can find that information on <a class="reference external" href="http://mozilla-balrog.readthedocs.io/en/latest/">Balrog’s official documentation</a>.</p>
<p>The basic interactions that Release Promotion has with Balrog are as follows:</p>
<ol class="arabic simple">
<li><p>Submit new release metadata to Balrog with a number of <code class="docutils literal notranslate"><span class="pre">balrog</span></code> tasks and the <code class="docutils literal notranslate"><span class="pre">release-balrog-submit-toplevel</span></code> task.</p></li>
<li><p>Update test channels to point at the new release in the <code class="docutils literal notranslate"><span class="pre">release-balrog-submit-toplevel</span></code> task.</p></li>
<li><p>Verify the new release updates with <code class="docutils literal notranslate"><span class="pre">release-update-verify</span></code> and <code class="docutils literal notranslate"><span class="pre">release-final-verify</span></code> tasks.</p></li>
<li><p>Schedule the new release to be shipped in the <code class="docutils literal notranslate"><span class="pre">release-balrog-scheduling</span></code> task.</p></li>
</ol>
</div>
<div class="section" id="submit-new-release-metadata">
<h2>Submit New Release Metadata<a class="headerlink" href="#submit-new-release-metadata" title="Permalink to this headline">¶</a></h2>
<p>Balrog requires many different pieces of information before it can ship updates. Most of this information revolves around update file (MAR) metadata (hash, filesize, target platform, target locale). This information is submitted by <code class="docutils literal notranslate"><span class="pre">balrog</span></code> tasks.</p>
<p>We also submit some more general information about releases (version number, MAR url templates, release name, etc.) as part of the <code class="docutils literal notranslate"><span class="pre">release-balrog-submit-toplevel</span></code> task.</p>
<p>All balrog submission is done by <a class="reference external" href="https://github.com/mozilla-releng/balrogscript">balrogscript workers</a>, and happens in the <code class="docutils literal notranslate"><span class="pre">promote</span></code> phase.</p>
</div>
<div class="section" id="update-test-channels">
<h2>Update Test Channels<a class="headerlink" href="#update-test-channels" title="Permalink to this headline">¶</a></h2>
<p>Balrog has “test” channels that we use to allow verification of new release updates prior to shipping. The <code class="docutils literal notranslate"><span class="pre">release-balrog-submit-toplevel</span></code> task is responsible for updating these test channels whenever we prepare a new release. This happens in the <code class="docutils literal notranslate"><span class="pre">promote</span></code> phase.</p>
</div>
<div class="section" id="verify-the-release">
<h2>Verify the Release<a class="headerlink" href="#verify-the-release" title="Permalink to this headline">¶</a></h2>
<p>Once a release is live on a test channel <code class="docutils literal notranslate"><span class="pre">release-update-verify</span></code> begins and performs same sanity checks. This happens in the <code class="docutils literal notranslate"><span class="pre">promote</span></code> phase.</p>
<p>After a release has been pushed to cdns, <code class="docutils literal notranslate"><span class="pre">release-final-verify</span></code> runs and performs some additional checks. This happens in the <code class="docutils literal notranslate"><span class="pre">push</span></code> phase.</p>
</div>
<div class="section" id="schedule-shipping">
<h2>Schedule Shipping<a class="headerlink" href="#schedule-shipping" title="Permalink to this headline">¶</a></h2>
<p>When we’re ready to ship a release we need to let Balrog know about it by scheduling a change to the appropriate Balrog rule. If <code class="docutils literal notranslate"><span class="pre">release_eta</span></code> is set it will be used as the ship date and time. If not, the release will be scheduled for shipping 5 minutes in the future. In either case, signoff will need to be done in Balrog by multiple parties before the release is actually made live.</p>
<p>This step is done by the <code class="docutils literal notranslate"><span class="pre">release-balrog-scheduling</span></code> task in the <code class="docutils literal notranslate"><span class="pre">ship</span></code> phase.</p>
</div>
<div class="section" id="secondary-tasks">
<h2><code class="docutils literal notranslate"><span class="pre">secondary</span></code> tasks<a class="headerlink" href="#secondary-tasks" title="Permalink to this headline">¶</a></h2>
<p>You may have noticed <code class="docutils literal notranslate"><span class="pre">secondary</span></code> variants of the <code class="docutils literal notranslate"><span class="pre">release-balrog-submit-toplevel</span></code>, <code class="docutils literal notranslate"><span class="pre">release-update-verify</span></code>, <code class="docutils literal notranslate"><span class="pre">release-final-verify</span></code>, and <code class="docutils literal notranslate"><span class="pre">release-balrog-scheduling</span></code> tasks. These fulfill the same function as their primary counterparts, but for the “beta” update channel. They are only used when we build Release Candidates.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="setting-up-an-update-server.html" class="btn btn-neutral float-right" title="Setting Up An Update Server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="release-promotion-action.html" class="btn btn-neutral float-left" title="Release Promotion Action" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>