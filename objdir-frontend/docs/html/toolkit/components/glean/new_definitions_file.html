

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>New Metrics and Pings &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Adding a New Metric Type" href="new_metric_types.html" />
    <link rel="prev" title="Inter-process Communication (IPC)" href="ipc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Toolkit</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../mozapps/extensions/addon-manager/index.html">Add-on Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crashes/crash-manager/index.html">Crash Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crashreporter/crashreporter/index.html">Crash Reporter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../featuregates/featuregates/index.html">Feature Gates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../search/index.html">Search Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../normandy/normandy/index.html">Shield Recipe Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../messaging-system/docs/index.html">Messaging System Schemas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pictureinpicture/pictureinpicture/index.html">Picture-in-Picture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../prompts/prompts/index.html">Prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/subprocess/toolkit_modules/subprocess/index.html">Subprocess Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../telemetry/index.html">Telemetry</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Firefox on Glean (FOG)</a><ul class="current">
<li class="toctree-l3"><a class="reference external" href="https://github.com/mozilla/glean/">Glean SDK Source</a></li>
<li class="toctree-l3"><a class="reference external" href="https://mozilla.github.io/glean/book/index.html">Glean SDK Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="code_organization.html">FOG code organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipc.html">Inter-process Communication (IPC)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">New Metrics and Pings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ipc">IPC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#where-do-i-define-new-metrics-and-pings">Where do I Define new Metrics and Pings?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-does-expiry-work">How does Expiry Work?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="new_metric_types.html">Adding a New Metric Type</a></li>
<li class="toctree-l3"><a class="reference internal" href="preferences.html">Preferences</a></li>
<li class="toctree-l3"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="style_guide.html">FOG Documentation Style Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="updating_parser.html">Updating glean_parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="updating_sdk.html">Updating the Glean SDK</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/toolkit_modules/index.html">Toolkit Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../content/toolkit_widgets/index.html">Toolkit Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../url-classifier/url-classifier/index.html">URL Classifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensions/webextensions/index.html">WebExtensions API Development</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Toolkit</a> &raquo;</li>
        
          <li><a href="index.html">Firefox on Glean (FOG)</a> &raquo;</li>
        
      <li>New Metrics and Pings</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/toolkit/components/glean/new_definitions_file.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="new-metrics-and-pings">
<h1>New Metrics and Pings<a class="headerlink" href="#new-metrics-and-pings" title="Permalink to this headline">¶</a></h1>
<p><strong>Note:</strong> FOG is not ready to be used,
so you probably should not be adding metrics and pings using this guide yet.
Instead, please use Firefox Telemetry unless you have explicitly been given permission by a
<a class="reference external" href="https://wiki.mozilla.org/Modules/All#Telemetry">Telemetry Module Peer</a>.</p>
<p>To add a new metric or ping to Firefox Desktop you should follow the
<a class="reference external" href="https://mozilla.github.io/glean/book/user/adding-new-metrics.html">Glean SDK documentation on the subject</a>,
with some few twists.</p>
<div class="section" id="ipc">
<h2>IPC<a class="headerlink" href="#ipc" title="Permalink to this headline">¶</a></h2>
<p>Firefox Desktop is made of multiple processes.
You can record data from any process in Firefox Desktop
<a class="reference internal" href="ipc.html"><span class="doc">subject to certain conditions</span></a>.</p>
<p>If you will be recording data to this metric in multiple processes,
you should make yourself aware of those conditions.</p>
</div>
<div class="section" id="where-do-i-define-new-metrics-and-pings">
<h2>Where do I Define new Metrics and Pings?<a class="headerlink" href="#where-do-i-define-new-metrics-and-pings" title="Permalink to this headline">¶</a></h2>
<p>Metrics and pings are defined in their definitions files
(<code class="docutils literal notranslate"><span class="pre">metrics.yaml</span></code> or <code class="docutils literal notranslate"><span class="pre">pings.yaml</span></code>, respectively).
But where can you find <code class="docutils literal notranslate"><span class="pre">metrics.yaml</span></code> or <code class="docutils literal notranslate"><span class="pre">pings.yaml</span></code>?</p>
<p>If you’re not the first person in your component to ask that question,
the answer is likely “in the root of your component”.
Look for the definitions files near to where you are instrumenting your code.
Or you can look in
<code class="docutils literal notranslate"><span class="pre">toolkit/components/glean/metrics_index.py</span></code>
to see the list of all currently-known definitions files.</p>
<p>If you <em>are</em> the first person in your component to ask that question,
you get to choose where to start them!
We recommend adding them in the root of your component, next to a <code class="docutils literal notranslate"><span class="pre">moz.build</span></code>.</p>
<p>When you do so, be sure to edit <code class="docutils literal notranslate"><span class="pre">toolkit/components/glean/metrics_index.py</span></code>,
adding your definitions files to the Python lists therein.
If you don’t, no API will be generated for your metrics and your build will fail.</p>
<p>In addition, do not forget to file a bug in <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Platform</span> <span class="pre">and</span> <span class="pre">Tools</span> <span class="pre">::</span> <span class="pre">General</span></code>
asking for your definitions files to be added to the others for <code class="docutils literal notranslate"><span class="pre">firefox.desktop</span></code>.
If you don’t, your metrics will not show up in datasets and tools
because the pipeline won’t know that they exist.</p>
<p>If you have any questions, be sure to ask on
<a class="reference external" href="https://chat.mozilla.org/#/room/#glean:mozilla.org">the #glean channel</a>.</p>
<p><strong>Note:</strong> Do <em>not</em> use <code class="docutils literal notranslate"><span class="pre">toolkit/components/glean/metrics.yaml</span></code>
or <code class="docutils literal notranslate"><span class="pre">toolkit/components/glean/pings.yaml</span></code>.
These are for metrics instrumenting the code under <code class="docutils literal notranslate"><span class="pre">toolkit/components/glean</span></code>
and are not general-purpose locations for adding metrics and pings.</p>
</div>
<div class="section" id="how-does-expiry-work">
<h2>How does Expiry Work?<a class="headerlink" href="#how-does-expiry-work" title="Permalink to this headline">¶</a></h2>
<p>In FOG,
unlike in other Glean-SDK-using projects,
metrics expire based on Firefox application version.
This is to allow metrics to be valid over the entire life of an application version,
whether that is the 4-6 weeks of usual releases or the 13 months of ESR releases.</p>
<p>There are three values accepted in the <code class="docutils literal notranslate"><span class="pre">expires</span></code> field of <code class="docutils literal notranslate"><span class="pre">metrics.yaml</span></code>s for FOG:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;X&quot;</span></code> (where <code class="docutils literal notranslate"><span class="pre">X</span></code> is the major portion of a Firefox Desktop version) -
The metric will be expired when the <code class="docutils literal notranslate"><span class="pre">MOZ_APP_VERSION</span></code> reaches or exceeds <code class="docutils literal notranslate"><span class="pre">X</span></code>.
(For example, when the Firefox Version is <code class="docutils literal notranslate"><span class="pre">88.0a1</span></code>,
all metrics marked with <code class="docutils literal notranslate"><span class="pre">expires:</span> <span class="pre">&quot;88&quot;</span></code> or lower will be expired.)
This is the recommended form for all new metrics to ensure they stop recording when they stop being relevant.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expired</span></code> - For marking a metric as manually expired.
Not usually used, but sometimes helpful for internal tests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">never</span></code> - For marking a metric as part of a permanent data collection.
Metrics marked with <code class="docutils literal notranslate"><span class="pre">never</span></code> must have <a class="reference internal" href="testing.html"><span class="doc">instrumentation tests</span></a>.</p></li>
</ul>
<p>For more information on what expiry means and the
<code class="docutils literal notranslate"><span class="pre">metrics.yaml</span></code> format, see
<a class="reference external" href="https://mozilla.github.io/glean/book/user/metric-parameters.html">the Glean SDK docs</a>
on this subject. Some quick facts:</p>
<ul class="simple">
<li><p>Data collected to expired metrics is not recorded or sent.</p></li>
<li><p>Recording to expired metrics is not an error at runtime.</p></li>
<li><p>Expired metrics being in a <code class="docutils literal notranslate"><span class="pre">metrics.yaml</span></code> is a linting error in <code class="docutils literal notranslate"><span class="pre">glean_parser</span></code>.</p></li>
<li><p>Expired (and non-expired) metrics that are no longer useful should be promptly removed from your <code class="docutils literal notranslate"><span class="pre">metrics.yaml</span></code>.
This reduces the size and improves the performance of Firefox
(and speeds up the Firefox build process)
by decreasing the amount of code that needs to be generated.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="new_metric_types.html" class="btn btn-neutral float-right" title="Adding a New Metric Type" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ipc.html" class="btn btn-neutral float-left" title="Inter-process Communication (IPC)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>