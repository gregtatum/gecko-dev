

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Highlighters &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Memory Tool Architecture" href="memory-panel.html" />
    <link rel="prev" title="High-Level Inspector Architecture" href="inspector-panel.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Firefox DevTools Contributor Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#automated-tests">Automated tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#files-and-directories">Files and directories</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#tool-architectures">Tool Architectures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="inspector-panel.html">Inspector Panel Architecture</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Inspector Highlighters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-highlighters">Using highlighters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-new-highlighters">Creating new highlighters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="memory-panel.html">Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="responsive-design-mode.html">Responsive Design Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="console-panel.html">Console</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#frontend">Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#backend">Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#preferences">Preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#about-this-documentation">About this documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Firefox DevTools Contributor Docs</a> &raquo;</li>
        
      <li>Highlighters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/devtools/tools/highlighters.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="highlighters">
<h1>Highlighters<a class="headerlink" href="#highlighters" title="Permalink to this headline">¶</a></h1>
<p>This article provides technical documentation about DevTools highlighters.</p>
<p>By highlighter, we mean anything that DevTools displays on top of the content page, in order to highlight an element, a set of elements or shapes to users.</p>
<p>The most obvious form of highlighter is the box-model highlighter, whose job is to display the 4 box-model regions on top of a given element in the content page, as illustrated in the following screen capture:</p>
<p><img alt="Box-model highlighter" src="../../_images/box-model-highlighter-screenshot.png" /></p>
<p>But there can be a wide variety of highlighters. In particular, highlighters are a pretty good way to give detailed information about:</p>
<ul class="simple">
<li><p>the exact form of a css shape,</p></li>
<li><p>how a css transform applied to an element,</p></li>
<li><p>where are the color stops of a css gradient,</p></li>
<li><p>which are all the elements that match a given selector,</p></li>
<li><p>…</p></li>
</ul>
<div class="section" id="using-highlighters">
<h2>Using highlighters<a class="headerlink" href="#using-highlighters" title="Permalink to this headline">¶</a></h2>
<p>Highlighters run on the debuggee side, not on the toolbox side. This is so that it’s possible to highlight elements on a remote device for instance. This means you need to go through the <a class="reference internal" href="../../testing/marionette/Protocol.html#protocol"><span class="std std-ref">Remote Debugging Protocol</span></a> to use a highlighter.</p>
<p>Since the box-model highlighter (HighlighterFront) is the most used type of highlighter (for instance it’s displayed when you move your mouse over nodes in the inspector), the HighlighterFront provides a custom set of methods to interact with it:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>startPicker()</code></td>
<td>Starts the node picker mode which will highlight every node you hover over in the page, and will change the current node selection in the inspector on click. “picker-node-hovered” and “picker-node-picked” events are sent.</td>
</tr>
<tr>
<td><code>stopPicker()</code></td>
<td>Stops the node picker mode.</td>
</tr>
<tr>
<td><code>highlightNodeFront(nodeFront)</code></td>
<td>Display the box-model highlighter on a given node. NodeFront objects are what the WalkerActor return.</td>
</tr>
<tr>
<td><code>highlightDomValueGrip(valueGrip)</code></td>
<td>Display the box-model highlighter on a given node, represented by a debugger object value grip.</td>
</tr>
<tr>
<td><code>unhighlight()</code></td>
<td>Hide the box-model highlighter.</td>
</tr>
</tbody>
</table><p>Not all methods that are related to highlighters are present on the HighlighterFront. The
<code class="docutils literal notranslate"><span class="pre">highlightDomValueGrip</span></code> method also requires the WalkerFront in order to transform a Grip into a
NodeFront. Therefore, methods that access other Fronts are available on the InspectorFront.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>highlightDomValueGrip(valueGrip)</code></td>
<td>Display the box-model highlighter on a given node, represented by a debugger object value grip.</td>
</tr>
</tbody>
</table><p>But the box-model highlighter isn’t the only type of highlighter, so the InspectorFront also provides the following method:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getHighlighterByType(typeName)</code></td>
<td>Instantiate a new highlighter, given its type (as a String). At the time of writing, the available types of highlighters are: <code>BoxModelHighlighter</code>, <code>CssTransformHighlighter</code>, <code>SelectorHighlighter</code> and <code>RectHighlighter</code>. This returns a promise that resolves to the new instance of <a href="https://wiki.mozilla.org/DevTools/protocol.js">protocol.js</a> actor.</td>
</tr>
</tbody>
</table><div class="section" id="the-highlighter-api">
<h3>The highlighter API<a class="headerlink" href="#the-highlighter-api" title="Permalink to this headline">¶</a></h3>
<p>When getting a highlighter via <code class="docutils literal notranslate"><span class="pre">toolbox.inspector.getHighlighterByType(typeName)</span></code>, the right type of highlighter will be instantiated on the server-side and will be wrapped into a <code class="docutils literal notranslate"><span class="pre">CustomHighlighterActor</span></code> and that’s what will be returned to the caller. This means that all types of highlighters share the same following API:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>show(NodeActor node[, Object options])</code></td>
<td>Highlighters are hidden by default. Calling this method is what makes them visible. The first, mandatory, parameter should be a NodeActor. NodeActors are what the WalkerActor return. It's easy to get a NodeActor for an existing DOM node. For example <code>toolbox.walker.querySelector(toolbox.walker.rootNode, "css selector")</code> resolves to a NodeFront (the client-side version of the NodeActor) which can be used as the first parameter. The second, optional, parameter depends on the type of highlighter being used.</td>
</tr>
<tr>
<td><code>hide()</code></td>
<td>Hides the highlighter.</td>
</tr>
<tr>
<td><code>finalize()</code></td>
<td>Destroys the highlighter.</td>
</tr>
</tbody>
</table></div>
</div>
<div class="section" id="creating-new-highlighters">
<h2>Creating new highlighters<a class="headerlink" href="#creating-new-highlighters" title="Permalink to this headline">¶</a></h2>
<p>Before digging into how one goes about adding a new type of highlighter to the DevTools, it is worth understanding how are highlighters displayed in the page.</p>
<div class="section" id="inserting-content-in-the-page">
<h3>Inserting content in the page<a class="headerlink" href="#inserting-content-in-the-page" title="Permalink to this headline">¶</a></h3>
<p>Highlighters use web technology themselves to display the required information on screen. For instance, the box-model highlighter uses SVG to draw the margin, border, padding and content regions over the highlighted node.</p>
<p>This means the highlighter content needs to be inserted in the page, but in a non-intrusive way. Indeed, the DevTools should never alter the page unless the alteration was done by the user (like changing the DOM using the inspector or a CSS rule via the style-editor for example). So simply appending the highlighter’s markup in the content document is not an option.</p>
<p>Furthermore, highlighters not only need to work with Firefox Desktop, but they should work just as well on Firefox OS, Firefox for Android, and more generally anything that runs the Gecko rendering engine. Therefore appending the highlighter’s markup to the browser chrome XUL structure isn’t an option either.</p>
<p>To this end, DevTools highlighters make use of a (chrome-only) API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">/**</span>
  <span class="o">*</span> <span class="n">Chrome</span> <span class="n">document</span> <span class="n">anonymous</span> <span class="n">content</span> <span class="n">management</span><span class="o">.</span>
  <span class="o">*</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">Chrome</span><span class="o">-</span><span class="n">only</span> <span class="n">API</span> <span class="n">that</span> <span class="n">allows</span> <span class="n">inserting</span> <span class="n">fixed</span> <span class="n">positioned</span> <span class="n">anonymous</span>
  <span class="o">*</span> <span class="n">content</span> <span class="n">on</span> <span class="n">top</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">page</span> <span class="n">displayed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">document</span><span class="o">.</span>
  <span class="o">*</span> <span class="n">The</span> <span class="n">supplied</span> <span class="n">content</span> <span class="ow">is</span> <span class="n">cloned</span> <span class="ow">and</span> <span class="n">inserted</span> <span class="n">into</span> <span class="n">the</span> <span class="n">document</span><span class="s1">&#39;s CanvasFrame.</span>
  <span class="o">*</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">this</span> <span class="n">only</span> <span class="n">works</span> <span class="k">for</span> <span class="n">HTML</span> <span class="n">documents</span><span class="o">.</span>
  <span class="o">*/</span>
 <span class="n">partial</span> <span class="n">interface</span> <span class="n">Document</span> <span class="p">{</span>
   <span class="o">/**</span>
    <span class="o">*</span> <span class="n">Deep</span><span class="o">-</span><span class="n">clones</span> <span class="n">the</span> <span class="n">provided</span> <span class="n">element</span> <span class="ow">and</span> <span class="n">inserts</span> <span class="n">it</span> <span class="n">into</span> <span class="n">the</span> <span class="n">CanvasFrame</span><span class="o">.</span>
    <span class="o">*</span> <span class="n">Returns</span> <span class="n">an</span> <span class="n">AnonymousContent</span> <span class="n">instance</span> <span class="n">that</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">manipulate</span> <span class="n">the</span>
    <span class="o">*</span> <span class="n">inserted</span> <span class="n">element</span><span class="o">.</span>
    <span class="o">*/</span>
   <span class="p">[</span><span class="n">ChromeOnly</span><span class="p">,</span> <span class="n">NewObject</span><span class="p">,</span> <span class="n">Throws</span><span class="p">]</span>
   <span class="n">AnonymousContent</span> <span class="n">insertAnonymousContent</span><span class="p">(</span><span class="n">Element</span> <span class="n">aElement</span><span class="p">);</span>

   <span class="o">/**</span>
    <span class="o">*</span> <span class="n">Removes</span> <span class="n">the</span> <span class="n">element</span> <span class="n">inserted</span> <span class="n">into</span> <span class="n">the</span> <span class="n">CanvasFrame</span> <span class="n">given</span> <span class="n">an</span> <span class="n">AnonymousContent</span>
    <span class="o">*</span> <span class="n">instance</span><span class="o">.</span>
    <span class="o">*/</span>
   <span class="p">[</span><span class="n">ChromeOnly</span><span class="p">,</span> <span class="n">Throws</span><span class="p">]</span>
   <span class="n">void</span> <span class="n">removeAnonymousContent</span><span class="p">(</span><span class="n">AnonymousContent</span> <span class="n">aContent</span><span class="p">);</span>
 <span class="p">};</span>
</pre></div>
</div>
<p>Using this API, it is possible for chrome-privileged JS to insert arbitrary DOM elements on top of the content page.</p>
<p>Technically, the DOM element is inserted into the <code class="docutils literal notranslate"><span class="pre">CanvasFrame</span></code> of the document. The <code class="docutils literal notranslate"><span class="pre">CanvasFrame</span></code> is part of the rendered frame tree and the DOM element is part of the native anonymous elements of the <code class="docutils literal notranslate"><span class="pre">CanvasFrame</span></code>.</p>
<p>Consider the following simple example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span> <span class="kd">let</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
 <span class="nx">el</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">&quot;My test element&quot;</span><span class="p">;</span>
 <span class="kd">let</span> <span class="nx">insertedEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">insertAnonymousContent</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</pre></div>
</div>
<p>In this example, the test DIV will be inserted in the page, and will be displayed on top of everything else, in a way that doesn’t impact the current layout.</p>
</div>
<div class="section" id="the-anonymouscontent-api">
<h3>The AnonymousContent API<a class="headerlink" href="#the-anonymouscontent-api" title="Permalink to this headline">¶</a></h3>
<p>In the previous example, the returned <code class="docutils literal notranslate"><span class="pre">insertedEl</span></code> object isn’t a DOM node, and it certainly is not <code class="docutils literal notranslate"><span class="pre">el</span></code>. It is a new object, whose type is <code class="docutils literal notranslate"><span class="pre">AnonymousContent</span></code> (<a class="reference external" href="https://searchfox.org/mozilla-central/source/dom/webidl/AnonymousContent.webidl">see the WebIDL here</a>).</p>
<p>Because of the way content is inserted into the page, it isn’t wanted to give consumers a direct reference to the inserted DOM node. This is why <code class="docutils literal notranslate"><span class="pre">document.insertAnonymousContent(el)</span></code> actually <strong>clones</strong> <code class="docutils literal notranslate"><span class="pre">el</span></code> and returns a new object whose API lets consumers make changes to the inserted element in a way that never gives back a reference to the inserted DOM node.</p>
</div>
<div class="section" id="canvasframeanonymouscontenthelper">
<h3>CanvasFrameAnonymousContentHelper<a class="headerlink" href="#canvasframeanonymouscontenthelper" title="Permalink to this headline">¶</a></h3>
<p>In order to help with the API described in the previous section, the <code class="docutils literal notranslate"><span class="pre">CanvasFrameAnonymousContentHelper</span></code> class was introduced.</p>
<p>Its goal is to provide a simple way for highlighters to insert their content into the page and modify it dynamically later. One of its goal is also to re-insert the highlighters’ content on page navigation. Indeed, the frame tree is destroyed when the page is navigated away from since it represents the document element. One thing to note is that highlighter content insertion is asynchronous and <code class="docutils literal notranslate"><span class="pre">CanvasFrameAnonymousContentHelper</span></code> users must call and wait for its <code class="docutils literal notranslate"><span class="pre">initialize</span></code> method to resolve.</p>
<p>Using this helper is quite simple:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">helper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CanvasFrameAnonymousContentHelper</span><span class="p">(</span><span class="nx">targetActor</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">buildMarkup</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="nx">await</span> <span class="nx">helper</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
</pre></div>
</div>
<p>It only requires a <code class="docutils literal notranslate"><span class="pre">targetActor</span></code>, which highlighters get when they are instantiated, and a callback function that will be used to create and insert the content the first time the highlighter is shown, and every time there’s a page navigation.</p>
<p>The returned object provides the following API:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getTextContentForElement(id)</code></td>
<td>Get the textContent of an element given its ID.</td>
</tr>
<tr>
<td><code>setTextContentForElement(id, text)</code></td>
<td>Set the textContent of an element given its ID.</td>
</tr>
<tr>
<td><code>setAttributeForElement(id, name, value)</code></td>
<td>Set an attribute value of an element given its ID.</td>
</tr>
<tr>
<td><code>getAttributeForElement(id, name)</code></td>
<td>Get an attribute value of an element given its ID.</td>
</tr>
<tr>
<td><code>removeAttributeForElement(id, name)</code></td>
<td>Remove an attribute of an element given its ID.</td>
</tr>
<tr>
<td><code>content</code></td>
<td>This property returns the wrapped AnonymousContent object.</td>
</tr>
<tr>
<td><code>destroy()</code></td>
<td>Destroy the helper instance.</td>
</tr>
</tbody>
</table></div>
<div class="section" id="creating-a-new-highlighter-class">
<h3>Creating a new highlighter class<a class="headerlink" href="#creating-a-new-highlighter-class" title="Permalink to this headline">¶</a></h3>
<p>A good way to get started is by taking a look at <a class="reference external" href="https://searchfox.org/mozilla-central/rev/1a973762afcbc5066f73f1508b0c846872fe3952/devtools/server/actors/highlighters.js#519-530">existing highlighters here</a>.</p>
<p>Here is some boilerplate code for a new highlighter class:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span> <span class="kd">function</span> <span class="nx">MyNewHighlighter</span><span class="p">(</span><span class="nx">targetActor</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">doc</span> <span class="o">=</span> <span class="nx">targetActor</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">markup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CanvasFrameAnonymousContentHelper</span><span class="p">(</span><span class="nx">targetActor</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_buildMarkup</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">markup</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
 <span class="p">}</span>

 <span class="nx">MyNewHighlighter</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">doc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">markup</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
   <span class="p">},</span>

   <span class="nx">_buildMarkup</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="kd">let</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">markup</span><span class="p">.</span><span class="nx">anonymousContentDocument</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
     <span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;div id=&quot;new-highlighted-&quot; style=&quot;display:none;&quot;&gt;&#39;</span><span class="p">;</span>
     <span class="k">return</span> <span class="nx">container</span><span class="p">;</span>
   <span class="p">},</span>

   <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">markup</span><span class="p">.</span><span class="nx">removeAttributeForElement</span><span class="p">(</span><span class="s2">&quot;new-highlighted-el&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">);</span>
   <span class="p">},</span>

   <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">markup</span><span class="p">.</span><span class="nx">setAttributeForElement</span><span class="p">(</span><span class="s2">&quot;new-highlighted-el&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">,</span> <span class="s2">&quot;display:none;&quot;</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">};</span>
</pre></div>
</div>
<p>In most situations, the <code class="docutils literal notranslate"><span class="pre">container</span></code> returned by <code class="docutils literal notranslate"><span class="pre">_buildMarkup</span></code> will be absolutely positioned, and will need to contain elements with IDs, so that these can then later be moved, resized, hidden or shown in <code class="docutils literal notranslate"><span class="pre">show</span></code> and <code class="docutils literal notranslate"><span class="pre">hide</span></code> using the AnonymousContent API.</p>
</div>
<div class="section" id="the-autorefreshhighlighter-parent-class">
<h3>The AutoRefreshHighlighter parent class<a class="headerlink" href="#the-autorefreshhighlighter-parent-class" title="Permalink to this headline">¶</a></h3>
<p>It is worth mentioning this class as it may be a useful parent class to inherit a new highlighter from in some situations.</p>
<p>If the new highlighter’s job is to highlight an element in the DOM, then it most likely should inherit from <code class="docutils literal notranslate"><span class="pre">AutoRefreshHighlighter</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">AutoRefreshHighlighter</span></code> class updates itself in a loop, checking if the currently highlighted node’s geometry has changed since the last iteration. This is useful to make sure the highlighter <strong>follows</strong> the highlighted node around, in case the layout around it changes, or in case it is an animated node.</p>
<p>Sub classes must implement the following methods:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_show()</code></td>
<td>Called when the highlighter should be shown.</td>
</tr>
<tr>
<td><code>_update()</code></td>
<td>Called while the highlighter is shown and the geometry of the current node changes.</td>
</tr>
<tr>
<td><code>_hide()</code></td>
<td>Called when the highlighter should be hidden.</td>
</tr>
</tbody>
</table><p>Sub classes will have access to the following properties:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>this.currentNode</code></td>
<td>The node to be shown.</td>
</tr>
<tr>
<td><code>this.currentQuads</code></td>
<td>All of the node's box model region quads.</td>
</tr>
<tr>
<td><code>this.win</code></td>
<td>The current window</td>
</tr>
</tbody>
</table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="memory-panel.html" class="btn btn-neutral float-right" title="Memory Tool Architecture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="inspector-panel.html" class="btn btn-neutral float-left" title="High-Level Inspector Architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>