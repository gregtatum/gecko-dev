

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Responsive Design Mode Architecture &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Console Tool Architecture" href="console-panel.html" />
    <link rel="prev" title="&lt;no title&gt;" href="debugger-panel.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Firefox DevTools Contributor Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#automated-tests">Automated tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#files-and-directories">Files and directories</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#tool-architectures">Tool Architectures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="inspector-panel.html">Inspector Panel Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="highlighters.html">Inspector Highlighters</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory-panel.html">Memory</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Responsive Design Mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="#opening-rdm-during-current-firefox-session">Opening RDM During Current Firefox Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="#closing-rdm-during-current-firefox-session">Closing RDM During Current Firefox Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="#session-restore">Session Restore</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="console-panel.html">Console</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#frontend">Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#backend">Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#preferences">Preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#about-this-documentation">About this documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Firefox DevTools Contributor Docs</a> &raquo;</li>
        
      <li>Responsive Design Mode Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/devtools/tools/responsive-design-mode.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="responsive-design-mode-architecture">
<h1>Responsive Design Mode Architecture<a class="headerlink" href="#responsive-design-mode-architecture" title="Permalink to this headline">¶</a></h1>
<div class="section" id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p>You have a single browser tab that has visited several pages, and now has a
history that looks like, in oldest to newest order:</p>
<ol class="simple">
<li><p>https://newsblur.com</p></li>
<li><p>https://mozilla.org (← current page)</p></li>
<li><p>https://convolv.es</p></li>
</ol>
</div>
<div class="section" id="opening-rdm-during-current-firefox-session">
<h2>Opening RDM During Current Firefox Session<a class="headerlink" href="#opening-rdm-during-current-firefox-session" title="Permalink to this headline">¶</a></h2>
<p>When opening RDM, the browser tab’s history must preserved.  Additionally, we
strive to preserve the exact state of the currently displayed page (effectively
any in-page state, which is important for single page apps where data can be
lost if they are reloaded).</p>
<p>This seems a bit convoluted, but one advantage of this technique is that it
preserves tab state since the same tab is reused.  This helps to maintain any
extra state that may be set on tab by add-ons or others.</p>
<ol class="simple">
<li><p>Create a temporary, hidden tab to load the tool UI.</p></li>
<li><p>Mark the tool tab browser’s docshell as active so the viewport frame is
created eagerly and will be ready to swap.</p></li>
<li><p>Create the initial viewport inside the tool UI.</p></li>
<li><p>Swap tab content from the regular browser tab to the browser within the
viewport in the tool UI, preserving all state via
<code class="docutils literal notranslate"><span class="pre">gBrowser._swapBrowserDocShells</span></code>.</p></li>
<li><p>Force the original browser tab to be non-remote since the tool UI must be
loaded in the parent process, and we’re about to swap the tool UI into
this tab.</p></li>
<li><p>Swap the tool UI (with viewport showing the content) into the original
browser tab and close the temporary tab used to load the tool via
<code class="docutils literal notranslate"><span class="pre">swapBrowsersAndCloseOther</span></code>.</p></li>
<li><p>Start a tunnel from the tool tab’s browser to the viewport browser
so that some browser UI functions, like navigation, are connected to
the content in the viewport, instead of the tool page.</p></li>
</ol>
</div>
<div class="section" id="closing-rdm-during-current-firefox-session">
<h2>Closing RDM During Current Firefox Session<a class="headerlink" href="#closing-rdm-during-current-firefox-session" title="Permalink to this headline">¶</a></h2>
<p>To close RDM, we follow a similar process to the one from opening RDM so we can
restore the content back to a normal tab.</p>
<ol class="simple">
<li><p>Stop the tunnel between outer and inner browsers.</p></li>
<li><p>Create a temporary, hidden tab to hold the content.</p></li>
<li><p>Mark the content tab browser’s docshell as active so the frame is created
eagerly and will be ready to swap.</p></li>
<li><p>Swap tab content from the browser within the viewport in the tool UI to the
regular browser tab, preserving all state via
<code class="docutils literal notranslate"><span class="pre">gBrowser._swapBrowserDocShells</span></code>.</p></li>
<li><p>Force the original browser tab to be remote since web content is loaded in
the child process, and we’re about to swap the content into this tab.</p></li>
<li><p>Swap the content into the original browser tab and close the temporary tab
used to hold the content via <code class="docutils literal notranslate"><span class="pre">swapBrowsersAndCloseOther</span></code>.</p></li>
</ol>
</div>
<div class="section" id="session-restore">
<h2>Session Restore<a class="headerlink" href="#session-restore" title="Permalink to this headline">¶</a></h2>
<p>When restarting Firefox and restoring a user’s browsing session, we must
correctly restore the tab history.  If the RDM tool was opened when the session
was captured, then it would be acceptable to either:</p>
<ul class="simple">
<li><p>A: Restore the tab content without any RDM tool displayed <strong>OR</strong></p></li>
<li><p>B: Restore the RDM tool the tab content inside, just as before the restart</p></li>
</ul>
<p>We currently follow path A (no RDM after session restore), which seems more in
line with how the rest of DevTools currently functions after restore.  To do so,
we watch for <code class="docutils literal notranslate"><span class="pre">beforeunload</span></code> events on the tab at shutdown and quickly exit RDM
so that session restore records only the original page content during its final
write at shutdown.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="console-panel.html" class="btn btn-neutral float-right" title="Console Tool Architecture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="debugger-panel.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>