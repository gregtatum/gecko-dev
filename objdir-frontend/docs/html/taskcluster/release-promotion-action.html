

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Release Promotion Action &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Balrog in Release Promotion" href="balrog.html" />
    <link rel="prev" title="Release Promotion" href="release-promotion.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/geckoview/index.html">Welcome to GeckoViewâ€™s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TaskCluster Task-Graph Generation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="taskgraph.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mach.html">Taskcluster Mach commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading.html">Loading Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="transforms.html">Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker-images.html">Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="cron.html">Periodic Taskgraphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="try.html">Try</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="release-promotion.html">Release Promotion</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="release-promotion.html#release-promotion-phases">Release Promotion Phases</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="release-promotion.html#in-depth-relpro-guide">In-depth relpro guide</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Release Promotion Action</a></li>
<li class="toctree-l4"><a class="reference internal" href="balrog.html">Balrog in Release Promotion</a></li>
<li class="toctree-l4"><a class="reference internal" href="setting-up-an-update-server.html">Setting Up An Update Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="partials.html">Partial Update Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="signing.html">Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="partner-repacks.html">Partner repacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="partner-attribution.html">Partner attribution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="versioncontrol.html">Version Control in CI</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Taskcluster Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-tos.html">How Tos</a></li>
<li class="toctree-l2"><a class="reference internal" href="task-graph.html">Task Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">TaskCluster Task-Graph Generation</a> &raquo;</li>
        
          <li><a href="release-promotion.html">Release Promotion</a> &raquo;</li>
        
      <li>Release Promotion Action</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/taskcluster/release-promotion-action.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="release-promotion-action">
<h1>Release Promotion Action<a class="headerlink" href="#release-promotion-action" title="Permalink to this headline">Â¶</a></h1>
<p>The release promotion action is how Releng triggers <a class="reference external" href="release-promotion.html">release promotion</a>
taskgraphs. The one action covers all release promotion needs: different
<em>flavors</em> allow for us to trigger the different <a class="reference internal" href="release-promotion.html#release-promotion-phases"><span class="std std-ref">Release Promotion Phases</span></a>
for each product. The input schema and release promotion flavors are defined in
the <a class="reference external" href="https://searchfox.org/mozilla-central/source/taskcluster/taskgraph/actions/release_promotion.py">release promotion action</a>.</p>
<div class="section" id="the-snowman-model">
<span id="snowman-model"></span><h2>The snowman model<a class="headerlink" href="#the-snowman-model" title="Permalink to this headline">Â¶</a></h2>
<p>The <a class="reference external" href="https://searchfox.org/mozilla-central/source/taskcluster/taskgraph/actions/release_promotion.py">release promotion action</a> allows us to chain multiple taskgraphs (aka graphs, aka task groups) together.
Essentially, weâ€™re using <a class="reference external" href="optimization.html">optimization</a> logic to replace task labels in the
current taskgraph with task IDs from the previous taskgraph(s).</p>
<p>This is the <code class="docutils literal notranslate"><span class="pre">snowman</span></code> model. If you request the body of
the snowman and point at the base, we only create the middle section of the snowman.
If you request the body of the snowman and donâ€™t point it at the base, we build the
first base and body of the snowman from scratch.</p>
<p>For example, letâ€™s generate a task <code class="docutils literal notranslate"><span class="pre">t2</span></code> that depends on <code class="docutils literal notranslate"><span class="pre">t1</span></code>. Letâ€™s call our new taskgraph <code class="docutils literal notranslate"><span class="pre">G</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G</span>
<span class="o">|</span>
<span class="n">t1</span>
<span class="o">|</span>
<span class="n">t2</span>
</pre></div>
</div>
<p>Task <code class="docutils literal notranslate"><span class="pre">t2</span></code> will wait on task <code class="docutils literal notranslate"><span class="pre">t1</span></code> to finish, and downloads some artifacts from task <code class="docutils literal notranslate"><span class="pre">t1</span></code>.</p>
<p>Now letâ€™s specify task group <code class="docutils literal notranslate"><span class="pre">G1</span></code> and <code class="docutils literal notranslate"><span class="pre">G2</span></code> as previous task group IDs. If task <code class="docutils literal notranslate"><span class="pre">t1</span></code> is in one of them, <code class="docutils literal notranslate"><span class="pre">t2</span></code> will depend on that task, rather than spawning a new <code class="docutils literal notranslate"><span class="pre">t1</span></code> in task group <code class="docutils literal notranslate"><span class="pre">G</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G1</span>        <span class="n">G2</span>        <span class="n">G</span>
<span class="o">|</span>         <span class="o">|</span>         <span class="o">|</span>
<span class="n">t1</span>        <span class="n">t1</span>        <span class="o">|</span>
            \<span class="n">______</span> <span class="o">|</span>
                   \<span class="o">|</span>
                    <span class="n">t2</span>

<span class="ow">or</span>

<span class="n">G1</span>        <span class="n">G2</span>        <span class="n">G</span>
<span class="o">|</span>         <span class="o">|</span>         <span class="o">|</span>
<span class="n">t1</span>        <span class="n">t0</span>        <span class="o">|</span>
  \<span class="n">________________</span> <span class="o">|</span>
                   \<span class="o">|</span>
                    <span class="n">t2</span>
</pre></div>
</div>
<p>For a more real-world example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">G</span>
     <span class="o">|</span>
   <span class="n">build</span>
     <span class="o">|</span>
  <span class="n">signing</span>
     <span class="o">|</span>
<span class="n">l10n</span><span class="o">-</span><span class="n">repack</span>
     <span class="o">|</span>
<span class="n">l10n</span><span class="o">-</span><span class="n">signing</span>
</pre></div>
</div>
<p>If we point the <code class="docutils literal notranslate"><span class="pre">promote</span></code> task group G at the on-push build task group <code class="docutils literal notranslate"><span class="pre">G1</span></code>, the l10n-repack job will depend on the previously finished build and build-signing tasks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">G1</span>            <span class="n">G</span>
   <span class="o">|</span>             <span class="o">|</span>
 <span class="n">build</span>           <span class="o">|</span>
   <span class="o">|</span>             <span class="o">|</span>
<span class="n">signing</span>          <span class="o">|</span>
       \<span class="n">_________</span><span class="o">|</span>
                 <span class="o">|</span>
            <span class="n">l10n</span><span class="o">-</span><span class="n">repack</span>
                 <span class="o">|</span>
            <span class="n">l10n</span><span class="o">-</span><span class="n">signing</span>
</pre></div>
</div>
<p>We can also explicitly exclude certain tasks from being optimized out.
We currently do this by specifying <code class="docutils literal notranslate"><span class="pre">rebuild_kinds</span></code> in the action; these
are <a class="reference external" href="kinds.html">kinds</a> that we want to explicitly rebuild in the current task group,
even if they existed in previous task groups. We also allow for specifying a list of
<code class="docutils literal notranslate"><span class="pre">do_not_optimize</span></code> labels, which would be more verbose and specific than
specifying kinds to rebuild.</p>
</div>
<div class="section" id="release-promotion-action-mechanics">
<h2>Release promotion action mechanics<a class="headerlink" href="#release-promotion-action-mechanics" title="Permalink to this headline">Â¶</a></h2>
<p>There are a number of inputs defined in the <a class="reference external" href="https://searchfox.org/mozilla-central/source/taskcluster/taskgraph/actions/release_promotion.py">release promotion action</a>. Among these are the <code class="docutils literal notranslate"><span class="pre">previous_graph_ids</span></code>, which is an ordered list of taskGroupIds of the task groups that we want to build our task group, off of. In the <a class="reference internal" href="#snowman-model"><span class="std std-ref">The snowman model</span></a>, these define the already-built portions of the snowman.</p>
<p>The action downloads the <code class="docutils literal notranslate"><span class="pre">parameters.yml</span></code> from the initial <code class="docutils literal notranslate"><span class="pre">previous_graph_id</span></code>, which matches the decision- or action- taskId. (See <a class="reference internal" href="#taskid-vs-taskgroupid"><span class="std std-ref">Release promotion action taskId and taskGroupId</span></a>.) This is most likely the decision task of the revision to promote, which is generally the same revision the release promotion action is run against.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the parameters have been changed since the build happened, <em>and</em> we explicitly want the new parameters for the release promotion action task, the first <code class="docutils literal notranslate"><span class="pre">previous_graph_id</span></code> should be the new revisionâ€™s decision task. Then the build and other previous action task group IDs can follow, so weâ€™re still replacing the task labels with the task IDs from the original revision.</p>
</div>
<p>The action then downloads the various <code class="docutils literal notranslate"><span class="pre">label-to-taskid.json</span></code> artifacts from each previous task group, and builds an <code class="docutils literal notranslate"><span class="pre">existing_tasks</span></code> parameter of which labels to replace with which task IDs. Each successive update to this dictionary overwrites existing keys with new task IDs, so the rightmost task group with a given label takes precedence. Any labels that match the <code class="docutils literal notranslate"><span class="pre">do_not_optimize</span></code> list or that belong to tasks in the <code class="docutils literal notranslate"><span class="pre">rebuild_kinds</span></code> list are excluded from the <code class="docutils literal notranslate"><span class="pre">existing_tasks</span></code> parameter.</p>
<p>Once all that happens, and weâ€™ve gotten our configuration from the original parameters and our action config and inputs, we run the decision task function with our custom parameters. The <a class="reference external" href="optimization.html">optimization</a> phase replaces any <code class="docutils literal notranslate"><span class="pre">existing_tasks</span></code> with the task IDs weâ€™ve built from the previous task groups.</p>
</div>
<div class="section" id="release-promotion-flavors">
<h2>Release Promotion Flavors<a class="headerlink" href="#release-promotion-flavors" title="Permalink to this headline">Â¶</a></h2>
<p>For the most part, release promotion flavors match the pattern <code class="docutils literal notranslate"><span class="pre">phase_product</span></code>,
e.g. <code class="docutils literal notranslate"><span class="pre">promote_firefox</span></code>, <code class="docutils literal notranslate"><span class="pre">push_devedition</span></code>, or <code class="docutils literal notranslate"><span class="pre">ship_firefox</span></code>.</p>
<p>Weâ€™ve added <code class="docutils literal notranslate"><span class="pre">_rc</span></code> suffix flavors, to deal with special RC behavior around rolling out updates using a different rate or channel.</p>
<p>We are planning on adding <code class="docutils literal notranslate"><span class="pre">_partners</span></code> suffix flavors, to allow for creating partner repacks off-cycle.</p>
<p>The various flavors are defined in the <a class="reference external" href="https://searchfox.org/mozilla-central/source/taskcluster/taskgraph/actions/release_promotion.py">release promotion action</a>.</p>
</div>
<div class="section" id="triggering-the-release-promotion-action-via-treeherder">
<h2>Triggering the release promotion action via Treeherder<a class="headerlink" href="#triggering-the-release-promotion-action-via-treeherder" title="Permalink to this headline">Â¶</a></h2>
<p>Currently, weâ€™re able to trigger this action via <a class="reference external" href="https://treeherder.mozilla.org">Treeherder</a>; we sometimes use this method for testing purposes. This is powerful, because we can modify the inputs directly, but is less production friendly, because it requires us to enter the inputs manually. At some point we may disable the ability to trigger the action via Treeherder.</p>
<p>This requires being signed in with the right scopes. On <a class="reference external" href="https://searchfox.org/mozilla-central/search?q=RELEASE_PROMOTION_PROJECTS&amp;path=taskcluster/taskgraph/util/attributes.py">Release Promotion Projects</a>, thereâ€™s a dropdown in the top right of a given revision. Choose <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">Push</span> <span class="pre">Action</span></code>, then <code class="docutils literal notranslate"><span class="pre">Release</span> <span class="pre">Promotion</span></code>. The inputs are specifiable as raw yaml on the left hand column.</p>
</div>
<div class="section" id="triggering-the-release-promotion-action-via-releaserunner3">
<h2>Triggering the release promotion action via releaserunner3<a class="headerlink" href="#triggering-the-release-promotion-action-via-releaserunner3" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://hg.mozilla.org/build/tools/file/tip/buildfarm/release">Releaserunner3</a> is our current method of triggering the release promotion action from Ship It in production. Examples of how to run this are in the <a class="reference external" href="https://github.com/mozilla-releng/releasewarrior-2.0/blob/master/docs/release-promotion/desktop/howto.md#how">releasewarrior docs</a>.</p>
<p>To deal with the above <code class="docutils literal notranslate"><span class="pre">previous_graph_ids</span></code> logic, we allow for a <code class="docutils literal notranslate"><span class="pre">decision_task_id</span></code> in <a class="reference external" href="https://searchfox.org/build-central/source/tools/buildfarm/release/trigger_action.py#118">trigger_action.py</a>. As of 2018-03-14, this script assumes we want to download <code class="docutils literal notranslate"><span class="pre">parameters.yml</span></code> from the same decision task that we get <code class="docutils literal notranslate"><span class="pre">actions.json</span></code> from. At some point, weâ€™d like the <a class="reference external" href="https://searchfox.org/build-central/source/tools/buildfarm/release/trigger_action.py#118">trigger_action.py</a> call to happen automatically once we push a button on Ship It.</p>
<p>The action task thatâ€™s generated from <code class="docutils literal notranslate"><span class="pre">actions.json</span></code> matches the <a class="reference external" href="https://searchfox.org/mozilla-central/source/.taskcluster.yml">.taskcluster.yml</a> template. This is important; Chain of Trust (v2) requires that the task definition be reproducible from <a class="reference external" href="https://searchfox.org/mozilla-central/source/.taskcluster.yml">.taskcluster.yml</a>.</p>
</div>
<div class="section" id="release-promotion-action-taskid-and-taskgroupid">
<span id="taskid-vs-taskgroupid"></span><h2>Release promotion action taskId and taskGroupId<a class="headerlink" href="#release-promotion-action-taskid-and-taskgroupid" title="Permalink to this headline">Â¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">taskGroupId</span></code> of a release promotion action task will be the same as the <code class="docutils literal notranslate"><span class="pre">taskId</span></code> of the decision task.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">taskGroupId</span></code> of a release promotion <em>task group</em> will be the same as the <code class="docutils literal notranslate"><span class="pre">taskId</span></code> of the release promotion action task.</p>
<p>So:</p>
<ul class="simple">
<li><p>for a given push, the decision taskId <code class="docutils literal notranslate"><span class="pre">D</span></code> will create the taskGroupId <code class="docutils literal notranslate"><span class="pre">D</span></code></p></li>
<li><p>we create a release promotion action task with the taskId <code class="docutils literal notranslate"><span class="pre">A</span></code>. The <code class="docutils literal notranslate"><span class="pre">A</span></code> task will be part of the <code class="docutils literal notranslate"><span class="pre">D</span></code> task group, but will spawn a task group with the taskGroupId <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p></li>
</ul>
<p>Another way of looking at it:</p>
<ul class="simple">
<li><p>If youâ€™re looking at a task <code class="docutils literal notranslate"><span class="pre">t1</span></code> in the action taskGroup, <code class="docutils literal notranslate"><span class="pre">t1</span></code>â€™s taskGroupId is the action taskâ€™s taskId. (In the above example, this would be <code class="docutils literal notranslate"><span class="pre">A</span></code>.)</p></li>
<li><p>Then if you look at the action taskâ€™s taskGroupId, thatâ€™s the original decision taskâ€™s taskId. (In the above example, this would be <code class="docutils literal notranslate"><span class="pre">D</span></code>.)</p></li>
</ul>
</div>
<div class="section" id="testing-and-developing-the-release-promotion-action">
<h2>Testing and developing the release promotion action<a class="headerlink" href="#testing-and-developing-the-release-promotion-action" title="Permalink to this headline">Â¶</a></h2>
<p>To test the release promotion, action, we can use <code class="docutils literal notranslate"><span class="pre">./mach</span> <span class="pre">taskgraph</span> <span class="pre">test-action-callback</span></code> to debug.</p>
<p>The full command for a <code class="docutils literal notranslate"><span class="pre">promote_firefox</span></code> test might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">mach</span> <span class="n">taskgraph</span> <span class="n">test</span><span class="o">-</span><span class="n">action</span><span class="o">-</span><span class="n">callback</span> \
    <span class="o">--</span><span class="n">task</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="nb">id</span> <span class="n">LR</span><span class="o">-</span><span class="n">xH1ViTTi2jrI</span><span class="o">-</span><span class="n">N1Mf2A</span> \
    <span class="o">--</span><span class="nb">input</span> <span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">gecko</span><span class="o">/</span><span class="n">params</span><span class="o">/</span><span class="n">promote_firefox</span><span class="o">.</span><span class="n">yml</span> \
    <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">gecko</span><span class="o">/</span><span class="n">params</span><span class="o">/</span><span class="n">maple</span><span class="o">-</span><span class="n">promote</span><span class="o">-</span><span class="n">firefox</span><span class="o">.</span><span class="n">yml</span> \
    <span class="n">release_promotion_action</span> <span class="o">&gt;</span> <span class="o">../</span><span class="n">promote</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The input file (in the above example, that would be <code class="docutils literal notranslate"><span class="pre">/src/gecko/params/promote_firefox.yml</span></code>), contains the action inputs. The input schema is defined in the <a class="reference external" href="https://searchfox.org/mozilla-central/source/taskcluster/taskgraph/actions/release_promotion.py">release promotion action</a>. Previous example inputs are embedded in previous promotion task group action task definitions (<code class="docutils literal notranslate"><span class="pre">task.extra.action.input</span></code>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">parameters.yml</span></code> file is downloadable from a previous decision or action task.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="balrog.html" class="btn btn-neutral float-right" title="Balrog in Release Promotion" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="release-promotion.html" class="btn btn-neutral float-left" title="Release Promotion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>