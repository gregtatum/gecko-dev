

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>System Add-ons Overview &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Crash Manager" href="../../../components/crashes/crash-manager/index.html" />
    <link rel="prev" title="AddonManager Reference" href="AddonManager.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Toolkit</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Add-on Manager</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="AddonManager.html">AddonManager Reference</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">System Add-ons Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#default-built-in-system-add-ons">Default, built-in system add-ons</a></li>
<li class="toctree-l4"><a class="reference internal" href="#system-add-on-updates">System add-on updates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#firefox-system-add-on-update-protocol">Firefox System Add-on Update Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#update-request">Update Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-response">Update Response</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-behavior">Update Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/crashes/crash-manager/index.html">Crash Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../crashreporter/crashreporter/index.html">Crash Reporter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/featuregates/featuregates/index.html">Feature Gates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../search/index.html">Search Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/normandy/normandy/index.html">Shield Recipe Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/messaging-system/docs/index.html">Messaging System Schemas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/pictureinpicture/pictureinpicture/index.html">Picture-in-Picture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/prompts/prompts/index.html">Prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/subprocess/toolkit_modules/subprocess/index.html">Subprocess Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/telemetry/index.html">Telemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/glean/index.html">Firefox on Glean (FOG)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/toolkit_modules/index.html">Toolkit Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../content/toolkit_widgets/index.html">Toolkit Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/url-classifier/url-classifier/index.html">URL Classifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/extensions/webextensions/index.html">WebExtensions API Development</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Toolkit</a> &raquo;</li>
        
          <li><a href="index.html">Add-on Manager</a> &raquo;</li>
        
      <li>System Add-ons Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/toolkit/mozapps/extensions/addon-manager/SystemAddons.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="system-add-ons-overview">
<h1>System Add-ons Overview<a class="headerlink" href="#system-add-ons-overview" title="Permalink to this headline">¶</a></h1>
<p>System add-ons are a method for shipping extensions to Firefox that:</p>
<ul class="simple">
<li><p>are hidden from the <a class="reference external" href="about:addons">about:addons</a> UI</p></li>
<li><p>cannot be user disabled</p></li>
<li><p>can be updated restartlessly based on criteria Mozilla sets</p></li>
</ul>
<p>Generally these are considered to be built-in features to Firefox, and the
fact that they are extensions and can be updated restartlessly are implementation
details as far as users are concerned.</p>
<p>If you’d like to ship an add-on with Firefox or as an update (either to an existing
feature or as a “hotfix” to patch critical problems in the wild) please contact the
GoFaster team: <a class="reference external" href="https://mail.mozilla.org/listinfo/gofaster">https://mail.mozilla.org/listinfo/gofaster</a></p>
<p>The add-ons themselves are either legacy Firefox add-ons or WebExtensions.
They must be:</p>
<ul class="simple">
<li><p>restartless</p></li>
<li><p>multi-process compatible</p></li>
</ul>
<p>Other than these restrictions there is nothing special or different about
the extensions themselves.</p>
<p>It is possible to override an installed system add-on by installing a different add-on
with the same ID into a higher priority location.</p>
<p>Available locations, starting from the highest priority include:</p>
<ol class="arabic simple">
<li><p>temporary install (<a class="reference external" href="about:debugging">about:debugging</a>)</p></li>
<li><p>normal user install into profile (<a class="reference external" href="about:addons">about:addons</a> or AMO/TestPilot/etc.)</p></li>
<li><p>system add-on updates</p></li>
<li><p>built-in system add-ons</p></li>
</ol>
<p>This makes it possible for a developer or user to override a system add-on
by installing an add-on with the same ID from AMO or TestPilot or as a temporary
add-on.</p>
<div class="section" id="default-built-in-system-add-ons">
<h2>Default, built-in system add-ons<a class="headerlink" href="#default-built-in-system-add-ons" title="Permalink to this headline">¶</a></h2>
<p>The set of <strong>default</strong> system add-ons are checked into <cite>mozilla-central</cite> under
<cite>./browser/extensions</cite>. These get placed into the <cite>features</cite> directory of the
application directory at build time.</p>
</div>
<div class="section" id="system-add-on-updates">
<h2>System add-on updates<a class="headerlink" href="#system-add-on-updates" title="Permalink to this headline">¶</a></h2>
<p>System add-on <strong>updates</strong> are served via Mozilla’s Automatic Update Service
(AUS, aka <a class="reference external" href="https://wiki.mozilla.org/Balrog">Balrog</a>). These are installed into the users profile under the <cite>features</cite>
directory.</p>
<p>Updates must be specifically signed by Mozilla - the signature that addons.mozilla.org
uses will not work for system add-ons.</p>
<p>As noted above, these updates may override a built-in system add-on, or they may
be a new install. Updates are always served as a set - if any add-on in the set
fails to install or upgrade, then the whole set fails. This is to leave Firefox
in a consistent state.</p>
<p>System add-on updates are removed when the Firefox application version changes,
to avoid compatibility problems - for instance a user downgrading to an earlier
version of Firefox than the update supports will end up with a disabled update
rather than falling back to the built-in version.</p>
</div>
</div>
<div class="section" id="firefox-system-add-on-update-protocol">
<h1>Firefox System Add-on Update Protocol<a class="headerlink" href="#firefox-system-add-on-update-protocol" title="Permalink to this headline">¶</a></h1>
<p>This section describes the protocol that Firefox uses when retrieving updates
from AUS, and the expected behavior of Firefox based on the updater service’s response.</p>
<div class="section" id="update-request">
<h2>Update Request<a class="headerlink" href="#update-request" title="Permalink to this headline">¶</a></h2>
<p>To determine what updates to install, Firefox makes an HTTP <strong>GET</strong> request to
AUS once a day via a URL of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">aus5</span><span class="o">.</span><span class="n">mozilla</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">update</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="n">SystemAddons</span><span class="o">/%</span><span class="n">VERSION</span><span class="o">%/%</span><span class="n">BUILD_ID</span><span class="o">%/%</span><span class="n">BUILD_TARGET</span><span class="o">%/%</span><span class="n">LOCALE</span><span class="o">%/%</span><span class="n">CHANNEL</span><span class="o">%/%</span><span class="n">OS_VERSION</span><span class="o">%/%</span><span class="n">DISTRIBUTION</span><span class="o">%/%</span><span class="n">DISTRIBUTION_VERSION</span><span class="o">%/</span><span class="n">update</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>The path segments surrounded by <code class="docutils literal notranslate"><span class="pre">%</span></code> symbols are variable fields that Firefox
fills in with information about itself and the environment it’s running in:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">VERSION</span></code></dt><dd><p>Firefox version number</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BUILD_ID</span></code></dt><dd><p>Build ID</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BUILD_TARGET</span></code></dt><dd><p>Build target</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">LOCALE</span></code></dt><dd><p>Build locale</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CHANNEL</span></code></dt><dd><p>Update channel</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">OS_VERSION</span></code></dt><dd><p>OS Version</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DISTRIBUTION</span></code></dt><dd><p>Firefox Distribution</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DISTRIBUTION_VERSION</span></code></dt><dd><p>Firefox Distribution version</p>
</dd>
</dl>
</div>
<div class="section" id="update-response">
<h2>Update Response<a class="headerlink" href="#update-response" title="Permalink to this headline">¶</a></h2>
<p>AUS should respond with an XML document that looks something like this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;updates&gt;</span>
  <span class="nt">&lt;addons&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;flyweb@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/flyweb/flyweb@mozilla.org-1.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;pocket@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/pocket/pocket@mozilla.org-1.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/addons&gt;</span>
<span class="nt">&lt;/updates&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The root element is <code class="docutils literal notranslate"><span class="pre">&lt;updates&gt;</span></code>, used for all updater responses.</p></li>
<li><p>The only child of <code class="docutils literal notranslate"><span class="pre">&lt;updates&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">&lt;addons&gt;</span></code>, which represents a list of
system add-ons to update.</p></li>
<li><p>Within <code class="docutils literal notranslate"><span class="pre">&lt;addons&gt;</span></code> are several <code class="docutils literal notranslate"><span class="pre">&lt;addon&gt;</span></code> tags, each one corresponding to a
system add-on to update.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">&lt;addon&gt;</span></code> tags <strong>must</strong> have the following attributes:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><p>The extension ID</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">URL</span></code></dt><dd><p>URL to a signed XPI of the specified add-on version to download</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hashFunction</span></code></dt><dd><p>Identifier of the hash function used to generate the hashValue attribute.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hashValue</span></code></dt><dd><p>Hash of the XPI file linked from the URL attribute, calculated using the function specified in the hashValue attribute.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>Size (in bytes) of the XPI file linked from the URL attribute.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">version</span></code></dt><dd><p>Version number of the add-on</p>
</dd>
</dl>
</div>
<div class="section" id="update-behavior">
<h2>Update Behavior<a class="headerlink" href="#update-behavior" title="Permalink to this headline">¶</a></h2>
<p>After receiving the update response, Firefox modifies the <strong>update</strong> add-ons
according to the following algorithm:</p>
<ol class="arabic simple">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">&lt;addons&gt;</span></code> tag is empty (<code class="docutils literal notranslate"><span class="pre">&lt;addons&gt;&lt;/addons&gt;</span></code>) in the response,
<strong>remove all system add-on updates</strong>.</p></li>
<li><p>If no add-ons were specified in the response (i.e. the <code class="docutils literal notranslate"><span class="pre">&lt;addons&gt;</span></code> tag
is not present), do nothing and finish.</p></li>
<li><p>If the <strong>update</strong> add-on set is equal to the set of add-ons specified in the
update response, do nothing and finish.</p></li>
<li><p>If the set of <strong>default</strong> add-ons is equal to the set of add-ons specified in
the update response, remove all the  <strong>update</strong> add-ons and finish.</p></li>
<li><p>Download each add-on specified in the update response and store them in the
“downloaded add-on set”. A failed download <strong>must</strong> abort the entire system
add-on update.</p></li>
<li><p>Validate the downloaded add-ons. The following <strong>must</strong> be true for all
downloaded add-ons, or the update process is aborted:</p>
<ol class="loweralpha simple">
<li><p>The ID and version of the downloaded add-on must match the specified ID or
version in the update response.</p></li>
<li><p>The hash provided in the update response must match the downloaded add-on
file.</p></li>
<li><p>The downloaded add-on file size must match the size given in the update
response.</p></li>
<li><p>The add-on must be compatible with Firefox (i.e. it must not be for a
different application, such as Thunderbird).</p></li>
<li><p>The add-on must be packed (i.e. be an XPI file).</p></li>
<li><p>The add-on must be restartless.</p></li>
<li><p>The add-on must be signed by the system add-on root certificate.</p></li>
</ol>
</li>
</ol>
<ol class="arabic simple" start="6">
<li><p>Once all downloaded add-ons are validated, install them into the profile
directory as part of the <strong>update</strong> set.</p></li>
</ol>
<p>Notes on the update process:</p>
<ul class="simple">
<li><p>Add-ons are considered “equal” if they have the same ID and version number.</p></li>
</ul>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The follow section describes common situations that we have or expect to run
into and how the protocol described above handles them.</p>
<p>For simplicity, unless otherwise specified, all examples assume that there are
two system add-ons in existence: <strong>FlyWeb</strong> and <strong>Pocket</strong>.</p>
<div class="section" id="basic">
<h3>Basic<a class="headerlink" href="#basic" title="Permalink to this headline">¶</a></h3>
<p>A user has Firefox 45, which shipped with FlyWeb 1.0 and Pocket 1.0. We want to
update users to FlyWeb 2.0. AUS sends out the following update response:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;updates&gt;</span>
  <span class="nt">&lt;addons&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;flyweb@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/flyweb/flyweb@mozilla.org-2.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;pocket@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/pocket/pocket@mozilla.org-1.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/addons&gt;</span>
<span class="nt">&lt;/updates&gt;</span>
</pre></div>
</div>
<p>Firefox will download FlyWeb 2.0 and Pocket 1.0 and store them in the profile directory.</p>
</div>
<div class="section" id="missing-add-on">
<h3>Missing Add-on<a class="headerlink" href="#missing-add-on" title="Permalink to this headline">¶</a></h3>
<p>A user has Firefox 45, which shipped with FlyWeb 1.0 and Pocket 1.0. We want to
update users to FlyWeb 2.0, but accidentally forget to specify Pocket in the
update response. AUS sends out the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;updates&gt;</span>
  <span class="nt">&lt;addons&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;flyweb@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/flyweb/flyweb@mozilla.org-2.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/addons&gt;</span>
<span class="nt">&lt;/updates&gt;</span>
</pre></div>
</div>
<p>Firefox will download FlyWeb 2.0 and store it in the profile directory. Pocket
1.0 from the <strong>default</strong> location will be used.</p>
</div>
<div class="section" id="remove-all-system-add-on-updates">
<h3>Remove all system add-on updates<a class="headerlink" href="#remove-all-system-add-on-updates" title="Permalink to this headline">¶</a></h3>
<p>A response from AUS with an empty add-on set will <em>remove all system add-on
updates</em>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;updates&gt;</span>
  <span class="nt">&lt;addons&gt;&lt;/addons&gt;</span>
<span class="nt">&lt;/updates&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="rollout">
<h3>Rollout<a class="headerlink" href="#rollout" title="Permalink to this headline">¶</a></h3>
<p>A user has Firefox 45, which shipped with FlyWeb 1.0 and Pocket 1.0. We want to
rollout FlyWeb 2.0 at a 10% sample rate. 10% of the time, AUS sends out:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;updates&gt;</span>
  <span class="nt">&lt;addons&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;flyweb@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/flyweb/flyweb@mozilla.org-2.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;pocket@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/pocket/pocket@mozilla.org-1.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/addons&gt;</span>
<span class="nt">&lt;/updates&gt;</span>
</pre></div>
</div>
<p>With this response, Firefox will download Pocket 1.0 and FlyWeb 2.0 and install
them into the profile directory.</p>
<p>The other 90% of the time, AUS sends out an empty response:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;updates&gt;&lt;/updates&gt;</span>
</pre></div>
</div>
<p>With the empty response, Firefox will not make any changes. This means users who
haven’t seen the 10% update response will stay on FlyWeb 1.0, and users who have
seen it will stay on FlyWeb 2.0.</p>
<p>Once we’re happy with the rollout and want to switch to 100%, AUS will send the
10% update response to 100% of users, upgrading everyone to FlyWeb 2.0.</p>
</div>
<div class="section" id="rollback">
<h3>Rollback<a class="headerlink" href="#rollback" title="Permalink to this headline">¶</a></h3>
<p>This example continues from the “Rollout” example. If, during the 10% rollout,
we find a major issue with FlyWeb 2.0, we want to roll all users back to FlyWeb 1.0.
AUS sends out the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;updates&gt;</span>
  <span class="nt">&lt;addons&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;flyweb@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/flyweb/flyweb@mozilla.org-1.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;addon</span> <span class="na">id=</span><span class="s">&quot;pocket@mozilla.org&quot;</span> <span class="na">URL=</span><span class="s">&quot;https://ftp.mozilla.org/pub/system-addons/pocket/pocket@mozilla.org-1.0.xpi&quot;</span> <span class="na">hashFunction=</span><span class="s">&quot;sha512&quot;</span> <span class="na">hashValue=</span><span class="s">&quot;abcdef123&quot;</span> <span class="na">size=</span><span class="s">&quot;1234&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/addons&gt;</span>
<span class="nt">&lt;/updates&gt;</span>
</pre></div>
</div>
<p>For users who have updated, Firefox will download FlyWeb 1.0 and Pocket 1.0 and
install them into the profile directory. For users that haven’t yet updated,
Firefox will see that the <strong>default</strong> add-on set matches the set in the update
ping and clear the <strong>update</strong> add-on set.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../components/crashes/crash-manager/index.html" class="btn btn-neutral float-right" title="Crash Manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="AddonManager.html" class="btn btn-neutral float-left" title="AddonManager Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>