

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stub Installer GUI &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="WebBrowser Plugin API" href="WebBrowserAPI.html" />
    <link rel="prev" title="Stub Installer Architecture" href="StubArch.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Firefox</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../urlbar/index.html">Address Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../BrowserUsageTelemetry.html">Browser Usage Telemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/enterprisepolicies/docs/index.html">Enterprise Policies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extensions/formautofill/docs/index.html">Form Autofill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/newtab/docs/index.html">Firefox Home (New Tab)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Installer</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="InstallerBuild.html">Installer Build</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="StubInstaller.html">Stub Installer</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="StubConfig.html">Stub Installer Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="StubArch.html">Stub Installer Architecture</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Stub Installer GUI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="FullInstaller.html">Full Installer</a></li>
<li class="toctree-l3"><a class="reference internal" href="MSI.html">MSI Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="Helper.html">Helper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../toolkit/mozapps/defaultagent/default-browser-agent/index.html">Default Browser Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/newtab/content-src/asrouter/docs/index.html">Messaging System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../base/sslerrorreport/index.html">SSL Error Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../base/tabbrowser/index.html">tabbrowser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../touchbar/index.html">Touch Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/uitour/docs/index.html">UITour</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/payments/docs/index.html">WebPayments UI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Firefox</a> &raquo;</li>
        
          <li><a href="index.html">Installer</a> &raquo;</li>
        
          <li><a href="StubInstaller.html">Stub Installer</a> &raquo;</li>
        
      <li>Stub Installer GUI</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/browser/installer/windows/installer/StubGUI.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stub-installer-gui">
<h1>Stub Installer GUI<a class="headerlink" href="#stub-installer-gui" title="Permalink to this headline">¶</a></h1>
<p>The stub installer’s primary GUI is built using the web platform, rendered by the native Windows browser control <code class="docutils literal notranslate"><span class="pre">IWebBrowser2</span></code>, which is based on Internet Explorer (Microsoft never updated it to use Edge <a class="footnote-reference brackets" href="#id3" id="id1">3</a>).</p>
<p>This is all driven by a custom NSIS plugin, called WebBrowser. The plugin’s source code can be found in the directory <code class="docutils literal notranslate"><span class="pre">other-licenses/nsis/Contrib/WebBrowser</span></code>, and its public API is documented <a class="reference internal" href="WebBrowserAPI.html"><span class="doc">here</span></a>. The plugin implements the COM interfaces needed to host the IWebBrowser2 object and embed it using OLE into the dialog provided by NSIS. It also provides an implementation of timers <a class="footnote-reference brackets" href="#id4" id="id2">4</a>, and supports making NSIS functions callable from JavaScript running inside the web page.</p>
<p>Note that not 100% of the stub UI is built using WebBrowser; we also have message boxes which use <a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/api/commctrl/nf-commctrl-taskdialog">the Windows TaskDialog function</a>, invoked from NSIS code using the standard System plugin.</p>
<div class="section" id="changing-the-ui">
<h2>Changing the UI<a class="headerlink" href="#changing-the-ui" title="Permalink to this headline">¶</a></h2>
<p>For each of the two main pages, there is one HTML file (which also contains the JavaScript for the page) and one CSS file.</p>
<p>The HTML file for each page is always the same regardless of the branding, so it’s kept in the <code class="docutils literal notranslate"><span class="pre">installer</span></code> directory next to <code class="docutils literal notranslate"><span class="pre">stub.nsi</span></code>. These files should be updated if elements need to be added or removed from the page, or if features requiring JavaScript are being implemented or changed.</p>
<p>Each branding directory (<code class="docutils literal notranslate"><span class="pre">/browser/branding/*</span></code>) contains a CSS file for each page, which specifies how the page should be laid out and rendered. These are normal CSS files and can easily be modified to change or redesign one or both pages for any or all brandings. Currently there are two completely different layouts, one for release and another for all other brandings, and the two differ only in this CSS file and in the background image file (also in the branding directory).</p>
</div>
<div class="section" id="constraints">
<h2>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<p>The most severe constraint on the web UI is that the browser engine must be configured to run in Internet Explorer 8 mode. This is because the installer must run correctly on an unpatched Windows 7 installation with no service packs or other updates, and that is the version of IE that such an installation provides. That means this constraint can only be relaxed if Firefox’s OS support changes to exclude unpatched Windows 7 (i.e., either dropping Windows 7 entirely or requiring Service Pack 1).</p>
<p>Image assets (meaning only the background image at the moment) can be any format IE8 can open, including JPEG, GIF, or PNG, but any newer formats like WebP won’t work. SVG isn’t supported until IE9.</p>
<p>Fonts should be limited to those that a default Windows 7+ installation provides, which may vary based on locale (it is possible to specify a specific font to use for a certain locale).</p>
<p>The size of the window is difficult to change, and doing so would affect all brandings and require redesigning the background art, so changing that should be avoided.</p>
<p>Care should be taken to make sure that accessibility is maintained, and best practices for web accessibility should be followed. For example, the installing page contains a progress bar. Normally, and in keeping with best practices, this would be implemented using a <code class="docutils literal notranslate"><span class="pre">&lt;progress&gt;</span></code> element, but IE8 doesn’t support those, so it has to be built manually out of divs instead. Because this is an inherently inaccessible design, appropriate ARIA attributes are used so that the control is presented to accessibility tools as a real progress bar.</p>
</div>
<div class="section" id="technical-details">
<h2>Technical Details<a class="headerlink" href="#technical-details" title="Permalink to this headline">¶</a></h2>
<div class="section" id="custom-functions">
<h3>Custom Functions<a class="headerlink" href="#custom-functions" title="Permalink to this headline">¶</a></h3>
<p>Custom functions provide a foreign function interface that allows JavaScript running in the web page to invoke NSIS functions. Since the installer logic is all handled in NSIS, this is necessary for the UI to be able to determine the state of the installation, relay any settings to the installer, etc. Custom functions always take a single argument on the NSIS stack, and return a single value on the NSIS stack (this design is mostly for convenience, to avoid needing the C++ glue layer to handle different numbers of intended arguments or return values).</p>
<p>The implementation of custom functions is basically glue between the NSIS ExecuteCodeSegment mechanism (which allows executing NSIS functions from native plugin code) and the web browser control’s support for IDispatch (which allows invoking native code from JavaScript). Connecting those two things together allows us to run NSIS code from within JavaScript.</p>
<p>To make an NSIS function available to JavaScript, the NSIS script must call the plugin’s <code class="docutils literal notranslate"><span class="pre">RegisterCustomFunction</span></code> export, passing it the address (as obtained from the <code class="docutils literal notranslate"><span class="pre">GetFunctionAddress</span></code> instruction) and the name that the function should be exposed to JavaScript under. This call has to happen after the call to <code class="docutils literal notranslate"><span class="pre">Init</span></code> and before <code class="docutils literal notranslate"><span class="pre">ShowPage</span></code>. The plugin wraps that address in a native C++ function, and passes it to the WebBrowser control to register with its IDispatch implementation. That code allocates a <code class="docutils literal notranslate"><span class="pre">DISPID</span></code> for the new function and associates it with the given name. Later, when JavaScript invokes a function by that name, our <code class="docutils literal notranslate"><span class="pre">IDispatch::Invoke</span></code> calls the wrapper function with the argument that was passed in by JavaScript (if any), and makes sure the return value gets relayed back to JavaScript as well.</p>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">3</a></span></dt>
<dd><p>There is currently a new control called <a class="reference external" href="https://docs.microsoft.com/en-us/microsoft-edge/hosting/webview2">WebView2</a> in development which uses the Chrome-based Edge engine, but it’s unfinished as of this writing and would only work on machines with Chrome-based Edge installed anyway.</p>
</dd>
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id2">4</a></span></dt>
<dd><p>Previously, the stub installer’s UI was based on nsDialogs, and used its timer implementation, so when nsDialogs was removed an alternative was needed. The replacement timers don’t strictly need to be provided by the WebBrowser plugin, but it was the convenient place to put those functions.</p>
</dd>
</dl>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="WebBrowserAPI.html">WebBrowser Plugin API</a></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="WebBrowserAPI.html" class="btn btn-neutral float-right" title="WebBrowser Plugin API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="StubArch.html" class="btn btn-neutral float-left" title="Stub Installer Architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>