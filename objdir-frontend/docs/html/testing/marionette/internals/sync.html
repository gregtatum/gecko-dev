

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sync module &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="geckodriver" href="../../geckodriver/index.html" />
    <link rel="prev" title="server module" href="server.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Marionette</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Intro.html">Introduction to Marionette</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Building.html">Building</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PythonTests.html">Mn Python tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Protocol.html">Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../NewContributors.html">New contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Patches.html">Submitting patches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Taskcluster.html">Testing with one-click loaners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CodeStyle.html">Style guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SeleniumAtoms.html">Selenium atoms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Prefs.html">Preferences</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Internals</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="action.html">action module</a></li>
<li class="toctree-l3"><a class="reference internal" href="addon.html">addon module</a></li>
<li class="toctree-l3"><a class="reference internal" href="assert.html">assert module</a></li>
<li class="toctree-l3"><a class="reference internal" href="browser.html">browser module</a></li>
<li class="toctree-l3"><a class="reference internal" href="capabilities.html">capabilities module</a></li>
<li class="toctree-l3"><a class="reference internal" href="capture.html">capture module</a></li>
<li class="toctree-l3"><a class="reference internal" href="cert.html">cert module</a></li>
<li class="toctree-l3"><a class="reference internal" href="cookie.html">cookie module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dom.html">dom module</a></li>
<li class="toctree-l3"><a class="reference internal" href="driver.html">driver module</a></li>
<li class="toctree-l3"><a class="reference internal" href="element.html">element module</a></li>
<li class="toctree-l3"><a class="reference internal" href="error.html">error module</a></li>
<li class="toctree-l3"><a class="reference internal" href="evaluate.html">evaluate module</a></li>
<li class="toctree-l3"><a class="reference internal" href="event.html">event module</a></li>
<li class="toctree-l3"><a class="reference internal" href="format.html">format module</a></li>
<li class="toctree-l3"><a class="reference internal" href="interaction.html">interaction module</a></li>
<li class="toctree-l3"><a class="reference internal" href="listener.html">listener module</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">log module</a></li>
<li class="toctree-l3"><a class="reference internal" href="message.html">message module</a></li>
<li class="toctree-l3"><a class="reference internal" href="modal.html">modal module</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigate.html">navigate module</a></li>
<li class="toctree-l3"><a class="reference internal" href="packets.html">packets module</a></li>
<li class="toctree-l3"><a class="reference internal" href="prefs.html">prefs module</a></li>
<li class="toctree-l3"><a class="reference internal" href="proxy.html">proxy module</a></li>
<li class="toctree-l3"><a class="reference internal" href="reftest.html">reftest module</a></li>
<li class="toctree-l3"><a class="reference internal" href="server.html">server module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">sync module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#bugs">Bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#communication">Communication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Marionette</a> &raquo;</li>
        
          <li><a href="index.html">Internals</a> &raquo;</li>
        
      <li>sync module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/testing/marionette/internals/sync.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sync-module">
<h1>sync module<a class="headerlink" href="#sync-module" title="Permalink to this headline">¶</a></h1>
<p>Provides an assortment of synchronisation primitives.</p>
<dl class="js function">
<dt id="executeSoon">
<code class="sig-name descname">executeSoon</code><span class="sig-paren">(</span><em class="sig-param">func</em><span class="sig-paren">)</span><a class="headerlink" href="#executeSoon" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispatch a function to be executed on the main thread.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>function</em>) – Function to be executed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js class">
<dt id="MessageManagerDestroyedPromise">
<em class="property">class </em><code class="sig-name descname">MessageManagerDestroyedPromise</code><span class="sig-paren">(</span><em class="sig-param">messageManager</em><span class="sig-paren">)</span><a class="headerlink" href="#MessageManagerDestroyedPromise" title="Permalink to this definition">¶</a></dt>
<dd><p>Detects when the specified message manager has been destroyed.</p>
<p>One can observe the removal and detachment of a content browser
(<cite>&lt;xul:browser&gt;</cite>) or a chrome window by its message manager
disconnecting.</p>
<p>When a browser is associated with a tab, this is safer than only
relying on the event <cite>TabClose</cite> which signalises the _intent <a href="#id1"><span class="problematic" id="id2">to_</span></a>
remove a tab and consequently would lead to the destruction of
the content browser and its browser message manager.</p>
<p>When closing a chrome window it is safer than only relying on
the event ‘unload’ which signalises the _intent <a href="#id3"><span class="problematic" id="id4">to_</span></a> close the
chrome window and consequently would lead to the destruction of
the window and its window message manager.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>messageManager</strong> (<em>MessageListenerManager</em>) – The message manager to observe for its disconnect state. Use the browser message manager when closing a content browser, and the window message manager when closing a chrome window.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>Promise</strong> – A promise that resolves when the message manager has been destroyed.</p>
</dd>
</dl>
</dd></dl>

<dl class="js class">
<dt id="PollPromise">
<em class="property">class </em><code class="sig-name descname">PollPromise</code><span class="sig-paren">(</span><em class="sig-param">func</em>, <em class="sig-param">timeout</em>, <em class="sig-param">interval=10</em><span class="sig-paren">)</span><a class="headerlink" href="#PollPromise" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs a Promise-like function off the main thread until it is resolved
through <code class="docutils literal notranslate"><span class="pre">resolve</span></code> or <code class="docutils literal notranslate"><span class="pre">rejected</span></code> callbacks.  The function is
guaranteed to be run at least once, irregardless of the timeout.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">func</span></code> is evaluated every <code class="docutils literal notranslate"><span class="pre">interval</span></code> for as long as its
runtime duration does not exceed <code class="docutils literal notranslate"><span class="pre">interval</span></code>.  Evaluations occur
sequentially, meaning that evaluations of <code class="docutils literal notranslate"><span class="pre">func</span></code> are queued if
the runtime evaluation duration of <code class="docutils literal notranslate"><span class="pre">func</span></code> is greater than <code class="docutils literal notranslate"><span class="pre">interval</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">func</span></code> is given two arguments, <code class="docutils literal notranslate"><span class="pre">resolve</span></code> and <code class="docutils literal notranslate"><span class="pre">reject</span></code>,
of which one must be called for the evaluation to complete.
Calling <code class="docutils literal notranslate"><span class="pre">resolve</span></code> with an argument indicates that the expected
wait condition was met and will return the passed value to the
caller.  Conversely, calling <code class="docutils literal notranslate"><span class="pre">reject</span></code> will evaluate <code class="docutils literal notranslate"><span class="pre">func</span></code>
again until the <code class="docutils literal notranslate"><span class="pre">timeout</span></code> duration has elapsed or <code class="docutils literal notranslate"><span class="pre">func</span></code> throws.
The passed value to <code class="docutils literal notranslate"><span class="pre">reject</span></code> will also be returned to the caller
once the wait has expired.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">els</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PollPromise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span> <span class="n">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">res</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">querySelectorAll</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">resolve</span><span class="p">(</span><span class="n">Array</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">reject</span><span class="p">([]);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="p">{</span><span class="n">timeout</span><span class="p">:</span> <span class="mi">1000</span><span class="p">});</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>Condition</em>) – Function to run off the main thread.</p></li>
<li><p><strong>timeout</strong> (<em>number</em>) – timeout Desired timeout if wanted.  If 0 or less than the runtime evaluation time of <code class="docutils literal notranslate"><span class="pre">func</span></code>, <code class="docutils literal notranslate"><span class="pre">func</span></code> is guaranteed to run at least once. Defaults to using no timeout.</p></li>
<li><p><strong>interval</strong> (<em>number</em>) – interval Duration between each poll of <code class="docutils literal notranslate"><span class="pre">func</span></code> in milliseconds. Defaults to 10 milliseconds.</p></li>
</ul>
</dd>
<dt class="field-even">Throws</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>*</strong> – If <code class="docutils literal notranslate"><span class="pre">func</span></code> throws, its error is propagated.</p></li>
<li><p><strong>TypeError</strong> – If <cite>timeout</cite> or <cite>interval`</cite> are not numbers.</p></li>
<li><p><strong>RangeError</strong> – If <cite>timeout</cite> or <cite>interval</cite> are not unsigned integers.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>[ 'Promise' ].&lt;*&gt;</strong> – Yields the value passed to <code class="docutils literal notranslate"><span class="pre">func</span></code>’s <code class="docutils literal notranslate"><span class="pre">resolve</span></code> or <code class="docutils literal notranslate"><span class="pre">reject</span></code> callbacks.</p>
</dd>
</dl>
</dd></dl>

<dl class="js class">
<dt id="Sleep">
<em class="property">class </em><code class="sig-name descname">Sleep</code><span class="sig-paren">(</span><em class="sig-param">timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#Sleep" title="Permalink to this definition">¶</a></dt>
<dd><p>Pauses for the given duration.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timeout</strong> (<em>number</em>) – Duration to wait before fulfilling promise in milliseconds.</p></li>
</ul>
</dd>
<dt class="field-even">Throws</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If <cite>timeout</cite> is not a number.</p></li>
<li><p><strong>RangeError</strong> – If <cite>timeout</cite> is not an unsigned integer.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>Promise</strong> – Promise that fulfills when the <cite>timeout</cite> is elapsed.</p>
</dd>
</dl>
</dd></dl>

<dl class="js class">
<dt id="TimedPromise">
<em class="property">class </em><code class="sig-name descname">TimedPromise</code><span class="sig-paren">(</span><em class="sig-param">func</em>, <em class="sig-param">timeout</em>, <em class="sig-param">throws=TimeoutError</em><span class="sig-paren">)</span><a class="headerlink" href="#TimedPromise" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents the timed, eventual completion (or failure) of an
asynchronous operation, and its resulting value.</p>
<p>In contrast to a regular Promise, it times out after <code class="docutils literal notranslate"><span class="pre">timeout</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>Condition</em>) – Function to run, which will have its <code class="docutils literal notranslate"><span class="pre">reject</span></code> callback invoked after the <code class="docutils literal notranslate"><span class="pre">timeout</span></code> duration is reached. It is given two callbacks: <code class="docutils literal notranslate"><span class="pre">resolve(value)</span></code> and <code class="docutils literal notranslate"><span class="pre">reject(error)</span></code>.</p></li>
<li><p><strong>timeout</strong> (<em>timeout</em>) – <code class="docutils literal notranslate"><span class="pre">condition</span></code>’s <code class="docutils literal notranslate"><span class="pre">reject</span></code> callback will be called after this timeout, given in milliseconds. By default 1500 ms in an optimised build and 4500 ms in debug builds.</p></li>
<li><p><strong>throws</strong> (<em>Error</em>) – throws When the <code class="docutils literal notranslate"><span class="pre">timeout</span></code> is hit, this error class will be thrown.  If it is null, no error is thrown and the promise is instead resolved on timeout.</p></li>
</ul>
</dd>
<dt class="field-even">Throws</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If <cite>timeout</cite> is not a number.</p></li>
<li><p><strong>RangeError</strong> – If <cite>timeout</cite> is not an unsigned integer.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>[ 'Promise' ].&lt;*&gt;</strong> – Timed promise.</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt id="waitForEvent">
<code class="sig-name descname">waitForEvent</code><span class="sig-paren">(</span><em class="sig-param">subject</em>, <em class="sig-param">eventName</em>, <em class="sig-param">options</em><span class="sig-paren">)</span><a class="headerlink" href="#waitForEvent" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for an event to be fired on a specified element.</p>
<p>This method has been duplicated from BrowserTestUtils.jsm.</p>
<p>Because this function is intended for testing, any error in checkFn
will cause the returned promise to be rejected instead of waiting for
the next event, since this is probably a bug in the test.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">promiseEvent</span> <span class="o">=</span> <span class="n">waitForEvent</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;eventName&quot;</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Do</span> <span class="n">some</span> <span class="n">processing</span> <span class="n">here</span> <span class="n">that</span> <span class="n">will</span> <span class="n">cause</span> <span class="n">the</span> <span class="n">event</span> <span class="n">to</span> <span class="n">be</span> <span class="n">fired</span>
<span class="o">//</span> <span class="o">...</span>
<span class="o">//</span> <span class="n">Now</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">Promise</span> <span class="ow">is</span> <span class="n">fulfilled</span>
<span class="n">let</span> <span class="n">receivedEvent</span> <span class="o">=</span> <span class="k">await</span> <span class="n">promiseEvent</span><span class="p">;</span>
</pre></div>
</div>
<p>The promise resolution/rejection handler for the returned promise is
guaranteed not to be called until the next event tick after the event
listener gets called, so that all other event listeners for the element
are executed before the handler is executed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">promiseEvent</span> <span class="o">=</span> <span class="n">waitForEvent</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;eventName&quot;</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Same</span> <span class="n">event</span> <span class="n">tick</span> <span class="n">here</span><span class="o">.</span>
<span class="k">await</span> <span class="n">promiseEvent</span><span class="p">;</span>
<span class="o">//</span> <span class="n">Next</span> <span class="n">event</span> <span class="n">tick</span> <span class="n">here</span><span class="o">.</span>
</pre></div>
</div>
<p>If some code, such like adding yet another event listener, needs to be
executed in the same event tick, use raw addEventListener instead and
place the code inside the event listener:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">Add</span> <span class="n">yet</span> <span class="n">another</span> <span class="n">event</span> <span class="n">listener</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">event</span> <span class="n">tick</span> <span class="k">as</span> <span class="n">the</span> <span class="n">load</span>
  <span class="o">//</span> <span class="n">event</span> <span class="n">listener</span><span class="o">.</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">waitForEvent</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s2">&quot;ready&quot;</span><span class="p">);</span>
<span class="p">},</span> <span class="p">{</span> <span class="n">once</span><span class="p">:</span> <span class="n">true</span> <span class="p">});</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subject</strong> (<em>Element</em>) – The element that should receive the event.</p></li>
<li><p><strong>eventName</strong> (<em>string</em>) – Name of the event to listen to.</p></li>
<li><p><strong>options</strong> (<em>Object</em>) – Extra options.</p></li>
<li><p><strong>options.capture</strong> (<em>boolean</em>) – True to use a capturing listener.</p></li>
<li><p><strong>options.checkFn</strong> (<em>function</em>) – Called with the <code class="docutils literal notranslate"><span class="pre">Event</span></code> object as argument, should return <code class="docutils literal notranslate"><span class="pre">true</span></code> if the event is the expected one, or <code class="docutils literal notranslate"><span class="pre">false</span></code> if it should be ignored and listening should continue. If not specified, the first event with the specified name resolves the returned promise.</p></li>
<li><p><strong>options.wantsUntrusted</strong> (<em>boolean</em>) – True to receive synthetic events dispatched by web content.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>[ 'Promise' ].&lt;Event&gt;</strong> – Promise which resolves to the received <code class="docutils literal notranslate"><span class="pre">Event</span></code> object, or rejects in case of a failure.</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt id="waitForMessage">
<code class="sig-name descname">waitForMessage</code><span class="sig-paren">(</span><em class="sig-param">messageManager</em>, <em class="sig-param">messageName</em>, <em class="sig-param">options</em><span class="sig-paren">)</span><a class="headerlink" href="#waitForMessage" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for a message to be fired from a particular message manager.</p>
<p>This method has been duplicated from BrowserTestUtils.jsm.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>messageManager</strong> (<em>nsIMessageManager</em>) – The message manager that should be used.</p></li>
<li><p><strong>messageName</strong> (<em>string</em>) – The message to wait for.</p></li>
<li><p><strong>options</strong> (<em>Object</em>) – Extra options.</p></li>
<li><p><strong>options.checkFn</strong> (<em>function</em>) – Called with the <code class="docutils literal notranslate"><span class="pre">Message</span></code> object as argument, should return <code class="docutils literal notranslate"><span class="pre">true</span></code> if the message is the expected one, or <code class="docutils literal notranslate"><span class="pre">false</span></code> if it should be ignored and listening should continue. If not specified, the first message with the specified name resolves the returned promise.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>[ 'Promise' ].&lt;Object&gt;</strong> – Promise which resolves to the data property of the received <code class="docutils literal notranslate"><span class="pre">Message</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt id="waitForObserverTopic">
<code class="sig-name descname">waitForObserverTopic</code><span class="sig-paren">(</span><em class="sig-param">topic</em>, <em class="sig-param">options</em><span class="sig-paren">)</span><a class="headerlink" href="#waitForObserverTopic" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for the specified observer topic to be observed.</p>
<p>This method has been duplicated from TestUtils.jsm.</p>
<p>Because this function is intended for testing, any error in checkFn
will cause the returned promise to be rejected instead of waiting for
the next notification, since this is probably a bug in the test.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topic</strong> (<em>string</em>) – The topic to observe.</p></li>
<li><p><strong>options</strong> (<em>Object</em>) – Extra options.</p></li>
<li><p><strong>options.checkFn</strong> (<em>function</em>) – Called with <code class="docutils literal notranslate"><span class="pre">subject</span></code>, and <code class="docutils literal notranslate"><span class="pre">data</span></code> as arguments, should return true if the notification is the expected one, or false if it should be ignored and listening should continue. If not specified, the first notification for the specified topic resolves the returned promise.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>[ 'Promise' ].&lt;Array.&lt;String, Object&gt;&gt;</strong> – Promise which resolves to an array of <code class="docutils literal notranslate"><span class="pre">subject</span></code>, and <code class="docutils literal notranslate"><span class="pre">data</span></code> from the observed notification.</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../geckodriver/index.html" class="btn btn-neutral float-right" title="geckodriver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="server.html" class="btn btn-neutral float-left" title="server module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>