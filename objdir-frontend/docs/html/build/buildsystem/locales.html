

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Localized Builds &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Including Rust Code in Firefox" href="rust.html" />
    <link rel="prev" title="Creating Toolchain Archives" href="toolchains.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Build System</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#important-concepts">Important Concepts</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="glossary.html">Build Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-overview.html">Build System Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="supported-configurations.html">Supported build targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozconfigs.html">Mozconfig Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozbuild-files.html">moz.build Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozbuild-symbols.html">mozbuild Sandbox Symbols</a></li>
<li class="toctree-l3"><a class="reference internal" href="files-metadata.html">Files Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="pgo.html">Profile Guided Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="slow.html">Why the Build System is Slow</a></li>
<li class="toctree-l3"><a class="reference internal" href="environment-variables.html">Environment Variables Impacting the Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-targets.html">Build Targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html">Python and the Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="test_manifests.html">Test Manifests</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozinfo.html">mozinfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="preprocessor.html">Text Preprocessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="jar-manifests.html">JAR Manifests</a></li>
<li class="toctree-l3"><a class="reference internal" href="defining-binaries.html">Defining Binaries for the Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="defining-xpcom-components.html">Defining XPCOM C++-implemented Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="toolchains.html">Creating Toolchain Archives</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Localized Builds</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#localization-repacks">Localization repacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exposing-strings">Exposing strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#l10n-merge">l10n-merge</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rust.html">Including Rust Code in Firefox</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse.html">Sparse Checkouts</a></li>
<li class="toctree-l3"><a class="reference internal" href="gn.html">Support for projects building with GN</a></li>
<li class="toctree-l3"><a class="reference internal" href="telemetry.html">Build Telemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="sccache-dist.html">Distributed sccache (sccache-dist)</a></li>
<li class="toctree-l3"><a class="reference internal" href="test_certificates.html">Adding Certificates for Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#integrated-development-environment-ide">integrated development environment (IDE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#mozbuild">mozbuild</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Build System</a> &raquo;</li>
        
      <li>Localized Builds</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/build/buildsystem/locales.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="localized-builds">
<span id="localization"></span><h1>Localized Builds<a class="headerlink" href="#localized-builds" title="Permalink to this headline">¶</a></h1>
<div class="section" id="localization-repacks">
<h2>Localization repacks<a class="headerlink" href="#localization-repacks" title="Permalink to this headline">¶</a></h2>
<p>To save on build time, the build system and automation collaborate to allow
downloading a packaged en-US Firefox, performing some locale-specific
post-processing, and re-packaging a locale-specific Firefox. Such artifacts
are termed “single-locale language repacks”. There is another concept of a
“multi-locale language build”, which is more like a regular build and less
like a re-packaging post-processing step.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These builds rely on make targets that don’t work for
<a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1387485">artifact builds</a>.</p>
</div>
<div class="section" id="instructions-for-single-locale-repacks-for-developers">
<h3>Instructions for single-locale repacks for developers<a class="headerlink" href="#instructions-for-single-locale-repacks-for-developers" title="Permalink to this headline">¶</a></h3>
<p>This assumes that <code class="docutils literal notranslate"><span class="pre">$AB_CD</span></code> is the locale you want to repack with; you
find the available localizations on <a class="reference external" href="https://hg.mozilla.org/l10n-central/">l10n-central</a>.</p>
<ol class="arabic">
<li><p>You must have a built and packaged object directory, or a pre-built
<code class="docutils literal notranslate"><span class="pre">en-US</span></code> package.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./mach build
./mach package
</pre></div>
</div>
</li>
<li><p>Repackage using the locale-specific changes.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./mach build installers-<span class="nv">$AB_CD</span>
</pre></div>
</div>
</li>
</ol>
<p>You should find a re-packaged build at <code class="docutils literal notranslate"><span class="pre">OBJDIR/dist/</span></code>, and a
runnable binary in <code class="docutils literal notranslate"><span class="pre">OBJDIR/dist/l10n-stage/</span></code>.
The <code class="docutils literal notranslate"><span class="pre">installers</span></code> target runs quite a few things for you, including getting
the repository for the requested locale from
<a class="reference external" href="https://hg.mozilla.org/l10n-central/">https://hg.mozilla.org/l10n-central/</a>. It will clone them into
<code class="docutils literal notranslate"><span class="pre">~/.mozbuild/l10n-central</span></code>. If you have an existing repository there, you
may want to occasionally update that via <code class="docutils literal notranslate"><span class="pre">hg</span> <span class="pre">pull</span> <span class="pre">-u</span></code>. If you prefer
to have the l10n repositories at a different location on your disk, you
can point to the directory via</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ac_add_options --with-l10n-base<span class="o">=</span>/make/this/a/absolute/path
</pre></div>
</div>
</div></blockquote>
<p>This build also packages a language pack.</p>
</div>
<div class="section" id="instructions-for-language-packs">
<h3>Instructions for language packs<a class="headerlink" href="#instructions-for-language-packs" title="Permalink to this headline">¶</a></h3>
<p>Language packs are extensions that contain just the localized resources. Building
them doesn’t require an actual build, but they’re only compatible with the
<code class="docutils literal notranslate"><span class="pre">mozilla-central</span></code> source they’re built with.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./mach build langpack-<span class="nv">$AB_CD</span>
</pre></div>
</div>
<p>This target shares much of the logic of the <code class="docutils literal notranslate"><span class="pre">installers-$AB_CD</span></code> target above,
and does the check-out of the localization repository etc. It doesn’t require
a package or a build, though. The generated language pack is in
<code class="docutils literal notranslate"><span class="pre">OBJDIR/dist/$(MOZ_PKG_PLATFORM)/xpi/</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Despite the platform-dependent location in the build directory, language packs
are platform independent, and the content that goes into them needs to be
built in a platform-independent way.</p>
</div>
</div>
<div class="section" id="instructions-for-multi-locale-builds">
<h3>Instructions for multi-locale builds<a class="headerlink" href="#instructions-for-multi-locale-builds" title="Permalink to this headline">¶</a></h3>
<p>If you want to create a single build with multiple locales, you will do</p>
<ol class="arabic">
<li><p>Create a build and package</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./mach build
./mach package
</pre></div>
</div>
</li>
<li><p>For each locale you want to include in the build:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">MOZ_CHROME_MULTILOCALE</span><span class="o">=</span><span class="s2">&quot;de it zh-TW&quot;</span>
<span class="k">for</span> AB_CD in <span class="nv">$MOZ_CHROME_MULTILOCALE</span><span class="p">;</span> <span class="k">do</span>
   ./mach build chrome-<span class="nv">$AB_CD</span>
<span class="k">done</span>
</pre></div>
</div>
</li>
<li><p>Create the multilingual package:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">AB_CD</span><span class="o">=</span>multi ./mach package
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="general-flow-of-repacks">
<h3>General flow of repacks<a class="headerlink" href="#general-flow-of-repacks" title="Permalink to this headline">¶</a></h3>
<p>The general flow of the locale repacks is controlled by
<code class="docutils literal notranslate"><span class="pre">$MOZ_BUILD_APP/locales/Makefile.in</span></code> and <code class="docutils literal notranslate"><span class="pre">toolkit/locales/l10n.mk</span></code>, plus
the packaging build system. The three main entry points above all trigger
related build flows:</p>
<ol class="arabic simple">
<li><p>Get the localization repository, if needed</p></li>
<li><p>Run l10n-merge with a prior clobber of the merge dir</p></li>
<li><p>Copy l10n files to <code class="docutils literal notranslate"><span class="pre">dist</span></code>, with minor differences here between <code class="docutils literal notranslate"><span class="pre">l10n-%</span></code> and <code class="docutils literal notranslate"><span class="pre">chrome-%</span></code></p></li>
<li><p>Repackage and package</p></li>
</ol>
<p>Details on l10n-merge are described in its own section below.
The copying of files is mainly controlled by <code class="docutils literal notranslate"><span class="pre">jar.mn</span></code>, in the few source
directories that include localizable files. <code class="docutils literal notranslate"><span class="pre">l10n-%</span></code> is used for repacks,
<code class="docutils literal notranslate"><span class="pre">chrome-%</span></code> for multi-locale packages. The repackaging is dedicated
Python code in <code class="docutils literal notranslate"><span class="pre">toolkit/mozapps/installer/l10n-repack.py</span></code>, using an existing
package. It strips existing <code class="docutils literal notranslate"><span class="pre">chrome</span></code> l10n resources, and adds localizations
and metadata.</p>
<p>Language packs don’t require repackaging. The windows installers are generated
by merely packaging an existing repackaged zip into to an installer.</p>
</div>
</div>
<div class="section" id="exposing-strings">
<h2>Exposing strings<a class="headerlink" href="#exposing-strings" title="Permalink to this headline">¶</a></h2>
<p>The localization flow handles a few file formats in well-known locations in the
source tree.</p>
<p>Alongside being built by including the directory in <code class="docutils literal notranslate"><span class="pre">$MOZ_BUILD_APP/locales/Makefile.in</span></code>
and respective entries in a <code class="docutils literal notranslate"><span class="pre">jar.mn</span></code>, we also have configuration files tailored
to localization tools and infrastructure. They’re also controlling which
files l10n-merge handles, and how.</p>
<p>These configurations are TOML files. They’re part of the bigger
localization ecosystem at Mozilla, and <a class="reference external" href="http://moz-l10n-config.readthedocs.io/en/latest/fileformat.html">the documentation about the
file format</a>
explains how to set them up, and what the entries mean. In short, you find</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span>[[paths]]
    reference = browser/locales/en-US/**
    l10n = {l}browser/**
</pre></div>
</div>
<p>to add a directory for all localizations. Changes to these files are best
submitted for review by :Pike or :flod.</p>
<p>These configuration files are the future, and right now, we still have
support for the previous way to configuring l10n, which is described below.</p>
<p>The locations are commonly in directories like</p>
<blockquote>
<div><p><code class="file docutils literal notranslate"><span class="pre">browser/</span></code><code class="docutils literal notranslate"><span class="pre">locales/en-US/</span></code><code class="file docutils literal notranslate"><span class="pre">subdir/file.ext</span></code></p>
</div></blockquote>
<p>The first thing to note is that only files beneath <code class="file docutils literal notranslate"><span class="pre">locales/en-US</span></code> are
exposed to localizers. The second thing to note is that only a few directories
are exposed. Which directories are exposed is defined in files called
<code class="docutils literal notranslate"><span class="pre">l10n.ini</span></code>, which are at a
<a class="reference external" href="https://searchfox.org/mozilla-central/search?q=path%3Al10n.ini&amp;redirect=true">few places</a>
in the source code.</p>
<p>An example looks like this</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[general]</span>
<span class="na">depth</span> <span class="o">=</span> <span class="s">../..</span>

<span class="k">[compare]</span>
<span class="na">dirs</span> <span class="o">=</span> <span class="s">browser</span>
<span class="s">    browser/branding/official</span>

<span class="k">[includes]</span>
<span class="na">toolkit</span> <span class="o">=</span> <span class="s">toolkit/locales/l10n.ini</span>
</pre></div>
</div>
<p>This tells the l10n infrastructure three things:</p>
<ul class="simple">
<li><p>resolve the paths against the directory two levels up</p></li>
<li><p>include files in <code class="file docutils literal notranslate"><span class="pre">browser/locales/en-US</span></code> and
<code class="file docutils literal notranslate"><span class="pre">browser/branding/official/locales/en-US</span></code></p></li>
<li><p>load more data from <code class="file docutils literal notranslate"><span class="pre">toolkit/locales/l10n.ini</span></code></p></li>
</ul>
<p>For projects like Thunderbird and SeaMonkey in <code class="docutils literal notranslate"><span class="pre">comm-central</span></code>, additional
data needs to be provided when including an <code class="docutils literal notranslate"><span class="pre">l10n.ini</span></code> from a different
repository:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[include_toolkit]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">hg</span>
<span class="na">mozilla</span> <span class="o">=</span> <span class="s">mozilla-central</span>
<span class="na">repo</span> <span class="o">=</span> <span class="s">https://hg.mozilla.org/</span>
<span class="na">l10n.ini</span> <span class="o">=</span> <span class="s">toolkit/locales/l10n.ini</span>
</pre></div>
</div>
<p>This tells the l10n infrastructure where to find the repository, and where inside
that repository the <code class="docutils literal notranslate"><span class="pre">l10n.ini</span></code> file is. This is needed because for local
builds, <code class="file docutils literal notranslate"><span class="pre">mail/locales/l10n.ini</span></code> references
<code class="file docutils literal notranslate"><span class="pre">mozilla/toolkit/locales/l10n.ini</span></code>, which is where the comm-central
build setup expects toolkit to be.</p>
<p>Now that the directories exposed to l10n are known, we can talk about the
supported file formats.</p>
<div class="section" id="file-formats">
<h3>File formats<a class="headerlink" href="#file-formats" title="Permalink to this headline">¶</a></h3>
<p>The following file formats are known to the l10n tool chains:</p>
<dl class="simple">
<dt>Fluent</dt><dd><p>Used in Firefox UI, both declarative and programmatically.</p>
</dd>
<dt>DTD</dt><dd><p>Deprecated. Used in XUL and XHTML.</p>
</dd>
<dt>Properties</dt><dd><p>Used from JavaScript and C++. When used from js, also comes with
<a class="reference external" href="https://developer.mozilla.org/docs/Mozilla/Localization/Localization_and_Plurals">plural support</a>.</p>
</dd>
<dt>ini</dt><dd><p>Used by the crashreporter and updater, avoid if possible.</p>
</dd>
<dt>inc</dt><dd><p>Used during builds, for example to create metadata for
language packs or bookmarks.</p>
</dd>
</dl>
<p>Adding new formats involves changing various different tools, and is strongly
discouraged.</p>
</div>
<div class="section" id="exceptions">
<h3>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h3>
<p>Generally, anything that exists in <code class="docutils literal notranslate"><span class="pre">en-US</span></code> needs a one-to-one mapping in
all localizations. There are a few cases where that’s not wanted, notably
around locale configuration and locale-dependent metadata.</p>
<p>For optional strings and files, l10n-merge won’t add <code class="docutils literal notranslate"><span class="pre">en-US</span></code> content if
the localization doesn’t have that content.</p>
<p>For the TOML files, the
<a class="reference external" href="https://moz-l10n-config.readthedocs.io/en/latest/fileformat.html#filters">[[filters]] documentation</a>
is a good reference. In short, filters match the localized source code, optionally
a <code class="docutils literal notranslate"><span class="pre">key</span></code>, and an action. An example like</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[filters]]</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;{l}browser/defines.inc&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s">&quot;MOZ_LANGPACK_CONTRIBUTORS&quot;</span>
    <span class="n">action</span> <span class="o">=</span> <span class="s">&quot;ignore&quot;</span>
</pre></div>
</div>
<p>indicates that the <code class="docutils literal notranslate"><span class="pre">MOZ_LANGPACK_CONTRIBUTORS</span></code> in <code class="docutils literal notranslate"><span class="pre">browser/defines.inc</span></code>
is optional.</p>
<p>For the legacy ini configuration files, there’s a Python module
<code class="docutils literal notranslate"><span class="pre">filter.py</span></code> next to the main <code class="docutils literal notranslate"><span class="pre">l10n.ini</span></code>, implementing <code class="xref py py-func docutils literal notranslate"><span class="pre">test()</span></code>, with the following
signature</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">entity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">does_not_matter</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;ignore&quot;</span>
    <span class="k">if</span> <span class="n">show_but_do_not_merge</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;report&quot;</span>
    <span class="c1"># default behavior, localizer or build need to do something</span>
    <span class="k">return</span> <span class="s2">&quot;error&quot;</span>
</pre></div>
</div>
<p>For any missing file, this function is called with <code class="docutils literal notranslate"><span class="pre">mod</span></code> being
the <em>module</em>, and <code class="docutils literal notranslate"><span class="pre">path</span></code> being the relative path inside
<code class="file docutils literal notranslate"><span class="pre">locales/en-US</span></code>. The module is the top-level dir as referenced in
<code class="file docutils literal notranslate"><span class="pre">l10n.ini</span></code>.</p>
<p>For missing strings, the <code class="xref py py-data docutils literal notranslate"><span class="pre">entity</span></code> parameter is the key of the string
in the en-US file.</p>
</div>
</div>
<div class="section" id="l10n-merge">
<h2>l10n-merge<a class="headerlink" href="#l10n-merge" title="Permalink to this headline">¶</a></h2>
<p>The chrome registry in Gecko doesn’t support fallback from a localization to <code class="docutils literal notranslate"><span class="pre">en-US</span></code> at runtime.
Thus, the build needs to ensure that the localization as it’s built into
the package has all required strings, and that the strings don’t contain
errors. To ensure that, we’re <em>merging</em> the localization and <code class="docutils literal notranslate"><span class="pre">en-US</span></code>
at build time, nick-named l10n-merge.</p>
<p>For Fluent, we’re also removing erroneous messages. For many errors in Fluent,
that’s cosmetic, but when a localization has different values or attributes
on a message, that’s actually important so that the DOM bindings of Fluent
can apply the translation without having to load the <code class="docutils literal notranslate"><span class="pre">en-US</span></code> source to
compare against.</p>
<p>The process can be manually triggered via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt; ./mach build merge-<span class="nv">$AB_CD</span>
</pre></div>
</div>
<p>It creates another directory in the object dir, <code class="file docutils literal notranslate"><span class="pre">browser/locales/merge-dir/$AB_CD</span></code>, in
which the sanitized files are stored. The actual repackaging process only looks
in the merged directory, so the preparation steps of l10n-merge need to ensure
that all files are generated or copied.</p>
<p>l10n-merge modifies a file if it supports the particular file type, and there
are missing strings which are not filtered out, or if an existing string
shows an error. See the Checks section below for details. If the files are
not modified, l10n-merge copies them over to the respective location in the
merge dir.</p>
<div class="section" id="checks">
<h3>Checks<a class="headerlink" href="#checks" title="Permalink to this headline">¶</a></h3>
<p>As part of the build and other localization tool chains, we run a variety
of source-based checks. Think of them as linters.</p>
<p>The suite of checks is usually determined by file type, i.e., there’s a
suite of checks for DTD files and one for properties files, etc.</p>
</div>
<div class="section" id="localizations">
<h3>Localizations<a class="headerlink" href="#localizations" title="Permalink to this headline">¶</a></h3>
<p>Now that we talked in-depth about how to expose content to localizers,
where are the localizations?</p>
<p>We host a mercurial repository per locale. All of our
localizations can be found on <a class="reference external" href="https://hg.mozilla.org/l10n-central/">https://hg.mozilla.org/l10n-central/</a>.</p>
<p>You can search inside our localized files on
<a class="reference external" href="https://transvision.mozfr.org/">Transvision</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rust.html" class="btn btn-neutral float-right" title="Including Rust Code in Firefox" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="toolchains.html" class="btn btn-neutral float-left" title="Creating Toolchain Archives" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>