

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Files Metadata &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Profile Guided Optimization" href="pgo.html" />
    <link rel="prev" title="mozbuild Sandbox Symbols" href="mozbuild-symbols.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Build System</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#important-concepts">Important Concepts</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="glossary.html">Build Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-overview.html">Build System Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="supported-configurations.html">Supported build targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozconfigs.html">Mozconfig Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozbuild-files.html">moz.build Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozbuild-symbols.html">mozbuild Sandbox Symbols</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Files Metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#defining-metadata">Defining Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-metadata-is-read">How Metadata is Read</a></li>
<li class="toctree-l4"><a class="reference internal" href="#finalizing-values">Finalizing Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#guidelines-for-defining-metadata">Guidelines for Defining Metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pgo.html">Profile Guided Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="slow.html">Why the Build System is Slow</a></li>
<li class="toctree-l3"><a class="reference internal" href="environment-variables.html">Environment Variables Impacting the Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-targets.html">Build Targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html">Python and the Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="test_manifests.html">Test Manifests</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozinfo.html">mozinfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="preprocessor.html">Text Preprocessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="jar-manifests.html">JAR Manifests</a></li>
<li class="toctree-l3"><a class="reference internal" href="defining-binaries.html">Defining Binaries for the Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="defining-xpcom-components.html">Defining XPCOM C++-implemented Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="toolchains.html">Creating Toolchain Archives</a></li>
<li class="toctree-l3"><a class="reference internal" href="locales.html">Localized Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="rust.html">Including Rust Code in Firefox</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse.html">Sparse Checkouts</a></li>
<li class="toctree-l3"><a class="reference internal" href="gn.html">Support for projects building with GN</a></li>
<li class="toctree-l3"><a class="reference internal" href="telemetry.html">Build Telemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="sccache-dist.html">Distributed sccache (sccache-dist)</a></li>
<li class="toctree-l3"><a class="reference internal" href="test_certificates.html">Adding Certificates for Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#integrated-development-environment-ide">integrated development environment (IDE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#mozbuild">mozbuild</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Build System</a> &raquo;</li>
        
      <li>Files Metadata</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/build/buildsystem/files-metadata.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="files-metadata">
<span id="mozbuild-files-metadata"></span><h1>Files Metadata<a class="headerlink" href="#files-metadata" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="mozbuild-files.html#mozbuild-files"><span class="std std-ref">moz.build Files</span></a> provide a mechanism for attaching metadata to
files. Essentially, you define some flags to set on a file or file
pattern. Later, some tool or process queries for metadata attached to a
file of interest and it does something intelligent with that data.</p>
<div class="section" id="defining-metadata">
<h2>Defining Metadata<a class="headerlink" href="#defining-metadata" title="Permalink to this headline">¶</a></h2>
<p>Files metadata is defined by using the
<a class="reference internal" href="mozbuild-symbols.html#mozbuild-subcontext-files"><span class="std std-ref">Files Sub-Context</span></a> in <code class="docutils literal notranslate"><span class="pre">moz.build</span></code>
files. e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Files</span><span class="p">(</span><span class="s1">&#39;**/Makefile.in&#39;</span><span class="p">):</span>
    <span class="n">BUG_COMPONENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Firefox Build System&#39;</span><span class="p">,</span> <span class="s1">&#39;General&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This working example says, <em>for all Makefile.in files in every directory
underneath this one - including this directory - set the Bugzilla
component to Firefox Build System :: General</em>.</p>
<p>For more info, read the
<a class="reference internal" href="mozbuild-symbols.html#mozbuild-subcontext-files"><span class="std std-ref">docs on Files</span></a>.</p>
</div>
<div class="section" id="how-metadata-is-read">
<h2>How Metadata is Read<a class="headerlink" href="#how-metadata-is-read" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Files</span></code> metadata is extracted in <a class="reference internal" href="mozbuild-files.html#mozbuild-fs-reading-mode"><span class="std std-ref">Filesystem Reading Mode</span></a>.</p>
<p>Reading starts by specifying a set of files whose metadata you are
interested in. For each file, the filesystem is walked to the root
of the source directory. Any <code class="docutils literal notranslate"><span class="pre">moz.build</span></code> encountered during this
walking are marked as relevant to the file.</p>
<p>Let’s say you have the following filesystem content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">moz</span><span class="o">.</span><span class="n">build</span>
<span class="o">/</span><span class="n">root_file</span>
<span class="o">/</span><span class="n">dir1</span><span class="o">/</span><span class="n">moz</span><span class="o">.</span><span class="n">build</span>
<span class="o">/</span><span class="n">dir1</span><span class="o">/</span><span class="n">foo</span>
<span class="o">/</span><span class="n">dir1</span><span class="o">/</span><span class="n">subdir1</span><span class="o">/</span><span class="n">foo</span>
<span class="o">/</span><span class="n">dir2</span><span class="o">/</span><span class="n">foo</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">/root_file</span></code>, the relevant <code class="docutils literal notranslate"><span class="pre">moz.build</span></code> files are just
<code class="docutils literal notranslate"><span class="pre">/moz.build</span></code>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">/dir1/foo</span></code> and <code class="docutils literal notranslate"><span class="pre">/dir1/subdir1/foo</span></code>, the relevant files are
<code class="docutils literal notranslate"><span class="pre">/moz.build</span></code> and <code class="docutils literal notranslate"><span class="pre">/dir1/moz.build</span></code>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">/dir2</span></code>, the relevant file is just <code class="docutils literal notranslate"><span class="pre">/moz.build</span></code>.</p>
<p>Once the list of relevant <code class="docutils literal notranslate"><span class="pre">moz.build</span></code> files is obtained, each
<code class="docutils literal notranslate"><span class="pre">moz.build</span></code> file is evaluated. Root <code class="docutils literal notranslate"><span class="pre">moz.build</span></code> file first,
leaf-most files last. This follows the rules of
<a class="reference internal" href="mozbuild-files.html#mozbuild-fs-reading-mode"><span class="std std-ref">Filesystem Reading Mode</span></a>, with the set of evaluated <code class="docutils literal notranslate"><span class="pre">moz.build</span></code>
files being controlled by filesystem content, not <code class="docutils literal notranslate"><span class="pre">DIRS</span></code> variables.</p>
<p>The file whose metadata is being resolved maps to a set of <code class="docutils literal notranslate"><span class="pre">moz.build</span></code>
files which in turn evaluates to a list of contexts. For file metadata,
we only care about one of these contexts:
<a class="reference internal" href="mozbuild-symbols.html#mozbuild-subcontext-files"><span class="std std-ref">Files</span></a>.</p>
<p>We start with an empty <code class="docutils literal notranslate"><span class="pre">Files</span></code> instance to represent the file. As
we encounter a <em>files sub-context</em>, we see if it is appropriate to
this file. If it is, we apply its values. This process is repeated
until all <em>files sub-contexts</em> have been applied or skipped. The final
state of the <code class="docutils literal notranslate"><span class="pre">Files</span></code> instance is used to represent the metadata for
this particular file.</p>
<p>It may help to visualize this. Say we have 2 <code class="docutils literal notranslate"><span class="pre">moz.build</span></code> files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># /moz.build</span>
<span class="k">with</span> <span class="n">Files</span><span class="p">(</span><span class="s1">&#39;*.cpp&#39;</span><span class="p">):</span>
    <span class="n">BUG_COMPONENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Core&#39;</span><span class="p">,</span> <span class="s1">&#39;XPCOM&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Files</span><span class="p">(</span><span class="s1">&#39;**/*.js&#39;</span><span class="p">):</span>
    <span class="n">BUG_COMPONENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Firefox&#39;</span><span class="p">,</span> <span class="s1">&#39;General&#39;</span><span class="p">)</span>

<span class="c1"># /foo/moz.build</span>
<span class="k">with</span> <span class="n">Files</span><span class="p">(</span><span class="s1">&#39;*.js&#39;</span><span class="p">):</span>
    <span class="n">BUG_COMPONENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Another&#39;</span><span class="p">,</span> <span class="s1">&#39;Component&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Querying for metadata for the file <code class="docutils literal notranslate"><span class="pre">/foo/test.js</span></code> will reveal 3
relevant <code class="docutils literal notranslate"><span class="pre">Files</span></code> sub-contexts. They are evaluated as follows:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/moz.build</span> <span class="pre">-</span> <span class="pre">Files('*.cpp')</span></code>. Does <code class="docutils literal notranslate"><span class="pre">/*.cpp</span></code> match
<code class="docutils literal notranslate"><span class="pre">/foo/test.js</span></code>? <strong>No</strong>. Ignore this context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/moz.build</span> <span class="pre">-</span> <span class="pre">Files('**/*.js')</span></code>. Does <code class="docutils literal notranslate"><span class="pre">/**/*.js</span></code> match
<code class="docutils literal notranslate"><span class="pre">/foo/test.js</span></code>? <strong>Yes</strong>. Apply <code class="docutils literal notranslate"><span class="pre">BUG_COMPONENT</span> <span class="pre">=</span> <span class="pre">('Firefox',</span> <span class="pre">'General')</span></code>
to us.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/foo/moz.build</span> <span class="pre">-</span> <span class="pre">Files('*.js')</span></code>. Does <code class="docutils literal notranslate"><span class="pre">/foo/*.js</span></code> match
<code class="docutils literal notranslate"><span class="pre">/foo/test.js</span></code>? <strong>Yes</strong>. Apply
<code class="docutils literal notranslate"><span class="pre">BUG_COMPONENT</span> <span class="pre">=</span> <span class="pre">('Another',</span> <span class="pre">'Component')</span></code>.</p></li>
</ol>
<p>At the end of execution, we have
<code class="docutils literal notranslate"><span class="pre">BUG_COMPONENT</span> <span class="pre">=</span> <span class="pre">('Another',</span> <span class="pre">'Component')</span></code> as the metadata for
<code class="docutils literal notranslate"><span class="pre">/foo/test.js</span></code>.</p>
<p>One way to look at file metadata is as a stack of data structures.
Each <code class="docutils literal notranslate"><span class="pre">Files</span></code> sub-context relevant to a given file is applied on top
of the previous state, starting from an empty state. The final state
wins.</p>
</div>
<div class="section" id="finalizing-values">
<span id="mozbuild-files-metadata-finalizing"></span><h2>Finalizing Values<a class="headerlink" href="#finalizing-values" title="Permalink to this headline">¶</a></h2>
<p>The default behavior of <code class="docutils literal notranslate"><span class="pre">Files</span></code> sub-context evaluation is to apply new
values on top of old. In most circumstances, this results in desired
behavior. However, there are circumstances where this may not be
desired. There is thus a mechanism to <em>finalize</em> or <em>freeze</em> values.</p>
<p>Finalizing values is useful for scenarios where you want to prevent
wildcard matches from overwriting previously-set values. This is useful
for one-off files.</p>
<p>Let’s take <code class="docutils literal notranslate"><span class="pre">Makefile.in</span></code> files as an example. The build system module
policy dictates that <code class="docutils literal notranslate"><span class="pre">Makefile.in</span></code> files are part of the <code class="docutils literal notranslate"><span class="pre">Build</span>
<span class="pre">Config</span></code> module and should be reviewed by peers of that module. However,
there exist <code class="docutils literal notranslate"><span class="pre">Makefile.in</span></code> files in many directories in the source
tree. Without finalization, a <code class="docutils literal notranslate"><span class="pre">*</span></code> or <code class="docutils literal notranslate"><span class="pre">**</span></code> wildcard matching rule
would match <code class="docutils literal notranslate"><span class="pre">Makefile.in</span></code> files and overwrite their metadata.</p>
<p>Finalizing of values is performed by setting the <code class="docutils literal notranslate"><span class="pre">FINAL</span></code> variable
on <code class="docutils literal notranslate"><span class="pre">Files</span></code> sub-contexts. See the
<a class="reference internal" href="mozbuild-symbols.html#mozbuild-subcontext-files"><span class="std std-ref">Files documentation</span></a> for more.</p>
<p>Here is an example with <code class="docutils literal notranslate"><span class="pre">Makefile.in</span></code> files, showing how it is
possible to finalize the <code class="docutils literal notranslate"><span class="pre">BUG_COMPONENT</span></code> value.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># /moz.build</span>
<span class="k">with</span> <span class="n">Files</span><span class="p">(</span><span class="s1">&#39;**/Makefile.in&#39;</span><span class="p">):</span>
    <span class="n">BUG_COMPONENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Firefox Build System&#39;</span><span class="p">,</span> <span class="s1">&#39;General&#39;</span><span class="p">)</span>
    <span class="n">FINAL</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># /foo/moz.build</span>
<span class="k">with</span> <span class="n">Files</span><span class="p">(</span><span class="s1">&#39;**&#39;</span><span class="p">):</span>
    <span class="n">BUG_COMPONENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Another&#39;</span><span class="p">,</span> <span class="s1">&#39;Component&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we query for metadata of <code class="docutils literal notranslate"><span class="pre">/foo/Makefile.in</span></code>, both <code class="docutils literal notranslate"><span class="pre">Files</span></code>
sub-contexts match the file pattern. However, since <code class="docutils literal notranslate"><span class="pre">BUG_COMPONENT</span></code> is
marked as finalized by <code class="docutils literal notranslate"><span class="pre">/moz.build</span></code>, the assignment from
<code class="docutils literal notranslate"><span class="pre">/foo/moz.build</span></code> is ignored. The final value for <code class="docutils literal notranslate"><span class="pre">BUG_COMPONENT</span></code>
is <code class="docutils literal notranslate"><span class="pre">('Firefox</span> <span class="pre">Build</span> <span class="pre">System',</span> <span class="pre">'General')</span></code>.</p>
<p>Here is another example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Files</span><span class="p">(</span><span class="s1">&#39;*.cpp&#39;</span><span class="p">):</span>
    <span class="n">BUG_COMPONENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;One-Off&#39;</span><span class="p">,</span> <span class="s1">&#39;For C++&#39;</span><span class="p">)</span>
    <span class="n">FINAL</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">with</span> <span class="n">Files</span><span class="p">(</span><span class="s1">&#39;**&#39;</span><span class="p">):</span>
    <span class="n">BUG_COMPONENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Regular&#39;</span><span class="p">,</span> <span class="s1">&#39;Component&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For every files except <code class="docutils literal notranslate"><span class="pre">foo.cpp</span></code>, the bug component will be resolved
as <code class="docutils literal notranslate"><span class="pre">Regular</span> <span class="pre">::</span> <span class="pre">Component</span></code>. However, <code class="docutils literal notranslate"><span class="pre">foo.cpp</span></code> has its value of
<code class="docutils literal notranslate"><span class="pre">One-Off</span> <span class="pre">::</span> <span class="pre">For</span> <span class="pre">C++</span></code> preserved because it is finalized.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><code class="docutils literal notranslate"><span class="pre">FINAL</span></code> only applied to variables defined in a context.</p>
<p>If you want to mark one variable as finalized but want to leave
another mutable, you’ll need to use 2 <code class="docutils literal notranslate"><span class="pre">Files</span></code> contexts.</p>
</div>
</div>
<div class="section" id="guidelines-for-defining-metadata">
<h2>Guidelines for Defining Metadata<a class="headerlink" href="#guidelines-for-defining-metadata" title="Permalink to this headline">¶</a></h2>
<p>In general, values defined towards the root of the source tree are
generic and become more specific towards the leaves. For example,
the <code class="docutils literal notranslate"><span class="pre">BUG_COMPONENT</span></code> for <code class="docutils literal notranslate"><span class="pre">/browser</span></code> might be <code class="docutils literal notranslate"><span class="pre">Firefox</span> <span class="pre">::</span> <span class="pre">General</span></code>
whereas <code class="docutils literal notranslate"><span class="pre">/browser/components/preferences</span></code> would list
<code class="docutils literal notranslate"><span class="pre">Firefox</span> <span class="pre">::</span> <span class="pre">Preferences</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pgo.html" class="btn btn-neutral float-right" title="Profile Guided Optimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mozbuild-symbols.html" class="btn btn-neutral float-left" title="mozbuild Sandbox Symbols" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>