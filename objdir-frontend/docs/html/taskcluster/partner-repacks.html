

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Partner repacks &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Partner attribution" href="partner-attribution.html" />
    <link rel="prev" title="Signing" href="signing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TaskCluster Task-Graph Generation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="taskgraph.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mach.html">Taskcluster Mach commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading.html">Loading Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="transforms.html">Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker-images.html">Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="cron.html">Periodic Taskgraphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="try.html">Try</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="release-promotion.html">Release Promotion</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="release-promotion.html#release-promotion-phases">Release Promotion Phases</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="release-promotion.html#in-depth-relpro-guide">In-depth relpro guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="release-promotion-action.html">Release Promotion Action</a></li>
<li class="toctree-l4"><a class="reference internal" href="balrog.html">Balrog in Release Promotion</a></li>
<li class="toctree-l4"><a class="reference internal" href="setting-up-an-update-server.html">Setting Up An Update Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="partials.html">Partial Update Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="signing.html">Signing</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Partner repacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="partner-attribution.html">Partner attribution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="versioncontrol.html">Version Control in CI</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Taskcluster Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-tos.html">How Tos</a></li>
<li class="toctree-l2"><a class="reference internal" href="task-graph.html">Task Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">TaskCluster Task-Graph Generation</a> &raquo;</li>
        
          <li><a href="release-promotion.html">Release Promotion</a> &raquo;</li>
        
      <li>Partner repacks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/taskcluster/partner-repacks.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="partner-repacks">
<h1>Partner repacks<a class="headerlink" href="#partner-repacks" title="Permalink to this headline">¶</a></h1>
<p id="id1">We create slightly-modified Firefox releases for some extra audiences</p>
<ul class="simple">
<li><p>EME-free builds, which disable DRM plugins by default</p></li>
<li><p>Funnelcake builds, which are used for Mozilla experiments</p></li>
<li><p>partner builds, which customize Firefox for external partners</p></li>
</ul>
<p>We use the phrase “partner repacks” to refer to all these builds because they
use the same process of repacking regular Firefox releases with additional files.
The specific differences depend on the type of build.</p>
<p>We produce partner repacks for some beta builds, and for release builds, as part of the release
automation. We don’t produce any files to update these builds as they are handled automatically
(see <a class="reference internal" href="#updates">updates</a>).</p>
<p>We also produce <a class="reference internal" href="partner-attribution.html#partner-attribution"><span class="std std-ref">Partner attribution</span></a> builds, which are Firefox Windows installers with a cohort identifier
added.</p>
<div class="section" id="parameters-scheduling">
<h2>Parameters &amp; Scheduling<a class="headerlink" href="#parameters-scheduling" title="Permalink to this headline">¶</a></h2>
<p>Partner repacks have a number of parameters which control how they work:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">release_enable_emefree</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">release_enable_partner_repack</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">release_partner_config</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">release_partner_build_number</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">release_partners</span></code></p></li>
</ul>
<p>We split the repacks into two ‘paths’, EME-free and everything else, to retain some
flexibility over enabling/disabling them separately. This costs us some duplication of the kinds
in the repacking stack. The two enable parameters are booleans to turn these two paths
on/off. We set them in shipit’s <a class="reference external" href="https://github.com/mozilla-releng/shipit/blob/main/api/src/shipit_api/admin/release.py#L93">is_partner_enabled()</a> when starting a
release. They’re both true for Firefox betas &gt;= b8 and releases, but otherwise disabled.</p>
<p><code class="docutils literal notranslate"><span class="pre">release_partner_config</span></code> is a dictionary of configuration data which drives the task generation
logic. It’s usually looked up during the release promotion action task, using the Github
GraphQL API in the <a class="reference external" href="python/taskgraph.util.html#taskgraph.util.partners.get_partner_config_by_url">get_partner_config_by_url()</a> function, with the
url defined in <a class="reference external" href="https://searchfox.org/mozilla-release/search?q=regexp%3A^partner+path%3Aconfig.yml&amp;redirect=true">taskcluster/ci/config.yml</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">release_partner_build_number</span></code> is an integer used to create unique upload paths in the firefox
candidates directory, while <code class="docutils literal notranslate"><span class="pre">release_partners</span></code> is a list of partners that should be
repacked (i.e. a subset of the whole config). Both are intended for use when respinning a few partners after
the regular Firefox has shipped. More information on that can be found in the
<a class="reference external" href="https://moz-releng-docs.readthedocs.io/en/latest/procedures/misc-operations/off-cycle-partner-repacks-and-funnelcake.html">RelEng Docs</a>.</p>
<p>Most of the machine time for generating partner repacks takes place in the <cite>promote</cite> phase of the
automation, or <cite>promote_rc</cite> in the case of X.0 release candidates. The EME-free builds are copied into the
Firefox releases directory in the <cite>push</cite> phase, along with the regular bits.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>We need some configuration to know <em>what</em> to repack, and <em>how</em> to do that. The <em>what</em> is defined by
default.xml manifests, as used with the <a class="reference external" href="https://gerrit.googlesource.com/git-repo">repo</a> tool
for git. The <a class="reference external" href="https://github.com/mozilla-partners/mozilla-EME-free-manifest/blob/master/default.xml">default.xml for EME-free</a> illustrates this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;manifest&gt;
  &lt;remote fetch=&quot;git@github.com:mozilla-partners/&quot; name=&quot;mozilla-partners&quot;/&gt;
  &lt;remote fetch=&quot;git@github.com:mozilla/&quot; name=&quot;mozilla&quot;/&gt;

  &lt;project name=&quot;repack-scripts&quot; path=&quot;scripts&quot; remote=&quot;mozilla-partners&quot; revision=&quot;master&quot;/&gt;
  &lt;project name=&quot;build-tools&quot; path=&quot;scripts/tools&quot; remote=&quot;mozilla&quot; revision=&quot;master&quot;/&gt;
  &lt;project name=&quot;mozilla-EME-free&quot; path=&quot;partners/mozilla-EME-free&quot; remote=&quot;mozilla-partners&quot; revision=&quot;master&quot;/&gt;
&lt;/manifest&gt;
</pre></div>
</div>
<p>The repack-scripts and build-tools repos are found in all manifests, and then there is a list of
partner repositories which contain the <em>how</em> configuration. Some of these repos are not publicly
visible.</p>
<p>A partner repository may contain multiple configurations inside the <code class="docutils literal notranslate"><span class="pre">desktop</span></code> directory. Each
subdirectory must contain a <code class="docutils literal notranslate"><span class="pre">repack.cfg</span></code> and a <code class="docutils literal notranslate"><span class="pre">distribution</span></code> directory, the latter
containing the customizations needed. Here’s <a class="reference external" href="https://github.com/mozilla-partners/mozilla-EME-free/blob/master/desktop/mozilla-EME-free/repack.cfg">EME-free’s repack.cfg</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aus</span><span class="o">=</span><span class="s2">&quot;mozilla-EMEfree&quot;</span>
<span class="n">dist_id</span><span class="o">=</span><span class="s2">&quot;mozilla-EMEfree&quot;</span>
<span class="n">dist_version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>
<span class="n">linux</span><span class="o">-</span><span class="n">i686</span><span class="o">=</span><span class="n">false</span>
<span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">=</span><span class="n">false</span>
<span class="n">locales</span><span class="o">=</span><span class="s2">&quot;ach af an ar&quot;</span>  <span class="c1"># truncated for display here</span>
<span class="n">mac</span><span class="o">=</span><span class="n">true</span>
<span class="n">win32</span><span class="o">=</span><span class="n">true</span>
<span class="n">win64</span><span class="o">=</span><span class="n">true</span>
<span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(platform)s</span><span class="s2">-EME-free/</span><span class="si">%(locale)s</span><span class="s2">&quot;</span>

<span class="c1"># Upload params</span>
<span class="n">upload_to_candidates</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>Note the list of locales and boolean toggles for enabling platforms. The <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> and
<code class="docutils literal notranslate"><span class="pre">upload_to_candidates</span></code> parameters are only present for repacks which are uploaded into the
<a class="reference external" href="https://archive.mozilla.org/pub/firefox/candidates/">candidates directory</a>.</p>
<p>All customizations will be placed in the <code class="docutils literal notranslate"><span class="pre">distribution</span></code> directory at the root of the Firefox
install directory, or in the case of OS X in <code class="docutils literal notranslate"><span class="pre">Firefox.app/Contents/Resources/distribution/</span></code>. A
<code class="docutils literal notranslate"><span class="pre">distribution.ini</span></code> file is the minimal requirement, here’s an example from <a class="reference external" href="https://github.com/mozilla-partners/mozilla-EME-free/blob/master/desktop/mozilla-EME-free/distribution/distribution.ini">EME-free</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Partner Distribution Configuration File</span>
<span class="c1"># Author: Mozilla</span>
<span class="c1"># Date: 2015-03-27</span>

<span class="p">[</span><span class="n">Global</span><span class="p">]</span>
<span class="nb">id</span><span class="o">=</span><span class="n">mozilla</span><span class="o">-</span><span class="n">EMEfree</span>
<span class="n">version</span><span class="o">=</span><span class="mf">1.0</span>
<span class="n">about</span><span class="o">=</span><span class="n">Mozilla</span> <span class="n">Firefox</span> <span class="n">EME</span><span class="o">-</span><span class="n">free</span>

<span class="p">[</span><span class="n">Preferences</span><span class="p">]</span>
<span class="n">media</span><span class="o">.</span><span class="n">eme</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
<span class="n">app</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">mozilla</span><span class="o">-</span><span class="n">EMEfree</span><span class="o">=</span><span class="s2">&quot;mozilla-EMEfree&quot;</span>
</pre></div>
</div>
<p>Extensions and other customizations might also be included in repacks.</p>
</div>
<div class="section" id="repacking-process">
<h2>Repacking process<a class="headerlink" href="#repacking-process" title="Permalink to this headline">¶</a></h2>
<p>The stack of tasks to create partner repacks is broadly similar to localised nightlies and
regular releases. The basic form is</p>
<ul class="simple">
<li><p>partner repack - insert the customisations into the the regular builds</p></li>
<li><p>signing - sign the internals which will become the installer (Mac only)</p></li>
<li><p>repackage - create the “installer” (Mac and Windows)</p></li>
<li><p>chunking dummy - a linux only bridge to …</p></li>
<li><p>repackage signing - sign the “installers” (mainly Windows)</p></li>
<li><p>beetmover - move the files to a partner-specific destination</p></li>
<li><p>beetmover checksums - possibly beetmove the checksums from previous step</p></li>
</ul>
<p>Some key divergences are:</p>
<ul class="simple">
<li><p>all intermediate artifacts are uploaded with a <code class="docutils literal notranslate"><span class="pre">releng/partner</span></code> prefix</p></li>
<li><p>we don’t insert any binaries on Windows so no need for internal signing</p></li>
<li><p>there’s no need to create any complete mar files at the repackage step</p></li>
<li><p>we support both public and private destinations in beetmover</p></li>
<li><p>we only need beetmover checksums for EME-free builds</p></li>
</ul>
<div class="section" id="partner-repack">
<h3>Partner repack<a class="headerlink" href="#partner-repack" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-partner-repack</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack</span></code></p></li>
<li><p>platforms: Typically all (but depends on what’s enabled by partner configuration)</p></li>
<li><p>upstreams: <code class="docutils literal notranslate"><span class="pre">build-signing</span></code> <code class="docutils literal notranslate"><span class="pre">l10n-signing</span></code></p></li>
</ul>
<p>There is one task per platform in this step, calling out to <a class="reference external" href="https://hg.mozilla.org/mozilla-central/file/default/testing/mozharness/scripts/desktop_partner_repacks.py">scripts/desktop_partner_repacks.py</a> in mozharness to prepare an environment and then perform the repacks.
The actual repacking is done by <a class="reference external" href="https://hg.mozilla.org/mozilla-central/file/default/python/mozrelease/mozrelease/partner_repack.py">python/mozrelease/mozrelease/partner_repack.py</a>.</p>
<p>It takes as input the build-signing and l10n-signing artifacts, which are all zip/tar.gz/tar.bz2
archives, simplifying the repack process by avoiding dmg and exe. Windows produces <code class="docutils literal notranslate"><span class="pre">target.zip</span></code>
&amp; <code class="docutils literal notranslate"><span class="pre">setup.exe</span></code>, Mac is <code class="docutils literal notranslate"><span class="pre">target.tar.gz</span></code>, Linux is the final product <code class="docutils literal notranslate"><span class="pre">target.tar.bz2</span></code>
(beetmover handles pretty naming as usual).</p>
</div>
<div class="section" id="signing">
<h3>Signing<a class="headerlink" href="#signing" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-partner-repack-notarization-part-1</span></code> <code class="docutils literal notranslate"><span class="pre">release-partner-repack-notarization-poller</span></code> <code class="docutils literal notranslate"><span class="pre">release-partner-repack-signing</span></code></p></li>
<li><p>platforms: Mac</p></li>
<li><p>upstreams: <code class="docutils literal notranslate"><span class="pre">release-partner-repack</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack</span></code></p></li>
</ul>
<p>We chunk the single partner repack task out to a signing task with 5 artifacts each. For
example, EME-free will become 19 tasks. We collect the target.tar.gz from the
upstream, and return a signed target.tar.gz. We use a <code class="docutils literal notranslate"><span class="pre">target.dmg</span></code> artifact for
nightlies/regular releases, but this is converted to <code class="docutils literal notranslate"><span class="pre">target.tar.gz</span></code> by the signing
scriptworker before sending it to the signing server, so partners are equivalent. The <code class="docutils literal notranslate"><span class="pre">part-1</span></code> task
uploads the binaries to apple, while the <code class="docutils literal notranslate"><span class="pre">poller</span></code> task waits for their approval, then
<code class="docutils literal notranslate"><span class="pre">release-partner-repack-signing</span></code> staples on the notarization ticket.</p>
</div>
<div class="section" id="repackage">
<h3>Repackage<a class="headerlink" href="#repackage" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-partner-repack-repackage</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack-repackage</span></code></p></li>
<li><p>platforms: Mac &amp; Windows</p></li>
<li><p>upstreams:</p>
<blockquote>
<div><ul class="simple">
<li><p>Mac: <code class="docutils literal notranslate"><span class="pre">release-partner-signing</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-signing</span></code></p></li>
<li><p>Windows: <code class="docutils literal notranslate"><span class="pre">release-partner-repack</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Mac has a repackage job for each of the signing tasks. Windows repackages are chunked here to
the same granularity as mac. Takes <code class="docutils literal notranslate"><span class="pre">target.zip</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">setup.exe</span></code> to produce <code class="docutils literal notranslate"><span class="pre">target.exe</span></code> on
Windows, and <code class="docutils literal notranslate"><span class="pre">target.tar.gz</span></code> to produce <code class="docutils literal notranslate"><span class="pre">target.dmg</span></code> on Mac. There’s no need to produce any
complete.mar files here like regular release bits do because we can reuse those.</p>
</div>
<div class="section" id="chunking-dummy">
<h3>Chunking dummy<a class="headerlink" href="#chunking-dummy" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-partner-repack-chunking-dummy</span></code></p></li>
<li><p>platforms: Linux</p></li>
<li><p>upstreams: <code class="docutils literal notranslate"><span class="pre">release-partner-repack</span></code></p></li>
</ul>
<p>We’re need Linux chunked at the next step so this dummy takes care of that for the relatively simple path
Linux follows. One task per sub config+locale combination, the same as Windows and Mac. This doesn’t need to
exist for EME-free because we don’t need to create Linux builds there.</p>
</div>
<div class="section" id="repackage-signing">
<h3>Repackage Signing<a class="headerlink" href="#repackage-signing" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-partner-repack-repackage-signing</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack-repackage-signing</span></code></p></li>
<li><p>platforms: All</p></li>
<li><p>upstreams:</p>
<blockquote>
<div><ul class="simple">
<li><p>Mac &amp; Windows: <code class="docutils literal notranslate"><span class="pre">release-partner-repackage</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-repackage</span></code></p></li>
<li><p>Linux: <code class="docutils literal notranslate"><span class="pre">release-partner-repack-chunking-dummy</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>This step GPG signs all platforms, and authenticode signs the Windows installer.</p>
</div>
<div class="section" id="beetmover">
<h3>Beetmover<a class="headerlink" href="#beetmover" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-partner-repack-beetmover</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack-beetmover</span></code></p></li>
<li><p>platforms: All</p></li>
<li><p>upstreams: <code class="docutils literal notranslate"><span class="pre">release-partner-repack-repackage-signing</span></code> <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack-repackage-signing</span></code></p></li>
</ul>
<p>Moves and renames the artifacts to their public location in the <a class="reference external" href="https://archive.mozilla.org/pub/firefox/candidates/">candidates directory</a>, or a private S3 bucket. Each task will
have the <code class="docutils literal notranslate"><span class="pre">project:releng:beetmover:action:push-to-partner</span></code> scope, with public uploads having
<code class="docutils literal notranslate"><span class="pre">project:releng:beetmover:bucket:release</span></code> and private uploads using
<code class="docutils literal notranslate"><span class="pre">project:releng:beetmover:bucket:partner</span></code>. The <code class="docutils literal notranslate"><span class="pre">upload_to_candidates</span></code> key in the partner config
controls the second scope. There’s a separate partner code path in <a class="reference external" href="https://github.com/mozilla-releng/scriptworker-scripts/tree/master/beetmoverscript">beetmoverscript</a>.</p>
</div>
<div class="section" id="beetmover-checksums">
<h3>Beetmover checksums<a class="headerlink" href="#beetmover-checksums" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>kinds: <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack-beetmover-checksums</span></code></p></li>
<li><p>platforms: Mac &amp; Windows</p></li>
<li><p>upstreams: <code class="docutils literal notranslate"><span class="pre">release-eme-free-repack-repackage-beetmover</span></code></p></li>
</ul>
<p>The EME-free builds should be present in our SHA256SUMS file and friends (<a class="reference external" href="https://archive.mozilla.org/pub/firefox/releases/61.0/SHA256SUMS">e.g.</a>) so we beetmove the target.checksums from
the beetmover tasks into the candidates directory. They get picked up by the
<code class="docutils literal notranslate"><span class="pre">release-generate-checksums</span></code> kind.</p>
</div>
</div>
<div class="section" id="updates">
<span id="id3"></span><h2>Updates<a class="headerlink" href="#updates" title="Permalink to this headline">¶</a></h2>
<p>It’s very rare to need to update a partner repack differently from the original
release build but we retain that capability. A partner build with distribution name <code class="docutils literal notranslate"><span class="pre">foo</span></code>,
based on a release Firefox build, will query for an update on the <code class="docutils literal notranslate"><span class="pre">release-cck-foo</span></code> channel. If
the update server <a class="reference external" href="http://mozilla-balrog.readthedocs.io/en/latest/">Balrog</a> finds no rule for
that channel it will fallback to the <code class="docutils literal notranslate"><span class="pre">release</span></code> channel. The update files for the regular releases do not
modify the <code class="docutils literal notranslate"><span class="pre">distribution/</span></code> directory, so the customizations are not modified.</p>
<p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1430254">Bug 1430254</a> is an example of an exception to this
logic.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="partner-attribution.html" class="btn btn-neutral float-right" title="Partner attribution" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="signing.html" class="btn btn-neutral float-left" title="Signing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>