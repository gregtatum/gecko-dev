

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mozlog — Structured logging for test output &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Device management" href="devicemanagement.html" />
    <link rel="prev" title="Logging and reporting" href="loggingreporting.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">mozbase</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="manifestparser.html">Managing lists of tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettinginfo.html">Getting information on the system under test</a></li>
<li class="toctree-l2"><a class="reference internal" href="setuprunning.html">Set up and running</a></li>
<li class="toctree-l2"><a class="reference internal" href="servingcontent.html">Handling content for the browser</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="loggingreporting.html">Logging and reporting</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozlog</span></code> — Structured logging for test output</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-format">Data Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testsuite-protocol">Testsuite Protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-mozlog.structuredlog">StructuredLogger Objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#proxylogger-objects">ProxyLogger Objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handlers">Handlers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#formatters">Formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#processing-log-files">Processing Log Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integration-with-argparse">Integration with argparse</a></li>
<li class="toctree-l4"><a class="reference internal" href="#simple-examples">Simple Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#more-complete-example">More Complete Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="devicemanagement.html">Device management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">mozbase</a> &raquo;</li>
        
          <li><a href="loggingreporting.html">Logging and reporting</a> &raquo;</li>
        
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozlog</span></code> — Structured logging for test output</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/mozbase/mozlog.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mozlog-structured-logging-for-test-output">
<h1><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozlog</span></code> — Structured logging for test output<a class="headerlink" href="#mozlog-structured-logging-for-test-output" title="Permalink to this headline">¶</a></h1>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozlog</span></code> is a library designed for logging the
execution and results of test harnesses. The internal data model is a
stream of JSON-compatible objects, with one object per log entry. The
default output format is line-based, with one JSON object serialized
per line.</p>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozlog</span></code> is <em>not</em> based on the stdlib logging
module, although it shares several concepts with it.</p>
<p>One notable difference between this module and the standard logging
module is the way that loggers are created. The structured logging
module does not require that loggers with a specific name are
singleton objects accessed through a factory function. Instead the
<code class="docutils literal notranslate"><span class="pre">StructuredLogger</span></code> constructor may be used directly. However all
loggers with the same name share the same internal state (the “Borg”
pattern). In particular the list of handler functions is the same for
all loggers with the same name.</p>
<p>Typically, you would only instantiate one logger object per
program. Two convenience methods are provided to set and get the
default logger in the program.</p>
<p>Logging is threadsafe, with access to handlers protected by a
<code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code>. However it is <cite>not</cite> process-safe. This means that
applications using multiple processes, e.g. via the
<code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> module, should arrange for all logging to happen in
a single process.</p>
<div class="section" id="data-format">
<h2>Data Format<a class="headerlink" href="#data-format" title="Permalink to this headline">¶</a></h2>
<p>Structured loggers produce messages in a simple format designed to be
compatible with the JSON data model. Each message is a single object,
with the type of message indicated by the <code class="docutils literal notranslate"><span class="pre">action</span></code> key. It is
intended that the set of <code class="docutils literal notranslate"><span class="pre">action</span></code> values be closed; where there are
use cases for additional values they should be integrated into this
module rather than extended in an ad-hoc way. The set of keys present
on on all messages is:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">action</span></code></dt><dd><p>The type of the message (string).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">time</span></code></dt><dd><p>The timestamp of the message in ms since the epoch (int).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">thread</span></code></dt><dd><p>The name of the thread emitting the message (string).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pid</span></code></dt><dd><p>The pid of the process creating the message (int).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt><dd><p>Name of the logger creating the message (string).</p>
</dd>
</dl>
<p>For each <code class="docutils literal notranslate"><span class="pre">action</span></code> there are is a further set of specific fields
describing the details of the event that caused the message to be
emitted:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">suite_start</span></code></dt><dd><p>Emitted when the testsuite starts running.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">tests</span></code></dt><dd><p>A dict of test ids keyed by group. Groups are any logical grouping
of tests, for example a manifest, directory or tag. For convenience,
a list of test ids can be used instead. In this case all tests will
automatically be placed in the ‘default’ group name. Test ids can
either be strings or lists of strings (an example of the latter is
reftests where the id has the form [test_url, ref_type, ref_url]).
Test ids are assumed to be unique within a given testsuite. In cases
where the test list is not known upfront an empty dict or list may
be passed (dict).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>An optional string to identify the suite by.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">run_info</span></code></dt><dd><p>An optional dictionary describing the properties of the
build and test environment. This contains the information provided
by <a class="reference internal" href="mozinfo.html"><span class="doc">mozinfo</span></a>, plus a boolean <code class="docutils literal notranslate"><span class="pre">debug</span></code> field indicating
whether the build under test is a debug build.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suite_end</span></code></dt><dd><p>Emitted when the testsuite is finished and no more results will be produced.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_start</span></code></dt><dd><p>Emitted when a test is being started.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">test</span></code></dt><dd><p>A unique id for the test (string or list of strings).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">path</span></code></dt><dd><p>Optional path to the test relative to some base (typically the root of the
source tree). Mainly used when <code class="docutils literal notranslate"><span class="pre">test</span></code> id is not a path (string).</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_status</span></code></dt><dd><p>Emitted for a test which has subtests to record the result of a
single subtest.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">test</span></code></dt><dd><p>The same unique id for the test as in the <code class="docutils literal notranslate"><span class="pre">test_start</span></code> message.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">subtest</span></code></dt><dd><p>Name of the subtest (string).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">status</span></code></dt><dd><p>Result of the test (string enum; <code class="docutils literal notranslate"><span class="pre">PASS</span></code>, <code class="docutils literal notranslate"><span class="pre">FAIL</span></code>,
<code class="docutils literal notranslate"><span class="pre">PRECONDITION_FAILED</span></code>, <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>, <code class="docutils literal notranslate"><span class="pre">NOTRUN</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">expected</span></code></dt><dd><p>Expected result of the test. Omitted if the expected result is the
same as the actual result (string enum, same as <code class="docutils literal notranslate"><span class="pre">status</span></code>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">known_intermittent</span></code></dt><dd><p>A list of known intermittent statuses for that test. Omitted if there are
no intermittent statuses expected. (items in the list are string enum, same as <code class="docutils literal notranslate"><span class="pre">status</span></code>)</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_end</span></code></dt><dd><p>Emitted to give the result of a test with no subtests, or the status
of the overall file when there are subtests.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">test</span></code></dt><dd><p>The same unique id for the test as in the <code class="docutils literal notranslate"><span class="pre">test_start</span></code> message.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">status</span></code></dt><dd><p>Either result of the test (if there are no subtests) in which case
(string enum <code class="docutils literal notranslate"><span class="pre">PASS</span></code>, <code class="docutils literal notranslate"><span class="pre">FAIL</span></code>, <code class="docutils literal notranslate"><span class="pre">PRECONDITION_FAILED</span></code>,
<code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>, <code class="docutils literal notranslate"><span class="pre">CRASH</span></code>, <code class="docutils literal notranslate"><span class="pre">ASSERT</span></code>, , <code class="docutils literal notranslate"><span class="pre">SKIP</span></code>) or the status of
the overall file where there are subtests (string enum <code class="docutils literal notranslate"><span class="pre">OK</span></code>,
<code class="docutils literal notranslate"><span class="pre">PRECONDITION_FAILED</span></code>, <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>, <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>, <code class="docutils literal notranslate"><span class="pre">CRASH</span></code>,
<code class="docutils literal notranslate"><span class="pre">ASSERT</span></code>, <code class="docutils literal notranslate"><span class="pre">SKIP</span></code>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">expected</span></code></dt><dd><p>The expected status, or omitted if the expected status matches the
actual status (string enum, same as <code class="docutils literal notranslate"><span class="pre">status</span></code>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">known_intermittent</span></code></dt><dd><p>A list of known intermittent statuses for that test. Omitted if there are
no intermittent statuses expected. (items in the list are string enum, same as <code class="docutils literal notranslate"><span class="pre">status</span></code>)</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">process_output</span></code></dt><dd><p>Output from a managed subprocess.</p>
<p><code class="docutils literal notranslate"><span class="pre">process</span></code>
pid of the subprocess.</p>
<p><code class="docutils literal notranslate"><span class="pre">command</span></code>
Command used to launch the subprocess.</p>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code>
Data output by the subprocess.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">log</span></code></dt><dd><p>General human-readable logging message, used to debug the harnesses
themselves rather than to provide input to other tools.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">level</span></code></dt><dd><p>Level of the log message (string enum <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code>, <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>,
<code class="docutils literal notranslate"><span class="pre">WARNING</span></code>, <code class="docutils literal notranslate"><span class="pre">INFO</span></code>, <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">message</span></code></dt><dd><p>Text of the log message.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">shutdown</span></code></dt><dd><p>This is a special action that can only be logged once per logger state.
It is sent when calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">StructuredLogger.shutdown()</span></code> or implicitly
when exiting the context manager.</p>
</dd>
</dl>
</div>
<div class="section" id="testsuite-protocol">
<h2>Testsuite Protocol<a class="headerlink" href="#testsuite-protocol" title="Permalink to this headline">¶</a></h2>
<p>When used for testsuites, the following structured logging messages must be emitted:</p>
<blockquote>
<div><ul class="simple">
<li><p>One <code class="docutils literal notranslate"><span class="pre">suite_start</span></code> message before any <code class="docutils literal notranslate"><span class="pre">test_*</span></code> messages</p></li>
<li><p>One <code class="docutils literal notranslate"><span class="pre">test_start</span></code> message per test that is run</p></li>
<li><p>One <code class="docutils literal notranslate"><span class="pre">test_status</span></code> message per subtest that is run. This might be
zero if the test type doesn’t have the notion of subtests.</p></li>
<li><p>One <code class="docutils literal notranslate"><span class="pre">test_end</span></code> message per test that is run, after the
<code class="docutils literal notranslate"><span class="pre">test_start</span></code> and any <code class="docutils literal notranslate"><span class="pre">test_status</span></code> messages for that same test.</p></li>
<li><p>One <code class="docutils literal notranslate"><span class="pre">suite_end</span></code> message after all <code class="docutils literal notranslate"><span class="pre">test_*</span></code> messages have been
emitted.</p></li>
</ul>
</div></blockquote>
<p>The above mandatory events may be interspersed with <code class="docutils literal notranslate"><span class="pre">process_output</span></code>
and <code class="docutils literal notranslate"><span class="pre">log</span></code> events, as required.</p>
<div class="section" id="subtests">
<h3>Subtests<a class="headerlink" href="#subtests" title="Permalink to this headline">¶</a></h3>
<p>The purpose of subtests is to deal with situations where a single test
produces more than one result, and the exact details of the number of
results is not known ahead of time. For example consider a test
harness that loads JavaScript-based tests in a browser. Each url
loaded would be a single test, with corresponding <code class="docutils literal notranslate"><span class="pre">test_start</span></code> and
<code class="docutils literal notranslate"><span class="pre">test_end</span></code> messages. If there can be more than one JS-defined test
on a page, however, it it useful to track the results of those tests
separately. Therefore each of those tests is a subtest, and one
<code class="docutils literal notranslate"><span class="pre">test_status</span></code> message must be generated for each subtest result.</p>
<p>Subtests must have a name that is unique within their parent test.</p>
<p>Whether or not a test has subtests changes the meaning of the
<code class="docutils literal notranslate"><span class="pre">status</span></code> property on the test itself. When the test does not have
any subtests, this property is the actual test result such as <code class="docutils literal notranslate"><span class="pre">PASS</span></code>
or <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> . When a test does have subtests, the test itself does not
have a result as-such; it isn’t meaningful to describe it as having a
<code class="docutils literal notranslate"><span class="pre">PASS</span></code> result, especially if the subtests did not all pass. Instead
this property is used to hold information about whether the test ran
without error. If no errors were detected the test must be given the
status <code class="docutils literal notranslate"><span class="pre">OK</span></code>. Otherwise the test may get the status <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> (for
e.g. uncaught JS exceptions), <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code> (if no results were reported
in the allowed time) or <code class="docutils literal notranslate"><span class="pre">CRASH</span></code> (if the test caused the process
under test to crash).</p>
</div>
</div>
<div class="section" id="module-mozlog.structuredlog">
<span id="structuredlogger-objects"></span><h2>StructuredLogger Objects<a class="headerlink" href="#module-mozlog.structuredlog" title="Permalink to this headline">¶</a></h2>
<dl class="py exception">
<dt id="mozlog.structuredlog.LoggerShutdownError">
<em class="property">exception </em><code class="sig-prename descclassname">mozlog.structuredlog.</code><code class="sig-name descname">LoggerShutdownError</code><a class="headerlink" href="#mozlog.structuredlog.LoggerShutdownError" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when attempting to log after logger.shutdown() has been called.</p>
</dd></dl>

<dl class="py function">
<dt id="mozlog.structuredlog.get_default_logger">
<code class="sig-prename descclassname">mozlog.structuredlog.</code><code class="sig-name descname">get_default_logger</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">component</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.get_default_logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the default logger if available, optionally tagged with component
name. Will return None if not yet set</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>component</strong> – The component name to tag log messages with</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mozlog.structuredlog.set_default_logger">
<code class="sig-prename descclassname">mozlog.structuredlog.</code><code class="sig-name descname">set_default_logger</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">default_logger</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.set_default_logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the default logger to logger.</p>
<p>It can then be retrieved with <a class="reference internal" href="#mozlog.structuredlog.get_default_logger" title="mozlog.structuredlog.get_default_logger"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_default_logger()</span></code></a></p>
<p>Note that <a class="reference internal" href="#mozlog.commandline.setup_logging" title="mozlog.commandline.setup_logging"><code class="xref py py-func docutils literal notranslate"><span class="pre">setup_logging()</span></code></a> will
set a default logger for you, so there should be no need to call this
function if you’re using setting up logging that way (recommended).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>default_logger</strong> – The logger to set to default.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="mozlog.structuredlog.StructuredLogger">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.structuredlog.</code><code class="sig-name descname">StructuredLogger</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">component</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.add_handler">
<code class="sig-name descname">add_handler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">handler</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.add_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a handler to the current logger</p>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.critical">
<code class="sig-name descname">critical</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.critical" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a message with level CRITICAL</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> – The string message to log</p></li>
<li><p><strong>exc_info</strong> – Either a boolean indicating whether to include a traceback
derived from sys.exc_info() or a three-item tuple in the
same format as sys.exc_info() containing exception information
to log.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.debug">
<code class="sig-name descname">debug</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a message with level DEBUG</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> – The string message to log</p></li>
<li><p><strong>exc_info</strong> – Either a boolean indicating whether to include a traceback
derived from sys.exc_info() or a three-item tuple in the
same format as sys.exc_info() containing exception information
to log.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.error">
<code class="sig-name descname">error</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.error" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a message with level ERROR</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> – The string message to log</p></li>
<li><p><strong>exc_info</strong> – Either a boolean indicating whether to include a traceback
derived from sys.exc_info() or a three-item tuple in the
same format as sys.exc_info() containing exception information
to log.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.handlers">
<em class="property">property </em><code class="sig-name descname">handlers</code><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.handlers" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of handlers that will be called when a
message is logged from this logger</p>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.info">
<code class="sig-name descname">info</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.info" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a message with level INFO</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> – The string message to log</p></li>
<li><p><strong>exc_info</strong> – Either a boolean indicating whether to include a traceback
derived from sys.exc_info() or a three-item tuple in the
same format as sys.exc_info() containing exception information
to log.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.process_output">
<code class="sig-name descname">process_output</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.process_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Log output from a managed process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>process</strong> – A unique identifier for the process producing the output
(typically the pid)</p></li>
<li><p><strong>data</strong> – The output to log</p></li>
<li><p><strong>command</strong> – A string representing the full command line used to start
the process.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.remove_handler">
<code class="sig-name descname">remove_handler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">handler</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.remove_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a handler from the current logger</p>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.shutdown">
<code class="sig-name descname">shutdown</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Shutdown the logger.</p>
<p>This logs a ‘shutdown’ action after which any further attempts to use
the logger will raise a <a class="reference internal" href="#mozlog.structuredlog.LoggerShutdownError" title="mozlog.structuredlog.LoggerShutdownError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">LoggerShutdownError</span></code></a>.</p>
<p>This is also called implicitly from the destructor or
when exiting the context manager.</p>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.suite_end">
<code class="sig-name descname">suite_end</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.suite_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a suite_end message</p>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.suite_start">
<code class="sig-name descname">suite_start</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.suite_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a suite_start message</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tests</strong> (<em>dict</em>) – Test identifiers that will be run in the suite, keyed by group name.</p></li>
<li><p><strong>name</strong> (<em>str</em>) – Optional name to identify the suite.</p></li>
<li><p><strong>run_info</strong> (<em>dict</em>) – Optional information typically provided by mozinfo.</p></li>
<li><p><strong>version_info</strong> (<em>dict</em>) – Optional target application version information provided
by mozversion.</p></li>
<li><p><strong>device_info</strong> (<em>dict</em>) – Optional target device information provided by mozdevice.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.test_end">
<code class="sig-name descname">test_end</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.test_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a test_end message indicating that a test completed. For tests
with subtests this indicates whether the overall test completed without
errors. For tests without subtests this indicates the test result
directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> – Identifier of the test that produced the result.</p></li>
<li><p><strong>status</strong> – Status string indicating the test result</p></li>
<li><p><strong>expected</strong> – Status string indicating the expected test result.</p></li>
<li><p><strong>message</strong> – String containing a message associated with the result.</p></li>
<li><p><strong>stack</strong> – a stack trace encountered during test execution.</p></li>
<li><p><strong>extra</strong> – suite-specific data associated with the test result.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.test_start">
<code class="sig-name descname">test_start</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.test_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a test_start message</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> – Identifier of the test that will run.</p></li>
<li><p><strong>path</strong> – Path to test relative to some base (typically the root of
the source tree).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.test_status">
<code class="sig-name descname">test_status</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.test_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a test_status message indicating a subtest result. Tests that
do not have subtests are not expected to produce test_status messages.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> – Identifier of the test that produced the result.</p></li>
<li><p><strong>subtest</strong> – Name of the subtest.</p></li>
<li><p><strong>status</strong> – Status string indicating the subtest result</p></li>
<li><p><strong>expected</strong> – Status string indicating the expected subtest result.</p></li>
<li><p><strong>message</strong> – String containing a message associated with the result.</p></li>
<li><p><strong>stack</strong> – a stack trace encountered during test execution.</p></li>
<li><p><strong>extra</strong> – suite-specific data associated with the test result.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozlog.structuredlog.StructuredLogger.warning">
<code class="sig-name descname">warning</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogger.warning" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a message with level WARNING</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> – The string message to log</p></li>
<li><p><strong>exc_info</strong> – Either a boolean indicating whether to include a traceback
derived from sys.exc_info() or a three-item tuple in the
same format as sys.exc_info() containing exception information
to log.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="mozlog.structuredlog.StructuredLogFileLike">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.structuredlog.</code><code class="sig-name descname">StructuredLogFileLike</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logger</span></em>, <em class="sig-param"><span class="n">level</span><span class="o">=</span><span class="default_value">'info'</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.structuredlog.StructuredLogFileLike" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper for file-like objects to redirect writes to logger
instead. Each call to <cite>write</cite> becomes a single log entry of type <cite>log</cite>.</p>
<p>When using this it is important that the callees i.e. the logging
handlers do not themselves try to write to the wrapped file as this
will cause infinite recursion.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logger</strong> – <cite>StructuredLogger</cite> to which to redirect the file write operations.</p></li>
<li><p><strong>level</strong> – log level to use for each write.</p></li>
<li><p><strong>prefix</strong> – String prefix to prepend to each log entry.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="proxylogger-objects">
<h2>ProxyLogger Objects<a class="headerlink" href="#proxylogger-objects" title="Permalink to this headline">¶</a></h2>
<p>Since <a class="reference internal" href="#mozlog.structuredlog.get_default_logger" title="mozlog.structuredlog.get_default_logger"><code class="xref py py-func docutils literal notranslate"><span class="pre">mozlog.structuredlog.get_default_logger()</span></code></a> return None when
the default logger is not initialized, it is not possible to directly
use it at the module level.</p>
<p>With ProxyLogger, it is possible to write the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mozlog</span> <span class="kn">import</span> <span class="n">get_proxy_logger</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">get_proxy_logger</span><span class="p">(</span><span class="s1">&#39;component_name&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
    <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;logging with a module level object&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>mozlog still needs to be initialized before the first call occurs
to a ProxyLogger instance, for example with
<a class="reference internal" href="#mozlog.commandline.setup_logging" title="mozlog.commandline.setup_logging"><code class="xref py py-func docutils literal notranslate"><span class="pre">mozlog.commandline.setup_logging()</span></code></a>.</p>
</div>
<span class="target" id="module-mozlog.proxy"></span><dl class="py class">
<dt id="mozlog.proxy.ProxyLogger">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.proxy.</code><code class="sig-name descname">ProxyLogger</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">component</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.proxy.ProxyLogger" title="Permalink to this definition">¶</a></dt>
<dd><p>A ProxyLogger behaves like a
<a class="reference internal" href="#mozlog.structuredlog.StructuredLogger" title="mozlog.structuredlog.StructuredLogger"><code class="xref py py-class docutils literal notranslate"><span class="pre">mozlog.structuredlog.StructuredLogger</span></code></a>.</p>
<p>Each method and attribute access will be forwarded to the underlying
StructuredLogger.</p>
<p>RuntimeError will be raised when the default logger is not yet initialized.</p>
</dd></dl>

<dl class="py function">
<dt id="mozlog.proxy.get_proxy_logger">
<code class="sig-prename descclassname">mozlog.proxy.</code><code class="sig-name descname">get_proxy_logger</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">component</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.proxy.get_proxy_logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <a class="reference internal" href="#mozlog.proxy.ProxyLogger" title="mozlog.proxy.ProxyLogger"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProxyLogger</span></code></a> for the given component.</p>
</dd></dl>

</div>
<div class="section" id="handlers">
<h2>Handlers<a class="headerlink" href="#handlers" title="Permalink to this headline">¶</a></h2>
<p>A handler is a callable that is called for each log message produced
and is responsible for handling the processing of that
message. The typical example of this is a <code class="docutils literal notranslate"><span class="pre">StreamHandler</span></code> which takes
a log message, invokes a formatter which converts the log to a string,
and writes it to a file.</p>
<span class="target" id="module-mozlog.handlers"></span><dl class="py class">
<dt id="mozlog.handlers.BaseHandler">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.handlers.</code><code class="sig-name descname">BaseHandler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inner</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.handlers.BaseHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>A base handler providing message handling facilities to
derived classes.</p>
</dd></dl>

<dl class="py class">
<dt id="mozlog.handlers.StreamHandler">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.handlers.</code><code class="sig-name descname">StreamHandler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stream</span></em>, <em class="sig-param"><span class="n">formatter</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.handlers.StreamHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Handler for writing to a file-like object</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stream</strong> – File-like object to write log messages to</p></li>
<li><p><strong>formatter</strong> – formatter to convert messages to string format</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="mozlog.handlers.LogLevelFilter">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.handlers.</code><code class="sig-name descname">LogLevelFilter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inner</span></em>, <em class="sig-param"><span class="n">level</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.handlers.LogLevelFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Handler that filters out messages with action of log and a level
lower than some specified level.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inner</strong> – Handler to use for messages that pass this filter</p></li>
<li><p><strong>level</strong> – Minimum log level to process</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="mozlog.handlers.BufferHandler">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.handlers.</code><code class="sig-name descname">BufferHandler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inner</span></em>, <em class="sig-param"><span class="n">message_limit</span><span class="o">=</span><span class="default_value">100</span></em>, <em class="sig-param"><span class="n">buffered_actions</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.handlers.BufferHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Handler that maintains a circular buffer of messages based on the
size and actions specified by a user.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inner</strong> – The underlying handler used to emit messages.</p></li>
<li><p><strong>message_limit</strong> – The maximum number of messages to retain for
context. If None, the buffer will grow without limit.</p></li>
<li><p><strong>buffered_actions</strong> – The set of actions to include in the buffer
rather than log directly.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="formatters">
<h2>Formatters<a class="headerlink" href="#formatters" title="Permalink to this headline">¶</a></h2>
<p>Formatters are callables that take a log message, and return either a
string representation of that message, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if that message
should not appear in the output. This allows formatters to both
exclude certain items and create internal buffers of the output so
that, for example, a single string might be returned for a
<code class="docutils literal notranslate"><span class="pre">test_end</span></code> message indicating the overall result of the test,
including data provided in the <code class="docutils literal notranslate"><span class="pre">test_status</span></code> messages.</p>
<p>Formatter modules are written so that they can take raw input on stdin
and write formatted output on stdout. This allows the formatters to be
invoked as part of a command line for post-processing raw log files.</p>
<span class="target" id="module-mozlog.formatters.base"></span><dl class="py class">
<dt id="mozlog.formatters.base.BaseFormatter">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.formatters.base.</code><code class="sig-name descname">BaseFormatter</code><a class="headerlink" href="#mozlog.formatters.base.BaseFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for implementing non-trivial formatters.</p>
<p>Subclasses are expected to provide a method for each action type they
wish to handle, each taking a single argument for the test data.
For example a trivial subclass that just produces the id of each test as
it starts might be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StartIdFormatter</span><span class="p">(</span><span class="n">BaseFormatter</span><span class="p">);</span>
    <span class="k">def</span> <span class="nf">test_start</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="c1">#For simplicity in the example pretend the id is always a string</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="module-mozlog.formatters.unittest"></span><dl class="py class">
<dt id="mozlog.formatters.unittest.UnittestFormatter">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.formatters.unittest.</code><code class="sig-name descname">UnittestFormatter</code><a class="headerlink" href="#mozlog.formatters.unittest.UnittestFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Formatter designed to produce output in a format like that used by
the <code class="docutils literal notranslate"><span class="pre">unittest</span></code> module in the standard library.</p>
</dd></dl>

<span class="target" id="module-mozlog.formatters.xunit"></span><dl class="py class">
<dt id="mozlog.formatters.xunit.XUnitFormatter">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.formatters.xunit.</code><code class="sig-name descname">XUnitFormatter</code><a class="headerlink" href="#mozlog.formatters.xunit.XUnitFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Formatter that produces XUnit-style XML output.</p>
<p>The tree is created in-memory so this formatter may be problematic
with very large log files.</p>
<p>Note that the data model isn’t a perfect match. In
particular XUnit assumes that each test has a unittest-style
class name and function name, which isn’t the case for us. The
implementation currently replaces path names with something that
looks like class names, but this doesn’t work for test types that
actually produce class names, or for test types that have multiple
components in their test id (e.g. reftests).</p>
</dd></dl>

<span class="target" id="module-mozlog.formatters.html"></span><dl class="py class">
<dt id="mozlog.formatters.html.HTMLFormatter">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.formatters.html.</code><code class="sig-name descname">HTMLFormatter</code><a class="headerlink" href="#mozlog.formatters.html.HTMLFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Formatter that produces a simple HTML-formatted report.</p>
</dd></dl>

<span class="target" id="module-mozlog.formatters.machformatter"></span><dl class="py class">
<dt id="mozlog.formatters.machformatter.MachFormatter">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.formatters.machformatter.</code><code class="sig-name descname">MachFormatter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">start_time</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">write_interval</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">write_times</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">terminal</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">disable_colors</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">summary_on_shutdown</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">enable_screenshot</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.formatters.machformatter.MachFormatter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<span class="target" id="module-mozlog.formatters.tbplformatter"></span><dl class="py class">
<dt id="mozlog.formatters.tbplformatter.TbplFormatter">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.formatters.tbplformatter.</code><code class="sig-name descname">TbplFormatter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">compact</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">summary_on_shutdown</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.formatters.tbplformatter.TbplFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Formatter that formats logs in the legacy formatting format used by TBPL
This is intended to be used to preserve backward compatibility with existing tools
hand-parsing this format.</p>
</dd></dl>

</div>
<div class="section" id="processing-log-files">
<h2>Processing Log Files<a class="headerlink" href="#processing-log-files" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">mozlog.reader</span></code> module provides utilities for working
with structured log files.</p>
<span class="target" id="module-mozlog.reader"></span><dl class="py class">
<dt id="mozlog.reader.LogHandler">
<em class="property">class </em><code class="sig-prename descclassname">mozlog.reader.</code><code class="sig-name descname">LogHandler</code><a class="headerlink" href="#mozlog.reader.LogHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for objects that act as log handlers. A handler is a callable
that takes a log entry as the only argument.</p>
<p>Subclasses are expected to provide a method for each action type they
wish to handle, each taking a single argument for the test data.
For example a trivial subclass that just produces the id of each test as
it starts might be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StartIdHandler</span><span class="p">(</span><span class="n">LogHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_start</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="c1">#For simplicity in the example pretend the id is always a string</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="mozlog.reader.each_log">
<code class="sig-prename descclassname">mozlog.reader.</code><code class="sig-name descname">each_log</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">log_iter</span></em>, <em class="sig-param"><span class="n">action_map</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.reader.each_log" title="Permalink to this definition">¶</a></dt>
<dd><p>Call a callback for each item in an iterable containing structured
log entries</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_iter</strong> – Iterator returning structured log entries</p></li>
<li><p><strong>action_map</strong> – Dictionary mapping action name to callback function. Log items
with actions not in this dictionary will be skipped.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mozlog.reader.handle_log">
<code class="sig-prename descclassname">mozlog.reader.</code><code class="sig-name descname">handle_log</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">log_iter</span></em>, <em class="sig-param"><span class="n">handler</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.reader.handle_log" title="Permalink to this definition">¶</a></dt>
<dd><p>Call a handler for each item in a log, discarding the return value</p>
</dd></dl>

<dl class="py function">
<dt id="mozlog.reader.imap_log">
<code class="sig-prename descclassname">mozlog.reader.</code><code class="sig-name descname">imap_log</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">log_iter</span></em>, <em class="sig-param"><span class="n">action_map</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.reader.imap_log" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an iterator that will invoke a callback per action for each item in a
iterable containing structured log entries</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_iter</strong> – Iterator returning structured log entries</p></li>
<li><p><strong>action_map</strong> – Dictionary mapping action name to callback function. Log items
with actions not in this dictionary will be skipped.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mozlog.reader.read">
<code class="sig-prename descclassname">mozlog.reader.</code><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">log_f</span></em>, <em class="sig-param"><span class="n">raise_on_error</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.reader.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a generator that will return the entries in a structured log file.
Note that the caller must not close the file whilst the generator is still
in use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_f</strong> – file-like object containing the raw log entries, one per line</p></li>
<li><p><strong>raise_on_error</strong> – boolean indicating whether ValueError should be raised
for lines that cannot be decoded.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="integration-with-argparse">
<h2>Integration with argparse<a class="headerlink" href="#integration-with-argparse" title="Permalink to this headline">¶</a></h2>
<p>The <cite>mozlog.commandline</cite> module provides integration with the <cite>argparse</cite>
module to provide uniform logging-related command line arguments to programs
using <cite>mozlog</cite>. Each known formatter gets a command line argument of the form
<code class="docutils literal notranslate"><span class="pre">--log-{name}</span></code>, which takes the name of a file to log to with that format,
or <code class="docutils literal notranslate"><span class="pre">-</span></code> to indicate stdout.</p>
<span class="target" id="module-mozlog.commandline"></span><dl class="py data">
<dt id="mozlog.commandline.TEXT_FORMATTERS">
<code class="sig-prename descclassname">mozlog.commandline.</code><code class="sig-name descname">TEXT_FORMATTERS</code><em class="property"> = ('raw', 'mach')</em><a class="headerlink" href="#mozlog.commandline.TEXT_FORMATTERS" title="Permalink to this definition">¶</a></dt>
<dd><p>a subset of formatters for non test harnesses related applications</p>
</dd></dl>

<dl class="py function">
<dt id="mozlog.commandline.add_logging_group">
<code class="sig-prename descclassname">mozlog.commandline.</code><code class="sig-name descname">add_logging_group</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">parser</span></em>, <em class="sig-param"><span class="n">include_formatters</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.commandline.add_logging_group" title="Permalink to this definition">¶</a></dt>
<dd><p>Add logging options to an argparse ArgumentParser or
optparse OptionParser.</p>
<p>Each formatter has a corresponding option of the form –log-{name}
where {name} is the name of the formatter. The option takes a value
which is either a filename or “-” to indicate stdout.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parser</strong> – The ArgumentParser or OptionParser object that should have
logging options added.</p></li>
<li><p><strong>include_formatters</strong> – List of formatter names that should be included
in the option group. Default to None, meaning
all the formatters are included. A common use
of this option is to specify
<a class="reference internal" href="#mozlog.commandline.TEXT_FORMATTERS" title="mozlog.commandline.TEXT_FORMATTERS"><code class="xref py py-data docutils literal notranslate"><span class="pre">TEXT_FORMATTERS</span></code></a> to include only the
most useful formatters for a command line tool
that is not related to test harnesses.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mozlog.commandline.setup_handlers">
<code class="sig-prename descclassname">mozlog.commandline.</code><code class="sig-name descname">setup_handlers</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logger</span></em>, <em class="sig-param"><span class="n">formatters</span></em>, <em class="sig-param"><span class="n">formatter_options</span></em>, <em class="sig-param"><span class="n">allow_unused_options</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.commandline.setup_handlers" title="Permalink to this definition">¶</a></dt>
<dd><p>Add handlers to the given logger according to the formatters and
options provided.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logger</strong> – The logger configured by this function.</p></li>
<li><p><strong>formatters</strong> – A dict of {formatter, [streams]} to use in handlers.</p></li>
<li><p><strong>formatter_options</strong> – a dict of {formatter: {option: value}} to
to use when configuring formatters.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mozlog.commandline.setup_logging">
<code class="sig-prename descclassname">mozlog.commandline.</code><code class="sig-name descname">setup_logging</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logger</span></em>, <em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">defaults</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">formatter_defaults</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">allow_unused_options</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozlog.commandline.setup_logging" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a structuredlogger based on command line arguments.</p>
<p>The created structuredlogger will also be set as the default logger, and
can be retrieved with <code class="xref py py-func docutils literal notranslate"><span class="pre">get_default_logger()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logger</strong> – A StructuredLogger instance or string name. If a string, a
new StructuredLogger instance will be created using
<cite>logger</cite> as the name.</p></li>
<li><p><strong>args</strong> – A dictionary of {argument_name:value} produced from
parsing the command line arguments for the application</p></li>
<li><p><strong>defaults</strong> – A dictionary of {formatter name: output stream} to apply
when there is no logging supplied on the command line. If
this isn’t supplied, reasonable defaults are chosen
(coloured mach formatting if stdout is a terminal, or raw
logs otherwise).</p></li>
<li><p><strong>formatter_defaults</strong> – A dictionary of {option_name: default_value} to provide
to the formatters in the absence of command line overrides.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#mozlog.structuredlog.StructuredLogger" title="mozlog.structuredlog.StructuredLogger">StructuredLogger</a></p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="simple-examples">
<h2>Simple Examples<a class="headerlink" href="#simple-examples" title="Permalink to this headline">¶</a></h2>
<p>Log to stdout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mozlog</span> <span class="kn">import</span> <span class="n">structuredlog</span>
<span class="kn">from</span> <span class="nn">mozlog</span> <span class="kn">import</span> <span class="n">handlers</span><span class="p">,</span> <span class="n">formatters</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">structuredlog</span><span class="o">.</span><span class="n">StructuredLogger</span><span class="p">(</span><span class="s2">&quot;my-test-suite&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">handlers</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
                                          <span class="n">formatters</span><span class="o">.</span><span class="n">JSONFormatter</span><span class="p">()))</span>
<span class="n">logger</span><span class="o">.</span><span class="n">suite_start</span><span class="p">([</span><span class="s2">&quot;test-id-1&quot;</span><span class="p">])</span>
<span class="n">logger</span><span class="o">.</span><span class="n">test_start</span><span class="p">(</span><span class="s2">&quot;test-id-1&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;This is a message with action=&#39;LOG&#39; and level=&#39;INFO&#39;&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">test_status</span><span class="p">(</span><span class="s2">&quot;test-id-1&quot;</span><span class="p">,</span> <span class="s2">&quot;subtest-1&quot;</span><span class="p">,</span> <span class="s2">&quot;PASS&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">test_end</span><span class="p">(</span><span class="s2">&quot;test-id-1&quot;</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">suite_end</span><span class="p">()</span>
</pre></div>
</div>
<p>Log with a context manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mozlog.structuredlog</span> <span class="kn">import</span> <span class="n">StructuredLogger</span>
<span class="kn">from</span> <span class="nn">mozlog.handlers</span> <span class="kn">import</span> <span class="n">StreamHandler</span>
<span class="kn">from</span> <span class="nn">mozlog.formatters</span> <span class="kn">import</span> <span class="n">JSONFormatter</span>

<span class="k">with</span> <span class="n">StructuredLogger</span><span class="p">(</span><span class="s2">&quot;my-test-suite&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
                                     <span class="n">JSONFormatter</span><span class="p">()))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;This is an info message&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Populate an <code class="docutils literal notranslate"><span class="pre">argparse.ArgumentParser</span></code> with logging options, and
create a logger based on the value of those options, defaulting to
JSON output on stdout if nothing else is supplied:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">mozlog</span> <span class="kn">import</span> <span class="n">commandline</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="c1"># Here one would populate the parser with other options</span>
<span class="n">commandline</span><span class="o">.</span><span class="n">add_logging_group</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">commandline</span><span class="o">.</span><span class="n">setup_logging</span><span class="p">(</span><span class="s2">&quot;testsuite-name&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">})</span>
</pre></div>
</div>
<p>Count the number of tests that timed out in a testsuite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mozlog</span> <span class="kn">import</span> <span class="n">reader</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">handle_test_end</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">count</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TIMEOUT&quot;</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">reader</span><span class="o">.</span><span class="n">each_log</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;my_test_run.log&quot;</span><span class="p">),</span>
                <span class="p">{</span><span class="s2">&quot;test_end&quot;</span><span class="p">:</span> <span class="n">handle_test_end</span><span class="p">})</span>

<span class="nb">print</span> <span class="n">count</span>
</pre></div>
</div>
</div>
<div class="section" id="more-complete-example">
<h2>More Complete Example<a class="headerlink" href="#more-complete-example" title="Permalink to this headline">¶</a></h2>
<p>This example shows a complete toy testharness set up to used
structured logging. It is available as <a class="reference external" href="_static/structured_example.py">structured_example.py</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="kn">from</span> <span class="nn">mozlog</span> <span class="kn">import</span> <span class="n">commandline</span><span class="p">,</span> <span class="n">get_default_logger</span>


<span class="k">class</span> <span class="nc">TestAssertion</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">assert_equals</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TestAssertion</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> not equal to </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">expected</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">test_func</span><span class="p">():</span>
            <span class="n">f</span><span class="p">()</span>
        <span class="n">test_func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">test_func</span><span class="o">.</span><span class="n">_expected</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">return</span> <span class="n">test_func</span>
    <span class="k">return</span> <span class="n">inner</span>


<span class="k">def</span> <span class="nf">test_that_passes</span><span class="p">():</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">test_that_fails</span><span class="p">():</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">test_that_has_an_error</span><span class="p">():</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>


<span class="nd">@expected</span><span class="p">(</span><span class="s2">&quot;FAIL&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_expected_fail</span><span class="p">():</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestRunner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_default_logger</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="s1">&#39;TestRunner&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gather_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;test_&quot;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">item</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gather_tests</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">suite_start</span><span class="p">(</span><span class="n">tests</span><span class="o">=</span><span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running tests&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_test</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">suite_end</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">test_start</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">_expected</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s2">&quot;_expected&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;PASS&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TestAssertion</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;FAIL&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;PASS&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">test_end</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="n">expected</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_parser</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">parser</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">get_parser</span><span class="p">()</span>
    <span class="n">commandline</span><span class="o">.</span><span class="n">add_logging_group</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">commandline</span><span class="o">.</span><span class="n">setup_logging</span><span class="p">(</span><span class="s2">&quot;structured-example&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">})</span>

    <span class="n">runner</span> <span class="o">=</span> <span class="n">TestRunner</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Error during test run:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Each global function with a name starting
<code class="docutils literal notranslate"><span class="pre">test_</span></code> represents a test. A passing test returns without
throwing. A failing test throws a <code class="xref py py-class docutils literal notranslate"><span class="pre">TestAssertion</span></code> exception
via the <code class="xref py py-func docutils literal notranslate"><span class="pre">assert_equals()</span></code> function. Throwing anything else is
considered an error in the test. There is also a <code class="xref py py-func docutils literal notranslate"><span class="pre">expected()</span></code>
decorator that is used to annotate tests that are expected to do
something other than pass.</p>
<p>The main entry point to the test runner is via that <code class="xref py py-func docutils literal notranslate"><span class="pre">main()</span></code>
function. This is responsible for parsing command line
arguments, and initiating the test run. Although the test harness
itself does not provide any command line arguments, the
<code class="xref py py-class docutils literal notranslate"><span class="pre">ArgumentParser</span></code> object is populated by
<code class="xref py py-meth docutils literal notranslate"><span class="pre">commandline.add_logging_group()</span></code>, which provides a generic
set of structured logging arguments appropriate to all tools producing
structured logging.</p>
<p>The values of these command line arguments are used to create a
<code class="xref py py-class docutils literal notranslate"><span class="pre">mozlog.StructuredLogger</span></code> object populated with the
specified handlers and formatters in
<code class="xref py py-func docutils literal notranslate"><span class="pre">commandline.setup_logging()</span></code>. The third argument to this
function is the default arguments to use. In this case the default
is to output raw (i.e. JSON-formatted) logs to stdout.</p>
<p>The main test harness is provided by the <code class="xref py py-class docutils literal notranslate"><span class="pre">TestRunner</span></code>
class. This class is responsible for scheduling all the tests and
logging all the results. It is passed the <code class="xref py py-obj docutils literal notranslate"><span class="pre">logger</span></code> object
created from the command line arguments. The <code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code> method
starts the test run. Before the run is started it logs a
<code class="docutils literal notranslate"><span class="pre">suite_start</span></code> message containing the id of each test that will run,
and after the testrun is done it logs a <code class="docutils literal notranslate"><span class="pre">suite_end</span></code> message.</p>
<p>Individual tests are run in the <code class="xref py py-meth docutils literal notranslate"><span class="pre">run_test()</span></code> method. For each
test this logs a <code class="docutils literal notranslate"><span class="pre">test_start</span></code> message. It then runs the test and
logs a <code class="docutils literal notranslate"><span class="pre">test_end</span></code> message containing the test name, status, expected
status, and any informational message about the reason for the
result. In this test harness there are no subtests, so the
<code class="docutils literal notranslate"><span class="pre">test_end</span></code> message has the status of the test and there are no
<code class="docutils literal notranslate"><span class="pre">test_status</span></code> messages.</p>
<div class="section" id="example-output">
<h3>Example Output<a class="headerlink" href="#example-output" title="Permalink to this headline">¶</a></h3>
<p>When run without providing any command line options, the raw
structured log messages are sent to stdout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python structured_example.py

{&quot;source&quot;: &quot;structured-example&quot;, &quot;tests&quot;: [&quot;test_that_has_an_error&quot;, &quot;test_that_fails&quot;, &quot;test_expected_fail&quot;, &quot;test_that_passes&quot;], &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682787, &quot;action&quot;: &quot;suite_start&quot;, &quot;pid&quot;: 18456}
{&quot;source&quot;: &quot;structured-example&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682787, &quot;action&quot;: &quot;log&quot;, &quot;message&quot;: &quot;Running tests&quot;, &quot;level&quot;: &quot;INFO&quot;, &quot;pid&quot;: 18456}
{&quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_that_has_an_error&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682787, &quot;action&quot;: &quot;test_start&quot;, &quot;pid&quot;: 18456}
{&quot;status&quot;: &quot;ERROR&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;pid&quot;: 18456, &quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_that_has_an_error&quot;, &quot;time&quot;: 1401446682788, &quot;action&quot;: &quot;test_end&quot;, &quot;message&quot;: &quot;Traceback (most recent call last):\n  File \&quot;structured_example.py\&quot;, line 61, in run_test\n    func()\n  File \&quot;structured_example.py\&quot;, line 31, in test_that_has_an_error\n    assert_equals(2, 1 + \&quot;1\&quot;)\nTypeError: unsupported operand type(s) for +: &#39;int&#39; and &#39;str&#39;\n&quot;, &quot;expected&quot;: &quot;PASS&quot;}
{&quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_that_fails&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682788, &quot;action&quot;: &quot;test_start&quot;, &quot;pid&quot;: 18456}
{&quot;status&quot;: &quot;FAIL&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;pid&quot;: 18456, &quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_that_fails&quot;, &quot;time&quot;: 1401446682788, &quot;action&quot;: &quot;test_end&quot;, &quot;message&quot;: &quot;1 not equal to 2&quot;, &quot;expected&quot;: &quot;PASS&quot;}
{&quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_expected_fail&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682788, &quot;action&quot;: &quot;test_start&quot;, &quot;pid&quot;: 18456}
{&quot;status&quot;: &quot;FAIL&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;pid&quot;: 18456, &quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_expected_fail&quot;, &quot;time&quot;: 1401446682788, &quot;action&quot;: &quot;test_end&quot;, &quot;message&quot;: &quot;4 not equal to 5&quot;}
{&quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_that_passes&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682788, &quot;action&quot;: &quot;test_start&quot;, &quot;pid&quot;: 18456}
{&quot;status&quot;: &quot;PASS&quot;, &quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_that_passes&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682789, &quot;action&quot;: &quot;test_end&quot;, &quot;pid&quot;: 18456}
{&quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_with_known_intermittent&quot;, &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682789, &quot;action&quot;: &quot;test_start&quot;, &quot;pid&quot;: 18456}
{&quot;status&quot;: &quot;FAIL&quot;, thread&quot;: &quot;MainThread&quot;, &quot;pid&quot;: 18456, &quot;source&quot;: &quot;structured-example&quot;, &quot;test&quot;: &quot;test_with_known_intermittent&quot;, &quot;time&quot;: 1401446682790, &quot;action&quot;: &quot;test_end&quot;, &quot;expected&quot;: &quot;PASS&quot;, &quot;known_intermittent&quot;: [&quot;FAIL&quot;, &quot;TIMEOUT&quot;]}
{&quot;action&quot;: &quot;suite_end&quot;, &quot;source&quot;: &quot;structured-example&quot;, &quot;pid&quot;: 18456, &quot;thread&quot;: &quot;MainThread&quot;, &quot;time&quot;: 1401446682790}
</pre></div>
</div>
<p>The structured logging module provides a number of command line
options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python structured_example.py --help

usage: structured_example.py [-h] [--log-unittest LOG_UNITTEST]
                             [--log-raw LOG_RAW] [--log-html LOG_HTML]
                             [--log-xunit LOG_XUNIT]
                             [--log-mach LOG_MACH]

optional arguments:
  -h, --help            show this help message and exit

Output Logging:
  Options for logging output. Each option represents a possible logging
  format and takes a filename to write that format to, or &#39;-&#39; to write to
  stdout.

  --log-unittest LOG_UNITTEST
                        Unittest style output
  --log-raw LOG_RAW     Raw structured log messages
  --log-html LOG_HTML   HTML report
  --log-xunit LOG_XUNIT
                        xUnit compatible XML
  --log-mach LOG_MACH   Human-readable output
</pre></div>
</div>
<p>In order to get human-readable output on stdout and the structured log
data to go to the file <code class="docutils literal notranslate"><span class="pre">structured.log</span></code>, we would run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python structured_example.py --log-mach=- --log-raw=structured.log

0:00.00 SUITE_START: MainThread 4
0:01.00 LOG: MainThread INFO Running tests
0:01.00 TEST_START: MainThread test_that_has_an_error
0:01.00 TEST_END: MainThread Harness status ERROR, expected PASS. Subtests passed 0/0. Unexpected 1
0:01.00 TEST_START: MainThread test_that_fails
0:01.00 TEST_END: MainThread Harness status FAIL, expected PASS. Subtests passed 0/0. Unexpected 1
0:01.00 TEST_START: MainThread test_expected_fail
0:02.00 TEST_END: MainThread Harness status FAIL. Subtests passed 0/0. Unexpected 0
0:02.00 TEST_START: MainThread test_that_passes
0:02.00 TEST_END: MainThread Harness status PASS. Subtests passed 0/0. Unexpected 0
0:02.00 SUITE_END: MainThread
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="devicemanagement.html" class="btn btn-neutral float-right" title="Device management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="loggingreporting.html" class="btn btn-neutral float-left" title="Logging and reporting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>