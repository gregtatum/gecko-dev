

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using C++ in Mozilla code &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Writing Rust Code" href="../../writing-rust-code/index.html" />
    <link rel="prev" title="Formatting C++ Code With clang-format" href="format_cpp_code_with_clang-format.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Code quality</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../static-analysis.html">Static analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lint/index.html">Linting</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Coding style</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="coding_style_cpp.html">C++ Coding style</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding_style_general.html">Mode line</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding_style_java.html">Java Coding style</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding_style_js.html">JavaScript Coding style</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding_style_other.html">Other coding style</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding_style_python.html">Python Coding style</a></li>
<li class="toctree-l3"><a class="reference internal" href="format_cpp_code_with_clang-format.html">Formatting C++ Code With clang-format</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using C++ in Mozilla code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#c-language-features">C++ language features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-and-mozilla-standard-libraries">C++ and Mozilla standard libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#further-c-rules">Further C++ rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stuff-that-is-good-to-do-for-c-or-c">Stuff that is good to do for C or C++</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Code quality</a> &raquo;</li>
        
          <li><a href="index.html">Coding style</a> &raquo;</li>
        
      <li>Using C++ in Mozilla code</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/code-quality/coding-style/using_cxx_in_firefox_code.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-c-in-mozilla-code">
<h1>Using C++ in Mozilla code<a class="headerlink" href="#using-c-in-mozilla-code" title="Permalink to this headline">¶</a></h1>
<div class="section" id="c-language-features">
<h2>C++ language features<a class="headerlink" href="#c-language-features" title="Permalink to this headline">¶</a></h2>
<p>Mozilla code only uses a subset of C++. Runtime type information (RTTI)
is disabled, as it tends to cause a very large increase in codesize.
This means that <code class="docutils literal notranslate"><span class="pre">dynamic_cast</span></code>, <code class="docutils literal notranslate"><span class="pre">typeid()</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;typeinfo&gt;</span></code> cannot
be used in Mozilla code. Also disabled are exceptions; do not use
<code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">catch</span></code> or throw any exceptions. Libraries that throw
exceptions may be used if you are willing to have the throw instead be
treated as an abort.</p>
<p>On the side of extending C++, we compile with <code class="docutils literal notranslate"><span class="pre">-fno-strict-aliasing</span></code>.
This means that when reinterpreting a pointer as a differently-typed
pointer, you don’t need to adhere to the “effective type” (of the
pointee) rule from the standard (aka. “the strict aliasing rule”) when
dereferencing the reinterpreted pointer. You still need make sure that
you don’t violate alignment requirements and need to make sure that the
data at the memory location pointed to forms a valid value when
interpreted according to the type of the pointer when dereferencing the
pointer for reading. Likewise, if you write by dereferencing the
reinterpreted pointer and the originally-typed pointer might still be
dereferenced for reading, you need to make sure that the values you
write are valid according to the original type. This value validity
issue is moot for e.g. primitive integers for which all bit patterns of
their size are valid values.</p>
<ul class="simple">
<li><p>As of Mozilla 59, C++14 mode is required to build Mozilla.</p></li>
<li><p>As of Mozilla 67, MSVC can no longer be used to build Mozilla.</p></li>
<li><p>As of Mozilla 73, C++17 mode is required to build Mozilla.</p></li>
</ul>
<p>This means that C++17 can be used where supported on all platforms. The
list of acceptable features is given below:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>GCC</p></th>
<th class="head"><p>Clang</p></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"><p>Current minimal requirement</p></th>
<th class="head"><p>7.1</p></th>
<th class="head"><p>5.0</p></th>
<th class="head"></th>
</tr>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>GCC</p></th>
<th class="head"><p>Clang</p></th>
<th class="head"><p>Can be used in code</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type_t</span> <span class="pre">&amp;&amp;</span></code></p></td>
<td><p>4.3</p></td>
<td><p>2.9</p></td>
<td><p>Yes (see notes)</p></td>
</tr>
<tr class="row-odd"><td><p>ref qualifiers on methods</p></td>
<td><p>4.8.1</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>default member - initializers (except for bit-fields)</p></td>
<td><p>4.7</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>default member - initializers (for bit-fields)</p></td>
<td><p>8</p></td>
<td><p>6</p></td>
<td><p><strong>No</strong></p></td>
</tr>
<tr class="row-even"><td><p>variadic templates</p></td>
<td><p>4.3</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Initializer lists</p></td>
<td><p>4.4</p></td>
<td><p>3.1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">static_assert</span></code></p></td>
<td><p>4.3</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">auto</span></code></p></td>
<td><p>4.4</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>lambdas</p></td>
<td><p>4.5</p></td>
<td><p>3.1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">decltype</span></code></p></td>
<td><p>4.3</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Foo&lt;Bar&lt;T&gt;&gt;</span></code></p></td>
<td><p>4.3</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">auto</span> <span class="pre">func()</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code></p></td>
<td><p>4.4</p></td>
<td><p>3.1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Templated aliasing</p></td>
<td><p>4.7</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nullptr</span></code></p></td>
<td><p>4.6</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">foo</span> <span class="pre">:</span> <span class="pre">int16_t</span></code> {};</p></td>
<td><p>4.4</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">class</span> <span class="pre">foo</span> <span class="pre">{}</span></code>;</p></td>
<td><p>4.4</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">foo;</span></code></p></td>
<td><p>4.6</p></td>
<td><p>3.1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[[attributes]]</span></code></p></td>
<td><p>4.8</p></td>
<td><p>3.3</p></td>
<td><p><strong>No</strong> (see notes)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">constexpr</span></code></p></td>
<td><p>4.6</p></td>
<td><p>3.1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">alignas</span></code></p></td>
<td><p>4.8</p></td>
<td><p>3.3</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">alignof</span></code></p></td>
<td><p>4.8</p></td>
<td><p>3.3</p></td>
<td><p>Yes, but see notes ; only clang 3.6 claims as_feature(cxx_alignof)</p></td>
</tr>
<tr class="row-odd"><td><p>Delegated constructors</p></td>
<td><p>4.7</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Inherited constructors</p></td>
<td><p>4.8</p></td>
<td><p>3.3</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">explicit</span> <span class="pre">operator</span> <span class="pre">bool()</span></code></p></td>
<td><p>4.5</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">char16_t/u&quot;string&quot;</span></code></p></td>
<td><p>4.4</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">R&quot;(string)&quot;</span></code></p></td>
<td><p>4.5</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">operator&quot;&quot;()</span></code></p></td>
<td><p>4.7</p></td>
<td><p>3.1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">=delete</span></code></p></td>
<td><p>4.4</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">=default</span></code></p></td>
<td><p>4.4</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>unrestricted unions</p></td>
<td><p>4.6</p></td>
<td><p>3.1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">(auto</span> <span class="pre">x</span> <span class="pre">:</span> <span class="pre">vec)</span></code> (<a class="reference external" href="https://stackoverflow.com/questions/15176104/c11-range-based-loop-get-item-by-value-or-reference-to-const">be careful about the type of the iterator</a>)</p></td>
<td><p>4.6</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">override</span></code>/<code class="docutils literal notranslate"><span class="pre">final</span></code></p></td>
<td><p>4.7</p></td>
<td><p>3.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">thread_local</span></code></p></td>
<td><p>4.8</p></td>
<td><p>3.3</p></td>
<td><p><strong>No</strong> (see notes)</p></td>
</tr>
<tr class="row-odd"><td><p>function template default arguments</p></td>
<td><p>4.3</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>local structs as template parameters</p></td>
<td><p>4.5</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>extended friend declarations</p></td>
<td><p>4.7</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0b100</span></code> (C++14)</p></td>
<td><p>4.9</p></td>
<td><p>2.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>Tweaks to some C++ contextual conversions</cite> (C++14)</p></td>
<td><p>4.9</p></td>
<td><p>3.4</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Return type deduction (C++14)</p></td>
<td><p>4.9</p></td>
<td><p>3.4</p></td>
<td><p>Yes (but only in template code when you would have used <code class="docutils literal notranslate"><span class="pre">decltype</span> <span class="pre">(complex-expression)</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p>Generic lambdas (C++14)</p></td>
<td><p>4.9</p></td>
<td><p>3.4</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Initialized lambda captures (C++14)</p></td>
<td><p>4.9</p></td>
<td><p>3.4</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Digit separator (C++14)</p></td>
<td><p>4.9</p></td>
<td><p>3.4</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Variable templates (C++14)</p></td>
<td><p>5.0</p></td>
<td><p>3.4</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Relaxed constexpr (C++14)</p></td>
<td><p>5.0</p></td>
<td><p>3.4</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Aggregate member initialization (C++14)</p></td>
<td><p>5.0</p></td>
<td><p>3.3</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Clarifying memory allocation (C++14)</p></td>
<td><p>5.0</p></td>
<td><p>3.4</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>[[deprecated]] attribute (C++14)</p></td>
<td><p>4.9</p></td>
<td><p>3.4</p></td>
<td><p><strong>No</strong> (see notes)</p></td>
</tr>
<tr class="row-odd"><td><p>Sized deallocation (C++14)</p></td>
<td><p>5.0</p></td>
<td><p>3.4</p></td>
<td><p><strong>No</strong> (see notes)</p></td>
</tr>
<tr class="row-even"><td><p>Concepts (Concepts TS)</p></td>
<td><p>6.0</p></td>
<td><p>—</p></td>
<td><p><strong>No</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Inline variables (C++17)</p></td>
<td><p>7.0</p></td>
<td><p>3.9</p></td>
<td><p><strong>No</strong> (clang 5 has bugs with inline variables)</p></td>
</tr>
<tr class="row-even"><td><p>constexpr_if (C++17)</p></td>
<td><p>7.0</p></td>
<td><p>3.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>constexpr lambdas (C++17)</p></td>
<td><p>—</p></td>
<td><p>—</p></td>
<td><p><strong>No</strong></p></td>
</tr>
<tr class="row-even"><td><p>Structured bindings (C++17)</p></td>
<td><p>7.0</p></td>
<td><p>4.0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Separated declaration and condition in <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">switch</span></code> (C++17)</p></td>
<td><p>7.0</p></td>
<td><p>3.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://en.cppreference.com/w/cpp/language/fold">Fold expressions</a> (C++17)</p></td>
<td><p>6.0</p></td>
<td><p>3.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>[[fallthrough]],  [[maybe_unused]], [[nodiscard]] (C++17)</p></td>
<td><p>7.0</p></td>
<td><p>3.9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Aligned allocation/deallocation (C++17)</p></td>
<td><p>7.0</p></td>
<td><p>4.0</p></td>
<td><p><strong>No</strong> (see notes)</p></td>
</tr>
<tr class="row-odd"><td><p>#pragma once</p></td>
<td><p>3.4</p></td>
<td><p>Yes</p></td>
<td><p><strong>Not</strong> until we <a class="reference external" href="https://groups.google.com/d/msg/mozilla.dev.platform/PgDjWw3xp8k/eqCFlP4Kz1MJ">normalize headers</a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://en.cppreference.com/w/cpp/experimental/lib_extensions_2#Source_code_information_capture">Source code information capture</a></p></td>
<td><p>8.0</p></td>
<td><p>—</p></td>
<td><p><strong>No</strong></p></td>
</tr>
</tbody>
</table>
<div class="section" id="sources">
<h3>Sources<a class="headerlink" href="#sources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>GCC: <a class="reference external" href="https://gcc.gnu.org/projects/cxx-status.html">https://gcc.gnu.org/projects/cxx-status.html</a></p></li>
<li><p>Clang: <a class="reference external" href="https://clang.llvm.org/cxx_status.html">https://clang.llvm.org/cxx_status.html</a></p></li>
</ul>
</div>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<p>rvalue references: Implicit move method generation cannot be used.</p>
<p>Attributes: Several common attributes are defined in
<a class="reference external" href="https://searchfox.org/mozilla-central/source/mfbt/Attributes.h">mozilla/Attributes.h</a>
or nscore.h.</p>
<p>Alignment: Some alignment utilities are defined in
<a class="reference external" href="https://searchfox.org/mozilla-central/source/mfbt/Alignment.h">mozilla/Alignment.h</a>.
/!\ MOZ_ALIGNOF and alignof don’t have the same semantics. Be careful
of what you expect from them.</p>
<p><code class="docutils literal notranslate"><span class="pre">[[deprecated]]</span></code>: If we have deprecated code, we should be removing it
rather than marking it as such. Marking things as <code class="docutils literal notranslate"><span class="pre">[[deprecated]]</span></code>
also means the compiler will warn if you use the deprecated API, which
turns into a fatal error in our automation builds, which is not helpful.</p>
<p>Sized deallocation: Our compilers all support this (custom flags are
required for GCC and Clang), but turning it on breaks some classes’
<code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> methods, and <a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1250998">some
work</a> would
need to be done to make it an efficiency win with our custom memory
allocator.</p>
<p>Aligned allocation/deallocation: Our custom memory allocator doesn’t
have support for these functions.</p>
<p>Thread locals: <code class="docutils literal notranslate"><span class="pre">thread_local</span></code> is not supported on Android.</p>
</div>
</div>
<div class="section" id="c-and-mozilla-standard-libraries">
<h2>C++ and Mozilla standard libraries<a class="headerlink" href="#c-and-mozilla-standard-libraries" title="Permalink to this headline">¶</a></h2>
<p>The Mozilla codebase contains within it several subprojects which follow
different rules for which libraries can and can’t be used it. The rules
listed here apply to normal platform code, and assume unrestricted
usability of MFBT or XPCOM APIs.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The rest of this section is a draft for expository and exploratory
purposes. Do not trust the information listed here.</p>
</div>
<p>What follows is a list of standard library components provided by
Mozilla or the C++ standard. If an API is not listed here, then it is
not permissible to use it in Mozilla code. Deprecated APIs are not
listed here. In general, prefer Mozilla variants of data structures to
standard C++ ones, even when permitted to use the latter, since Mozilla
variants tend to have features not found in the standard library (e.g.,
memory size tracking) or have more controllable performance
characteristics.</p>
<p>A list of approved standard library headers is maintained in
<a class="reference external" href="https://searchfox.org/mozilla-central/source/config/stl-headers.mozbuild">config/stl-headers.mozbuild</a>.</p>
<div class="section" id="data-structures">
<h3>Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Header</p></th>
<th class="head"><p>STL equivalent</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsAutoTArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsTArray.h</span></code></p></td>
<td></td>
<td><p>Like <code class="docutils literal notranslate"><span class="pre">nsTArray</span></code>, but will store a small amount as stack storage</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nsAutoTObserverArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsTObserverArray.h</span></code></p></td>
<td></td>
<td><p>Like <code class="docutils literal notranslate"><span class="pre">nsTObserverArray</span></code>, but will store a small amount as stack storage</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::BloomFilter</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla/BloomFilter.h</span></code></p></td>
<td></td>
<td><p>Probabilistic set membership (see <a class="reference external" href="https://en.wikipedia.org/wiki/Bloom_filter#Counting_filters">Wikipedia</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nsClassHashtable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsClassHashtable.h</span></code></p></td>
<td></td>
<td><p>Adaptation of nsTHashtable, see <a class="reference external" href="https://developer.mozilla.org/docs/Mozilla/Tech/XPCOM/Guide/Hashtables">XPCOM hashtable guide</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsCOMArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsCOMArray.h</span></code></p></td>
<td></td>
<td><p>Like <code class="docutils literal notranslate"><span class="pre">nsTArray&lt;nsCOMPtr&lt;T&gt;&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nsDataHashtable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsClassHashtable.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::unordered_map</span></code></p></td>
<td><p>Adaptation of <code class="docutils literal notranslate"><span class="pre">nsTHashtable</span></code>, see <a class="reference external" href="https://developer.mozilla.org/docs/Mozilla/Tech/XPCOM/Guide/Hashtables">XPCOM hashtable guide</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsDeque</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsDeque.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::deque&lt;void</span> <span class="pre">*&gt;</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::EnumSet</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla/EnumSet.h</span></code></p></td>
<td></td>
<td><p>Like <code class="docutils literal notranslate"><span class="pre">std::set</span></code>, but for enum classes.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Hash{Map,Set}</span></code></p></td>
<td><p><a class="reference external" href="https://searchfox.org/mozilla-central/source/mfbt/HashTable.h">mozilla/HashTable.h</a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::unordered_{map,set}</span></code></p></td>
<td><p>A general purpose hash map and hash set.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nsInterfaceHashtable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsInterfaceHashtable.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::unordered_map</span></code></p></td>
<td><p>Adaptation of <code class="docutils literal notranslate"><span class="pre">nsTHashtable</span></code>, see <a class="reference external" href="https://developer.mozilla.org/docs/Mozilla/Tech/XPCOM/Guide/Hashtables">XPCOM hashtable guide</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsJSThingHashtable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsJSThingHashtable.h</span></code></p></td>
<td></td>
<td><p>Adaptation of <code class="docutils literal notranslate"><span class="pre">nsTHashtable</span></code>, see <a class="reference external" href="https://developer.mozilla.org/docs/Mozilla/Tech/XPCOM/Guide/Hashtables">XPCOM hashtable guide</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::LinkedList</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla/LinkedList.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::list</span></code></p></td>
<td><p>Doubly-linked list</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsRef</span> <span class="pre">PtrHashtable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsRefPtrHashtable.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::unordered_map</span></code></p></td>
<td><p>Adaptation of <code class="docutils literal notranslate"><span class="pre">nsTHashtable</span></code>, see <a class="reference external" href="https://developer.mozilla.org/docs/Mozilla/Tech/XPCOM/Guide/Hashtables">XPCOM hashtable guide</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::SegmentedVector</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla/SegmentedVector.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::deque</span></code> w/o O(1) pop_front</p></td>
<td><p>Doubly-linked list of vector elements</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::SplayTree</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla/SplayTree.h</span></code></p></td>
<td></td>
<td><p>Quick access to recently-accessed elements (see <a class="reference external" href="https://en.wikipedia.org/wiki/Splay_tree">Wikipedia</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nsTArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsTArray.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::vector</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsTHashtable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsTHashtable.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::unordered_{map,set}</span></code></p></td>
<td><p>See <a class="reference external" href="https://developer.mozilla.org/docs/Mozilla/Tech/XPCOM/Guide/Hashtables">XPCOM hashtable guide</a>,  you probably want a subclass</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nsTObserverArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsTObserverArray.h</span></code></p></td>
<td></td>
<td><p>Like <code class="docutils literal notranslate"><span class="pre">nsTArray</span></code>, but iteration is stable even through mutation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsTPriorityQueue</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsTPriorityQueue.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::priority_queue</span></code></p></td>
<td><p>Unlike the STL class, not a container adapter</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Vector</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla/Vector.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::vector</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Buffer</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla/Buffer.h</span></code></p></td>
<td></td>
<td><p>Unlike <code class="docutils literal notranslate"><span class="pre">Array</span></code>, has a run-time variable length. Unlike <code class="docutils literal notranslate"><span class="pre">Vector</span></code>, does not have capacity and growth mechanism. Unlike  <code class="docutils literal notranslate"><span class="pre">Span</span></code>, owns  its buffer.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="safety-utilities">
<h3>Safety utilities<a class="headerlink" href="#safety-utilities" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Header</p></th>
<th class="head"><p>STL equivalent</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Array</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/Array.h</span></code></p></td>
<td></td>
<td><p>safe array index</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::AssertedCast</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/Casting.h</span></code></p></td>
<td></td>
<td><p>casts</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::CheckedInt</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/CheckedInt.h</span></code></p></td>
<td></td>
<td><p>avoids overflow</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nsCOMPtr</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">xpcom/base/nsCOMPtr.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::EnumeratedArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/EnumeratedArray.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Array</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Maybe</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/Maybe.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::optional</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::RangedPtr</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/RangedPtr.h</span></code></p></td>
<td></td>
<td><p>like <code class="docutils literal notranslate"><span class="pre">mozilla::Span</span></code> but with two pointers instead of pointer and length</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::RefPtr</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/RefPtr.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Span</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mozilla/Span.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">gsl::span</span></code>, <code class="docutils literal notranslate"><span class="pre">absl::Span</span></code>, <code class="docutils literal notranslate"><span class="pre">std::string_view</span></code>, <code class="docutils literal notranslate"><span class="pre">std::u16string_view</span></code></p></td>
<td><p>Rust’s slice concept for C++ (without borrow checking)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">StaticRefPtr</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">xpcom/base/StaticPtr.h</span></code></p></td>
<td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nsRefPtr</span></code> w/o static constructor</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::UniquePtr</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/UniquePtr.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::unique_ptr</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::WeakPtr</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/WeakPtr.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::weak_ptr</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsWeakPtr</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">xpcom/base/nsWeakPtr.h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::weak_ptr</span></code></p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="strings">
<h3>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h3>
<p>See the <a class="reference external" href="https://developer.mozilla.org/docs/Mozilla/Tech/XPCOM/Guide/Internal_strings">Mozilla internal string
guide</a> for
usage of <code class="docutils literal notranslate"><span class="pre">nsAString</span></code> (our copy-on-write replacement for
<code class="docutils literal notranslate"><span class="pre">std::u16string</span></code>) and <code class="docutils literal notranslate"><span class="pre">nsACString</span></code> (our copy-on-write replacement
for <code class="docutils literal notranslate"><span class="pre">std::string</span></code>).</p>
<p>Be sure not to introduce further uses of <code class="docutils literal notranslate"><span class="pre">std::wstring</span></code>, which is not
portable! (Some uses exist in the IPC code.)</p>
</div>
<div class="section" id="algorithms">
<h3>Algorithms<a class="headerlink" href="#algorithms" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::BinarySearch</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/BinarySearch.h</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::BitwiseCast</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/Casting.h</span></code> (strict aliasing-safe cast)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla/MathAlgorithms.h</span></code></p></td>
<td><p>(rotate, ctlz, popcount, gcd, abs, lcm)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::RollingMean</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/RollingMean.h</span></code> ()</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="concurrency">
<h3>Concurrency<a class="headerlink" href="#concurrency" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Header</p></th>
<th class="head"><p>STL/boost equivalent</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Atomic</span></code></p></td>
<td><p>mfbt/Atomic.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::atomic</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::CondVar</span></code></p></td>
<td><p>xpcom/threads/CondVar.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::condition_variable</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::DataMutex</span></code></p></td>
<td><p>xpcom/threads/DataMutex.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">boost::synchronized_value</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Monitor</span></code></p></td>
<td><p>xpcom/threads/Monitor.h</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Mutex</span></code></p></td>
<td><p>xpcom/threads/Mutex.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::mutex</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::ReentrantMonitor</span></code></p></td>
<td><p>xpcom/threads/ReentrantMonitor.h</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::StaticMutex</span></code></p></td>
<td><p>xpcom/base/StaticMutex.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::mutex</span></code></p></td>
<td><p>Mutex that can (and in fact, must) be used as a global/static variable.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="miscellaneous">
<h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Header</p></th>
<th class="head"><p>STL/boost equivalent</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::AlignedStorage</span></code></p></td>
<td><p>mfbt/Alignment.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::aligned_storage</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::MaybeOneOf</span></code></p></td>
<td><p>mfbt/MaybeOneOf.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::optional&lt;std::variant&lt;T1,</span> <span class="pre">T2&gt;&gt;</span></code></p></td>
<td><p>~ <code class="docutils literal notranslate"><span class="pre">mozilla::Maybe&lt;union</span> <span class="pre">{T1,</span> <span class="pre">T2}&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::Pair</span></code></p></td>
<td><p>mfbt/Pair.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::tuple&lt;T1,</span> <span class="pre">T2&gt;</span></code></p></td>
<td><p>minimal space!</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mozilla::TimeStamp</span></code></p></td>
<td><p>xpcom/ds/TimeStamp.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::chrono::time_point</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>mozilla/TypeTraits.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;type_traits&gt;</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>mozilla/PodOperations.h</p></td>
<td></td>
<td><p>C++ versions of <code class="docutils literal notranslate"><span class="pre">memset</span></code>, <code class="docutils literal notranslate"><span class="pre">memcpy</span></code>, etc.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>mozilla/ArrayUtils.h</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>mozilla/Compression.h</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>mozilla/Endian.h</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>mozilla/FloatingPoint.h</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>mozilla/HashFunctions.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::hash</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>mozilla/Move.h</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std::move</span></code>, <code class="docutils literal notranslate"><span class="pre">std::swap</span></code>, <code class="docutils literal notranslate"><span class="pre">std::forward</span></code></p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mozilla-data-structures-and-standard-c-ranges-and-iterators">
<h3>Mozilla data structures and standard C++ ranges and iterators<a class="headerlink" href="#mozilla-data-structures-and-standard-c-ranges-and-iterators" title="Permalink to this headline">¶</a></h3>
<p>Some Mozilla-defined data structures provide STL-style
<a class="reference external" href="https://en.cppreference.com/w/cpp/named_req/Iterator">iterators</a> and
are usable in <a class="reference external" href="https://en.cppreference.com/w/cpp/language/range-for">range-based for
loops</a> as well
as STL <a class="reference external" href="https://en.cppreference.com/w/cpp/algorithm">algorithms</a>.</p>
<p>Currently, these include:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Header</p></th>
<th class="head"><p>Bug(s)</p></th>
<th class="head"><p>Iterator category</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsTArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">xpcom/ds/n</span> <span class="pre">sTArray.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1126552">1126552</a></p></td>
<td><p>Random-access</p></td>
<td><p>Also reverse-iterable. Also supports remove-erase pattern via RemoveElementsAt method. Also supports back-inserting output iterators via <code class="docutils literal notranslate"><span class="pre">MakeBackInserter</span></code> function.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nsBaseHashtable</span></code> and subclasses: <code class="docutils literal notranslate"><span class="pre">nsClassHashtable</span></code> <code class="docutils literal notranslate"><span class="pre">nsDataHashtable</span></code> <code class="docutils literal notranslate"><span class="pre">nsInterfaceHashtable</span></code> <code class="docutils literal notranslate"><span class="pre">nsJSThingHashtable</span></code> <code class="docutils literal notranslate"><span class="pre">nsRefPtrHashtable</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">xpcom/ds/nsBaseHashtable.h</span></code> <code class="docutils literal notranslate"><span class="pre">xpcom/ds/nsClassHashtable.h</span></code> <code class="docutils literal notranslate"><span class="pre">xpcom/ds/nsDataHashtable.h</span></code> <code class="docutils literal notranslate"><span class="pre">xpcom/ds/nsInterfaceHashtable.h</span></code> <code class="docutils literal notranslate"><span class="pre">xpcom/ds/nsJSThingHashtable.h</span></code> <code class="docutils literal notranslate"><span class="pre">xpcom/ds/nsRefPtrHashtable.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1575479">1575479</a></p></td>
<td><p>Forward</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nsCOMArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">xpcom/ds/nsCOMArray.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1342303">1342303</a></p></td>
<td><p>Random-access</p></td>
<td><p>Also reverse-iterable.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Array</span></code> <code class="docutils literal notranslate"><span class="pre">EnumerationArray</span></code> <code class="docutils literal notranslate"><span class="pre">RangedArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/Array.h</span></code> <code class="docutils literal notranslate"><span class="pre">mfbt/EnumerationArray.h</span></code> <code class="docutils literal notranslate"><span class="pre">mfbt/RangedArray.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1216041">1216041</a></p></td>
<td><p>Random-access</p></td>
<td><p>Also reverse-iterable.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Buffer</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/Buffer.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1512155">1512155</a></p></td>
<td><p>Random-access</p></td>
<td><p>Also reverse-iterable.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DoublyLinkedList</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/DoublyLinkedList.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1277725">1277725</a></p></td>
<td><p>Forward</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">EnumeratedRange</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/EnumeratedRange.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1142999">1142999</a></p></td>
<td><p><em>Missing</em></p></td>
<td><p>Also reverse-iterable.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">IntegerRange</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/IntegerRange.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1126701">1126701</a></p></td>
<td><p><em>Missing</em></p></td>
<td><p>Also reverse-iterable.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SmallPointerArray</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/SmallPointerArray.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1331718">1331718</a></p></td>
<td><p>Random-access</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Span</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mfbt/Span.h</span></code></p></td>
<td><p><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1295611">1295611</a></p></td>
<td><p>Random-access</p></td>
<td><p>Also reverse-iterable.</p></td>
</tr>
</tbody>
</table>
<p>Note that if the iterator category is stated as “missing”, the type is
probably only usable in range-based for. This is most likely just an
omission, which could be easily fixed.</p>
<p>Useful in this context are also the class template <code class="docutils literal notranslate"><span class="pre">IteratorRange</span></code>
(which can be used to construct a range from any pair of iterators) and
function template <code class="docutils literal notranslate"><span class="pre">Reversed</span></code> (which can be used to reverse any range),
both defined in <code class="docutils literal notranslate"><span class="pre">mfbt/ReverseIterator.h</span></code></p>
</div>
</div>
<div class="section" id="further-c-rules">
<h2>Further C++ rules<a class="headerlink" href="#further-c-rules" title="Permalink to this headline">¶</a></h2>
<div class="section" id="don-t-use-static-constructors">
<h3>Don’t use static constructors<a class="headerlink" href="#don-t-use-static-constructors" title="Permalink to this headline">¶</a></h3>
<p>(You probably shouldn’t be using global variables to begin with. Quite
apart from the weighty software-engineering arguments against them,
globals affect startup time! But sometimes we have to do ugly things.)</p>
<p>Non-portable example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">FooBarClass</span> <span class="nf">static_object</span><span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="mi">92</span><span class="p">);</span>

<span class="kt">void</span>
<span class="nf">bar</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">static_object</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
     <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once upon a time, there were compiler bugs that could result in
constructors not being called for global objects. Those bugs are
probably long gone by now, but even with the feature working correctly,
there are so many problems with correctly ordering C++ constructors that
it’s easier to just have an init function:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="n">FooBarClass</span><span class="o">*</span> <span class="n">static_object</span><span class="p">;</span>

<span class="n">FooBarClass</span><span class="o">*</span>
<span class="nf">getStaticObject</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">static_object</span><span class="p">)</span>
    <span class="n">static_object</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">FooBarClass</span><span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="mi">92</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">static_object</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">bar</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">getStaticObject</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="don-t-use-exceptions">
<h3>Don’t use exceptions<a class="headerlink" href="#don-t-use-exceptions" title="Permalink to this headline">¶</a></h3>
<p>See the introduction to the “C++ language features” section at the start
of this document.</p>
</div>
<div class="section" id="don-t-use-run-time-type-information">
<h3>Don’t use Run-time Type Information<a class="headerlink" href="#don-t-use-run-time-type-information" title="Permalink to this headline">¶</a></h3>
<p>See the introduction to the “C++ language features” section at the start
of this document.</p>
<p>If you need runtime typing, you can achieve a similar result by adding a
<code class="docutils literal notranslate"><span class="pre">classOf()</span></code> virtual member function to the base class of your
hierarchy and overriding that member function in each subclass. If
<code class="docutils literal notranslate"><span class="pre">classOf()</span></code> returns a unique value for each class in the hierarchy,
you’ll be able to do type comparisons at runtime.</p>
</div>
<div class="section" id="don-t-use-the-c-standard-library-including-iostream-and-locale">
<h3>Don’t use the C++ standard library (including iostream and locale)<a class="headerlink" href="#don-t-use-the-c-standard-library-including-iostream-and-locale" title="Permalink to this headline">¶</a></h3>
<p>See the section “C++ and Mozilla standard libraries”.</p>
</div>
<div class="section" id="use-c-lambdas-but-with-care">
<h3>Use C++ lambdas, but with care<a class="headerlink" href="#use-c-lambdas-but-with-care" title="Permalink to this headline">¶</a></h3>
<p>C++ lambdas are supported across all our compilers now. Rejoice! We
recommend explicitly listing out the variables that you capture in the
lambda, both for documentation purposes, and to double-check that you’re
only capturing what you expect to capture.</p>
</div>
<div class="section" id="use-namespaces">
<h3>Use namespaces<a class="headerlink" href="#use-namespaces" title="Permalink to this headline">¶</a></h3>
<p>Namespaces may be used according to the style guidelines in <a class="reference internal" href="coding_style_cpp.html#c-coding-style"><span class="std std-ref">C++ Coding style</span></a>.</p>
</div>
<div class="section" id="don-t-mix-varargs-and-inlines">
<h3>Don’t mix varargs and inlines<a class="headerlink" href="#don-t-mix-varargs-and-inlines" title="Permalink to this headline">¶</a></h3>
<p>What? Why are you using varargs to begin with?! Stop that at once!</p>
</div>
<div class="section" id="make-header-files-compatible-with-c-and-c">
<h3>Make header files compatible with C and C++<a class="headerlink" href="#make-header-files-compatible-with-c-and-c" title="Permalink to this headline">¶</a></h3>
<p>Non-portable example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/*oldCheader.h*/</span>
<span class="kt">int</span> <span class="nf">existingCfunction</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">anotherExistingCfunction</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">);</span>

<span class="cm">/* oldCfile.c */</span>
<span class="cp">#include</span> <span class="cpf">&quot;oldCheader.h&quot;</span><span class="cp"></span>
<span class="p">...</span>

<span class="c1">// new file.cpp</span>
<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<span class="cp">#include</span> <span class="cpf">&quot;oldCheader.h&quot;</span><span class="cp"></span>
<span class="p">};</span>
<span class="p">...</span>
</pre></div>
</div>
<p>If you make new header files with exposed C interfaces, make the header
files work correctly when they are included by both C and C++ files.</p>
<p>(If you need to include a C header in new C++ files, that should just
work. If not, it’s the C header maintainer’s fault, so fix the header if
you can, and if not, whatever hack you come up with will probably be
fine.)</p>
<p>Portable example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/* oldCheader.h*/</span>
<span class="n">PR_BEGIN_EXTERN_C</span>
<span class="kt">int</span> <span class="n">existingCfunction</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">anotherExistingCfunction</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">);</span>
<span class="n">PR_END_EXTERN_C</span>

<span class="cm">/* oldCfile.c */</span>
<span class="cp">#include</span> <span class="cpf">&quot;oldCheader.h&quot;</span><span class="cp"></span>
<span class="p">...</span>

<span class="c1">// new file.cpp</span>
<span class="cp">#include</span> <span class="cpf">&quot;oldCheader.h&quot;</span><span class="cp"></span>
<span class="p">...</span>
</pre></div>
</div>
<p>There are number of reasons for doing this, other than just good style.
For one thing, you are making life easier for everyone else, doing the
work in one common place (the header file) instead of all the C++ files
that include it. Also, by making the C header safe for C++, you document
that “hey, this file is now being included in C++”. That’s a good thing.
You also avoid a big portability nightmare that is nasty to fix…</p>
</div>
<div class="section" id="use-override-on-subclass-virtual-member-functions">
<h3>Use override on subclass virtual member functions<a class="headerlink" href="#use-override-on-subclass-virtual-member-functions" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">override</span></code> keyword is supported in C++11 and in all our supported
compilers, and it catches bugs.</p>
</div>
<div class="section" id="always-declare-a-copy-constructor-and-assignment-operator">
<h3>Always declare a copy constructor and assignment operator<a class="headerlink" href="#always-declare-a-copy-constructor-and-assignment-operator" title="Permalink to this headline">¶</a></h3>
<p>Many classes shouldn’t be copied or assigned. If you’re writing one of
these, the way to enforce your policy is to declare a deleted copy
constructor as private and not supply a definition. While you’re at it,
do the same for the assignment operator used for assignment of objects
of the same class. Example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">private</span><span class="o">:</span>
    <span class="n">Foo</span><span class="p">(</span><span class="k">const</span> <span class="n">Foo</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="n">Foo</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Foo</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Any code that implicitly calls the copy constructor will hit a
compile-time error. That way nothing happens in the dark. When a user’s
code won’t compile, they’ll see that they were passing by value, when
they meant to pass by reference (oops).</p>
</div>
<div class="section" id="be-careful-of-overloaded-methods-with-like-signatures">
<h3>Be careful of overloaded methods with like signatures<a class="headerlink" href="#be-careful-of-overloaded-methods-with-like-signatures" title="Permalink to this headline">¶</a></h3>
<p>It’s best to avoid overloading methods when the type signature of the
methods differs only by one “abstract” type (e.g. <code class="docutils literal notranslate"><span class="pre">PR_Int32</span></code> or
<code class="docutils literal notranslate"><span class="pre">int32</span></code>). What you will find as you move that code to different
platforms, is suddenly on the Foo2000 compiler your overloaded methods
will have the same type-signature.</p>
</div>
<div class="section" id="type-scalar-constants-to-avoid-unexpected-ambiguities">
<h3>Type scalar constants to avoid unexpected ambiguities<a class="headerlink" href="#type-scalar-constants-to-avoid-unexpected-ambiguities" title="Permalink to this headline">¶</a></h3>
<p>Non-portable code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FooClass</span> <span class="p">{</span>
  <span class="c1">// having such similar signatures</span>
  <span class="c1">// is a bad idea in the first place.</span>
  <span class="kt">void</span> <span class="nf">doit</span><span class="p">(</span><span class="kt">long</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">doit</span><span class="p">(</span><span class="kt">short</span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">void</span>
<span class="n">B</span><span class="o">::</span><span class="n">foo</span><span class="p">(</span><span class="n">FooClass</span><span class="o">*</span> <span class="n">xyz</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">xyz</span><span class="o">-&gt;</span><span class="n">doit</span><span class="p">(</span><span class="mi">45</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Be sure to type your scalar constants, e.g., <code class="docutils literal notranslate"><span class="pre">uint32_t(10)</span></code> or
<code class="docutils literal notranslate"><span class="pre">10L</span></code>. Otherwise, you can produce ambiguous function calls which
potentially could resolve to multiple methods, particularly if you
haven’t followed (2) above. Not all of the compilers will flag ambiguous
method calls.</p>
<p>Portable code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FooClass</span> <span class="p">{</span>
  <span class="c1">// having such similar signatures</span>
  <span class="c1">// is a bad idea in the first place.</span>
  <span class="kt">void</span> <span class="nf">doit</span><span class="p">(</span><span class="kt">long</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">doit</span><span class="p">(</span><span class="kt">short</span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">void</span>
<span class="n">B</span><span class="o">::</span><span class="n">foo</span><span class="p">(</span><span class="n">FooClass</span><span class="o">*</span> <span class="n">xyz</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">xyz</span><span class="o">-&gt;</span><span class="n">doit</span><span class="p">(</span><span class="mf">45L</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="use-nscomptr-in-xpcom-code">
<h3>Use nsCOMPtr in XPCOM code<a class="headerlink" href="#use-nscomptr-in-xpcom-code" title="Permalink to this headline">¶</a></h3>
<p>See the <code class="docutils literal notranslate"><span class="pre">nsCOMPtr</span></code> <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Using_nsCOMPtr">User
Manual</a> for
usage details.</p>
</div>
<div class="section" id="don-t-use-identifiers-that-start-with-an-underscore">
<h3>Don’t use identifiers that start with an underscore<a class="headerlink" href="#don-t-use-identifiers-that-start-with-an-underscore" title="Permalink to this headline">¶</a></h3>
<p>This rule occasionally surprises people who’ve been hacking C++ for
decades. But it comes directly from the C++ standard!</p>
<p>According to the C++ Standard, 17.4.3.1.2 Global Names
[lib.global.names], paragraph 1:</p>
<p>Certain sets of names and function signatures are always reserved to the
implementation:</p>
<ul class="simple">
<li><p>Each name that contains a double underscore (__) or begins with an
underscore followed by an uppercase letter (2.11) is reserved to the
implementation for any use.</p></li>
<li><p><strong>Each name that begins with an underscore is reserved to the
implementation</strong> for use as a name in the global namespace.</p></li>
</ul>
</div>
</div>
<div class="section" id="stuff-that-is-good-to-do-for-c-or-c">
<h2>Stuff that is good to do for C or C++<a class="headerlink" href="#stuff-that-is-good-to-do-for-c-or-c" title="Permalink to this headline">¶</a></h2>
<div class="section" id="avoid-conditional-includes-when-possible">
<h3>Avoid conditional #includes when possible<a class="headerlink" href="#avoid-conditional-includes-when-possible" title="Permalink to this headline">¶</a></h3>
<p>Don’t write an <code class="docutils literal notranslate"><span class="pre">#include</span></code> inside an <code class="docutils literal notranslate"><span class="pre">#ifdef</span></code> if you could instead
put it outside. Unconditional includes are better because they make the
compilation more similar across all platforms and configurations, so
you’re less likely to cause stupid compiler errors on someone else’s
favorite platform that you never use.</p>
<p>Bad code example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef MOZ_ENABLE_JPEG_FOUR_BILLION</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="c1">   // &lt;--- don&#39;t do this</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;jpeg4e9.h&quot;</span><span class="c1">  // &lt;--- only do this if the header really might not be there</span><span class="cp"></span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Of course when you’re including different system files for different
machines, you don’t have much choice. That’s different.</p>
</div>
<div class="section" id="every-cpp-source-file-should-have-a-unique-name">
<h3>Every .cpp source file should have a unique name<a class="headerlink" href="#every-cpp-source-file-should-have-a-unique-name" title="Permalink to this headline">¶</a></h3>
<p>Every object file linked into libxul needs to have a unique name. Avoid
generic names like nsModule.cpp and instead use nsPlacesModule.cpp.</p>
</div>
<div class="section" id="turn-on-warnings-for-your-compiler-and-then-write-warning-free-code">
<h3>Turn on warnings for your compiler, and then write warning free code<a class="headerlink" href="#turn-on-warnings-for-your-compiler-and-then-write-warning-free-code" title="Permalink to this headline">¶</a></h3>
<p>What generates a warning on one platform will generate errors on
another. Turn warnings on. Write warning-free code. It’s good for you.
Treat warnings as errors by adding
<code class="docutils literal notranslate"><span class="pre">ac_add_options</span> <span class="pre">--enable-warnings-as-errors</span></code> to your mozconfig file.</p>
</div>
<div class="section" id="use-the-same-type-for-all-bitfields-in-a-struct-or-class">
<h3>Use the same type for all bitfields in a <code class="docutils literal notranslate"><span class="pre">struct</span></code> or <code class="docutils literal notranslate"><span class="pre">class</span></code><a class="headerlink" href="#use-the-same-type-for-all-bitfields-in-a-struct-or-class" title="Permalink to this headline">¶</a></h3>
<p>Some compilers do not pack the bits when different bitfields are given
different types. For example, the following struct might have a size of
8 bytes, even though it would fit in 1:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="nl">ch</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="nl">i</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="don-t-use-an-enum-type-for-a-bitfield">
<h3>Don’t use an enum type for a bitfield<a class="headerlink" href="#don-t-use-an-enum-type-for-a-bitfield" title="Permalink to this headline">¶</a></h3>
<p>The classic example of this is using <code class="docutils literal notranslate"><span class="pre">PRBool</span></code> for a boolean bitfield.
Don’t do that. <code class="docutils literal notranslate"><span class="pre">PRBool</span></code> is a signed integer type, so the bitfield’s
value when set will be <code class="docutils literal notranslate"><span class="pre">-1</span></code> instead of <code class="docutils literal notranslate"><span class="pre">+1</span></code>, which—I know,
<em>crazy</em>, right? The things C++ hackers used to have to put up with…</p>
<p>You shouldn’t be using <code class="docutils literal notranslate"><span class="pre">PRBool</span></code> anyway. Use <code class="docutils literal notranslate"><span class="pre">bool</span></code>. Bitfields of
type <code class="docutils literal notranslate"><span class="pre">bool</span></code> are fine.</p>
<p>Enums are signed on some platforms (in some configurations) and unsigned
on others and therefore unsuitable for writing portable code when every
bit counts, even if they happen to work on your system.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../writing-rust-code/index.html" class="btn btn-neutral float-right" title="Writing Rust Code" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="format_cpp_code_with_clang-format.html" class="btn btn-neutral float-left" title="Formatting C++ Code With clang-format" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>