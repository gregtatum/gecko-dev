

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mozprocess — Launch and manage processes &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mozrunner — Manage remote and local gecko processes" href="mozrunner.html" />
    <link rel="prev" title="mozprofile — Create and modify Mozilla application profiles" href="mozprofile.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">mozbase</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="manifestparser.html">Managing lists of tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="gettinginfo.html">Getting information on the system under test</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="setuprunning.html">Set up and running</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mozfile.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozfile</span></code> — File utilities for use in Mozilla testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozgeckoprofiler.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozgeckoprofiler.rst</span></code> — Gecko Profiler utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozinstall.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozinstall</span></code> — Install and uninstall Gecko-based applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozpower.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozpower</span></code> — Power-usage testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozprofile.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozprofile</span></code> — Create and modify Mozilla application profiles</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozprocess</span></code> — Launch and manage processes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-a-process">Running a process</a></li>
<li class="toctree-l4"><a class="reference internal" href="#collecting-process-output">Collecting process output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#execution">Execution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#child-management">Child management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-mozprocess">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mozrunner.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozrunner</span></code> — Manage remote and local gecko processes</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozcrash.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozcrash</span></code> — Print stack traces from minidumps left behind by crashed processes</a></li>
<li class="toctree-l3"><a class="reference internal" href="mozdebug.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozdebug</span></code> — Configure and launch compatible debuggers.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="servingcontent.html">Handling content for the browser</a></li>
<li class="toctree-l2"><a class="reference internal" href="loggingreporting.html">Logging and reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="devicemanagement.html">Device management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">mozbase</a> &raquo;</li>
        
          <li><a href="setuprunning.html">Set up and running</a> &raquo;</li>
        
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozprocess</span></code> — Launch and manage processes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/mozbase/mozprocess.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mozprocess-launch-and-manage-processes">
<h1><a class="reference internal" href="#module-mozprocess" title="mozprocess"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mozprocess</span></code></a> — Launch and manage processes<a class="headerlink" href="#mozprocess-launch-and-manage-processes" title="Permalink to this headline">¶</a></h1>
<p>Mozprocess is a process-handling module that provides some additional
features beyond those available with python’s subprocess:</p>
<ul class="simple">
<li><p>better handling of child processes, especially on Windows</p></li>
<li><p>the ability to timeout the process after some absolute period, or some
period without any data written to stdout/stderr</p></li>
<li><p>the ability to specify output handlers that will be called
for each line of output produced by the process</p></li>
<li><p>the ability to specify handlers that will be called on process timeout
and normal process termination</p></li>
</ul>
<div class="section" id="running-a-process">
<h2>Running a process<a class="headerlink" href="#running-a-process" title="Permalink to this headline">¶</a></h2>
<p>mozprocess consists of two classes: ProcessHandler inherits from ProcessHandlerMixin.</p>
<p>Let’s see how to run a process.
First, the class should be instantiated with at least one argument which is a command (or a list formed by the command followed by its arguments).
Then the process can be launched using the <em>run()</em> method.
Finally the <em>wait()</em> method will wait until end of execution.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="c1"># under Windows replace by command = [&#39;dir&#39;, &#39;/a&#39;]</span>
<span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;-l&#39;</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;execute command: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">commandline</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that using <em>ProcessHandler</em> instead of <em>ProcessHandlerMixin</em> will print the output of executed command. The attribute <em>commandline</em> provides the launched command.</p>
</div>
<div class="section" id="collecting-process-output">
<h2>Collecting process output<a class="headerlink" href="#collecting-process-output" title="Permalink to this headline">¶</a></h2>
<p>Let’s now consider a basic shell script that will print numbers from 1 to 5 waiting 1 second between each.
This script will be used as a command to launch in further examples.</p>
<p><strong>proc_sleep_echo.sh</strong>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="k">for</span> i in <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span>
<span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$i</span>
    sleep <span class="m">1</span>
<span class="k">done</span>
</pre></div>
</div>
<p>If you are running under Windows, you won’t be able to use the previous script (unless using Cygwin).
So you’ll use the following script:</p>
<p><strong>proc_sleep_echo.bat</strong>:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="k">echo</span> off
<span class="k">FOR</span> <span class="se">%%</span>A <span class="k">IN</span> <span class="p">(</span>1 2 3 4 5<span class="p">)</span> <span class="k">DO</span> <span class="p">(</span>
    <span class="k">ECHO</span> <span class="se">%%</span>A
    <span class="c1">REM if you have TIMEOUT then use it instead of PING</span>
    <span class="c1">REM TIMEOUT /T 1 /NOBREAK</span>
    PING -n 2 127.0.0.1 <span class="p">&gt;</span> NUL
<span class="p">)</span>
</pre></div>
</div>
<p>Mozprocess allows the specification of custom output handlers to gather process output while running.
ProcessHandler will by default write all outputs on stdout. You can also provide (to ProcessHandler or ProcessHandlerMixin) a function or a list of functions that will be used as callbacks on each output line generated by the process.</p>
<p>In the following example the command’s output will be stored in a file <em>output.log</em> and printed in stdout:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;output.log&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tostdout</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tofile</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>

<span class="c1"># under Windows you&#39;ll replace by &#39;proc_sleep_echo.bat&#39;</span>
<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_sleep_echo.sh&#39;</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">tostdout</span><span class="p">,</span> <span class="n">tofile</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandlerMixin</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">processOutputLine</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

<span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The process output can be saved (<em>obj = ProcessHandler(…, storeOutput=True)</em>) so as it is possible to request it (<em>obj.output</em>) at any time. Note that the default value for <em>stroreOutput</em> is <em>True</em>, so it is not necessary to provide it in the parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_sleep_echo.sh&#39;</span> <span class="c1"># Windows: &#39;proc_sleep_echo.bat&#39;</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">storeOutput</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>In previous example, you will see the <em>p.output</em> list growing.</p>
</div>
<div class="section" id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="status">
<h3>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h3>
<p>It is possible to query the status of the process via <em>poll()</em> that will return None if the process is still running, 0 if it ended without failures and a negative value if it was killed by a signal (Unix-only).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_sleep_echo.sh&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;poll status: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">())</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;poll status: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="timeout">
<h3>Timeout<a class="headerlink" href="#timeout" title="Permalink to this headline">¶</a></h3>
<p>A timeout can be provided to the <em>run()</em> method. If the process last more than timeout seconds, it will be stopped.</p>
<p>After execution, the property <em>timedOut</em> will be set to True if a timeout was reached.</p>
<p>It is also possible to provide functions (<em>obj = ProcessHandler[Mixin](…, onTimeout=functions)</em>) that will be called if the timeout was reached.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="k">def</span> <span class="nf">ontimeout</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;REACHED TIMEOUT&quot;</span><span class="p">)</span>

<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_sleep_echo.sh&#39;</span> <span class="c1"># Windows: &#39;proc_sleep_echo.bat&#39;</span>
<span class="n">functions</span> <span class="o">=</span> <span class="p">[</span><span class="n">ontimeout</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">onTimeout</span><span class="o">=</span><span class="n">functions</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;timedOut = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">timedOut</span><span class="p">)</span>
</pre></div>
</div>
<p>By default the process will be killed on timeout but it is possible to prevent this by setting <em>kill_on_timeout</em> to <em>False</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">onTimeout</span><span class="o">=</span><span class="n">functions</span><span class="p">,</span> <span class="n">kill_on_timeout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;timedOut = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">timedOut</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, no output will be available after the timeout, but the process will still be running.</p>
</div>
<div class="section" id="waiting">
<h3>Waiting<a class="headerlink" href="#waiting" title="Permalink to this headline">¶</a></h3>
<p>It is possible to wait until the process exits as already seen with the method <em>wait()</em>, or until the end of a timeout if given. Note that in last case the process is still alive after the timeout.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_sleep_echo.sh&#39;</span> <span class="c1"># Windows: &#39;proc_sleep_echo.bat&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;timedOut = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">timedOut</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="killing">
<h3>Killing<a class="headerlink" href="#killing" title="Permalink to this headline">¶</a></h3>
<p>You can request to kill the process with the method <em>kill</em>. f the parameter “ignore_children” is set to False when the process handler class is initialized, all the process’s children will be killed as well.</p>
<p>Except on Windows, you can specify the signal with which to kill method the process (e.g.: <em>kill(signal.SIGKILL)</em>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_sleep_echo.sh&#39;</span> <span class="c1"># Windows: &#39;proc_sleep_echo.bat&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="end-of-execution">
<h3>End of execution<a class="headerlink" href="#end-of-execution" title="Permalink to this headline">¶</a></h3>
<p>You can provide a function or a list of functions to call at the end of the process using the initialization parameter <em>onFinish</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="k">def</span> <span class="nf">finish</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished!!&quot;</span><span class="p">)</span>

<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_sleep_echo.sh&#39;</span> <span class="c1"># Windows: &#39;proc_sleep_echo.bat&#39;</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">onFinish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="child-management">
<h2>Child management<a class="headerlink" href="#child-management" title="Permalink to this headline">¶</a></h2>
<p>Consider the following scripts:</p>
<p><strong>proc_child.sh</strong>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="k">for</span> i in a b c d e
<span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$i</span>
    sleep <span class="m">1</span>
<span class="k">done</span>
</pre></div>
</div>
<p><strong>proc_parent.sh</strong>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
./proc_child.sh
<span class="k">for</span> i in <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span>
<span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$i</span>
    sleep <span class="m">1</span>
<span class="k">done</span>
</pre></div>
</div>
<p>For windows users consider:</p>
<p><strong>proc_child.bat</strong>:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="k">echo</span> off
<span class="k">FOR</span> <span class="se">%%</span>A <span class="k">IN</span> <span class="p">(</span>a b c d e<span class="p">)</span> <span class="k">DO</span> <span class="p">(</span>
    <span class="k">ECHO</span> <span class="se">%%</span>A
    <span class="c1">REM TIMEOUT /T 1 /NOBREAK</span>
    PING -n 2 127.0.0.1 <span class="p">&gt;</span> NUL
<span class="p">)</span>
</pre></div>
</div>
<p><strong>proc_parent.bat</strong>:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="k">echo</span> off
<span class="k">call</span> proc_child.bat
<span class="k">FOR</span> <span class="se">%%</span>A <span class="k">IN</span> <span class="p">(</span>1 2 3 4 5<span class="p">)</span> <span class="k">DO</span> <span class="p">(</span>
    <span class="k">ECHO</span> <span class="se">%%</span>A
    <span class="c1">REM TIMEOUT /T 1 /NOBREAK</span>
    PING -n 2 127.0.0.1 <span class="p">&gt;</span> NUL
<span class="p">)</span>
</pre></div>
</div>
<p>For processes that launch other processes, mozprocess allows you to get child running status, wait for child termination, and kill children.</p>
<div class="section" id="ignoring-children">
<h3>Ignoring children<a class="headerlink" href="#ignoring-children" title="Permalink to this headline">¶</a></h3>
<p>By default the <em>ignore_children</em> option is False. In that case, killing the main process will kill all its children at the same time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="k">def</span> <span class="nf">finish</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished&quot;</span><span class="p">)</span>

<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_parent.sh&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">ignore_children</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">onFinish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;kill&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</pre></div>
</div>
<p>If <em>ignore_children</em> is set to <em>True</em>, killing will apply only to the main process that will wait children end of execution before stopping (join).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">mozprocess</span> <span class="kn">import</span> <span class="n">processhandler</span>

<span class="k">def</span> <span class="nf">finish</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished&quot;</span><span class="p">)</span>

<span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;./proc_parent.sh&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">processhandler</span><span class="o">.</span><span class="n">ProcessHandler</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">ignore_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onFinish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;kill&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="module-mozprocess">
<span id="api-documentation"></span><h2>API Documentation<a class="headerlink" href="#module-mozprocess" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="mozprocess.ProcessHandlerMixin">
<em class="property">class </em><code class="sig-prename descclassname">mozprocess.</code><code class="sig-name descname">ProcessHandlerMixin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cmd</span></em>, <em class="sig-param"><span class="n">args</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">cwd</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">env</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ignore_children</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">kill_on_timeout</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">processOutputLine</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">processStderrLine</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">onTimeout</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">onFinish</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozprocess.ProcessHandlerMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>A class for launching and manipulating local processes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cmd</strong> – command to run. May be a string or a list. If specified as a list, the first
element will be interpreted as the command, and all additional elements will be interpreted
as arguments to that command.</p></li>
<li><p><strong>args</strong> – list of arguments to pass to the command (defaults to None). Must not be set when
<cite>cmd</cite> is specified as a list.</p></li>
<li><p><strong>cwd</strong> – working directory for command (defaults to None).</p></li>
<li><p><strong>env</strong> – is the environment to use for the process (defaults to os.environ).</p></li>
<li><p><strong>ignore_children</strong> – causes system to ignore child processes when True,
defaults to False (which tracks child processes).</p></li>
<li><p><strong>kill_on_timeout</strong> – when True, the process will be killed when a timeout is reached.
When False, the caller is responsible for killing the process.
Failure to do so could cause a call to wait() to hang indefinitely. (Defaults to True.)</p></li>
<li><p><strong>processOutputLine</strong> – function or list of functions to be called for
each line of output produced by the process (defaults to an empty
list).</p></li>
<li><p><strong>processStderrLine</strong> – function or list of functions to be called
for each line of error output - stderr - produced by the process
(defaults to an empty list). If this is not specified, stderr lines
will be sent to the <em>processOutputLine</em> callbacks.</p></li>
<li><p><strong>onTimeout</strong> – function or list of functions to be called when the process times out.</p></li>
<li><p><strong>onFinish</strong> – function or list of functions to be called when the process terminates
normally without timing out.</p></li>
<li><p><strong>kwargs</strong> – additional keyword args to pass directly into Popen.</p></li>
</ul>
</dd>
</dl>
<p>NOTE: Child processes will be tracked by default.  If for any reason
we are unable to track child processes and ignore_children is set to False,
then we will fall back to only tracking the root process.  The fallback
will be logged.</p>
<dl class="py method">
<dt id="mozprocess.ProcessHandlerMixin.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cmd</span></em>, <em class="sig-param"><span class="n">args</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">cwd</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">env</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ignore_children</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">kill_on_timeout</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">processOutputLine</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">processStderrLine</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">onTimeout</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">onFinish</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozprocess.ProcessHandlerMixin.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize self.  See help(type(self)) for accurate signature.</p>
</dd></dl>

<dl class="py method">
<dt id="mozprocess.ProcessHandlerMixin.commandline">
<em class="property">property </em><code class="sig-name descname">commandline</code><a class="headerlink" href="#mozprocess.ProcessHandlerMixin.commandline" title="Permalink to this definition">¶</a></dt>
<dd><p>the string value of the command line (command + args)</p>
</dd></dl>

<dl class="py method">
<dt id="mozprocess.ProcessHandlerMixin.kill">
<code class="sig-name descname">kill</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sig</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozprocess.ProcessHandlerMixin.kill" title="Permalink to this definition">¶</a></dt>
<dd><p>Kills the managed process.</p>
<p>If you created the process with ‘ignore_children=False’ (the
default) then it will also also kill all child processes spawned by
it. If you specified ‘ignore_children=True’ when creating the
process, only the root process will be killed.</p>
<p>Note that this does not manage any state, save any output etc,
it immediately kills the process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sig</strong> – Signal used to kill the process, defaults to SIGKILL
(has no effect on Windows)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mozprocess.ProcessHandlerMixin.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">outputTimeout</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozprocess.ProcessHandlerMixin.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the process.</p>
<p>If timeout is not None, the process will be allowed to continue for
that number of seconds before being killed. If the process is killed
due to a timeout, the onTimeout handler will be called.</p>
<p>If outputTimeout is not None, the process will be allowed to continue
for that number of seconds without producing any output before
being killed.</p>
</dd></dl>

<dl class="py method">
<dt id="mozprocess.ProcessHandlerMixin.timedOut">
<em class="property">property </em><code class="sig-name descname">timedOut</code><a class="headerlink" href="#mozprocess.ProcessHandlerMixin.timedOut" title="Permalink to this definition">¶</a></dt>
<dd><p>True if the process has timed out for any reason.</p>
</dd></dl>

<dl class="py method">
<dt id="mozprocess.ProcessHandlerMixin.wait">
<code class="sig-name descname">wait</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozprocess.ProcessHandlerMixin.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Waits until all output has been read and the process is
terminated.</p>
<p>If timeout is not None, will return after timeout seconds.
This timeout only causes the wait function to return and
does not kill the process.</p>
<p>Returns the process exit code value:
- None if the process hasn’t terminated yet
- A negative number if the process was killed by signal N (Unix only)
- ‘0’ if the process ended without failures</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="mozprocess.ProcessHandler">
<em class="property">class </em><code class="sig-prename descclassname">mozprocess.</code><code class="sig-name descname">ProcessHandler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cmd</span></em>, <em class="sig-param"><span class="n">logfile</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">stream</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">storeOutput</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mozprocess.ProcessHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience class for handling processes with default output handlers.</p>
<p>By default, all output is sent to stdout. This can be disabled by setting
the <em>stream</em> argument to None.</p>
<p>If processOutputLine keyword argument is specified the function or the
list of functions specified by this argument will be called for each line
of output; the output will not be written to stdout automatically then
if stream is True (the default).</p>
<p>If storeOutput==True, the output produced by the process will be saved
as self.output.</p>
<p>If logfile is not None, the output produced by the process will be
appended to the given file.</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mozrunner.html" class="btn btn-neutral float-right" title="mozrunner — Manage remote and local gecko processes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mozprofile.html" class="btn btn-neutral float-left" title="mozprofile — Create and modify Mozilla application profiles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>