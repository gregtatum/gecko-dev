

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basics &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Rust/C++ interop" href="ffi.html" />
    <link rel="prev" title="Writing Rust Code" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools/index.html">Firefox DevTools Contributor Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Writing Rust Code</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#formatting-rust-code">Formatting Rust code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-cargo">Using Cargo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-static-prefs">Using static prefs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#helper-crates">Helper crates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ffi.html">Rust/C++ interop</a></li>
<li class="toctree-l2"><a class="reference internal" href="xpcom.html">XPCOM components in Rust</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Writing Rust Code</a> &raquo;</li>
        
      <li>Basics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/writing-rust-code/basics.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basics">
<h1>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="formatting-rust-code">
<h2>Formatting Rust code<a class="headerlink" href="#formatting-rust-code" title="Permalink to this headline">¶</a></h2>
<p>To format all the Rust code within a directory <code class="docutils literal notranslate"><span class="pre">$DIR</span></code>, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./mach lint -l rustfmt --fix $DIR
</pre></div>
</div>
</div>
<div class="section" id="using-cargo">
<h2>Using Cargo<a class="headerlink" href="#using-cargo" title="Permalink to this headline">¶</a></h2>
<p>Many Cargo commands can be run on individual crates. Change into the directory
containing the crate’s <code class="docutils literal notranslate"><span class="pre">Cargo.toml</span></code> file, and then run the command with
<code class="docutils literal notranslate"><span class="pre">MOZ_TOPOBJDIR</span></code> set appropriately. For example, to generate and view rustdocs
for the <code class="docutils literal notranslate"><span class="pre">xpcom</span></code> crate, run these commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd xpcom/rust/xpcom
MOZ_TOPOBJDIR=$OBJDIR cargo doc
cd -
firefox target/doc/xpcom/index.html 
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">$OBJDIR</span></code> is the path to the object directory.</p>
</div>
<div class="section" id="using-static-prefs">
<h2>Using static prefs<a class="headerlink" href="#using-static-prefs" title="Permalink to this headline">¶</a></h2>
<p>Static boolean/integer prefs can be easily accessed from Rust code. Add a
<code class="docutils literal notranslate"><span class="pre">rust:</span> <span class="pre">true</span></code> field to the pref definition in
<a class="reference external" href="https://searchfox.org/mozilla-central/source/modules/libpref/init/StaticPrefList.yaml">modules/libpref/init/StaticPrefList.yaml</a>,
like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my.lucky.pref</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RelaxedAtomicBool</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">mirror</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">always</span>
  <span class="nt">rust</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>The pref can then be accessed via the <code class="docutils literal notranslate"><span class="pre">pref!</span></code> macro, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>let my_lucky_pref = static_prefs::pref!(&quot;my.lucky.pref&quot;);
</pre></div>
</div>
</div>
<div class="section" id="helper-crates">
<h2>Helper crates<a class="headerlink" href="#helper-crates" title="Permalink to this headline">¶</a></h2>
<p>The following in-tree helper crates provide idiomatic support for some common patterns.</p>
<ul>
<li><p><a class="reference external" href="https://searchfox.org/mozilla-central/source/xpcom/rust/nserror/src/lib.rs">nserror</a>
reflects <code class="docutils literal notranslate"><span class="pre">nsresult</span></code> codes into Rust.</p></li>
<li><p><a class="reference external" href="https://searchfox.org/mozilla-central/source/xpcom/rust/nsstring/src/lib.rs">nsstring</a>
exposes bindings for XPCOM string types. You can use the same <code class="docutils literal notranslate"><span class="pre">ns{A,C}String</span></code>
types as C++ for owned strings and pass them back and forth over the
boundary. There is also <code class="docutils literal notranslate"><span class="pre">ns{A,C}Str</span></code> for dependent or borrowed strings.</p></li>
<li><p><a class="reference external" href="https://searchfox.org/mozilla-central/source/xpcom/rust/xpcom/src">xpcom</a>
provides multiple building blocks for a component’s implementation.</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">RefPtr</span></code> type is for managing reference-counted pointers.</p></li>
<li><p>XPCOM service getters are generated by
<a class="reference external" href="https://searchfox.org/mozilla-central/source/xpcom/build/Services.py">xpcom/build/Services.py</a>
and can be called like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">pref_service</span> <span class="o">=</span> <span class="n">xpcom</span><span class="p">::</span><span class="n">services</span><span class="p">::</span><span class="n">get_PrefService</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>There is also a <code class="docutils literal notranslate"><span class="pre">get_service</span></code> function that works like <code class="docutils literal notranslate"><span class="pre">do_GetService</span></code> in
C++, as an alternative.</p></li>
<li><p>A set of <code class="docutils literal notranslate"><span class="pre">derive</span></code> macros help with declaring interface implementations. The
<a class="reference external" href="https://searchfox.org/mozilla-central/source/xpcom/rust/xpcom/xpcom_macros/src/lib.rs">docs</a>
have details and examples.</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://searchfox.org/mozilla-central/source/xpcom/rust/moz_task/src/lib.rs">moz_task</a>
wraps XPCOM’s threading functions in order to make it easy and safe to write
threaded code. It has helpers for getting and creating threads, dispatching
async runnables, and thread-safe handles.</p></li>
<li><p><a class="reference external" href="https://searchfox.org/mozilla-central/source/storage/rust/src/lib.rs">storage</a>
is an interface to mozStorage, our wrapper for SQLite. It can wrap an
existing storage connection, and prepare and execute statements. This crate
wraps the synchronous connection API, and lets you execute statements
asynchronously via <code class="docutils literal notranslate"><span class="pre">moz_task</span></code>.</p></li>
<li><p><a class="reference external" href="https://searchfox.org/mozilla-central/source/storage/variant/src/lib.rs">storage_variant</a>
is for working with variants. It also provides a <code class="docutils literal notranslate"><span class="pre">HashPropertyBag</span></code> type
that’s useful for passing hash maps over XPCOM to JS.</p></li>
</ul>
<p>Unfortunately, rustdocs are <a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1428139">not yet generated and
hosted</a> for crates within
mozilla-central. Therefore, the crate links shown above link to files
containing the relevant rustdocs source where possible. However, you can
generate docs locally using the <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">doc</span></code> command described above.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ffi.html" class="btn btn-neutral float-right" title="Rust/C++ interop" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Writing Rust Code" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>