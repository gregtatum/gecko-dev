

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Remote Debugging Protocol &mdash; Firefox Source Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/firefox.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.4/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Client API" href="client-api.html" />
    <link rel="prev" title="Current DevTools CSP" href="../frontend/csp.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Firefox Source Docs
          

          
            
            <img src="../../_static/firefox-wordmark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Getting Set Up To Work On The Firefox Codebase</a></li>
</ul>
<p class="caption"><span class="caption-text">Working On Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Working on Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bug-mgmt/index.html">Bug Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/index.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../layout/index.html">Layout &amp; CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/index.html">Graphics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Firefox DevTools Contributor Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#automated-tests">Automated tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#files-and-directories">Files and directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tool-architectures">Tool Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#frontend">Frontend</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#backend">Backend</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Remote Debugging Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-conventions">General Conventions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-root-actor">The Root Actor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interacting-with-thread-like-actors">Interacting with Thread-Like Actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspecting-paused-threads">Inspecting Paused Threads</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lexical-environments">Lexical Environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#breakpoints">Breakpoints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-listeners">Event Listeners</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stream-transport">Stream Transport</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="client-api.html">Client API</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugger-api.html">Debugger API</a></li>
<li class="toctree-l3"><a class="reference internal" href="backward-compatibility.html">Backward Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="actor-hierarchy.html">Actors Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="actor-e10s-handling.html">Handling Multi-Processes in Actors</a></li>
<li class="toctree-l3"><a class="reference internal" href="protocol.js.html">Writing Actors With protocol.js</a></li>
<li class="toctree-l3"><a class="reference internal" href="actor-registration.html">Registering A New Actor</a></li>
<li class="toctree-l3"><a class="reference internal" href="actor-best-practices.html">Actor Best Practices</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#preferences">Preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#about-this-documentation">About this documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/index.html">Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../js/index.html">SpiderMonkey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/geckoview/index.html">Welcome to GeckoView’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/libpref/index.html">libpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remote/index.html">Remote Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/common/services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uriloader/index.html">File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget/cocoa/index.html">Firefox on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code-quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-rust-code/index.html">Writing Rust Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler/index.html">Gecko Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">The Firefox Build System</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mach/index.html">Mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/try/index.html">Try Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/moztreedocs/index.html">Managing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing &amp; Test Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../testing/testing-policy/index.html">Testing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web-platform/index.html">web-platform-tests documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sanitizer/index.html">Sanitizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/perfdocs/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/code-coverage/index.html">Code coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing-rust-code/index.html">Testing &amp; Debugging Rust Code</a></li>
</ul>
<p class="caption"><span class="caption-text">Localization &amp; Internationalization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intl/index.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../l10n/index.html">Localization</a></li>
</ul>
<p class="caption"><span class="caption-text">Firefox and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Using third-party Python packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Metrics Collected in Firefox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metrics/index.html#pings">Pings</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Firefox Source Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Firefox DevTools Contributor Docs</a> &raquo;</li>
        
      <li>Remote Debugging Protocol</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/devtools/backend/protocol.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="remote-debugging-protocol">
<h1>Remote Debugging Protocol<a class="headerlink" href="#remote-debugging-protocol" title="Permalink to this headline">¶</a></h1>
<p>The Mozilla debugging protocol allows a debugger to connect to a browser, discover what sorts of things are present to debug or inspect, select JavaScript threads to watch, and observe and modify their execution. The protocol provides a unified view of JavaScript, DOM nodes, CSS rules, and the other technologies used in client-side web applications. The protocol ought to be sufficiently general to be extended for use with other sorts of clients (profilers, say) and servers (mail readers; random XULrunner applications).</p>
<p>All communication between debugger (client) and browser (server) is in the form of JSON objects. This makes the protocol directly readable by humans, capable of graceful evolution, and easy to implement using stock libraries. In particular, it should be easy to create mock implementations for testing and experimentation.</p>
<p>The protocol operates at the JavaScript level, not at the C++ or machine level, and assumes that the JavaScript implementation itself is healthy and responsive. The JavaScript program being executed may well have gone wrong, but the JavaScript implementation’s internal state must not be corrupt. Bugs in the implementation may cause the debugger to fail; bugs in the interpreted program must not.</p>
<div class="section" id="general-conventions">
<h2>General Conventions<a class="headerlink" href="#general-conventions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="actors">
<h3>Actors<a class="headerlink" href="#actors" title="Permalink to this headline">¶</a></h3>
<p>An <strong>actor</strong> is something on the server that can exchange JSON packets with the client. Every packet from the client specifies the actor to which it is directed, and every packet from the server indicates which actor sent it.</p>
<p>Each server has a root actor, with which the client first interacts. The root actor can explain what sort of thing the server represents (browser; mail reader; etc.), and enumerate things available to debug: tabs, chrome, and so on. Each of these, in turn, is represented by an actor to which requests can be addressed. Both artifacts of the program being debugged, like JavaScript objects and stack frames, and artifacts of the debugging machinery, like breakpoints and watchpoints, are actors with whom packets can be exchanged.</p>
<p>For example, a debugger might connect to a browser, ask the root actor to list the browser’s tabs, and present this list to the developer. If the developer chooses some tabs to debug, then the debugger can send <code class="docutils literal notranslate"><span class="pre">attach</span></code> requests to the actors representing those tabs, to begin debugging.</p>
<p>Actor names are JSON strings, containing no spaces or colons. The name of the root actor is <code class="docutils literal notranslate"><span class="pre">&quot;root&quot;</span></code>.</p>
<p>To allow the server to reuse actor names and the resources they require, actors have limited lifetimes. All actors in a server form a tree, whose root is the root actor. Closing communications with an actor automatically closes communications with its descendants. For example, the actors representing a thread’s stack frames are children of the actor representing the thread itself, so that when a debugger detaches from a thread, which closes the thread’s actor, the frames’ actors are automatically closed. This arrangement allows the protocol to mention actors liberally, without making the client responsible for explicitly closing every actor that has ever been mentioned.</p>
<p>When we say that some actor <em>A</em> is a child of some actor <em>B</em>, we mean that <em>A</em> is a direct child of <em>B</em>, not a grandchild, great-grandchild, or the like. Similarly, <strong>parent</strong> means “direct parent”. We use the terms <strong>ancestor</strong> and <strong>descendent</strong> to refer to those looser relationships.</p>
<p>The root actor has no parent, and lives as long as the underlying connection to the client does; when that connection is closed, all actors are closed.</p>
<p>Note that the actor hierarchy does not, in general, correspond to any particular hierarchy appearing in the debuggee. For example, although web workers are arranged in a hierarchy, the actors representing web worker threads are all children of the root actor: one might want to detach from a parent worker while continuing to debug one of its children, so it doesn’t make sense to close communications with a child worker simply because one has closed communications with its parent.</p>
<p><em>(We are stealing the “actor” terminology from Mozilla’s IPDL, to mean, roughly, “things participating in the protocol”. However, IPDL does much more with the idea than we do: it treats both client and server as collections of actors, and uses that detail to statically verify properties of the protocol. In contrast, the debugging protocol simply wants a consistent way to indicate the entities to which packets are directed.)</em></p>
</div>
<div class="section" id="packets">
<h3>Packets<a class="headerlink" href="#packets" title="Permalink to this headline">¶</a></h3>
<p>The protocol is carried by a reliable, bi-directional byte stream; data sent in both directions consists of JSON objects, called packets. A packet is a top-level JSON object, not contained inside any other value.</p>
<p>Every packet sent from the client has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="n">actor</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="nb">type</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">actor</span></code> is the name of the actor to whom the packet is directed and <code class="docutils literal notranslate"><span class="pre">type</span></code> is a string specifying what sort of packet it is. Additional properties may be present, depending on <code class="docutils literal notranslate"><span class="pre">type</span></code>.</p>
<p>Every packet sent from the server has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="n">actor</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">actor</span></code> is the name of the actor that sent it. The packet may have additional properties, depending on the situation.</p>
<p>If a packet is directed to an actor that no longer exists, the server sends a packet to the client of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="n">actor</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;noSuchActor&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">actor</span></code> is the name of the non-existent actor. (It is strange to receive messages from actors that do not exist, but the client evidently believes that actor exists, and this reply allows the client to pair up the error report with the source of the problem.)</p>
<p>Clients should silently ignore packet properties they do not recognize. We expect that, as the protocol evolves, we will specify new properties that can appear in existing packets, and experimental implementations will do the same.</p>
</div>
<div class="section" id="common-patterns-of-actor-communication">
<h3>Common Patterns of Actor Communication<a class="headerlink" href="#common-patterns-of-actor-communication" title="Permalink to this headline">¶</a></h3>
<p>Each type of actor specifies which packets it can receive, which it might send, and when it can do each. Although in principle these interaction rules could be complex, in practice most actors follow one of two simple patterns:</p>
<ul class="simple">
<li><p><strong>Request/Reply</strong>: Each packet sent to the actor (“request”) elicits a single packet in response (“reply”).</p></li>
<li><p><strong>Request/Reply/Notify</strong>: Like Request/Reply, but the actor may send packets that are not in response to any specific request (“notification”), perhaps announcing events that occur spontaneously in the debuggee.</p></li>
</ul>
<p>These patterns are described in more detail below.</p>
<p>Some actors require more complicated rules. For example, the set of packets accepted by a <a class="reference external" href="#interacting-with-thread-like-actors">Thread-like actor</a> depends on which one of four states it occupies. The actor may spontaneously transition from one state to another, and not all state transitions produce notification packets. Actors like this require careful specification.</p>
<div class="section" id="the-request-reply-pattern">
<h4>The Request/Reply Pattern<a class="headerlink" href="#the-request-reply-pattern" title="Permalink to this headline">¶</a></h4>
<p>In this specification, if we call a packet a <strong>request</strong>, then it is a packet sent by the client, which always elicits a single packet from the actor in return, the <strong>reply</strong>. These terms indicate a simple pattern of communication: the actor processes packets in the order they are received, and the client can trust that the <em>i</em>’th reply corresponds to the <em>i</em>’th request.</p>
<p>An <a class="reference external" href="#error-packets">error reply packet</a> from a request/reply actor constitutes a reply.</p>
<p>Note that it is correct for a client to send several requests to a request/reply actor without waiting for a reply to each request before sending the next; requests can be pipelined. However, as the pending requests consume memory, the client should ensure that only a bounded number of requests are outstanding at any one time.</p>
</div>
<div class="section" id="the-request-reply-notify-pattern">
<h4>The Request/Reply/Notify Pattern<a class="headerlink" href="#the-request-reply-notify-pattern" title="Permalink to this headline">¶</a></h4>
<p>Some actors follow the request/reply pattern, but may also send the client <em><strong>notification</strong></em> packets, not in reply to any particular request. For example, if the client sends the root actor a <code class="docutils literal notranslate"><span class="pre">[&quot;listTabs&quot;](#listing-browser-tabs)</span></code> request, then the root actor sends a reply. However, since the client has now expressed an interest in the list of open tabs, the root actor may subsequently send the client a <code class="docutils literal notranslate"><span class="pre">&quot;tabListChanged&quot;</span></code> notification packet, indicating that the client should re-fetch the list of tabs if it is interested in the latest state.</p>
<p>There should be a small upper bound on the number of notification packets any actor may send between packets received from the client, to ensure that the actor does not flood the client. In the example above, the root actor sends at most one <code class="docutils literal notranslate"><span class="pre">&quot;tabListChanged&quot;</span></code> notification after each <code class="docutils literal notranslate"><span class="pre">&quot;listTabs&quot;</span></code> request.</p>
</div>
<div class="section" id="error-packets">
<h4>Error Packets<a class="headerlink" href="#error-packets" title="Permalink to this headline">¶</a></h4>
<p>Any actor can reply to a packet it is unable to process with an <strong>error reply</strong> of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="n">actor</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="n">message</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>name</em> is a JSON string naming what went wrong, and <em>message</em> is an English error message. Error <em>names</em> are specified by the protocol; the client can use the name to identify which error condition arose. The <em>message</em> may vary from implementation to implementation, and should only be displayed to the user as a last resort, as the server lacks enough information about the user interface context to provide appropriate messages.</p>
<p>If an actor receives a packet whose type it does not recognize, it sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="n">actor</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;unrecognizedPacketType&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="n">message</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> provides details to help debugger developers understand what went wrong: what kind of actor actor is; the packet received; and so on.</p>
<p>If an actor receives a packet which is missing needed parameters (say, an <code class="docutils literal notranslate"><span class="pre">&quot;autocomplete&quot;</span></code> packet with no <code class="docutils literal notranslate"><span class="pre">&quot;text&quot;</span></code> parameter), it sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="n">actor</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;missingParameter&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="n">message</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> provides details to help debugger developers fix the problem.</p>
<p>If an actor receives a packet with a parameter whose value is inappropriate for the operation, it sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="n">actor</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;badParameterType&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="n">message</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> provides details to help debugger developers fix the problem. (Some packets’ descriptions specify more specific errors for particular circumstances.)</p>
</div>
</div>
<div class="section" id="grips">
<h3>Grips<a class="headerlink" href="#grips" title="Permalink to this headline">¶</a></h3>
<p>A grip is a JSON value that refers to a specific JavaScript value in the debuggee. Grips appear anywhere an arbitrary value from the debuggee needs to be conveyed to the client: stack frames, object property lists, lexical environments, <code class="docutils literal notranslate"><span class="pre">paused</span></code> packets, and so on.</p>
<p>For mutable values like objects and arrays, grips do not merely convey the value’s current state to the client. They also act as references to the original value, by including an actor to which the client can send messages to modify the value in the debuggee.</p>
<p>A grip has one of the following forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span>
</pre></div>
</div>
<p>where value is a string, a number, or a boolean value. For these types of values, the grip is simply the JSON form of the value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;null&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents the JavaScript <code class="docutils literal notranslate"><span class="pre">null</span></code> value. (The protocol does not represent JavaScript <code class="docutils literal notranslate"><span class="pre">null</span></code> simply by the JSON <code class="docutils literal notranslate"><span class="pre">null</span></code>, for the convenience of clients implemented in JavaScript: this representation allows such clients to use <code class="docutils literal notranslate"><span class="pre">typeof(grip)</span> <span class="pre">==</span> <span class="pre">&quot;object&quot;</span></code> to decide whether the grip is simple or not.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;undefined&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents the JavaScript <code class="docutils literal notranslate"><span class="pre">undefined</span></code> value. (<code class="docutils literal notranslate"><span class="pre">undefined</span></code> has no direct representation in JSON.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;Infinity&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents the JavaScript <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> value. (<code class="docutils literal notranslate"><span class="pre">Infinity</span></code> has no direct representation in JSON.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;-Infinity&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents the JavaScript <code class="docutils literal notranslate"><span class="pre">-Infinity</span></code> value. (<code class="docutils literal notranslate"><span class="pre">-Infinity</span></code> has no direct representation in JSON.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;NaN&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents the JavaScript <code class="docutils literal notranslate"><span class="pre">NaN</span></code> value. (<code class="docutils literal notranslate"><span class="pre">NaN</span></code> has no direct representation in JSON.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;-0&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents the JavaScript <code class="docutils literal notranslate"><span class="pre">-0</span></code> value. (<code class="docutils literal notranslate"><span class="pre">-0</span></code> stringifies to JSON as 0.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="n">className</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="n">actor</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents a JavaScript object whose class is <code class="docutils literal notranslate"><span class="pre">className</span></code>. (Arrays and functions are treated as objects for the sake of forming grips.) Actor can be consulted for the object’s contents, as explained below.</p>
<p>If the class is “Function”, the grip may have additional properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;Function&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="n">actor</span><span class="p">,</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;displayName&quot;</span><span class="p">:</span><span class="n">displayName</span><span class="p">,</span>
  <span class="s2">&quot;userDisplayName&quot;</span><span class="p">:</span><span class="n">userDisplayName</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;column&quot;</span><span class="p">:</span><span class="n">column</span> <span class="p">}</span>
</pre></div>
</div>
<p>These additional properties are:</p>
<p><em><strong>Name</strong></em></p>
<p>The function’s name (as given in the source code, following the <code class="docutils literal notranslate"><span class="pre">function</span></code> keyword), as a string. If the function is anonymous, the <code class="docutils literal notranslate"><span class="pre">name</span></code> property is omitted.</p>
<p><em><strong>displayName</strong></em></p>
<p>A name the system has inferred for the function (say, <code class="docutils literal notranslate"><span class="pre">&quot;Foo.method&quot;</span></code>). If the function has a given name (appearing in the grip as the <code class="docutils literal notranslate"><span class="pre">&quot;name&quot;</span></code> property), or if the system was unable to infer a suitable name for it, the <code class="docutils literal notranslate"><span class="pre">displayName</span></code> property is omitted.</p>
<p><em><strong>userDisplayName</strong></em></p>
<p>If the function object has a <code class="docutils literal notranslate"><span class="pre">&quot;displayName&quot;</span></code> value property whose value is a string, this is that property’s value. (Many JavaScript development tools consult such properties, to give developers a way to provide their own meaningful names for functions.)</p>
<p><em><strong>url</strong></em></p>
<p>The URL of the function’s source location (see <a class="reference external" href="#source-locations">Source Locations</a>);</p>
<p><em><strong>line</strong></em></p>
<p>The line number of the function’s source location (see <a class="reference external" href="#source-locations">Source Locations</a>);</p>
<p><em><strong>column</strong></em></p>
<p>The column number of the function’s source location (see <a class="reference external" href="#source-locations">Source Locations</a>);</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;longString&quot;</span><span class="p">,</span> <span class="s2">&quot;initial&quot;</span><span class="p">:</span><span class="n">initial</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span><span class="n">length</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="n">actor</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents a very long string, where “very long” is defined at the server’s discretion. <code class="docutils literal notranslate"><span class="pre">Initial</span></code> is some initial portion of the string, <code class="docutils literal notranslate"><span class="pre">length</span></code> is the string’s full length, and actor can be consulted for the rest of the string, as explained below.</p>
<p>For example, the following table shows some JavaScript expressions and the grips that would represent them in the protocol:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">JavaScript Expression</th>
<th align="center">Grip</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">42</td>
<td align="center">42</td>
</tr>
<tr>
<td align="center">true</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">"nasu"</td>
<td align="center">"nasu"</td>
</tr>
<tr>
<td align="center">(void 0)</td>
<td align="center"><code>{ "type":"undefined" }</code></td>
</tr>
<tr>
<td align="center">({x:1})</td>
<td align="center"><code>{ "type":"object", "class":"Object", "actor":"24" }</code></td>
</tr>
<tr>
<td align="center">"Arms and the man I sing, who, <em>[much, much more text]</em>"</td>
<td align="center"><code>{ "type":"longString", "initial":"Arms and the man I sing", "length":606647, "actor":"25" }</code></td>
</tr>
</tbody>
</table><p>Garbage collection will never free objects visible to the client via the protocol. Thus, actors representing JavaScript objects are effectively garbage collection roots.</p>
<div class="section" id="objects">
<h4>Objects<a class="headerlink" href="#objects" title="Permalink to this headline">¶</a></h4>
<p>While a thread is paused, the client can send requests to the actors appearing in object grips to examine the objects they represent in more detail.</p>
<div class="section" id="property-descriptors">
<h5>Property Descriptors<a class="headerlink" href="#property-descriptors" title="Permalink to this headline">¶</a></h5>
<p>Protocol requests that describe objects’ properties to the client often use <strong>descriptors</strong>, JSON values modeled after ECMAScript 5’s property descriptors, to describe individual properties.</p>
<p>A descriptor has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">enumerable</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">configurable</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>enumerable</em> and <em>configurable</em> are boolean values indicating whether the property is enumerable and configurable, and additional properties are present depending on what sort of property it is.</p>
<p>A descriptor for a data property has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">enumerable</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">configurable</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;writeable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">writeable</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>value</em> is a grip on the property’s value, and <em>writeable</em> is a boolean value indicating whether the property is writeable.</p>
<p>A descriptor for an accessor property has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">enumerable</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">configurable</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;get&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">getter</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">setter</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>getter</em> and <em>setter</em> are grips on the property’s getter and setter functions. These may be <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;type&quot;:&quot;undefined&quot;</span> <span class="pre">}</span></code> if the property lacks the given accessor function.</p>
<p>A <strong>safe getter value descriptor</strong> provides a value that an inherited accessor returned when applied to an instance. (See <a class="reference external" href="#finding-an-objects-prototype-and-properties">Finding An Object’s Prototype And Properties</a> for an explanation of why and when such descriptors are used.) Such a descriptor has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;getterValue&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;getterPrototypeLevel&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">level</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">enumerable</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;writable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">writable</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>value</em> is a grip on the value the getter returned, <em>level</em> is the number of steps up the object’s prototype chain one must take to find the object on which the getter appears as an own property. If the getter appears directly on the object, <em>level</em> is zero. The <em>writable</em> property is true if the inherited accessor has a setter, and false otherwise.</p>
<p>For example, if the JavaScript program being debugged evaluates the expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="s2">&quot;kaiju&quot;</span><span class="p">,</span> <span class="n">get</span> <span class="n">a</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">42</span><span class="p">;</span> <span class="p">}})</span>
</pre></div>
</div>
<p>then a grip on this value would have the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;Object&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>and sending a <a class="reference external" href="#finding-an-objects-prototype-and-properties">“prototypeAndProperties”</a> request to <em>actor</em> would produce the following reply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;prototype&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;Object&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">objprotoActor</span><span class="o">&gt;</span> <span class="p">},</span>
  <span class="s2">&quot;ownProperties&quot;</span><span class="p">:{</span> <span class="s2">&quot;x&quot;</span><span class="p">:{</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;writeable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mi">10</span> <span class="p">},</span>
                    <span class="s2">&quot;y&quot;</span><span class="p">:{</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;writeable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;kaiju&quot;</span> <span class="p">},</span>
                    <span class="s2">&quot;a&quot;</span><span class="p">:{</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
                          <span class="s2">&quot;get&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;Function&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">getterActor</span><span class="o">&gt;</span> <span class="p">},</span>
                          <span class="s2">&quot;set&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;undefined&quot;</span> <span class="p">}</span>
                        <span class="p">}</span>
                   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sending a <a class="reference external" href="#finding-an-objects-prototype-and-properties">“prototypeAndProperties”</a> request to an object actor referring to a DOM mouse event might produce the following reply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">mouseEventActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;prototype&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;MouseEvent&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">mouseEventProtoActor</span><span class="o">&gt;</span> <span class="p">},</span>
  <span class="s2">&quot;ownProperties&quot;</span><span class="p">:{</span> <span class="p">}</span>
  <span class="s2">&quot;safeGetterValues&quot;</span><span class="p">:{</span> <span class="s2">&quot;screenX&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;getterValue&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;getterPrototypeLevel&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;writable&quot;</span><span class="p">:</span> <span class="n">false</span> <span class="p">},</span>
                       <span class="s2">&quot;screenY&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;getterValue&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;getterPrototypeLevel&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;writable&quot;</span><span class="p">:</span> <span class="n">false</span> <span class="p">},</span>
                       <span class="s2">&quot;clientX&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;getterValue&quot;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span>  <span class="s2">&quot;getterPrototypeLevel&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;writable&quot;</span><span class="p">:</span> <span class="n">false</span> <span class="p">},</span>
                       <span class="s2">&quot;clientY&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;getterValue&quot;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span>  <span class="s2">&quot;getterPrototypeLevel&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;writable&quot;</span><span class="p">:</span> <span class="n">false</span> <span class="p">},</span>
                       <span class="o">...</span>
                     <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-an-object-s-prototype-and-properties">
<h5>Finding An Object’s Prototype And Properties<a class="headerlink" href="#finding-an-object-s-prototype-and-properties" title="Permalink to this headline">¶</a></h5>
<p>To examine an object’s prototype and properties, a client can send the object’s grip’s actor a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;prototypeAndProperties&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>to which the grip actor replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;prototype&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">prototype</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;ownProperties&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">ownProperties</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>prototype</em> is a grip on the object’s prototype (possibly <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;type&quot;:&quot;null&quot;</span> <span class="pre">}</span></code>), and <em>ownProperties</em> has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">name</span><span class="p">:</span><span class="o">&lt;</span><span class="n">descriptor</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>with a <em>name</em>:<descriptor> pair for each of the object’s own properties.</p>
<p>The web makes extensive use of inherited accessor properties; for example, the <code class="docutils literal notranslate"><span class="pre">clientX</span></code> and <code class="docutils literal notranslate"><span class="pre">clientY</span></code>&gt; properties of a mouse click event are actually accessor properties which the event object inherits from its prototype chain. It can be very valuable to display such properties’ values directly on the object (taking care to distinguish them from true “own” properties), if the server can determine that the getters can be called without side effects.</p>
<p>To this end, when possible, the server may provide safe getter value descriptors for an object, as described in <a class="reference external" href="#property-descriptors">Property Descriptors</a> above, reporting the values that getter functions found on the object’s prototype chain return when applied to that object. If the server chooses to provide any, the reply includes a <code class="docutils literal notranslate"><span class="pre">&quot;safeGetterValues&quot;</span></code> property of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">name</span><span class="p">:</span><span class="o">&lt;</span><span class="n">descriptor</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>with a <em>name</em>:<descriptor> pair for each safe getter the object inherits from its prototype chain, or that appears directly on the object. Each <em>descriptor</em> here is a safe getter value descriptor.</p>
<p><em>TODO: What about objects with many properties?</em></p>
</div>
<div class="section" id="finding-an-object-s-prototype">
<h5>Finding an Object’s Prototype<a class="headerlink" href="#finding-an-object-s-prototype" title="Permalink to this headline">¶</a></h5>
<p>To find an object’s prototype, a client can send the object’s grip’s actor a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;prototype&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>to which the grip actor replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;prototype&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">prototype</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>prototype</em> is a grip on the object’s prototype (possibly <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;type&quot;:&quot;null&quot;</span> <span class="pre">}</span></code>).</p>
</div>
<div class="section" id="listing-an-object-s-own-properties-names">
<h5>Listing an Object’s Own Properties’ Names<a class="headerlink" href="#listing-an-object-s-own-properties-names" title="Permalink to this headline">¶</a></h5>
<p>To list an object’s own properties’ names, a client can send the object’s grip’s actor a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;ownPropertyNames&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>to which the grip actor replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;ownPropertyNames&quot;</span><span class="p">:[</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>where each <em>name</em> is a string naming an own property of the object.</p>
</div>
<div class="section" id="finding-descriptors-for-single-properties">
<h5>Finding Descriptors For Single Properties<a class="headerlink" href="#finding-descriptors-for-single-properties" title="Permalink to this headline">¶</a></h5>
<p>To obtain a descriptor for a particular property of an object, a client can send the object’s grip’s actor a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;property&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>to which the grip actor replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;descriptor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">descriptor</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>descriptor</em> is a descriptor for the own property of the object named <em>name</em>, or <code class="docutils literal notranslate"><span class="pre">null</span></code> if the object has no such own property.</p>
<p>A property descriptor has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">configurable</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">enumerable</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>configurable</em> and <em>enumerable</em> are boolean values. <em>Configurable</em> is true if the property can be deleted or have its attributes changed. <em>Enumerable</em> is true if the property will be enumerated by a <code class="docutils literal notranslate"><span class="pre">for-in</span></code> enumeration.</p>
<p>Descriptors for value properties have the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">configurable</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">enumerable</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;writable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">writable</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>writable</em> is <code class="docutils literal notranslate"><span class="pre">true</span></code> if the property’s value can be written to; <em>value</em> is a grip on the property’s value; and <em>configurable</em> and <em>enumerable</em> are as described above.</p>
<p>Descriptors for accessor properties have the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">configurable</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">enumerable</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;get&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">get</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">set</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>get</em> and <em>set</em> are grips on the property’s getter and setter functions; either or both are omitted if the property lacks the given accessor function. <em>Configurable</em> and <em>enumerable</em> are as described above.</p>
<p><em>TODO: assign to value property</em></p>
<p><em>TODO: special stuff for arrays</em></p>
<p><em>TODO: special stuff for functions</em></p>
<p><em>TODO: find function’s source position</em></p>
<p><em>TODO: get function’s named arguments, in order</em></p>
<p><em>TODO: descriptors for Harmony proxies</em></p>
</div>
<div class="section" id="functions">
<h5>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h5>
<p>If an object’s class as given in the grip is <code class="docutils literal notranslate"><span class="pre">&quot;Function&quot;</span></code>, then the grip’s actor responds to the messages given here.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">functionGripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;parameterNames&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This requests the names of the parameters of the function represented by <em>functionGripActor</em>. The reply has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">functionGripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;parameterNames&quot;</span><span class="p">:[</span> <span class="o">&lt;</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>where each <em>parameter</em> is the name of a formal parameter to the function as a string. If the function takes destructuring arguments, then <em>parameter</em> is a structure of JSON array and object forms matching the form of the destructuring arguments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">functionGripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;scope&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Return the lexical environment over which the function has closed. The reply has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">functionGripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">environment</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>environment</em> is a <a class="reference external" href="#lexical-environments">lexical environment</a>. Note that the server only returns environments of functions in a context being debugged; if the function’s global scope is not the browsing context to which we are attached, the function grip actor sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">functionGripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;notDebuggee&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> is text explaining the problem.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">functionGripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;decompile&quot;</span><span class="p">,</span> <span class="s2">&quot;pretty&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pretty</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Return JavaScript source code for a function equivalent to the one represented by <em>functionGripActor</em>. If the optional <code class="docutils literal notranslate"><span class="pre">pretty</span></code> parameter is present and <em>pretty</em> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, then produce indented source code with line breaks. The reply has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">functionGripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;decompiledCode&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>code</em> is a string.</p>
<p>If <em>functionGripActor</em>’s referent is not a function, or is a function proxy, the actor responds to these requests with an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">functionGripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;objectNotFunction&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> is a string containing any additional information that would be helpful to debugger developers.</p>
</div>
</div>
<div class="section" id="long-strings">
<h4>Long Strings<a class="headerlink" href="#long-strings" title="Permalink to this headline">¶</a></h4>
<p>The client can find the full contents of a long string by sending a request to the long string grip actor of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;substring&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">start</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">end</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>start</em> and <em>end</em> are integers. This requests the substring starting at the <em>start</em>’th character, and ending before the <em>end</em>’th character. The actor replies as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;substring&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>string</em> is the requested portion of the string the actor represents. Values for <em>start</em> less than zero are treated as zero; values greater than the length of the string are treated as the length of the string. Values for <em>end</em> are treated similarly. If <em>end</em> is less than <em>start</em>, the two values are swapped. (This is meant to be the same behavior as JavaScript’s <code class="docutils literal notranslate"><span class="pre">String.prototype.substring</span></code>.)</p>
<p>As with any other actor, the client may only send messages to a long string grip actor while it is alive: for <a class="reference external" href="#grip-lifetimes">pause-lifetime grips</a>, until the debuggee is resumed; or for <a class="reference external" href="#grip-lifetimes">thread-lifetime grips</a>, until the thread is detached from or exits. However, unlike object grip actors, the client may communicate with a long string grip actor at any time the actor is alive, regardless of whether the debuggee is paused. (Since strings are immutable values in JavaScript, the responses from a long string grip actor cannot depend on the actions of the debuggee.)</p>
</div>
<div class="section" id="grip-lifetimes">
<h4>Grip Lifetimes<a class="headerlink" href="#grip-lifetimes" title="Permalink to this headline">¶</a></h4>
<p>Most grips are <strong>pause-lifetime</strong> grips: they last only while the JavaScript thread is paused, and become invalid as soon as the debugger allows the thread to resume execution. (The actors in pause-lifetime grips are children of an actor that is closed when the thread resumes, or is detached from.) This arrangement allows the protocol to use grips freely in responses without requiring the client to remember and close them all.</p>
<p>However, in some cases the client may wish to retain a reference to an object or long string while the debuggee runs. For example, a panel displaying objects selected by the user must update its view of the objects each time the debuggee pauses. To carry this out, the client can promote a pause-lifetime grip to a <strong>thread-lifetime</strong> grip, which lasts until the thread is detached from or exits. Actors in thread-lifetime grips are children of the thread actor. When the client no longer needs a thread-lifetime grip, it can explicitly release it.</p>
<p>Both pause-lifetime and thread-lifetime grips are garbage collection roots.</p>
<p>To promote a pause-lifetime grip to a thread-lifetime grip, the client sends a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;threadGrip&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>gripActor</em> is the actor from the existing pause-lifetime grip. The grip actor will reply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;threadGrip&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">threadGrip</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>threadGrip</em> is a new grip on the same object, but whose actor is parented by the thread actor, not the pause actor.</p>
<p>The client can release a thread-lifetime grip by sending the grip actor a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;release&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The grip actor will reply, simply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This closes the grip actor. The <code class="docutils literal notranslate"><span class="pre">&quot;release&quot;</span></code> packet may only be sent to thread-lifetime grip actors; if a pause-lifetime grip actor receives a <code class="docutils literal notranslate"><span class="pre">&quot;release&quot;</span></code> packet, it sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gripActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;notReleasable&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where each <em>gripActor</em> is the name of a child of <em>thread</em> that should be freed. The thread actor will reply, simply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Regardless of the lifetime of a grip, the client may only send messages to object grip actors while the thread to which they belong is paused; the client’s interaction with mutable values cannot take place concurrently with the thread.</p>
</div>
</div>
<div class="section" id="completion-values">
<h3>Completion Values<a class="headerlink" href="#completion-values" title="Permalink to this headline">¶</a></h3>
<p>Some packets describe the way a stack frame’s execution completed using a <strong>completion value</strong>, which takes one of the following forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;return&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">grip</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the frame completed normally, returning the value given by <em>grip</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;throw&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">grip</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the frame threw an exception; <em>grip</em> is the exception value thrown.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;terminated&quot;</span><span class="p">:</span><span class="n">true</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the frame’s execution was terminated, as by a “slow script” dialog box or running out of memory.</p>
</div>
<div class="section" id="source-locations">
<h3>Source Locations<a class="headerlink" href="#source-locations" title="Permalink to this headline">¶</a></h3>
<p>Many packets refer to particular locations in source code: breakpoint requests specify where the breakpoint should be set; stack frames show the current point of execution; and so on.</p>
<p>Descriptions of source code locations (written as <em>location</em> in packet descriptions) can take one of the following forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">line</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;column&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">column</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This refers to line <em>line</em>, column <em>column</em> of the source code loaded from <em>url</em>. Line and column numbers start with 1. If <em>column</em> or <em>line</em> are omitted, they default to 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;eval&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">line</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;column&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">column</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This refers to line <em>line</em>, column <em>column</em> of the source code passed to the call to eval at <em>location</em>. To distinguish the different texts passed to eval, each is assigned a unique integer, <em>id</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">line</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;column&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">column</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This refers to line <em>line</em>, column <em>column</em> of the source code passed to the call to the <code class="docutils literal notranslate"><span class="pre">Function</span></code> constructor at <em>location</em>. To distinguish the different texts passed to the <code class="docutils literal notranslate"><span class="pre">Function</span></code> constructor, each is assigned a unique integer, <em>id</em>.</p>
<p>As indicated, locations can be nested. A location like this one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;eval&quot;</span><span class="p">:{</span> <span class="s2">&quot;eval&quot;</span><span class="p">:{</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;file:///home/example/sample.js&quot;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span><span class="mi">20</span> <span class="p">}</span>
           <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span><span class="mi">30</span> <span class="p">}</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span><span class="mi">40</span> <span class="p">}</span>
</pre></div>
</div>
<p>refers to line 40 of the code passed to the call to eval occurring on line 30 of the code passed to the call to eval on line 20 of <code class="docutils literal notranslate"><span class="pre">file:///home/example/sample.js</span></code>.</p>
</div>
</div>
<div class="section" id="the-root-actor">
<h2>The Root Actor<a class="headerlink" href="#the-root-actor" title="Permalink to this headline">¶</a></h2>
<p>When the connection to the server is opened, the root actor opens the conversation with the following packet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="s2">&quot;applicationType&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">appType</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;traits&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">traits</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<p>The root actor’s name is always <code class="docutils literal notranslate"><span class="pre">&quot;root&quot;</span></code>. <em>appType</em> is a string indicating what sort of program the server represents. There may be more properties present, depending on <em>appType</em>.</p>
<p><em>traits</em> is an object describing protocol variants this server supports that are not convenient for the client to detect otherwise. The property names present indicate what traits the server has; the properties’ values depend on their names. If <em>traits</em> would have no properties, the <code class="docutils literal notranslate"><span class="pre">&quot;traits&quot;</span></code> property of the packet may be omitted altogether. This version of the protocol defines no traits, so if the <code class="docutils literal notranslate"><span class="pre">&quot;traits&quot;</span></code> property is present at all, its value must be an object with no properties, <code class="docutils literal notranslate"><span class="pre">{}</span></code>.</p>
<p>For web browsers, the introductory packet should have the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="s2">&quot;applicationType&quot;</span><span class="p">:</span><span class="s2">&quot;browser&quot;</span><span class="p">,</span> <span class="s2">&quot;traits&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">traits</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<div class="section" id="listing-browser-tabs">
<h3>Listing Browser Tabs<a class="headerlink" href="#listing-browser-tabs" title="Permalink to this headline">¶</a></h3>
<p>To get a list of the tabs currently present in a browser, a client sends the root actor a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;listTabs&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The root actor replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="s2">&quot;tabs&quot;</span><span class="p">:[</span><span class="o">&lt;</span><span class="n">tab</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="s2">&quot;selected&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">selected</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where each <em>tab</em> describes a single open tab, and <em>selected</em> is the index in the array of tabs of the currently selected tab. This form may have other properties describing other global actors; for one example, see <a class="reference external" href="#chrome-debugging">Chrome Debugging</a>.</p>
<p>Each <em>tab</em> has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">URL</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>targetActor</em> is the name of an actor representing the tab, and <em>title</em> and <em>URL</em> are the title and URL of the web page currently visible in that tab. This form may have other properties describing other tab-specific actors.</p>
<p>To attach to a <em>targetActor</em>, a client sends a message of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;attach&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The target actor replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;threadActor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tabThreadActor</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>tabThreadActor</em> is the name of a thread-like actor representing the tab’s current content. If the user navigates the tab, <em>tabThreadActor</em> switches to the new content; we do not create a separate thread-like actor each page the tab visits.</p>
<p>If the user closes the tab before the client attaches to it, <em>targetActor</em> replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;exited&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>When the client is no longer interested in interacting with the tab, the client can request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;detach&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <em>targetActor</em> replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;detached&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>If the client was not already attached to <em>targetActor</em>, <em>targetActor</em> sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;wrongState&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>While the client is attached, <em>targetActor</em> sends notifications to the client whenever the user navigates the tab to a new page. When navigation begins, <em>targetActor</em> sends a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;tabNavigated&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">:</span><span class="s2">&quot;start&quot;</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">newURL</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the tab has begun navigating to <em>newURL</em>; JavaScript execution in the tab’s prior page is suspended. When navigation is complete, <em>targetActor</em> sends a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;tabNavigated&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">:</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">newURL</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">newTitle</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>newURL</em> and <em>newTitle</em> are the URL and title of the page the tab is now showing. The <em>tabThreadActor</em> given in the response to the original <code class="docutils literal notranslate"><span class="pre">&quot;attach&quot;</span></code> packet is now debugging the new page’s code.</p>
<p>If the user closes a tab to which the client is attached, its <em>targetActor</em> sends a notification packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">targetActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;tabDetached&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The client is now detached from the tab.</p>
</div>
<div class="section" id="chrome-debugging">
<h3>Chrome Debugging<a class="headerlink" href="#chrome-debugging" title="Permalink to this headline">¶</a></h3>
<p>If the server supports debugging chrome code, the root actor’s reply to a <code class="docutils literal notranslate"><span class="pre">&quot;listTabs&quot;</span></code> request includes a property named <code class="docutils literal notranslate"><span class="pre">&quot;chromeDebugger&quot;</span></code>, whose value is the name of a thread-like actor to which the client can attach to debug chrome code.</p>
</div>
</div>
<div class="section" id="interacting-with-thread-like-actors">
<h2>Interacting with Thread-Like Actors<a class="headerlink" href="#interacting-with-thread-like-actors" title="Permalink to this headline">¶</a></h2>
<p>Actors representing independent threads of JavaScript execution, like browsing contexts and web workers, are collectively known as “threads”. Interactions with actors representing threads follow a more complicated communication pattern.</p>
<p>A thread is always in one of the following states:</p>
<ul class="simple">
<li><p><strong>Detached</strong>: the thread is running freely, and not presently interacting with the debugger. Detached threads run, encounter errors, and exit without exchanging any sort of messages with the debugger. A debugger can attach to a thread, putting it in the <strong>Paused</strong> state. Or, a detached thread may exit on its own, entering the <strong>Exited</strong> state.</p></li>
<li><p><strong>Running</strong>: the thread is running under the debugger’s observation, executing JavaScript code or possibly blocked waiting for input. It will report exceptions, breakpoint hits, watchpoint hits, and other interesting events to the client, and enter the <strong>Paused</strong> state. The debugger can also interrupt a running thread; this elicits a response and puts the thread in the <strong>Paused</strong> state. A running thread may also exit, entering the <strong>Exited</strong> state.</p></li>
<li><p><strong>Paused</strong>: the thread has reported a pause to the client and is awaiting further instructions. In this state, a thread can accept requests and send replies. If the client asks the thread to continue or step, it returns to the <strong>Running</strong> state. If the client detaches from the thread, it returns to the <strong>Detached</strong> state.</p></li>
<li><p><strong>Exited</strong>: the thread has ceased execution, and will disappear. The resources of the underlying thread may have been freed; this state merely indicates that the actor’s name is not yet available for reuse. When the actor receives a “release” packet, the name may be reused.</p></li>
</ul>
<p><img alt="Thread states" src="../../_images/thread-states.png" /></p>
<p>These interactions are meant to have certain properties:</p>
<ul class="simple">
<li><p>At no point may either client or server send an unbounded number of packets without receiving a packet from its counterpart. This avoids deadlock without requiring either side to buffer an arbitrary number of packets per actor.</p></li>
<li><p>In states where a transition can be initiated by either the debugger or the thread, it is always clear to the debugger which state the thread actually entered, and for what reason.<br>For example, if the debugger interrupts a running thread, it cannot be sure whether the thread stopped because of the interruption, paused of its own accord (to report a watchpoint hit, say), or exited. However, the next packet the debugger receives will either be “paused”, or “exited”, resolving the ambiguity.<br>Similarly, when the debugger attaches to a thread, it cannot be sure whether it has succeeded in attaching to the thread, or whether the thread exited before the “attach” packet arrived. However, in either case the debugger can expect a disambiguating response: if the attach succeeded, it receives an “attached” packet; and in the second case, it receives an “exit” packet.<br>To support this property, the thread ignores certain debugger packets in some states (the “interrupt” packet in the <strong>Paused</strong> and <strong>Exited</strong> states, for example). These cases all handle situations where the ignored packet was preempted by some thread action.</p></li>
</ul>
<p>Note that the rules here apply to the client’s interactions with each thread actor separately. A client may send an “interrupt” to one thread actor while awaiting a reply to a request sent to a different thread actor.</p>
<p><em>TODO: What about user selecting nodes in displayed content? Should those be eventy things the client can receive in the “paused” state? What does that mean for the “request”/”reply” pattern?</em></p>
<div class="section" id="attaching-to-a-thread">
<h3>Attaching To a Thread<a class="headerlink" href="#attaching-to-a-thread" title="Permalink to this headline">¶</a></h3>
<p>To attach to a thread, the client sends a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;attach&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Here, <em>thread</em> is the actor representing the thread, perhaps a browsing context from a “listContexts” reply. This packet causes the thread to pause its execution, if it does not exit of its own accord first. The thread responds in one of two ways:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;paused&quot;</span><span class="p">,</span> <span class="s2">&quot;why&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;attached&quot;</span> <span class="p">},</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread is now in the <strong>Paused</strong> state, because the client has attached to it. The actor name <em>thread</em> remains valid until the client detaches from the thread or acknowledges a thread exit. This is an ordinary <code class="docutils literal notranslate"><span class="pre">&quot;paused&quot;</span></code> packet, whose form and additional properties are as described in <a class="reference external" href="#thread-pauses">Thread Pauses</a>, below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;exited&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the thread exited on its own before receiving the “attach” packet. The thread is now in the <strong>Exited</strong> state. The client should follow by sending a “release” packet; see <a class="reference external" href="#exiting-threads">Exiting Threads</a>, below.</p>
<p>If the client sends an <code class="docutils literal notranslate"><span class="pre">&quot;attach&quot;</span></code> packet to a thread that is not in the <strong>Detached</strong> or <strong>Exited</strong> state, the actor sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;wrongState&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> details which state the thread was in instead (to make debugging debuggers easier). In this case, the thread’s state is unaffected.</p>
</div>
<div class="section" id="detaching-from-a-thread">
<h3>Detaching From a Thread<a class="headerlink" href="#detaching-from-a-thread" title="Permalink to this headline">¶</a></h3>
<p>To detach from a thread, the client sends a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;detach&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread responds in one of three ways:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;detached&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the client has detached from the thread. The thread is now in the <strong>Detached</strong> state: it can run freely, and no longer reports events to the client. Communications with <em>thread</em> are closed, and the actor name is available for reuse. If the thread had been in the <strong>Paused</strong> state, the pause actor is closed (because the pause actor is a child of <em>thread</em>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;paused&quot;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;detached&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This series of packets indicates that the thread paused of its own accord (for the reason given by the additional properties of the “paused” packet), and only then received the “detach” packet. As above, this indicates that the thread is in the <strong>Detached</strong> state, the just-created pause actor is closed, and the actor name is available for reuse.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;exited&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the thread exited on its own before receiving the “detach” packet. The client should follow by sending a “release” packet; see <a class="reference external" href="#exiting-threads">Exiting Threads</a>, below.</p>
<p>Detaching from a thread causes all breakpoints, watchpoints, and other debugging-related state to be forgotten.</p>
<p>If the client sends a <code class="docutils literal notranslate"><span class="pre">&quot;detach&quot;</span></code> packet to a thread that is not in the <strong>Running</strong>, <strong>Paused</strong>, or <strong>Exited</strong> state, the actor sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;wrongState&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> details which state the thread was in instead (to make debugging debuggers easier). In this case, the thread’s state is unaffected.</p>
</div>
<div class="section" id="running-threads">
<h3>Running Threads<a class="headerlink" href="#running-threads" title="Permalink to this headline">¶</a></h3>
<p>Once the client has attached to a thread, it is in the <strong>Running</strong> state. In this state, four things can happen:</p>
<ul class="simple">
<li><p>The thread can hit a breakpoint or watchpoint, or encounter some other condition of interest to the client.</p></li>
<li><p>The thread can exit.</p></li>
<li><p>The client can detach from the thread.</p></li>
<li><p>The client can interrupt the running thread.</p></li>
</ul>
<p>Note that a client action can occur simultaneously with a thread action. The protocol is designed to avoid ambiguities when both client and thread act simultaneously.</p>
</div>
<div class="section" id="thread-pauses">
<h3>Thread Pauses<a class="headerlink" href="#thread-pauses" title="Permalink to this headline">¶</a></h3>
<p>If the thread pauses to report an interesting event to the client, it sends a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;paused&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pauseActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;why&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">reason</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;currentFrame&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">frame</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;poppedFrames&quot;</span><span class="p">:[</span><span class="o">&lt;</span><span class="n">poppedFrame</span><span class="o">&gt;...</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the thread has entered the <strong>Paused</strong> state, and explains where and why.</p>
<p><em>PauseActor</em> is a “pause actor”, representing this specific pause of the thread; it lives until the thread next leaves the <strong>Paused</strong> state. The pause actor parents actors referring to values and other entities uncovered during this pause; when the thread resumes, those actors are automatically closed. This relieves the client from the responsibility to explicitly close every actor mentioned during the pause.</p>
<p>Since actors in value grips are parented by the pause actor, this means that those grips become invalid when the thread resumes, or is detached from; it is not possible to take a grip from one pause and use it in the next. To create a grip that remains valid between pauses, see <a class="reference external" href="#grip-lifetimes">Grip Lifetimes</a>.</p>
<p>The <em>currentFrame</em> value describes the top frame on the JavaScript stack; see <a class="reference external" href="#listing-stack-frames">Listing Stack Frames</a>, below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;poppedFrames&quot;</span></code> property is an array of frame actor names, listing the actors for all frames that were live as of the last pause, but have since been popped. If no frames have been popped, or if this is the first pause for this thread, then this property’s value is the empty array.</p>
<p>The <em>reason</em> value describes why the thread paused. It has one of the following forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;attached&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread paused because the client attached to it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;interrupted&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread stopped because it received an “interrupt” packet from the client.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;resumeLimit&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The client resumed the thread with a <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> packet that included a <code class="docutils literal notranslate"><span class="pre">resumeLimit</span></code> property, and the thread paused because the given <em>limit</em> was met. Execution remains in the frame the thread was resumed in, and that frame is not about to be popped.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;resumeLimit&quot;</span><span class="p">,</span> <span class="s2">&quot;frameFinished&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">completion</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The client resumed the thread with a <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> packet that included a <code class="docutils literal notranslate"><span class="pre">resumeLimit</span></code> property, and the thread paused because the frame is about to be popped. <em>Completion</em> is a <a class="reference external" href="#completion-values">completion value</a> describing how the frame’s execution ended. The frame being popped is still the top frame on the stack, but subsequent <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> operations will run in the calling frame.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;debuggerStatement&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread stopped because it executed a JavaScript “debugger” statement.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;breakpoint&quot;</span><span class="p">,</span> <span class="s2">&quot;actors&quot;</span><span class="p">:[</span><span class="o">&lt;</span><span class="n">breakpointActor</span><span class="o">&gt;...</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread stopped at the breakpoints represented by the given actors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;watchpoint&quot;</span><span class="p">,</span> <span class="s2">&quot;actors&quot;</span><span class="p">:[</span><span class="o">&lt;</span><span class="n">watchpointActor</span><span class="o">&gt;...</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread stopped at the watchpoints represented by the given actors.</p>
<p><em>TODO: This should provide more details about the watchpoint in the packet, instead of incurring another round-trip before we can display anything helpful.</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;clientEvaluated&quot;</span><span class="p">,</span> <span class="s2">&quot;frameFinished&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">completion</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The expression given in the client’s prior <code class="docutils literal notranslate"><span class="pre">clientEvaluate</span></code> command has completed execution; <em>completion</em> is a <a class="reference external" href="#completion-values">completion value</a> describing how it completed. The frame created for the <code class="docutils literal notranslate"><span class="pre">clientEvaluate</span></code> resumption has been popped from the stack. See <a class="reference external" href="#evaluating-source-language-expressions">Evaluating Source-Language Expressions</a> for details.</p>
</div>
<div class="section" id="resuming-a-thread">
<h3>Resuming a Thread<a class="headerlink" href="#resuming-a-thread" title="Permalink to this headline">¶</a></h3>
<p>If a thread is in the <strong>Paused</strong> state, the client can resume it by sending a packet of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;resume&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This puts the thread in the <strong>Running</strong> state. The thread will pause again for breakpoint hits, watchpoint hits, throw watches, frame pop watches, and other standing pause requests.</p>
<p>To step a thread’s execution, the client can send a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;resume&quot;</span><span class="p">,</span> <span class="s2">&quot;resumeLimit&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">limit</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p><em>Limit</em> must have one of the following forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;next&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread should pause:</p>
<ul class="simple">
<li><p>just before the current frame is popped, whether by throwing an exception or returning a value; or</p></li>
<li><p>when control in the current frame reaches a different statement than the one it is currently at.</p></li>
</ul>
<p>Note that execution in frames younger than the current frame never meets these conditions, so a <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code> limit steps over calls, generator-iterator invocations, and so on.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;step&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread should pause:</p>
<ul class="simple">
<li><p>just before the current frame is popped, whether by throwing an exception or returning a value; or</p></li>
<li><p>just after a new frame is pushed; or</p></li>
<li><p>when control in the current frame reaches a different statement than the one it is currently at.</p></li>
</ul>
<p>This is the same as <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code>, except that it steps into calls.</p>
<p>To resume the thread but have it stop when the current frame is about to be popped, the client can send a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;resume&quot;</span><span class="p">,</span> <span class="s2">&quot;resumeLimit&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;finish&quot;</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>Here, the thread should pause just before the current frame is popped, whether by throwing an exception, returning a value, or being terminated.</p>
<p>When a thread pauses because a limit was reached, the “paused” packet’s <em>reason</em> will have a type of <code class="docutils literal notranslate"><span class="pre">&quot;resumeLimit&quot;</span></code>.</p>
<p>A resume limit applies only to the current resumption; once the thread pauses, whether because the limit was reached or some other event occurred—a breakpoint hit, for example—the resume limit is no longer in effect.</p>
<p>If no <code class="docutils literal notranslate"><span class="pre">&quot;resumeLimit&quot;</span></code> property appears in the <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> packet, then the thread should run until some standing pause condition is met (a breakpoint is hit; a watchpoint triggers; or the like).</p>
<p>To force the current frame to end execution immediately, the client can send a packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;resume&quot;</span><span class="p">,</span> <span class="s2">&quot;forceCompletion&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">completion</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>completion</em> is a <a class="reference external" href="#completion-values">completion value</a> indicating whether the frame should return a value, throw an exception, or be terminated. Execution resumes in the current frame’s caller, in the manner appropriate for <em>completion</em>.</p>
<p>To request that execution pause when an exception is thrown, the client may send a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;resume&quot;</span><span class="p">,</span> <span class="s2">&quot;pauseOnExceptions&quot;</span><span class="p">:</span> <span class="n">true</span> <span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">pauseOnExceptions</span></code> has the value <code class="docutils literal notranslate"><span class="pre">false</span></code> or is omitted, execution will continue in the face of thrown exceptions. When a thread pauses because an exception was thrown, the “paused” packet’s <em>reason</em> will have the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;exception&quot;</span><span class="p">,</span> <span class="s2">&quot;exception&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">exception</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>exception</em> is a grip on the exception object.</p>
<p>To request that execution pause on a DOM event, the client may send a request of the form:</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">&quot;forceCompletion&quot;</span></code> property is present in a <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> packet, along with <code class="docutils literal notranslate"><span class="pre">&quot;resumeLimit&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;pauseOnExceptions&quot;</span></code>, the thread will respond with an error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;badParameterType&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> packet closes the pause actor the client provided in the “paused” packet that began the pause.</p>
<p>If the client sends a <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> packet to a thread that is not in the <strong>Paused</strong> state, the actor sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;wrongState&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> details which state the thread was in instead (to make debugging debuggers easier). In this case, the thread’s state is unaffected.</p>
</div>
<div class="section" id="interrupting-a-thread">
<h3>Interrupting a Thread<a class="headerlink" href="#interrupting-a-thread" title="Permalink to this headline">¶</a></h3>
<p>If a thread is in the <strong>Running</strong> state, the client can cause it to pause where it is by sending a packet of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;interrupt&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread responds in one of two ways:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;paused&quot;</span><span class="p">,</span> <span class="s2">&quot;why&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">reason</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the thread stopped, and is now in the <strong>Paused</strong> state. If <em>reason</em> is <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;type&quot;:&quot;interrupted&quot;</span> <span class="pre">}</span></code>, then the thread paused due to the client’s <em>interrupt</em> packet. Otherwise, the thread paused of its own accord before receiving the <em>interrupt</em> packet, and will ignore the <em>interrupt</em> packet when it receives it. In either case, this is an ordinary <code class="docutils literal notranslate"><span class="pre">&quot;paused&quot;</span></code> packet, whose form and additional properties are as described in <a class="reference external" href="#thread-pauses">Thread Pauses</a>, above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;exited&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This indicates that the thread exited before receiving the client’s <em>interrupt</em> packet, and is now in the <strong>Exited</strong> state. See <a class="reference external" href="#exiting-threads">Exiting Threads</a>, below.</p>
<p>If the client sends an <code class="docutils literal notranslate"><span class="pre">&quot;interrupt&quot;</span></code> packet to a thread that is not in the <strong>Running</strong>, <strong>Paused</strong>, or <strong>Exited</strong> state, the actor sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;wrongState&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> details which state the thread was in instead (to make debugging debuggers easier). In this case, the thread’s state is unaffected.</p>
</div>
<div class="section" id="exiting-threads">
<h3>Exiting Threads<a class="headerlink" href="#exiting-threads" title="Permalink to this headline">¶</a></h3>
<p>When a thread in the <strong>Running</strong> state exits, it sends a packet of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;exited&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>At this point, the thread can no longer be manipulated by the client, and most of the thread’s resources may be freed; however, the thread actor name must remain alive, to handle stray <code class="docutils literal notranslate"><span class="pre">interrupt</span></code> and <code class="docutils literal notranslate"><span class="pre">detach</span></code> packets. To allow the last trace of the thread to be freed, the client should send a packet of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;release&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This acknowledges the exit and allows the thread actor name, <em>thread</em>, to be reused for other actors.</p>
</div>
</div>
<div class="section" id="inspecting-paused-threads">
<h2>Inspecting Paused Threads<a class="headerlink" href="#inspecting-paused-threads" title="Permalink to this headline">¶</a></h2>
<p>When a thread is in the <strong>Paused</strong> state, the debugger can make requests to inspect its stack, lexical environment, and values.</p>
<p>Only those packets explicitly defined to do so can cause the thread to resume execution. JavaScript features like getters, setters, and proxies, which could normally lead inspection operations like enumerating properties and examining their values to run arbitrary JavaScript code, are disabled while the thread is paused. If a given protocol request is not defined to let the thread run, but carrying out the requested operation would normally cause it to do so—say, fetching the value of a getter property—the actor sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;threadWouldRun&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;cause&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">cause</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> is text that could be displayed to users explaining why the operation could not be carried out. <em>Cause</em> is one of the following strings:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center"><em>cause</em> value</th>
<th align="center">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">"proxy"</td>
<td align="center">Carrying out the operation would cause a proxy handler to run.</td>
</tr>
<tr>
<td align="center">"getter"</td>
<td align="center">Carrying out the operation would cause an object property getter to run.</td>
</tr>
<tr>
<td align="center">"setter"</td>
<td align="center">Carrying out the operation would cause an object property setter to run.</td>
</tr>
</tbody>
</table><p>(Taken together, the <code class="docutils literal notranslate"><span class="pre">&quot;threadWouldRun&quot;</span></code> error name and the <em>cause</em> value should allow the debugger to present an appropriately localized error message.)</p>
<div class="section" id="loading-script-sources">
<h3>Loading Script Sources<a class="headerlink" href="#loading-script-sources" title="Permalink to this headline">¶</a></h3>
<p>To get a snapshot of all sources currently loaded by the thread actor, the client can send the following packet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">to</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">threadActorID</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s2">&quot;sources&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The response packet has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">from</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">threadActorID</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">sources</span><span class="p">:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">sourceForm1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">sourceForm2</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">sourceFormN</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>Where each <em>sourceForm</em> has the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">actor</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActorID</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="n">url</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceURL</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="n">isBlackBoxed</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">isBlackBoxed</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>sourceActorID</em> is the source actor’s id</p></li>
<li><p><em>sourceURL</em> is the URL of the source represented by the source actor</p></li>
<li><p><em>isBlackBoxed</em> is a boolean specifying whether the source actor’s ‘black-boxed’ flag is set. See <a class="reference external" href="#black-boxing-sources">Black Boxing Sources</a>.</p></li>
</ul>
<p>Each source actor exists throughout the thread’s whole lifetime.</p>
<p>To get the contents of a source, send the corresponding source actor the following packet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">to</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActorID</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s2">&quot;source&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>And the source actor replies with a packet of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">from</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActorID</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">contentsOfSource</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>contentsOfSource</em> is a grip representing the string of source code: either a JSON string, or a long string grip. (See <a class="reference external" href="#grips">Grips</a> for a description of long string grips.)</p>
<div class="section" id="black-boxing-sources">
<h4>Black-Boxing Sources<a class="headerlink" href="#black-boxing-sources" title="Permalink to this headline">¶</a></h4>
<p>When debugging a web application that uses large off-the-shelf JavaScript libraries, it may help the developer focus on their own code to treat such libraries as “black boxes”, whose internal details are omitted or simplified in the user interface. For example, the user interface could display a sub-chain of stack frames within a black-boxed library as a single element; breakpoints set in a black-boxed library could be disabled; and so on.</p>
<p>Each source actor has a ‘black-boxed’ flag, and understands requests to set and clear the flag. When a source actor is black-boxed, the debugger does not pause when it hits breakpoints or <code class="docutils literal notranslate"><span class="pre">debugger</span></code> statements inside that source. If pausing on exceptions is enabled and an exception is thrown inside a black-boxed source, the debugger does not pause until the stack has unwound to a frame in a source that is not black-boxed.</p>
<p>Thread actors still list black-boxed source actors in <code class="docutils literal notranslate"><span class="pre">&quot;sources&quot;</span></code> replies; and include stack frames running black-boxed code in <code class="docutils literal notranslate"><span class="pre">&quot;frames&quot;</span></code> requests. However, each <em>sourceForm</em> includes an <code class="docutils literal notranslate"><span class="pre">&quot;isBlackBoxed&quot;</span></code> property, giving the client all the information it needs to implement the black-boxing behavior in the user interface.</p>
<p>To set a source actor’s ‘black-boxed’ flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;blackbox&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <em>sourceActor</em> responds with a blank response on success:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActor</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Or an error response on failure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">reason</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>To clear a source actor’s ‘black-boxed’ flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;unblackbox&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>And once again, the <em>sourceActor</em> responds with a blank response on success:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActor</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Or an error response on failure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sourceActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">reason</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="listing-stack-frames">
<h3>Listing Stack Frames<a class="headerlink" href="#listing-stack-frames" title="Permalink to this headline">¶</a></h3>
<p>To inspect the thread’s JavaScript stack, the client can send the following request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;frames&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">start</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">count</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">count</span></code> properties are optional. If present, <em>start</em> gives the number of the youngest stack frame the reply should describe, where the youngest frame on the stack is frame number zero; if absent, <em>start</em> is taken to be zero. If present, <em>count</em> specifies the maximum number of frames the reply should describe; if absent, it is taken to be infinity. (Clients should probably avoid sending <code class="docutils literal notranslate"><span class="pre">frames</span></code> requests with no <em>count</em>, to avoid being flooded by frames from unbounded recursion.)</p>
<p>The thread replies as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;frames&quot;</span><span class="p">:[</span><span class="o">&lt;</span><span class="n">frame</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>where each <em>frame</em> has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">depth</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;this&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">this</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><em>actor</em> is the name of an actor representing this frame;</p></li>
<li><p><em>depth</em> is the number of this frame, starting with zero for the youngest frame on the stack;</p></li>
<li><p><em>type</em> is a string indicating what sort of frame this is; and</p></li>
<li><p><em>this</em> is a grip on the value of <code class="docutils literal notranslate"><span class="pre">this</span></code> for this call.</p></li>
</ul>
<p>The frame may have other properties, depending on <em>type</em>.</p>
<p>All actors mentioned in the frame or grips appearing in the frame (<em>actor</em>, <em>callee</em>, <em>environment</em>, and so on) are parented by the thread actor.</p>
<div class="section" id="global-code-frames">
<h4>Global Code Frames<a class="headerlink" href="#global-code-frames" title="Permalink to this headline">¶</a></h4>
<p>A frame for global code has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">depth</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;global&quot;</span><span class="p">,</span>
  <span class="s2">&quot;this&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">this</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;where&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;source&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">source</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;environment&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">environment</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><em>location</em> is the source location of the current point of execution in the global code (see <a class="reference external" href="#source-locations">Source Locations</a>);</p></li>
<li><p><em>environment</em> is a value representing the lexical environment of the current point of execution (see <a class="reference external" href="#lexical-environments">Lexical Environments</a>);</p></li>
<li><p><em>source</em> is a source form as described in <a class="reference external" href="#loading-script-sources">Loading Script Sources</a></p></li>
</ul>
<p>and other properties are as above.</p>
</div>
<div class="section" id="function-call-frames">
<h4>Function Call Frames<a class="headerlink" href="#function-call-frames" title="Permalink to this headline">¶</a></h4>
<p>A frame for an ordinary JavaScript function call has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">depth</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;call&quot;</span><span class="p">,</span> <span class="s2">&quot;this&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">this</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;where&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;environment&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">environment</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;callee&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">callee</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;arguments&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">arguments</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><em>callee</em> is a grip on the function value being called;</p></li>
<li><p><em>arguments</em> is an array of grips on the actual values passed to the function;</p></li>
</ul>
<p>and other properties are as above.</p>
<p>If the callee is a host function, or a function scoped to some global other than the one to which we are attached, the <code class="docutils literal notranslate"><span class="pre">&quot;where&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;environment&quot;</span></code> properties are absent.</p>
<p>The argument list may be incomplete or inaccurate, for various reasons. If the program has assigned to its formal parameters, the original values passed may have been lost, and compiler optimizations may drop some argument values.</p>
</div>
<div class="section" id="eval-frames">
<h4>Eval Frames<a class="headerlink" href="#eval-frames" title="Permalink to this headline">¶</a></h4>
<p>A frame for a call to <code class="docutils literal notranslate"><span class="pre">eval</span></code> has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">depth</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;eval&quot;</span><span class="p">,</span> <span class="s2">&quot;this&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">this</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;where&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;environment&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">environment</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where the properties are as defined above.</p>
</div>
<div class="section" id="client-evaluation-frames">
<h4>Client Evaluation Frames<a class="headerlink" href="#client-evaluation-frames" title="Permalink to this headline">¶</a></h4>
<p>When the client evaluates an expression with an <code class="docutils literal notranslate"><span class="pre">clientEvaluate</span></code> packet, the evaluation appears on the stack as a special kind of frame, of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">depth</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;clientEvaluate&quot;</span><span class="p">,</span> <span class="s2">&quot;this&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">this</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;where&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;environment&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">environment</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where the properties are as defined above. In this case, <em>where</em> will be a location inside the expression provided by the debugger.</p>
</div>
</div>
<div class="section" id="popping-stack-frames">
<h3>Popping Stack Frames<a class="headerlink" href="#popping-stack-frames" title="Permalink to this headline">¶</a></h3>
<p>The client can remove frames from the stack by sending a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">frameActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;pop&quot;</span><span class="p">,</span> <span class="s2">&quot;completionValue&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">completion</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>frameActor</em> is the actor representing the stack frame to pop, and <em>completion</em> is a <a class="reference external" href="#completion-values">completion value</a> describing how the frame should appear to have finished execution. All younger stack frames are also popped. The thread remains paused. The frame actor will reply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">frameActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;watches&quot;</span><span class="p">:[</span><span class="o">&lt;</span><span class="n">watchActor</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>where each <em>watchActor</em> is the name of a frame pop watch actor that has been triggered in the process of popping the given frame. If no frame pop watches are triggered, the <code class="docutils literal notranslate"><span class="pre">watches</span></code> property may be omitted.</p>
<p><em>TODO: specify the error to return if the frame cannot be popped — can host (C++) function frames be popped?</em></p>
</div>
<div class="section" id="evaluating-source-language-expressions">
<h3>Evaluating Source-Language Expressions<a class="headerlink" href="#evaluating-source-language-expressions" title="Permalink to this headline">¶</a></h3>
<p>To evaluate a source-language expression in a thread, the client sends a specialized <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> packet of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;clientEvaluate&quot;</span><span class="p">,</span> <span class="s2">&quot;expression&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">frame</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This resumes the thread just as an ordinary <code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code> packet does, but, rather than continuing execution where the pause took place, has the thread begin evaluation of the source-language expression given by <em>expr</em>, a string. The evaluation takes place in a new <a class="reference external" href="#client-evaluation-frames">Client Evaluation Frame</a>, pushed on top of <em>thread</em>’s current stack, using the environment of <em>frame</em>. <em>Frame</em> must be a live actor for one of <em>thread</em>’s frames, and the given frame must be one from which we can retrieve a lexical environment; that is, it must not be the frame for a call to a non-debuggee function. When evaluation of <em>expr</em> completes, the client will report a <code class="docutils literal notranslate"><span class="pre">clientEvaluate</span></code> pause containing the expression’s value.</p>
<p>If evaluating <em>expr</em> completes abruptly, this outcome is still reported via an <code class="docutils literal notranslate"><span class="pre">clientEvaluated</span></code> pause, so it is not necessary for the client to take explicit steps to catch exceptions thrown by the expression.</p>
<p>If <em>frame</em> is not the name of an actor for a frame currently on <em>thread</em>’s stack, the thread actor sends a reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;unknownFrame&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> provides any details that would be helpful to the debugger developers. In this case, the thread’s state is unaffected.</p>
<p>If <em>frame</em> is not a frame whose environment we can access, the thread actor sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;notDebuggee&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> provides further appropriate details.</p>
<p>If the client sends a <code class="docutils literal notranslate"><span class="pre">&quot;clientEvaluate&quot;</span></code> packet to a thread that is not in the <strong>Paused</strong> state, the actor sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;wrongState&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>message</em> details which state the thread was in instead (to make debugging debuggers easier). In this case, the thread’s state is unaffected.</p>
<p><em>TODO: evaluate with given grips bound to given identifiers</em></p>
</div>
</div>
<div class="section" id="lexical-environments">
<h2>Lexical Environments<a class="headerlink" href="#lexical-environments" title="Permalink to this headline">¶</a></h2>
<p>A lexical environment (written as <em>environment</em> in packet descriptions) records the identifier bindings visible at a particular point in the program. An environment has one of the following forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">object</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">parentEnvironment</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents a scope chain element whose identifier bindings reflect the properties of <em>object</em> (a grip). This could be the global object (<code class="docutils literal notranslate"><span class="pre">window</span></code> in a browser), or a DOM element (for event handler content attributes, which have the input element, form, and document on their scope chain along with the <code class="docutils literal notranslate"><span class="pre">window</span></code>).</p>
<p><em>Actor</em> is the name of an actor representing this lexical environment. The requests it can answer are described below.</p>
<p><em>ParentEnvironment</em> is a lexical environment describing the next enclosing environment; the <code class="docutils literal notranslate"><span class="pre">parent</span></code> property is omitted on the outermost environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">function</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;bindings&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">bindings</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">parentEnvironment</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents the variable environment created by a call to <em>function</em> (a grip). <em>Bindings</em> describes the bindings in scope, including the function’s arguments, the <code class="docutils literal notranslate"><span class="pre">arguments</span></code> object, and local <code class="docutils literal notranslate"><span class="pre">var</span></code> and function bindings; its form is described in detail below. The other properties are as described above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;with&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">object</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">parentEnvironment</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents an environment introduced by a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement whose operand is <em>object</em> (a grip). The other properties are as described above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;bindings&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">bindings</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">parentEnvironment</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This represents an environment introduced by a <code class="docutils literal notranslate"><span class="pre">let</span></code> block, <code class="docutils literal notranslate"><span class="pre">for-in</span></code> statement, <code class="docutils literal notranslate"><span class="pre">catch</span></code> block, or the like. The properties are as described above.</p>
<p>A <em>bindings</em> value has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;arguments&quot;</span><span class="p">:[</span> <span class="p">{</span> <span class="n">name</span><span class="p">:</span><span class="o">&lt;</span><span class="n">descriptor</span><span class="o">&gt;</span> <span class="p">},</span> <span class="o">...</span> <span class="p">],</span>
  <span class="s2">&quot;variables&quot;</span><span class="p">:{</span> <span class="n">name</span><span class="p">:</span><span class="o">&lt;</span><span class="n">descriptor</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>Each <em>name</em> is the name of a bound identifier, as a string. Each <em>descriptor</em> is a <a class="reference external" href="#property-descriptors">property descriptor</a> for the variable, presenting the variable’s value as the descriptor’s <code class="docutils literal notranslate"><span class="pre">&quot;value&quot;</span></code> property, and the variable’s mutability as the descriptor’s <code class="docutils literal notranslate"><span class="pre">&quot;writable&quot;</span></code> property. The descriptor’s <code class="docutils literal notranslate"><span class="pre">&quot;configurable&quot;</span></code> property reflects whether the environment supports deleting and adding variables. Each descriptor’s <code class="docutils literal notranslate"><span class="pre">&quot;enumerable&quot;</span></code> property is <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;arguments&quot;</span></code> list appears only in bindings for <code class="docutils literal notranslate"><span class="pre">&quot;function&quot;</span></code> environments. It lists the arguments in the order they appear in the function’s definition. (The same name may appear several times in the list, as permitted by JavaScript; the name’s last appearance is the one in scope in the function.)</p>
<p>Note that language implementations may omit some environment records from a function’s scope if it can determine that the function would not use them. This means that it may be impossible for a debugger to find all the variables that ought to be in scope.</p>
<p>To fully enumerate the bindings introduced by any lexical environment, the client can send a request of the following form to the environment’s actor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">envActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;bindings&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The actor will reply as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">envActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;bindings&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">bindings</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Note that this request elicits a <code class="docutils literal notranslate"><span class="pre">&quot;threadWouldRun&quot;</span></code> error reply when <em>envActor</em> refers to an object environment whose object is a proxy.</p>
<p>To change the value of a variable bound in a particular lexical environment, the client can send a request to the environment’s actor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">envActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;assign&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This changes the value of the identifier whose name is <em>name</em> (a string) to that represented by <em>value</em> (a grip). The actor will reply as follows, simply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">envActor</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>If the named identifier is immutable, the actor will send an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">envActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;immutableBinding&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">message</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>If <em>envActor</em> refers to an object environment whose object is a proxy, or whose property named <em>name</em> has a setter function, this request elicits a <code class="docutils literal notranslate"><span class="pre">&quot;threadWouldRun&quot;</span></code> error reply.</p>
<div class="section" id="lexical-environment-examples">
<h3>Lexical Environment Examples<a class="headerlink" href="#lexical-environment-examples" title="Permalink to this headline">¶</a></h3>
<p>For example, if we have the following JavaScript code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">function</span> <span class="n">g</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;value of z&quot;</span><span class="p">;</span>
    <span class="n">alert</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>we set a breakpoint on the line containing the call to <code class="docutils literal notranslate"><span class="pre">alert</span></code>, and then evaluate the expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="s2">&quot;argument to f&quot;</span><span class="p">)(</span><span class="s2">&quot;argument to g&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>then we would hit that breakpoint, eliciting a packet like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;paused&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">pauseActor</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;why&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;breakpoint&quot;</span><span class="p">,</span> <span class="s2">&quot;actors&quot;</span><span class="p">:[</span><span class="o">&lt;</span><span class="n">breakpointActor</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">},</span>
  <span class="s2">&quot;frame&quot;</span><span class="p">:{</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">frameActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;call&quot;</span><span class="p">,</span> <span class="s2">&quot;where&quot;</span><span class="p">:{</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;sample.js&quot;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span><span class="mi">3</span> <span class="p">},</span>
            <span class="s2">&quot;environment&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gFrameActor</span><span class="o">&gt;</span><span class="p">,</span>
                            <span class="s2">&quot;function&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;Function&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gActor</span><span class="o">&gt;</span> <span class="p">},</span>
                            <span class="s2">&quot;functionName&quot;</span><span class="p">:</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;bindings&quot;</span><span class="p">:{</span> <span class="n">arguments</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;argument to g&quot;</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="s2">&quot;false&quot;</span><span class="p">,</span>
                                                               <span class="s2">&quot;writable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="n">true</span> <span class="p">}</span> <span class="p">}</span> <span class="p">]</span> <span class="p">},</span>
                            <span class="s2">&quot;parent&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">fFrameActor</span><span class="o">&gt;</span><span class="p">,</span>
                                       <span class="s2">&quot;function&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;Function&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">fActor</span><span class="o">&gt;</span> <span class="p">},</span>
                                       <span class="s2">&quot;functionName&quot;</span><span class="p">:</span><span class="s2">&quot;f&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;bindings&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="n">arguments</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;argument to f&quot;</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="s2">&quot;false&quot;</span><span class="p">,</span>
                                                                    <span class="s2">&quot;writable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="n">true</span> <span class="p">}</span> <span class="p">}</span> <span class="p">],</span>
                                                     <span class="n">variables</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;value of z&quot;</span><span class="p">,</span> <span class="s2">&quot;configurable&quot;</span><span class="p">:</span><span class="s2">&quot;false&quot;</span><span class="p">,</span>
                                                                         <span class="s2">&quot;writable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span> <span class="s2">&quot;enumerable&quot;</span><span class="p">:</span><span class="n">true</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
                                       <span class="s2">&quot;parent&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">globalCodeActor</span><span class="o">&gt;</span><span class="p">,</span>
                                                  <span class="s2">&quot;object&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;Global&quot;</span><span class="p">,</span>
                                                             <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">globalObjectActor</span><span class="o">&gt;</span> <span class="p">}</span>
                                                <span class="p">}</span>
                                     <span class="p">}</span>
                          <span class="p">},</span>
                       <span class="s2">&quot;callee&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;calleeName&quot;</span><span class="p">:</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
            <span class="s2">&quot;this&quot;</span><span class="p">:{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;Function&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">gActor</span><span class="o">&gt;</span> <span class="p">},</span>
            <span class="s2">&quot;arguments&quot;</span><span class="p">:[</span><span class="s2">&quot;argument to g&quot;</span><span class="p">]</span>
          <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can see here the three nested environment forms, starting with the <code class="docutils literal notranslate"><span class="pre">environment</span></code> property of the top stack frame, reported in the pause:</p>
<ul class="simple">
<li><p>The first environment form shows the environment record created by the call to <code class="docutils literal notranslate"><span class="pre">g</span></code>, with the string <code class="docutils literal notranslate"><span class="pre">&quot;argument</span> <span class="pre">to</span> <span class="pre">g&quot;</span></code> passed as the value of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></li>
<li><p>Because <code class="docutils literal notranslate"><span class="pre">g</span></code> is nested within <code class="docutils literal notranslate"><span class="pre">f</span></code>, each function object generated for <code class="docutils literal notranslate"><span class="pre">g</span></code> captures the environment of a call to the enclosing function <code class="docutils literal notranslate"><span class="pre">f</span></code>.  Thus, the next thing on <code class="docutils literal notranslate"><span class="pre">g</span></code>’s scope chain is an environment form for the call to <code class="docutils literal notranslate"><span class="pre">f</span></code>, where <code class="docutils literal notranslate"><span class="pre">&quot;argument</span> <span class="pre">to</span> <span class="pre">f&quot;</span></code> was passed as the vale of <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
<li><p>Because <code class="docutils literal notranslate"><span class="pre">f</span></code> is a top-level function, the (only) function object for <code class="docutils literal notranslate"><span class="pre">f</span></code> closes over the global object. This is the “type”:”object” environment shown as the parent of <code class="docutils literal notranslate"><span class="pre">f</span></code>’s environment record.</p></li>
<li><p>Because the global object is at the end of the scope chain, its environment form has no <code class="docutils literal notranslate"><span class="pre">parent</span></code> property.</p></li>
</ul>
</div>
</div>
<div class="section" id="breakpoints">
<h2>Breakpoints<a class="headerlink" href="#breakpoints" title="Permalink to this headline">¶</a></h2>
<p>While a thread is paused, a client can set breakpoints in the thread’s code by sending requests of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;setBreakpoint&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>location</em> is a <a class="reference external" href="#source-locations">source location</a>. If the thread is able to establish a breakpoint at the given location, it replies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;actualLocation&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">actualLocation</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <em>actor</em> is an actor representing the breakpoint (a child of the thread actor), and <em>actualLocation</em> is the location at which the breakpoint was really set. If <em>location</em> and <em>actualLocation</em> are the same, then the <code class="docutils literal notranslate"><span class="pre">actualLocation</span></code> property can be omitted.</p>
<p>If the thread cannot find the script referred to in <em>location</em>, it sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;noScript&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>If <em>location</em> refers to a line and column at which the given script has no program code, and no reasonable alternative location can be chosen (say, by skipping forward), then the thread sends an error reply of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;noCodeAtLineColumn&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>To delete a breakpoint, the client can send the breakpoint’s actor a message of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">breakpointActor</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;delete&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>to which the breakpoint actor will reply, simply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">breakpointActor</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This closes communications with <em>breakpointActor</em>.</p>
</div>
<div class="section" id="event-listeners">
<h2>Event Listeners<a class="headerlink" href="#event-listeners" title="Permalink to this headline">¶</a></h2>
<p>To request a list of all the event listeners and event handlers (see <a class="reference external" href="https://developer.mozilla.org/docs/Web/Guide/DOM/Events/Event_handlers#Definitions">DOM Event Handlers</a> for definitions of the two terms) attached to the page, the client sends a request of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;eventListeners&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The thread replies with a response of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">thread</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;listeners&quot;</span><span class="p">:[</span> <span class="o">&lt;</span><span class="n">listener</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>Such requests can be sent when the thread is either paused or running. A <em>listener</em> value has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;node&quot;</span><span class="p">:{</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">node</span><span class="o">-</span><span class="n">selector</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&gt;</span> <span class="p">},</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;capturing&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">capturing</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;allowsUntrusted&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">allowsUntrusted</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;inSystemEventGroup&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">inSystemEventGroup</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;isEventHandler&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">isEventHandler</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s2">&quot;function&quot;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">function</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The values for these properties are:</p>
<p><em><strong>node-selector</strong></em></p>
<p>A unique CSS selector of the DOM element on which the event handler is attached, or <code class="docutils literal notranslate"><span class="pre">&quot;window&quot;</span></code> if the handler is attached on the window.</p>
<p><em><strong>node</strong></em></p>
<p>A grip on the DOM element on which the event handler is attached.</p>
<p><em><strong>type</strong></em></p>
<p>The type of the DOM event as specified in the DOM specification (see <a class="reference external" href="https://developer.mozilla.org/docs/XPCOM_Interface_Reference/nsIEventListenerInfo#Attributes">nsIEventListenerInfo</a>).</p>
<p><em><strong>capturing</strong></em></p>
<p>A boolean flag indicating whether the event listener is in capture mode (see <a class="reference external" href="https://developer.mozilla.org/docs/XPCOM_Interface_Reference/nsIEventListenerInfo#Attributes">nsIEventListenerInfo</a>).</p>
<p><em><strong>allowsUntrusted</strong></em></p>
<p>A boolean flag that indicates whether the listener allows untrusted events (see <a class="reference external" href="https://developer.mozilla.org/docs/XPCOM_Interface_Reference/nsIEventListenerInfo#Attributes">nsIEventListenerInfo</a>).</p>
<p><em><strong>inSystemEventGroup</strong></em></p>
<p>A boolean flag that indicates whether or not the event listener is in the system event group (see <a class="reference external" href="https://developer.mozilla.org/docs/XPCOM_Interface_Reference/nsIEventListenerInfo#Attributes">nsIEventListenerInfo</a>).</p>
<p><em><strong>isEventHandler</strong></em></p>
<p>A boolean flag indicating whether this is an event handler or an event listener (see <a class="reference external" href="https://developer.mozilla.org/docs/Web/Guide/DOM/Events/Event_handlers#Definitions">DOM Event Handlers</a> for definitions of the two terms). For HTML attribute handlers or assignments to WebIDL properties this flag would be true.</p>
<p><em><strong>function</strong></em></p>
<p>A grip on the function object.</p>
</div>
<div class="section" id="stream-transport">
<h2>Stream Transport<a class="headerlink" href="#stream-transport" title="Permalink to this headline">¶</a></h2>
<p>The debugging protocol is specified in terms of packets exchanged between a client and server, where each packet is either a JSON text or a block of bytes (a “bulk data” packet). The protocol does not specify any particular mechanism for carrying packets from one party to the other. Implementations may choose whatever transport they like, as long as packets arrive reliably, undamaged, and in order.</p>
<p>This section describes the Mozilla Remote Debugging Protocol Stream Transport, a transport layer suitable for carrying Mozilla debugging protocol packets over a reliable, ordered byte stream, like a TCP/IP stream or a pipe. Debugger user interfaces can use it to exchange packets with debuggees in other processes (say, for debugging Firefox chrome code), or on other machines (say, for debugging Firefox OS apps running on a phone or tablet).</p>
<p>(The Stream Transport is not the only transport used by Mozilla. For example, when using Firefox’s built-in script debugger, the client and server are in the same process, so for efficiency they use a transport that simply exchanges the JavaScript objects corresponding to the JSON texts specified by the protocol, and avoid serializing packets altogether.)</p>
<div class="section" id="id1">
<h3>Packets<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Once the underlying byte stream is established, transport participants may immediately begin sending packets, using the forms described here. The transport requires no initial handshake or setup, and no shutdown exchange: the first bytes on the stream in each direction are those of the first packet, if any; the last bytes on the stream in each direction are the final bytes of the last packet sent, if any.</p>
<p>The transport defines two types of packets: JSON and bulk data.</p>
<div class="section" id="json-packets">
<h4>JSON Packets<a class="headerlink" href="#json-packets" title="Permalink to this headline">¶</a></h4>
<p>A JSON packet has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">length</span><span class="p">:</span><span class="n">JSON</span>
</pre></div>
</div>
<p>where <em>length</em> is a series of decimal ASCII digits, <em>JSON</em> is a well-formed JSON text (as defined in <a class="reference external" href="http://www.ietf.org/rfc/rfc4627.txt">RFC 4627</a>) encoded in UTF-8, and <em>length</em>, interpreted as a number, is the length of <em>JSON</em> in bytes.</p>
</div>
<div class="section" id="bulk-data-packets">
<h4>Bulk Data Packets<a class="headerlink" href="#bulk-data-packets" title="Permalink to this headline">¶</a></h4>
<p>A bulk data packet has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bulk</span> <span class="n">actor</span> <span class="nb">type</span> <span class="n">length</span><span class="p">:</span><span class="n">data</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p>The keyword <code class="docutils literal notranslate"><span class="pre">bulk</span></code> is encoded in ASCII, and the spaces are always exactly one ASCII space</p></li>
<li><p><em>actor</em> is a sequence of Unicode characters, encoded in UTF-8, containing no spaces or colons</p></li>
<li><p><em>type</em> is a sequence of Unicode characters, encoded in UTF-8, containing no spaces or colons</p></li>
<li><p><em>length</em> is a sequence of decimal ASCII digits</p></li>
<li><p><em>data</em> is a sequence of bytes whose length is <em>length</em> interpreted as a number</p></li>
</ul>
<p>The <em>actor</em> field is the name of the actor sending or receiving the packet. (Actors are server-side entities, so if the packet was sent by the client, <em>actor</em> names the recipient; and if the packet was sent by the server, <em>actor</em> names the sender.) The protocol imposes the same syntactic restrictions on actor names that we require here.</p>
<p>Which actor names are valid at any given point in an exchange is established by the remote debugging protocol.</p>
<p>The <em>type</em> field defines the type of the packet, which may be used with the actor name to route the packet to its destination properly. The protocol provides more detail about the type, which remains in effect here.</p>
<p>The content of a bulk data packet is exactly the sequence of bytes appearing as <em>data</em>. Data is not UTF-8 text.</p>
</div>
</div>
<div class="section" id="stream-requirements">
<h3>Stream Requirements<a class="headerlink" href="#stream-requirements" title="Permalink to this headline">¶</a></h3>
<p>The Stream Transport requires the underlying stream to have the following properties:</p>
<ul class="simple">
<li><p>It must be <strong>transparent</strong>: each transmitted byte is carried to the recipient without modification. Bytes whose values are ASCII control characters or fall outside the range of ASCII altogether must be carried unchanged; line terminators are left alone.</p></li>
<li><p>It must be <strong>reliable</strong>: every transmitted byte makes it to the recipient, or else the connection is dropped altogether. Errors introduced by hardware, say, must be detected and corrected, or at least reported (and the connection dropped). The Stream Transport includes no checksums of its own; those are the stream’s responsibility. (So, for example, a plain serial line is not suitable for use as an underlying stream.)</p></li>
<li><p>It must be <strong>ordered</strong>: bytes are received in the same order they are transmitted, and bytes are not duplicated. (UDP packets, for example, may be duplicated or arrive out of order.)</p></li>
</ul>
<p>TCP/IP streams and USB streams meet these requirements.</p>
</div>
<div class="section" id="implementation-notes">
<h3>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="constant-overhead-bulk-data">
<h4>Constant-Overhead Bulk Data<a class="headerlink" href="#constant-overhead-bulk-data" title="Permalink to this headline">¶</a></h4>
<p>Mozilla added bulk data packets to the protocol to let devices with limited memory upload performance profiling and other large data sets more efficiently. Profiling data sets need to be as large as possible, as larger data sets can cover a longer period of time or more frequent samples. However, converting a large data set to a JavaScript object, converting that object to a JSON text, and sending the text over the connection entails making several temporary complete copies of the data; on small devices, this limits how much data the profiler can collect. Avoiding these temporary copies would allow small devices to collect and transmit larger profile data sets. Since it seemed likely that other sorts of tools would need to exchange large binary blocks efficiently as well, we wanted a solution usable by all protocol participants, rather than one tailored to the profiler’s specific case.</p>
<p>In our implementation of this Stream Transport, when a participant wishes to transmit a bulk data packet, it provides the actor name, the type, the data’s length in bytes, and a callback function. When the underlying stream is ready to send more data, the transport writes the packet’s <code class="docutils literal notranslate"><span class="pre">bulk</span> <span class="pre">actor</span> <span class="pre">type</span> <span class="pre">length:</span></code> header, and then passes the underlying <code class="docutils literal notranslate"><span class="pre">nsIOutputStream</span></code> to the callback, which then writes the packet’s data portion directly to the stream. Similarly, when a participant receives a bulk data packet, the transport parses the header, and then passes the actor name, type, and the transport’s underlying <code class="docutils literal notranslate"><span class="pre">nsIInputStream</span></code> to a callback function, which consumes the data directly. Thus, while the callback functions may well use fixed-size buffers to send and receive data, the transport imposes no overhead proportional to the full size of the data.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="client-api.html" class="btn btn-neutral float-right" title="Client API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../frontend/csp.html" class="btn btn-neutral float-left" title="Current DevTools CSP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>